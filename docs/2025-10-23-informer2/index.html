<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Kubernetes Informer 机制详解
  #


  一、架构原理
  #

Kubernetes 的 Informer 机制是一个高效的客户端缓存系统，用于减少对 API Server 的直接请求压力。其核心架构包含以下组件： 1

  核心组件说明
  #

1. Reflector（反射器）

执行 LIST 操作获取资源的初始状态
执行 WATCH 操作持续监听资源变化
处理 &ldquo;resourceVersion 过期&rdquo; 错误，通过 watch bookmarks 优化重连 2

2. DeltaFIFO（增量先进先出队列）

存储 Reflector 和本地缓存之间的变化（Delta）
每个对象的 key 对应一个 Deltas 切片
支持 Added、Updated、Deleted、Replaced、Sync 五种变化类型 3 4

3. Indexer（索引器/本地缓存）

维护资源对象的本地缓存
提供索引功能加速查询
最终一致性保证 5

4. SharedProcessor（共享处理器）

将事件通知分发给多个事件处理器
每个 listener 有独立的缓冲区和 goroutine 6


  二、SharedInformer 接口与实现
  #


  接口定义
  #

SharedInformer 提供了以下关键方法： 7

  核心实现
  #

sharedIndexInformer 是 SharedIndexInformer 的主要实现： 8"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-10-23-informer2/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-10-23 informer模式2"><meta property="og:description" content="Kubernetes Informer 机制详解 # 一、架构原理 # Kubernetes 的 Informer 机制是一个高效的客户端缓存系统，用于减少对 API Server 的直接请求压力。其核心架构包含以下组件： 1
核心组件说明 # 1. Reflector（反射器）
执行 LIST 操作获取资源的初始状态 执行 WATCH 操作持续监听资源变化 处理 “resourceVersion 过期” 错误，通过 watch bookmarks 优化重连 2 2. DeltaFIFO（增量先进先出队列）
存储 Reflector 和本地缓存之间的变化（Delta） 每个对象的 key 对应一个 Deltas 切片 支持 Added、Updated、Deleted、Replaced、Sync 五种变化类型 3 4 3. Indexer（索引器/本地缓存）
维护资源对象的本地缓存 提供索引功能加速查询 最终一致性保证 5 4. SharedProcessor（共享处理器）
将事件通知分发给多个事件处理器 每个 listener 有独立的缓冲区和 goroutine 6 二、SharedInformer 接口与实现 # 接口定义 # SharedInformer 提供了以下关键方法： 7
核心实现 # sharedIndexInformer 是 SharedIndexInformer 的主要实现： 8"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-10-23 informer模式2 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-10-23-informer2/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.62e641c9f3322f2ad7718686ee65b5b68950f3de9d8614456185deb4d99bbc55.js integrity="sha256-YuZByfMyLyrXcYaG7mW1tolQ896dhhRFYYXetNmbvFU=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-9-29-vercel%E5%88%9B%E5%A7%8B%E4%BA%BA%E5%AF%B9%E8%AF%9D/>2025-9-29 Vercel创始人对话</a></li><li><a href=/docs/2025-9-28-spec-workflow-mcp/>2025-9-28 spec-workflow-mcp</a></li><li><a href=/docs/2025-9-28-chrome-mcp-tools/>2025-9-28 chrome-devtools-mcp</a></li><li><a href=/docs/2025-9-19-%E7%90%86%E8%A7%A3/>2025-9-19 理解</a></li><li><a href=/docs/2025-9-10-%E6%8F%90%E7%A4%BA%E8%AF%8D/>2025-9-10 提示词</a></li><li><a href=/docs/2025-9-9-music/>2025-9-09 music资源</a></li><li><a href=/docs/2025-8-29-%E8%A1%A8%E5%8D%95%E5%88%B0%E9%9B%86%E7%BE%A4/>2025-8-28 表单到集群</a></li><li><a href=/docs/2025-6-27-geminicli/>2025-6-27 geminicli</a></li><li><a href=/docs/2025-6-23-ingress-nginx-contrller-%E5%88%86%E6%9E%90/>2025-6-23 ingress nginx contrller 内存使用过高分析</a></li><li><a href=/docs/2025-6-20-oom/>2025-6-20 oom排查思路</a></li><li><a href=/docs/2025-6-16-fire%E8%A7%84%E5%88%99/>2025-6-16 Cursor RIPER-5规则</a></li><li><a href=/docs/2025-6-12-karmada/>2025-6-12 karmada介绍</a></li><li><a href=/docs/2025-6-12-flutter%E8%A7%84%E5%88%99/>2025-6-12 flutter规则</a></li><li><a href=/docs/2025-6-10-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91/>2025-6-10 独立开发</a></li><li><a href=/docs/2025-5-21-ingress%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/>2025-5-21 主Ingress副本变为0后报503问题分析</a></li><li><a href=/docs/2025-5-7-%E6%8E%A5%E5%8D%95app/>2025-5-07 接单app设计</a></li><li><a href=/docs/2025-5-7-%E5%A5%BD%E5%BF%83%E6%80%81-app/>2025-5-07 好心态app</a></li><li><a href=/docs/2025-4-28-cursor-agent-%E6%8F%90%E7%A4%BA%E5%99%A8/>2025-4-28 cursor agent 提示器</a></li><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-4-16 自研k8s平台</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-4-16 sleep睡眠应用</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-4-16 paas开发记录</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-4-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-4-16 BOSS直聘自动投递</a></li><li><a href=/docs/2025-4-14-github%E6%8E%A8%E9%80%81/>2025-4-14 github推送</a></li><li><a href=/docs/2025-3-30-metallb/>2025-3-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-3-24 自我介绍</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics高可用架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics 架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics 和 Thanos 对比</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanos高可用架构</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanos架构</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w pod压测复盘</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 火山云迁移工程师面试记录</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-3-14 vivo面试</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s删除pod或deployment的流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s创建pod流程图详解</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-2-28 prometheus面试题</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 面试0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 高级运维面试题-linux部分</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 中级运维面试题</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224面试</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 面试0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 面试0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 面试2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8s题目</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 面试0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 面试2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 美国码农计划</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 美国码农薪酬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8s组件</a></li><li><a href=/docs/2025-10-27-reconciler%E6%A8%A1%E5%BC%8F/>2025-10-27 informer模式3</a></li><li><a href=/docs/2025-10-23-informer3/>2025-10-23 informer模式3</a></li><li><a href=/docs/2025-10-23-informer2/ class=active>2025-10-23 informer模式2</a></li><li><a href=/docs/2025-10-23-informer/>2025-10-23 informer模式</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeasz部署k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 顶级devops工具大盘点</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 清理docker镜像</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 构建容器镜像利器buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 是技术大神还是基础架构部的祸害</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 搭个日志手机系统不香吗</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 我只想做技术 走技术路线</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 常见linux运维面试题</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 大厂总结nginx高并发优化笔记</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 史上最牛jenkins pipeline流水线详解</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEG与istio集成</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginx如何解决惊群效应</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctl检测集群pod间连通性</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linux运维工程师50个常见面试题</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linux系统性能优化 七个实战经验</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awk文本处理器 8个案例</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruise原地升级解析</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8S面试题</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8s背后service是如何工作的</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8S的最后一块拼图</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istio部署</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfile定制专属镜像</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33款gitops与devops主流系统</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linux面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linux运维面试题</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8s面试题</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruise详细解释以及原地升级及全链路灰度发布方案</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8S之ingress-nginx原理及配置</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 使用cloudflare(CF)搭建dockerhub代理</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 单master单etcd改造为3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 面试总结</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 如何为K8S保驾护航</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8S如何获得 IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_status_update.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_control.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_pod_control.go源码解读</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8S调度器 extender.go 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8S控制器之sync.go 同步 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8S控制器之rollback.go 回滚 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8S控制器之recreate.go 重建 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8S控制器之 scheduler.go 调度器 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8S控制器之 rolling.go 滚动更新 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8S控制器之 progress.go 进度 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8S控制器之 deployment_controller.go源码解读</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S 调度器 scheduler_one.go 源码解读</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 彻悟容器网络</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 面试用 Golang 手撸 LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 自动屏蔽IP攻击</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 离线安装kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 磁盘数据恢复</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 清理残留的calico网络插件</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 流量何处来何处去</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 极大提高工作效率的 Linux 命令</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 文学的故乡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 搞懂K8S鉴权</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 容器网络原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 容器的文件系统 OverlayFS 原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 容器原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 容器内的 1 号进程</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 容器中域名解析以及不同dnspolicy对域名解析的影响</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 如何调试 crash 容器的网络</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 如何使用tekton快速搭建CI/CD平台</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 大规模并发下如何加快 Pod 启动速度</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 使用kubernees leases 轻松实现leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 二进制部署K8S加节点操作</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 两张图全面理解K8S原理</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 ssl证书自签发</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheus企业级监控使用总结</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 原理</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux 性能优化大全</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes 证书详解(鉴权)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes 证书详解(认证)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes 源码结构</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekey添加新节点</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8S面试宝典</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8S面试大全</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8s运维之清理磁盘</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8S调试POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8S的POD类型</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8s应用的最佳实践</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8S命令指南</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8S原地升级</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S 探针原理</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S 开发可不止 CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebs原理</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chart和repo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanel网络</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCD稳定性及性能优化实践</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCD备份</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Docker重要的网络知识点</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfile的copy和add的区别</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNS之光</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd 基本操作</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNI插件选型</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go 架构</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go 四种客户端</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICD思考</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calico网络自定义</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acme自动更新证书</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16个概念带你入门 Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 面试0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600条最强linux命令总结</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16张硬核图解k8s网络</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8s之kubelet源码解读</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 面试</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8s流量链路剖析</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S 流量链路剖析</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSI剖析演进</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNI剖析演进</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSI剖析演进</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNI剖析演进</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 面试</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8s架构师面试大全</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 使用 OpenFunction 在任何基础设施上运行无服务器工作负载</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 离线安装集群</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 操作系统说明</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 快速指南</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 开始使用 cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 多架构支持</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 公有云上部署</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 个性化集群参数配置</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router 网络组件</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl 命令行介绍</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB 负载均衡部署</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico 配置 BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-安装集群主要插件</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S 集群存储</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-安装网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-安装kube-ovn网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-安装flannel网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-安装cilium网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-安装calico网络组件</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-安装etcd集群</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-集群规划和基础参数设定</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-安装kube_node节点</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-安装kube_master节点</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-安装容器运行时</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-创建证书和环境准备</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 思考</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/2025-4-20-%E6%80%A7%E5%90%8C%E6%84%8Fapp/>2025 4 20 性同意app</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-10-23 informer模式2</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#一架构原理>一、架构原理</a><ul><li><a href=#核心组件说明>核心组件说明</a></li></ul></li><li><a href=#二sharedinformer-接口与实现>二、SharedInformer 接口与实现</a><ul><li><a href=#接口定义>接口定义</a></li><li><a href=#核心实现>核心实现</a></li><li><a href=#运行机制>运行机制</a></li><li><a href=#事件处理>事件处理</a></li></ul></li><li><a href=#三云平台使用-informer-的设计模式>三、云平台使用 Informer 的设计模式</a><ul><li><a href=#1-使用-sharedinformerfactory>1. 使用 SharedInformerFactory</a></li><li><a href=#2-标准-controller-模式>2. 标准 Controller 模式</a></li><li><a href=#3-简化示例>3. 简化示例</a></li></ul></li><li><a href=#四云平台设计建议>四、云平台设计建议</a><ul><li><a href=#架构设计要点>架构设计要点</a></li><li><a href=#最佳实践>最佳实践</a></li><li><a href=#代码实现示例结构>代码实现示例结构</a></li></ul></li><li><a href=#五关键注意事项>五、关键注意事项</a></li><li><a href=#notes>Notes</a><ul><li><a href=#citations>Citations</a></li></ul></li></ul><ul><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#the-two-api-requests-involved>The Two API Requests Involved</a><ul><li><a href=#1-list-request-initial-synchronization>1. LIST Request (Initial Synchronization)</a></li><li><a href=#2-watch-request-continuous-updates>2. WATCH Request (Continuous Updates)</a></li></ul></li><li><a href=#specific-implementations-for-pods-deployments-and-services>Specific Implementations for Pods, Deployments, and Services</a><ul><li><a href=#pod-informer>Pod Informer</a></li><li><a href=#deployment-informer>Deployment Informer</a></li><li><a href=#service-informer>Service Informer</a></li></ul></li><li><a href=#api-request-details>API Request Details</a><ul><li><a href=#url-construction>URL Construction</a></li><li><a href=#request-patterns>Request Patterns</a></li></ul></li><li><a href=#how-complete-information-including-status-is-retrieved>How Complete Information (Including Status) is Retrieved</a></li><li><a href=#notes-1>Notes</a><ul><li><a href=#citations-1>Citations</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=kubernetes-informer-机制详解>Kubernetes Informer 机制详解
<a class=anchor href=#kubernetes-informer-%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3>#</a></h1><h2 id=一架构原理>一、架构原理
<a class=anchor href=#%e4%b8%80%e6%9e%b6%e6%9e%84%e5%8e%9f%e7%90%86>#</a></h2><p>Kubernetes 的 Informer 机制是一个高效的客户端缓存系统，用于减少对 API Server 的直接请求压力。其核心架构包含以下组件： <a href=#0-0>1</a></p><h3 id=核心组件说明>核心组件说明
<a class=anchor href=#%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6%e8%af%b4%e6%98%8e>#</a></h3><p><strong>1. Reflector（反射器）</strong></p><ul><li>执行 LIST 操作获取资源的初始状态</li><li>执行 WATCH 操作持续监听资源变化</li><li>处理 &ldquo;resourceVersion 过期&rdquo; 错误，通过 watch bookmarks 优化重连 <a href=#0-1>2</a></li></ul><p><strong>2. DeltaFIFO（增量先进先出队列）</strong></p><ul><li>存储 Reflector 和本地缓存之间的变化（Delta）</li><li>每个对象的 key 对应一个 Deltas 切片</li><li>支持 Added、Updated、Deleted、Replaced、Sync 五种变化类型 <a href=#0-2>3</a> <a href=#0-3>4</a></li></ul><p><strong>3. Indexer（索引器/本地缓存）</strong></p><ul><li>维护资源对象的本地缓存</li><li>提供索引功能加速查询</li><li>最终一致性保证 <a href=#0-4>5</a></li></ul><p><strong>4. SharedProcessor（共享处理器）</strong></p><ul><li>将事件通知分发给多个事件处理器</li><li>每个 listener 有独立的缓冲区和 goroutine <a href=#0-5>6</a></li></ul><h2 id=二sharedinformer-接口与实现>二、SharedInformer 接口与实现
<a class=anchor href=#%e4%ba%8csharedinformer-%e6%8e%a5%e5%8f%a3%e4%b8%8e%e5%ae%9e%e7%8e%b0>#</a></h2><h3 id=接口定义>接口定义
<a class=anchor href=#%e6%8e%a5%e5%8f%a3%e5%ae%9a%e4%b9%89>#</a></h3><p>SharedInformer 提供了以下关键方法： <a href=#0-6>7</a></p><h3 id=核心实现>核心实现
<a class=anchor href=#%e6%a0%b8%e5%bf%83%e5%ae%9e%e7%8e%b0>#</a></h3><p><code>sharedIndexInformer</code> 是 SharedIndexInformer 的主要实现： <a href=#0-7>8</a></p><h3 id=运行机制>运行机制
<a class=anchor href=#%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6>#</a></h3><p>当调用 <code>Run</code> 方法时，informer 会：</p><ol><li>创建 DeltaFIFO 队列</li><li>构建 Controller 配置</li><li>启动 Reflector 执行 LIST/WATCH</li><li>启动处理器分发事件 <a href=#0-8>9</a></li></ol><h3 id=事件处理>事件处理
<a class=anchor href=#%e4%ba%8b%e4%bb%b6%e5%a4%84%e7%90%86>#</a></h3><p>当资源变化时，会触发相应的事件处理： <a href=#0-9>10</a></p><h2 id=三云平台使用-informer-的设计模式>三、云平台使用 Informer 的设计模式
<a class=anchor href=#%e4%b8%89%e4%ba%91%e5%b9%b3%e5%8f%b0%e4%bd%bf%e7%94%a8-informer-%e7%9a%84%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f>#</a></h2><h3 id=1-使用-sharedinformerfactory>1. 使用 SharedInformerFactory
<a class=anchor href=#1-%e4%bd%bf%e7%94%a8-sharedinformerfactory>#</a></h3><p>SharedInformerFactory 是推荐的方式，它可以：</p><ul><li>为多个 informer 共享缓存</li><li>减少内存占用和网络开销</li><li>统一管理 informer 生命周期 <a href=#0-10>11</a> <a href=#0-11>12</a></li></ul><h3 id=2-标准-controller-模式>2. 标准 Controller 模式
<a class=anchor href=#2-%e6%a0%87%e5%87%86-controller-%e6%a8%a1%e5%bc%8f>#</a></h3><p>参考 sample-controller 的实现，标准模式包括：</p><p><strong>控制器结构定义：</strong> <a href=#0-12>13</a></p><p><strong>初始化和事件处理器注册：</strong> <a href=#0-13>14</a></p><p><strong>运行流程：</strong> <a href=#0-14>15</a></p><h3 id=3-简化示例>3. 简化示例
<a class=anchor href=#3-%e7%ae%80%e5%8c%96%e7%a4%ba%e4%be%8b>#</a></h3><p>对于简单场景，可以参考这个基础示例： <a href=#0-15>16</a></p><h2 id=四云平台设计建议>四、云平台设计建议
<a class=anchor href=#%e5%9b%9b%e4%ba%91%e5%b9%b3%e5%8f%b0%e8%ae%be%e8%ae%a1%e5%bb%ba%e8%ae%ae>#</a></h2><h3 id=架构设计要点>架构设计要点
<a class=anchor href=#%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1%e8%a6%81%e7%82%b9>#</a></h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph TB
    subgraph &#34;云平台控制器&#34;
        A[SharedInformerFactory] --&gt; B[Pod Informer]
        A --&gt; C[Service Informer]
        A --&gt; D[自定义资源 Informer]
        B --&gt; E[Event Handler]
        C --&gt; E
        D --&gt; E
        E --&gt; F[WorkQueue]
        F --&gt; G[Worker Pool]
        G --&gt; H[业务逻辑处理]
        H --&gt; I[API Server 更新]
    end
    
    subgraph &#34;Kubernetes API Server&#34;
        J[API Server]
    end
    
    B -.LIST/WATCH.-&gt; J
    C -.LIST/WATCH.-&gt; J
    D -.LIST/WATCH.-&gt; J
    I -.UPDATE/CREATE.-&gt; J
</code></pre><h3 id=最佳实践>最佳实践
<a class=anchor href=#%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><p><strong>使用 WorkQueue 解耦事件和处理逻辑</strong></p><ul><li>Event Handler 只负责将对象 key 加入队列</li><li>Worker 从队列取出 key，通过 Lister 获取最新状态</li><li>支持重试和限流</li></ul></li><li><p><strong>等待缓存同步</strong></p><ul><li>使用 <code>cache.WaitForCacheSync()</code> 确保初始数据加载完成</li><li>避免在缓存未同步时做决策</li></ul></li><li><p><strong>Lister 优先于直接 API 调用</strong></p><ul><li>读操作使用 Lister 从本地缓存获取</li><li>只在写操作时调用 API Server</li><li>大幅减少 API Server 负载</li></ul></li><li><p><strong>合理设置 Resync Period</strong></p><ul><li>定期触发完整的对账逻辑</li><li>处理可能遗漏的事件</li><li>一般设置为 10-30 分钟</li></ul></li><li><p><strong>使用 TransformFunc 优化内存</strong></p><ul><li>移除不需要的字段</li><li>减少内存占用</li></ul></li><li><p><strong>错误处理和重试</strong></p><ul><li>实现 WatchErrorHandler 处理连接断开</li><li>使用限流队列避免过载</li></ul></li></ol><h3 id=代码实现示例结构>代码实现示例结构
<a class=anchor href=#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e7%a4%ba%e4%be%8b%e7%bb%93%e6%9e%84>#</a></h3><p>对于云平台控制器，推荐以下结构：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Controller 初始化：
</span></span><span style=display:flex><span>├── 创建 Clientset
</span></span><span style=display:flex><span>├── 创建 SharedInformerFactory
</span></span><span style=display:flex><span>├── 获取各资源的 Informer
</span></span><span style=display:flex><span>├── 注册 EventHandler（仅加入队列）
</span></span><span style=display:flex><span>├── 保存 Lister 和 HasSynced 引用
</span></span><span style=display:flex><span>└── 创建 WorkQueue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>运行阶段：
</span></span><span style=display:flex><span>├── 启动 InformerFactory
</span></span><span style=display:flex><span>├── 等待缓存同步
</span></span><span style=display:flex><span>├── 启动 Worker 协程池
</span></span><span style=display:flex><span>└── 处理队列中的事件
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Worker 处理逻辑：
</span></span><span style=display:flex><span>├── 从队列获取 key
</span></span><span style=display:flex><span>├── 通过 Lister 读取最新状态
</span></span><span style=display:flex><span>├── 执行业务逻辑
</span></span><span style=display:flex><span>├── 调用 API 更新资源
</span></span><span style=display:flex><span>└── 处理错误和重试
</span></span></code></pre></div><h2 id=五关键注意事项>五、关键注意事项
<a class=anchor href=#%e4%ba%94%e5%85%b3%e9%94%ae%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>#</a></h2><ol><li><p><strong>事件处理必须快速返回</strong></p><ul><li>EventHandler 不应执行耗时操作</li><li>将实际处理逻辑移到 Worker 中 <a href=#0-16>17</a></li></ul></li><li><p><strong>理解最终一致性</strong></p><ul><li>Informer 缓存是最终一致的</li><li>可能看到旧版本或中间状态</li><li>设计时需要考虑幂等性</li></ul></li><li><p><strong>ResourceVersion 处理</strong></p><ul><li>用于检测对象是否真正变化</li><li>避免处理 Resync 事件 <a href=#0-17>18</a></li></ul></li></ol><h2 id=notes>Notes
<a class=anchor href=#notes>#</a></h2><p>Informer 机制是 Kubernetes 控制器模式的核心，通过本地缓存和事件驱动大幅提升了系统性能和可扩展性。对于云平台开发，遵循标准的 SharedInformerFactory + WorkQueue + Lister 模式，可以构建高效、可靠的控制器。建议参考 sample-controller 的完整实现作为起点，并根据具体业务需求进行调整。</p><p>关键要点：</p><ul><li>使用 SharedInformerFactory 共享缓存</li><li>EventHandler 只加队列不做业务处理</li><li>Worker 通过 Lister 读取最新状态</li><li>等待缓存同步后再开始处理</li><li>实现合适的错误处理和重试机制</li></ul><h3 id=citations>Citations
<a class=anchor href=#citations>#</a></h3><p><strong>File:</strong> staging/src/k8s.io/client-go/ARCHITECTURE.md (L96-121)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>```mermaid
</span></span><span style=display:flex><span>graph TD
</span></span><span style=display:flex><span>    subgraph &#34;Kubernetes API&#34;
</span></span><span style=display:flex><span>        API_Server[API Server]
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    subgraph &#34;client-go: Informer Mechanism&#34;
</span></span><span style=display:flex><span>        Reflector(&#34;1. Reflector&#34;)
</span></span><span style=display:flex><span>        DeltaFIFO(&#34;2. DeltaFIFO&#34;)
</span></span><span style=display:flex><span>        Indexer[&#34;3. Indexer (Cache)&#34;]
</span></span><span style=display:flex><span>        EventHandlers(&#34;4. Event Handlers&#34;)
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    subgraph &#34;User Code&#34;
</span></span><span style=display:flex><span>        WorkQueue[&#34;5. Work Queue&#34;]
</span></span><span style=display:flex><span>        Controller(&#34;6. Controller&#34;)
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    API_Server -- LIST/WATCH --&gt; Reflector
</span></span><span style=display:flex><span>    Reflector -- Puts changes into --&gt; DeltaFIFO
</span></span><span style=display:flex><span>    DeltaFIFO -- Is popped by internal loop, which updates --&gt; Indexer
</span></span><span style=display:flex><span>    Indexer -- Update triggers --&gt; EventHandlers
</span></span><span style=display:flex><span>    EventHandlers -- Adds key to --&gt; WorkQueue
</span></span><span style=display:flex><span>    WorkQueue -- Is processed by --&gt; Controller
</span></span><span style=display:flex><span>    Controller -- Reads from cache via Lister --&gt; Indexer
</span></span></code></pre></div><pre tabindex=0><code>
**File:** staging/src/k8s.io/client-go/tools/cache/reflector.go (L85-147)
```go
// Reflector watches a specified resource and causes all changes to be reflected in the given store.
type Reflector struct {
	// name identifies this reflector. By default, it will be a file:line if possible.
	name string
	// The name of the type we expect to place in the store. The name
	// will be the stringification of expectedGVK if provided, and the
	// stringification of expectedType otherwise. It is for display
	// only, and should not be used for parsing or comparison.
	typeDescription string
	// An example object of the type we expect to place in the store.
	// Only the type needs to be right, except that when that is
	// `unstructured.Unstructured` the object&#39;s `&#34;apiVersion&#34;` and
	// `&#34;kind&#34;` must also be right.
	expectedType reflect.Type
	// The GVK of the object we expect to place in the store if unstructured.
	expectedGVK *schema.GroupVersionKind
	// The destination to sync up with the watch source
	store ReflectorStore
	// listerWatcher is used to perform lists and watches.
	listerWatcher ListerWatcherWithContext
	// backoff manages backoff of ListWatch
	backoffManager wait.BackoffManager
	resyncPeriod   time.Duration
	// minWatchTimeout defines the minimum timeout for watch requests.
	minWatchTimeout time.Duration
	// clock allows tests to manipulate time
	clock clock.Clock
	// paginatedResult defines whether pagination should be forced for list calls.
	// It is set based on the result of the initial list call.
	paginatedResult bool
	// lastSyncResourceVersion is the resource version token last
	// observed when doing a sync with the underlying store
	// it is thread safe, but not synchronized with the underlying store
	lastSyncResourceVersion string
	// isLastSyncResourceVersionUnavailable is true if the previous list or watch request with
	// lastSyncResourceVersion failed with an &#34;expired&#34; or &#34;too large resource version&#34; error.
	isLastSyncResourceVersionUnavailable bool
	// lastSyncResourceVersionMutex guards read/write access to lastSyncResourceVersion
	lastSyncResourceVersionMutex sync.RWMutex
	// Called whenever the ListAndWatch drops the connection with an error.
	watchErrorHandler WatchErrorHandlerWithContext
	// WatchListPageSize is the requested chunk size of initial and resync watch lists.
	// If unset, for consistent reads (RV=&#34;&#34;) or reads that opt-into arbitrarily old data
	// (RV=&#34;0&#34;) it will default to pager.PageSize, for the rest (RV != &#34;&#34; &amp;&amp; RV != &#34;0&#34;)
	// it will turn off pagination to allow serving them from watch cache.
	// NOTE: It should be used carefully as paginated lists are always served directly from
	// etcd, which is significantly less efficient and may lead to serious performance and
	// scalability problems.
	WatchListPageSize int64
	// ShouldResync is invoked periodically and whenever it returns `true` the Store&#39;s Resync operation is invoked
	ShouldResync func() bool
	// MaxInternalErrorRetryDuration defines how long we should retry internal errors returned by watch.
	MaxInternalErrorRetryDuration time.Duration
	// useWatchList if turned on instructs the reflector to open a stream to bring data from the API server.
	// Streaming has the primary advantage of using fewer server&#39;s resources to fetch data.
	//
	// The old behaviour establishes a LIST request which gets data in chunks.
	// Paginated list is less efficient and depending on the actual size of objects
	// might result in an increased memory consumption of the APIServer.
	//
	// See https://github.com/kubernetes/enhancements/tree/master/keps/sig-api-machinery/3157-watch-list#design-details
	useWatchList bool
}
</code></pre><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/delta_fifo.go (L63-146)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// DeltaFIFO is like FIFO, but differs in two ways.  One is that the</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// accumulator associated with a given object&#39;s key is not that object</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// but rather a Deltas, which is a slice of Delta values for that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// object.  Applying an object to a Deltas means to append a Delta</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// except when the potentially appended Delta is a Deleted and the</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deltas already ends with a Deleted.  In that case the Deltas does</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// not grow, although the terminal Deleted will be replaced by the new</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deleted if the older Deleted&#39;s object is a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DeletedFinalStateUnknown.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The other difference is that DeltaFIFO has two additional ways that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// an object can be applied to an accumulator: Replaced and Sync.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// If EmitDeltaTypeReplaced is not set to true, Sync will be used in</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// replace events for backwards compatibility.  Sync is used for periodic</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// resync events.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DeltaFIFO is a producer-consumer queue, where a Reflector is</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// intended to be the producer, and the consumer is whatever calls</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the Pop() method.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DeltaFIFO solves this use case:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//   - You want to process every object change (delta) at most once.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//   - When you process an object, you want to see everything</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//     that&#39;s happened to it since you last processed it.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//   - You want to process the deletion of some of the objects.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//   - You might want to periodically reprocess objects.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DeltaFIFO&#39;s Pop(), Get(), and GetByKey() methods return</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// interface{} to satisfy the Store/Queue interfaces, but they</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// will always return an object of type Deltas. List() returns</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the newest object from each accumulator in the FIFO.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A DeltaFIFO&#39;s knownObjects KeyListerGetter provides the abilities</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// to list Store keys and to get objects by Store key.  The objects in</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// question are called &#34;known objects&#34; and this set of objects</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// modifies the behavior of the Delete, Replace, and Resync methods</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// (each in a different way).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A note on threading: If you call Pop() in parallel from multiple</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// threads, you could end up with multiple threads processing slightly</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// different versions of the same object.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DeltaFIFO</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// lock/cond protects access to &#39;items&#39; and &#39;queue&#39;.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>lock</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cond</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Cond</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// `items` maps a key to a Deltas.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Each such Deltas has at least one Delta.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>items</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>Deltas</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// `queue` maintains FIFO order of keys for consumption in Pop().</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// There are no duplicates in `queue`.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// A key is in `queue` if and only if it is in `items`.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>queue</span> []<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// populated is true if the first batch of items inserted by Replace() has been populated</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// or Delete/Add/Update/AddIfNotPresent was called first.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>populated</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// initialPopulationCount is the number of items inserted by the first call of Replace()</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initialPopulationCount</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// keyFunc is used to make the key used for queued item</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// insertion and retrieval, and should be deterministic.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>keyFunc</span> <span style=color:#a6e22e>KeyFunc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// knownObjects list keys that are &#34;known&#34; --- affecting Delete(),</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Replace(), and Resync()</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>knownObjects</span> <span style=color:#a6e22e>KeyListerGetter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Used to indicate a queue is closed so a control loop can exit when a queue is empty.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Currently, not used to gate any of CRUD operations.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>closed</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// emitDeltaTypeReplaced is whether to emit the Replaced or Sync</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// DeltaType when Replace() is called (to preserve backwards compat).</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>emitDeltaTypeReplaced</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Called with every object if non-nil.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>transformer</span> <span style=color:#a6e22e>TransformFunc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// logger is a per-instance logger. This gets chosen when constructing</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the instance, with klog.Background() as default.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/delta_fifo.go (L166-198)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// DeltaType is the type of a change (addition, deletion, etc)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DeltaType</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Change type definition</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Added</span>   <span style=color:#a6e22e>DeltaType</span> = <span style=color:#e6db74>&#34;Added&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Updated</span> <span style=color:#a6e22e>DeltaType</span> = <span style=color:#e6db74>&#34;Updated&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Deleted</span> <span style=color:#a6e22e>DeltaType</span> = <span style=color:#e6db74>&#34;Deleted&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Replaced is emitted when we encountered watch errors and had to do a</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// relist. We don&#39;t know if the replaced object has changed.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// NOTE: Previous versions of DeltaFIFO would use Sync for Replace events</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// as well. Hence, Replaced is only emitted when the option</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// EmitDeltaTypeReplaced is true.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Replaced</span> <span style=color:#a6e22e>DeltaType</span> = <span style=color:#e6db74>&#34;Replaced&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Sync is for synthetic events during a periodic resync.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Sync</span> <span style=color:#a6e22e>DeltaType</span> = <span style=color:#e6db74>&#34;Sync&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Delta is a member of Deltas (a list of Delta objects) which</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// in its turn is the type stored by a DeltaFIFO. It tells you what</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// change happened, and the object&#39;s state after* that change.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// [*] Unless the change is a deletion, and then you&#39;ll get the final</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// state of the object before it was deleted.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Delta</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Type</span>   <span style=color:#a6e22e>DeltaType</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Object</span> <span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deltas is a list of one or more &#39;Delta&#39;s to an individual object.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The oldest delta is at index 0, the newest delta is the last one.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Deltas</span> []<span style=color:#a6e22e>Delta</span>
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L40-93)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// SharedInformer provides eventually consistent linkage of its</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// clients to the authoritative state of a given collection of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// objects.  An object is identified by its API group, kind/resource,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// namespace (if any), and name; the `ObjectMeta.UID` is not part of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// an object&#39;s ID as far as this contract is concerned.  One</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SharedInformer provides linkage to objects of a particular API</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// group and kind/resource.  The linked object collection of a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SharedInformer may be further restricted to one namespace (if</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// applicable) and/or by label selector and/or field selector.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The authoritative state of an object is what apiservers provide</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// access to, and an object goes through a strict sequence of states.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// An object state is either (1) present with a ResourceVersion and</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// other appropriate content or (2) &#34;absent&#34;.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A SharedInformer maintains a local cache --- exposed by GetStore(),</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// by GetIndexer() in the case of an indexed informer, and possibly by</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// machinery involved in creating and/or accessing the informer --- of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the state of each relevant object.  This cache is eventually</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// consistent with the authoritative state.  This means that, unless</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// prevented by persistent communication problems, if ever a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// particular object ID X is authoritatively associated with a state S</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// then for every SharedInformer I whose collection includes (X, S)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// eventually either (1) I&#39;s cache associates X with S or a later</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// state of X, (2) I is stopped, or (3) the authoritative state</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// service for X terminates.  To be formally complete, we say that the</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// absent state meets any restriction by label selector or field</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// selector.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// For a given informer and relevant object ID X, the sequence of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// states that appears in the informer&#39;s cache is a subsequence of the</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// states authoritatively associated with X.  That is, some states</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// might never appear in the cache but ordering among the appearing</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// states is correct.  Note, however, that there is no promise about</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ordering between states seen for different objects.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The local cache starts out empty, and gets populated and updated</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// during `Run()`.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As a simple example, if a collection of objects is henceforth</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// unchanging, a SharedInformer is created that links to that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// collection, and that SharedInformer is `Run()` then that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SharedInformer&#39;s cache eventually holds an exact copy of that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// collection (unless it is stopped too soon, the authoritative state</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// service ends, or communication problems between the two</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// persistently thwart achievement).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As another simple example, if the local cache ever holds a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// non-absent state for some object ID and the object is eventually</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// removed from the authoritative state then eventually the object is</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// removed from the local cache (unless the SharedInformer is stopped</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// too soon, the authoritative state service ends, or communication</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// problems persistently thwart the desired result).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L130-134)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// A client must process each notification promptly; a SharedInformer</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// is not engineered to deal well with a large backlog of</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// notifications to deliver.  Lengthy processing should be passed off</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// to something else, for example through a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// `client-go/util/workqueue`.</span>
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L139-237)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SharedInformer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// AddEventHandler adds an event handler to the shared informer using</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the shared informer&#39;s resync period.  Events to a single handler are</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// delivered sequentially, but there is no coordination between</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// different handlers.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It returns a registration handle for the handler that can be used to</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// remove the handler again, or to tell if the handler is synced (has</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// seen every item in the initial list).</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Contextual logging: AddEventHandlerWithOptions together with a logger in the options should be used instead of AddEventHandler in code which supports contextual logging.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AddEventHandler</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>ResourceEventHandler</span>) (<span style=color:#a6e22e>ResourceEventHandlerRegistration</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// AddEventHandlerWithResyncPeriod adds an event handler to the</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// shared informer with the requested resync period; zero means</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// this handler does not care about resyncs.  The resync operation</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// consists of delivering to the handler an update notification</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// for every object in the informer&#39;s local cache; it does not add</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// any interactions with the authoritative storage.  Some</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// informers do no resyncs at all, not even for handlers added</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// with a non-zero resyncPeriod.  For an informer that does</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// resyncs, and for each handler that requests resyncs, that</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// informer develops a nominal resync period that is no shorter</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// than the requested period but may be longer.  The actual time</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// between any two resyncs may be longer than the nominal period</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// because the implementation takes time to do work and there may</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// be competing load and scheduling noise.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It returns a registration handle for the handler that can be used to remove</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the handler again and an error if the handler cannot be added.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Contextual logging: AddEventHandlerWithOptions together with a logger in the options should be used instead of AddEventHandlerWithResyncPeriod in code which supports contextual logging.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AddEventHandlerWithResyncPeriod</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>ResourceEventHandler</span>, <span style=color:#a6e22e>resyncPeriod</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) (<span style=color:#a6e22e>ResourceEventHandlerRegistration</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// AddEventHandlerWithOptions is a variant of AddEventHandlerWithResyncPeriod where</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// all optional parameters are passed in a struct.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AddEventHandlerWithOptions</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>ResourceEventHandler</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>HandlerOptions</span>) (<span style=color:#a6e22e>ResourceEventHandlerRegistration</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RemoveEventHandler removes a formerly added event handler given by</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// its registration handle.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This function is guaranteed to be idempotent, and thread-safe.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RemoveEventHandler</span>(<span style=color:#a6e22e>handle</span> <span style=color:#a6e22e>ResourceEventHandlerRegistration</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// GetStore returns the informer&#39;s local cache as a Store.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetStore</span>() <span style=color:#a6e22e>Store</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// GetController is deprecated, it does nothing useful</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetController</span>() <span style=color:#a6e22e>Controller</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Run starts and runs the shared informer, returning after it stops.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The informer will be stopped when stopCh is closed.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Contextual logging: RunWithContext should be used instead of Run in code which uses contextual logging.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Run</span>(<span style=color:#a6e22e>stopCh</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{})
</span></span><span style=display:flex><span>	<span style=color:#75715e>// RunWithContext starts and runs the shared informer, returning after it stops.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The informer will be stopped when the context is canceled.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>RunWithContext</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// HasSynced returns true if the shared informer&#39;s store has been</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// informed by at least one full LIST of the authoritative state</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// of the informer&#39;s object collection.  This is unrelated to &#34;resync&#34;.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Note that this doesn&#39;t tell you if an individual handler is synced!!</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// For that, please call HasSynced on the handle returned by</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// AddEventHandler.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>HasSynced</span>() <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// LastSyncResourceVersion is the resource version observed when last synced with the underlying</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// store. The value returned is not synchronized with access to the underlying store and is not</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// thread-safe.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>LastSyncResourceVersion</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The WatchErrorHandler is called whenever ListAndWatch drops the</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// connection with an error. After calling this handler, the informer</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// will backoff and retry.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The default implementation looks at the error type and tries to log</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the error message at an appropriate level.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// There&#39;s only one handler, so if you call this multiple times, last one</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// wins; calling after the informer has been started returns an error.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The handler is intended for visibility, not to e.g. pause the consumers.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The handler should return quickly - any expensive processing should be</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// offloaded.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Contextual logging: SetWatchErrorHandlerWithContext should be used instead of SetWatchErrorHandler in code which supports contextual logging.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SetWatchErrorHandler</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>WatchErrorHandler</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// SetWatchErrorHandlerWithContext is a variant of SetWatchErrorHandler where</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// the handler is passed an additional context parameter.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SetWatchErrorHandlerWithContext</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>WatchErrorHandlerWithContext</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The TransformFunc is called for each object which is about to be stored.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This function is intended for you to take the opportunity to</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// remove, transform, or normalize fields. One use case is to strip unused</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// metadata fields out of objects to save on RAM cost.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Must be set before starting the informer.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Please see the comment on TransformFunc for more details.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SetTransform</span>(<span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>TransformFunc</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// IsStopped reports whether the informer has already been stopped.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Adding event handlers to already stopped informers is not possible.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// An informer already stopped will never be started again.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>IsStopped</span>() <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L402-452)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// `*sharedIndexInformer` implements SharedIndexInformer and has three</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// main components.  One is an indexed local cache, `indexer Indexer`.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The second main component is a Controller that pulls</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// objects/notifications using the ListerWatcher and pushes them into</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// a DeltaFIFO --- whose knownObjects is the informer&#39;s local cache</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// --- while concurrently Popping Deltas values from that fifo and</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// processing them with `sharedIndexInformer::HandleDeltas`.  Each</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// invocation of HandleDeltas, which is done with the fifo&#39;s lock</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// held, processes each Delta in turn.  For each Delta this both</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// updates the local cache and stuffs the relevant notification into</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the sharedProcessor.  The third main component is that</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// sharedProcessor, which is responsible for relaying those</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// notifications to each of the informer&#39;s clients.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>sharedIndexInformer</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>indexer</span>    <span style=color:#a6e22e>Indexer</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>controller</span> <span style=color:#a6e22e>Controller</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>processor</span>             <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedProcessor</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cacheMutationDetector</span> <span style=color:#a6e22e>MutationDetector</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listerWatcher</span> <span style=color:#a6e22e>ListerWatcher</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// objectType is an example object of the type this informer is expected to handle. If set, an event</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// with an object with a mismatching type is dropped instead of being delivered to listeners.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>objectType</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// objectDescription is the description of this informer&#39;s objects. This typically defaults to</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>objectDescription</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// resyncCheckPeriod is how often we want the reflector&#39;s resync timer to fire so it can call</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// shouldResync to check if any of our listeners need a resync.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resyncCheckPeriod</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// defaultEventHandlerResyncPeriod is the default resync period for any handlers added via</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// AddEventHandler (i.e. they don&#39;t specify one and just want to use the shared informer&#39;s default</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// value).</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>defaultEventHandlerResyncPeriod</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// clock allows for testability</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>clock</span> <span style=color:#a6e22e>clock</span>.<span style=color:#a6e22e>Clock</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>started</span>, <span style=color:#a6e22e>stopped</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>startedLock</span>      <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// blockDeltas gives a way to stop all event distribution so that a late event handler</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// can safely join the shared informer.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>blockDeltas</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Called whenever the ListAndWatch drops the connection with an error.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>watchErrorHandler</span> <span style=color:#a6e22e>WatchErrorHandlerWithContext</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>transform</span> <span style=color:#a6e22e>TransformFunc</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L529-588)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedIndexInformer</span>) <span style=color:#a6e22e>RunWithContext</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleCrashWithContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>FromContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>HasStarted</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Warning: the sharedIndexInformer has started, run more than once is not allowed&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>startedLock</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>startedLock</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fifo</span> <span style=color:#a6e22e>Queue</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>clientgofeaturegate</span>.<span style=color:#a6e22e>FeatureGates</span>().<span style=color:#a6e22e>Enabled</span>(<span style=color:#a6e22e>clientgofeaturegate</span>.<span style=color:#a6e22e>InOrderInformers</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fifo</span> = <span style=color:#a6e22e>NewRealFIFO</span>(<span style=color:#a6e22e>MetaNamespaceKeyFunc</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>indexer</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>transform</span>)
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fifo</span> = <span style=color:#a6e22e>NewDeltaFIFOWithOptions</span>(<span style=color:#a6e22e>DeltaFIFOOptions</span>{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>KnownObjects</span>:          <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>indexer</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>EmitDeltaTypeReplaced</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Transformer</span>:           <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>transform</span>,
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cfg</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Queue</span>:             <span style=color:#a6e22e>fifo</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListerWatcher</span>:     <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>listerWatcher</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ObjectType</span>:        <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>objectType</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ObjectDescription</span>: <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>objectDescription</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>FullResyncPeriod</span>:  <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>resyncCheckPeriod</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ShouldResync</span>:      <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>shouldResync</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Process</span>:                      <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>HandleDeltas</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchErrorHandlerWithContext</span>: <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>watchErrorHandler</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>controller</span> = <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>cfg</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>controller</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>controller</span>).<span style=color:#a6e22e>clock</span> = <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>clock</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>started</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Separate stop context because Processor should be stopped strictly after controller.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Cancelation in the parent context is ignored and all values are passed on,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// including - but not limited to - a logger.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>processorStopCtx</span>, <span style=color:#a6e22e>stopProcessor</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithCancelCause</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithoutCancel</span>(<span style=color:#a6e22e>ctx</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>wait</span>.<span style=color:#a6e22e>Group</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()                                         <span style=color:#75715e>// Wait for Processor to stop</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>stopProcessor</span>(<span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;informer is stopping&#34;</span>)) <span style=color:#75715e>// Tell Processor to stop</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TODO: extend the MutationDetector interface so that it optionally</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// has a RunWithContext method that we can use here.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>StartWithChannel</span>(<span style=color:#a6e22e>processorStopCtx</span>.<span style=color:#a6e22e>Done</span>(), <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>cacheMutationDetector</span>.<span style=color:#a6e22e>Run</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>StartWithContext</span>(<span style=color:#a6e22e>processorStopCtx</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>run</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>startedLock</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>startedLock</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>stopped</span> = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// Don&#39;t want any new listeners</span>
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>RunWithContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L724-769)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedIndexInformer</span>) <span style=color:#a6e22e>HandleDeltas</span>(<span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>isInInitialList</span> <span style=color:#66d9ef>bool</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blockDeltas</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>blockDeltas</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>deltas</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>obj</span>.(<span style=color:#a6e22e>Deltas</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>processDeltas</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>indexer</span>, <span style=color:#a6e22e>deltas</span>, <span style=color:#a6e22e>isInInitialList</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;object given as Process argument is not Deltas&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Conforms to ResourceEventHandler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedIndexInformer</span>) <span style=color:#a6e22e>OnAdd</span>(<span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>isInInitialList</span> <span style=color:#66d9ef>bool</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Invocation of this function is locked under s.blockDeltas, so it is</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// safe to distribute the notification</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>cacheMutationDetector</span>.<span style=color:#a6e22e>AddObject</span>(<span style=color:#a6e22e>obj</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>distribute</span>(<span style=color:#a6e22e>addNotification</span>{<span style=color:#a6e22e>newObj</span>: <span style=color:#a6e22e>obj</span>, <span style=color:#a6e22e>isInInitialList</span>: <span style=color:#a6e22e>isInInitialList</span>}, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Conforms to ResourceEventHandler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedIndexInformer</span>) <span style=color:#a6e22e>OnUpdate</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>isSync</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If is a Sync event, isSync should be true</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If is a Replaced event, isSync is true if resource version is unchanged.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If RV is unchanged: this is a Sync/Replaced event, so isSync is true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>accessor</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>Accessor</span>(<span style=color:#a6e22e>new</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>oldAccessor</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>Accessor</span>(<span style=color:#a6e22e>old</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Events that didn&#39;t change resourceVersion are treated as resync events</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// and only propagated to listeners that requested resync</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>isSync</span> = <span style=color:#a6e22e>accessor</span>.<span style=color:#a6e22e>GetResourceVersion</span>() <span style=color:#f92672>==</span> <span style=color:#a6e22e>oldAccessor</span>.<span style=color:#a6e22e>GetResourceVersion</span>()
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Invocation of this function is locked under s.blockDeltas, so it is</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// safe to distribute the notification</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>cacheMutationDetector</span>.<span style=color:#a6e22e>AddObject</span>(<span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>distribute</span>(<span style=color:#a6e22e>updateNotification</span>{<span style=color:#a6e22e>oldObj</span>: <span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>newObj</span>: <span style=color:#a6e22e>new</span>}, <span style=color:#a6e22e>isSync</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Conforms to ResourceEventHandler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedIndexInformer</span>) <span style=color:#a6e22e>OnDelete</span>(<span style=color:#a6e22e>old</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Invocation of this function is locked under s.blockDeltas, so it is</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// safe to distribute the notification</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>distribute</span>(<span style=color:#a6e22e>deleteNotification</span>{<span style=color:#a6e22e>oldObj</span>: <span style=color:#a6e22e>old</span>}, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/shared_informer.go (L791-804)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// sharedProcessor has a collection of processorListener and can</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// distribute a notification object to its listeners.  There are two</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// kinds of distribute operations.  The sync distributions go to a</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// subset of the listeners that (a) is recomputed in the occasional</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// calls to shouldResync and (b) every listener is initially put in.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The non-sync distributions go to every listener.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>sharedProcessor</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listenersStarted</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listenersLock</span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Map from listeners to whether or not they are currently syncing</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listeners</span> <span style=color:#66d9ef>map</span>[<span style=color:#f92672>*</span><span style=color:#a6e22e>processorListener</span>]<span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>clock</span>     <span style=color:#a6e22e>clock</span>.<span style=color:#a6e22e>Clock</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span>        <span style=color:#a6e22e>wait</span>.<span style=color:#a6e22e>Group</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/informers/factory.go (L54-75)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// SharedInformerOption defines the functional option type for SharedInformerFactory.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SharedInformerOption</span> <span style=color:#66d9ef>func</span>(<span style=color:#f92672>*</span><span style=color:#a6e22e>sharedInformerFactory</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>sharedInformerFactory</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>sharedInformerFactory</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>client</span>           <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>namespace</span>        <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tweakListOptions</span> <span style=color:#a6e22e>internalinterfaces</span>.<span style=color:#a6e22e>TweakListOptionsFunc</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>lock</span>             <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>defaultResync</span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>customResync</span>     <span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>transform</span>        <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>TransformFunc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>informers</span> <span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>SharedIndexInformer</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// startedInformers is used for tracking which informers have been started.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This allows Start() to be called multiple times safely.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>startedInformers</span> <span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// wg tracks how many goroutines were started.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// shuttingDown is true when Shutdown has been called. It may still be running</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// because it needs to wait for goroutines.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>shuttingDown</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/informers/factory.go (L111-142)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// NewSharedInformerFactory constructs a new instance of sharedInformerFactory for all namespaces.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewSharedInformerFactory</span>(<span style=color:#a6e22e>client</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>defaultResync</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) <span style=color:#a6e22e>SharedInformerFactory</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>NewSharedInformerFactoryWithOptions</span>(<span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>defaultResync</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NewFilteredSharedInformerFactory constructs a new instance of sharedInformerFactory.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Listers obtained via this SharedInformerFactory will be subject to the same filters</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// as specified here.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deprecated: Please use NewSharedInformerFactoryWithOptions instead</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewFilteredSharedInformerFactory</span>(<span style=color:#a6e22e>client</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>defaultResync</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>namespace</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#a6e22e>internalinterfaces</span>.<span style=color:#a6e22e>TweakListOptionsFunc</span>) <span style=color:#a6e22e>SharedInformerFactory</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>NewSharedInformerFactoryWithOptions</span>(<span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>defaultResync</span>, <span style=color:#a6e22e>WithNamespace</span>(<span style=color:#a6e22e>namespace</span>), <span style=color:#a6e22e>WithTweakListOptions</span>(<span style=color:#a6e22e>tweakListOptions</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NewSharedInformerFactoryWithOptions constructs a new instance of a SharedInformerFactory with additional options.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewSharedInformerFactoryWithOptions</span>(<span style=color:#a6e22e>client</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>defaultResync</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>SharedInformerOption</span>) <span style=color:#a6e22e>SharedInformerFactory</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>factory</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sharedInformerFactory</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>client</span>:           <span style=color:#a6e22e>client</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>namespace</span>:        <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>NamespaceAll</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>defaultResync</span>:    <span style=color:#a6e22e>defaultResync</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>informers</span>:        make(<span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>SharedIndexInformer</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>startedInformers</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#66d9ef>bool</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>customResync</span>:     make(<span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>]<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Apply all options</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>options</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>factory</span> = <span style=color:#a6e22e>opt</span>(<span style=color:#a6e22e>factory</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>factory</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/sample-controller/controller.go (L68-89)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Controller is the controller implementation for Foo resources</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Controller</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// kubeclientset is a standard kubernetes clientset</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>kubeclientset</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// sampleclientset is a clientset for our own API group</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sampleclientset</span> <span style=color:#a6e22e>clientset</span>.<span style=color:#a6e22e>Interface</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>deploymentsLister</span> <span style=color:#a6e22e>appslisters</span>.<span style=color:#a6e22e>DeploymentLister</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>deploymentsSynced</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>InformerSynced</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>foosLister</span>        <span style=color:#a6e22e>listers</span>.<span style=color:#a6e22e>FooLister</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>foosSynced</span>        <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>InformerSynced</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// workqueue is a rate limited work queue. This is used to queue work to be</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// processed instead of performing it as soon as a change happens. This</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// means we can ensure we only process a fixed amount of resources at a</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// time, and makes it easy to ensure we are never processing the same item</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// simultaneously in two different workers.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>workqueue</span> <span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>TypedRateLimitingInterface</span>[<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ObjectName</span>]
</span></span><span style=display:flex><span>	<span style=color:#75715e>// recorder is an event recorder for recording Event resources to the</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Kubernetes API.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>recorder</span> <span style=color:#a6e22e>record</span>.<span style=color:#a6e22e>EventRecorder</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/sample-controller/controller.go (L92-156)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewController</span>(
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>kubeclientset</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sampleclientset</span> <span style=color:#a6e22e>clientset</span>.<span style=color:#a6e22e>Interface</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>deploymentInformer</span> <span style=color:#a6e22e>appsinformers</span>.<span style=color:#a6e22e>DeploymentInformer</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fooInformer</span> <span style=color:#a6e22e>informers</span>.<span style=color:#a6e22e>FooInformer</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>FromContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create event broadcaster</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Add sample-controller types to the default Kubernetes Scheme so Events can be</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// logged for sample-controller types.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>Must</span>(<span style=color:#a6e22e>samplescheme</span>.<span style=color:#a6e22e>AddToScheme</span>(<span style=color:#a6e22e>scheme</span>.<span style=color:#a6e22e>Scheme</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>V</span>(<span style=color:#ae81ff>4</span>).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Creating event broadcaster&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>eventBroadcaster</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>record</span>.<span style=color:#a6e22e>NewBroadcaster</span>(<span style=color:#a6e22e>record</span>.<span style=color:#a6e22e>WithContext</span>(<span style=color:#a6e22e>ctx</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>eventBroadcaster</span>.<span style=color:#a6e22e>StartStructuredLogging</span>(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>eventBroadcaster</span>.<span style=color:#a6e22e>StartRecordingToSink</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>typedcorev1</span>.<span style=color:#a6e22e>EventSinkImpl</span>{<span style=color:#a6e22e>Interface</span>: <span style=color:#a6e22e>kubeclientset</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Events</span>(<span style=color:#e6db74>&#34;&#34;</span>)})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>recorder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>eventBroadcaster</span>.<span style=color:#a6e22e>NewRecorder</span>(<span style=color:#a6e22e>scheme</span>.<span style=color:#a6e22e>Scheme</span>, <span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>EventSource</span>{<span style=color:#a6e22e>Component</span>: <span style=color:#a6e22e>controllerAgentName</span>})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ratelimiter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>NewTypedMaxOfRateLimiter</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>NewTypedItemExponentialFailureRateLimiter</span>[<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ObjectName</span>](<span style=color:#ae81ff>5</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>, <span style=color:#ae81ff>1000</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>),
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>TypedBucketRateLimiter</span>[<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ObjectName</span>]{<span style=color:#a6e22e>Limiter</span>: <span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>NewLimiter</span>(<span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>Limit</span>(<span style=color:#ae81ff>50</span>), <span style=color:#ae81ff>300</span>)},
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>controller</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Controller</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>kubeclientset</span>:     <span style=color:#a6e22e>kubeclientset</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>sampleclientset</span>:   <span style=color:#a6e22e>sampleclientset</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>deploymentsLister</span>: <span style=color:#a6e22e>deploymentInformer</span>.<span style=color:#a6e22e>Lister</span>(),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>deploymentsSynced</span>: <span style=color:#a6e22e>deploymentInformer</span>.<span style=color:#a6e22e>Informer</span>().<span style=color:#a6e22e>HasSynced</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>foosLister</span>:        <span style=color:#a6e22e>fooInformer</span>.<span style=color:#a6e22e>Lister</span>(),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>foosSynced</span>:        <span style=color:#a6e22e>fooInformer</span>.<span style=color:#a6e22e>Informer</span>().<span style=color:#a6e22e>HasSynced</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>workqueue</span>:         <span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>NewTypedRateLimitingQueue</span>(<span style=color:#a6e22e>ratelimiter</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>recorder</span>:          <span style=color:#a6e22e>recorder</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Setting up event handlers&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Set up an event handler for when Foo resources change</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fooInformer</span>.<span style=color:#a6e22e>Informer</span>().<span style=color:#a6e22e>AddEventHandler</span>(<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ResourceEventHandlerFuncs</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>AddFunc</span>: <span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>enqueueFoo</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>UpdateFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>enqueueFoo</span>(<span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Set up an event handler for when Deployment resources change. This</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// handler will lookup the owner of the given Deployment, and if it is</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// owned by a Foo resource then the handler will enqueue that Foo resource for</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// processing. This way, we don&#39;t need to implement custom logic for</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// handling Deployment resources. More info on this pattern:</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// https://github.com/kubernetes/community/blob/8cafef897a22026d42f5e5bb3f104febe7e29830/contributors/devel/controllers.md</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>deploymentInformer</span>.<span style=color:#a6e22e>Informer</span>().<span style=color:#a6e22e>AddEventHandler</span>(<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ResourceEventHandlerFuncs</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>AddFunc</span>: <span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>handleObject</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>UpdateFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>newDepl</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>new</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>appsv1</span>.<span style=color:#a6e22e>Deployment</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>oldDepl</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>old</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>appsv1</span>.<span style=color:#a6e22e>Deployment</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>newDepl</span>.<span style=color:#a6e22e>ResourceVersion</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>oldDepl</span>.<span style=color:#a6e22e>ResourceVersion</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Periodic resync will send update events for all known Deployments.</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Two different versions of the same Deployment will always have different RVs.</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>handleObject</span>(<span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DeleteFunc</span>: <span style=color:#a6e22e>controller</span>.<span style=color:#a6e22e>handleObject</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>controller</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/sample-controller/controller.go (L158-188)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Run will set up the event handlers for types we are interested in, as well</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// as syncing informer caches and starting workers. It will block until stopCh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// is closed, at which point it will shutdown the workqueue and wait for</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// workers to finish processing their current work items.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span>) <span style=color:#a6e22e>Run</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>workers</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleCrash</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>workqueue</span>.<span style=color:#a6e22e>ShutDown</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>FromContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Start the informer factories to begin populating the informer caches</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Starting Foo controller&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Wait for the caches to be synced before starting workers</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Waiting for informer caches to sync&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>WaitForCacheSync</span>(<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>(), <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>deploymentsSynced</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>foosSynced</span>); !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to wait for caches to sync&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Starting workers&#34;</span>, <span style=color:#e6db74>&#34;count&#34;</span>, <span style=color:#a6e22e>workers</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Launch two workers to process Foo resources</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>workers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>wait</span>.<span style=color:#a6e22e>UntilWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>runWorker</span>, <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Started workers&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Shutting down workers&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/example_test.go (L184-269)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Example_usingInformers</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This example demonstrates the basic pattern for using an informer to watch</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// for changes to Pods. This is a conceptual example; a real controller would</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// have more robust logic and a workqueue.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Configure the client (out-of-cluster for this example).</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>kubeconfig</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>home</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;HOME&#34;</span>); <span style=color:#a6e22e>home</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>kubeconfig</span> = <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>home</span>, <span style=color:#e6db74>&#34;.kube&#34;</span>, <span style=color:#e6db74>&#34;config&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>config</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientcmd</span>.<span style=color:#a6e22e>BuildConfigFromFlags</span>(<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>kubeconfig</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error encountered: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>clientset</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>NewForConfig</span>(<span style=color:#a6e22e>config</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error encountered: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// A SharedInformerFactory provides a shared cache for multiple informers,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// which reduces memory and network overhead.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>factory</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>informers</span>.<span style=color:#a6e22e>NewSharedInformerFactory</span>(<span style=color:#a6e22e>clientset</span>, <span style=color:#ae81ff>10</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>podInformer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>factory</span>.<span style=color:#a6e22e>Core</span>().<span style=color:#a6e22e>V1</span>().<span style=color:#a6e22e>Pods</span>().<span style=color:#a6e22e>Informer</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>podInformer</span>.<span style=color:#a6e22e>AddEventHandler</span>(<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ResourceEventHandlerFuncs</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>AddFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>MetaNamespaceKeyFunc</span>(<span style=color:#a6e22e>obj</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Pod ADDED: %s&#34;</span>, <span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>UpdateFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>oldObj</span>, <span style=color:#a6e22e>newObj</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>MetaNamespaceKeyFunc</span>(<span style=color:#a6e22e>newObj</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Pod UPDATED: %s&#34;</span>, <span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DeleteFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>DeletionHandlingMetaNamespaceKeyFunc</span>(<span style=color:#a6e22e>obj</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Pod DELETED: %s&#34;</span>, <span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error encountered: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Graceful shutdown requires a two-channel pattern.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The first channel, `sigCh`, is used by the `signal` package to send us</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// OS signals (e.g., Ctrl+C). This channel must be of type `chan os.Signal`.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The second channel, `stopCh`, is used to tell the informer factory to</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// stop. The informer factory&#39;s `Start` method expects a channel of type</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// `&lt;-chan struct{}`. It will stop when this channel is closed.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The goroutine below is the &#34;translator&#34; that connects these two channels.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It waits for a signal on `sigCh`, and when it receives one, it closes</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// `stopCh`, which in turn tells the informer factory to shut down.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sigCh</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Signal</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>signal</span>.<span style=color:#a6e22e>Notify</span>(<span style=color:#a6e22e>sigCh</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGINT</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGTERM</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>stopCh</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>sigCh</span>
</span></span><span style=display:flex><span>		close(<span style=color:#a6e22e>stopCh</span>)
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Start the informer.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>factory</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#a6e22e>stopCh</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Wait for the initial cache sync.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>WaitForCacheSync</span>(<span style=color:#a6e22e>stopCh</span>, <span style=color:#a6e22e>podInformer</span>.<span style=color:#a6e22e>HasSynced</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Timed out waiting for caches to sync&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Informer has synced. Watching for Pod events...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Wait for the stop signal.</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>stopCh</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Shutting down...&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=client-go-informer-mechanism-how-it-retrieves-resource-information>Client-Go Informer Mechanism: How It Retrieves Resource Information
<a class=anchor href=#client-go-informer-mechanism-how-it-retrieves-resource-information>#</a></h1><p>The client-go informer mechanism retrieves status and detailed information for Kubernetes resources through a <strong>LIST-then-WATCH pattern</strong> involving two primary API requests. Here&rsquo;s how it works:</p><h2 id=architecture-overview>Architecture Overview
<a class=anchor href=#architecture-overview>#</a></h2><p>The informer mechanism consists of several key components that work together: <a href=#1-0>1</a></p><p>The data flows from the API Server through a <strong>Reflector</strong>, which performs the initial LIST operation and then establishes a WATCH, feeding changes into a <strong>DeltaFIFO</strong> queue, which then updates the local <strong>Indexer (Cache)</strong>.</p><h2 id=the-two-api-requests-involved>The Two API Requests Involved
<a class=anchor href=#the-two-api-requests-involved>#</a></h2><h3 id=1-list-request-initial-synchronization>1. LIST Request (Initial Synchronization)
<a class=anchor href=#1-list-request-initial-synchronization>#</a></h3><p>The Reflector first performs a LIST operation to get a complete snapshot of all resources: <a href=#1-1>2</a></p><p>The LIST implementation retrieves all objects with full details including status: <a href=#1-2>3</a></p><h3 id=2-watch-request-continuous-updates>2. WATCH Request (Continuous Updates)
<a class=anchor href=#2-watch-request-continuous-updates>#</a></h3><p>After the initial LIST, the Reflector establishes a WATCH to receive incremental updates: <a href=#1-3>4</a></p><p>The WATCH mechanism processes events (Added, Modified, Deleted, Bookmark) and updates the local store: <a href=#1-4>5</a></p><h2 id=specific-implementations-for-pods-deployments-and-services>Specific Implementations for Pods, Deployments, and Services
<a class=anchor href=#specific-implementations-for-pods-deployments-and-services>#</a></h2><h3 id=pod-informer>Pod Informer
<a class=anchor href=#pod-informer>#</a></h3><p>For Pods, the informer creates a <code>ListWatch</code> that calls the client&rsquo;s List and Watch methods: <a href=#1-5>6</a></p><h3 id=deployment-informer>Deployment Informer
<a class=anchor href=#deployment-informer>#</a></h3><p>Deployments follow the same pattern: <a href=#1-6>7</a></p><h3 id=service-informer>Service Informer
<a class=anchor href=#service-informer>#</a></h3><p>Services use an identical structure: <a href=#1-7>8</a></p><h2 id=api-request-details>API Request Details
<a class=anchor href=#api-request-details>#</a></h2><h3 id=url-construction>URL Construction
<a class=anchor href=#url-construction>#</a></h3><p>The REST client constructs URLs by joining path components: <a href=#1-8>9</a></p><h3 id=request-patterns>Request Patterns
<a class=anchor href=#request-patterns>#</a></h3><p>For <strong>LIST requests</strong>, the URLs follow these patterns:</p><ul><li>Pods: <code>GET /api/v1/namespaces/{namespace}/pods</code></li><li>Deployments: <code>GET /apis/apps/v1/namespaces/{namespace}/deployments</code></li><li>Services: <code>GET /api/v1/namespaces/{namespace}/services</code></li></ul><p>For <strong>WATCH requests</strong>, the same URLs are used with the <code>watch=true</code> query parameter:</p><ul><li>Pods: <code>GET /api/v1/namespaces/{namespace}/pods?watch=true</code></li><li>Deployments: <code>GET /apis/apps/v1/namespaces/{namespace}/deployments?watch=true</code></li><li>Services: <code>GET /api/v1/namespaces/{namespace}/services?watch=true</code></li></ul><p>The watch request includes additional parameters: <a href=#1-9>10</a></p><h2 id=how-complete-information-including-status-is-retrieved>How Complete Information (Including Status) is Retrieved
<a class=anchor href=#how-complete-information-including-status-is-retrieved>#</a></h2><p>Both LIST and WATCH requests retrieve <strong>complete resource objects</strong>, including all fields such as <code>spec</code>, <code>status</code>, <code>metadata</code>, and any subresources. The API server returns the full object representation by default, not just metadata.</p><p>The <code>ListWatch</code> interface abstracts these operations: <a href=#1-10>11</a></p><p>And the concrete implementation creates functions that call the typed client methods: <a href=#1-11>12</a></p><h2 id=notes-1>Notes
<a class=anchor href=#notes-1>#</a></h2><ul><li>The informer mechanism automatically handles pagination for large LIST results, resource version tracking for resuming watches after disconnection, and exponential backoff for retries.</li><li>Watch bookmarks are used to provide more recent resource versions, allowing more efficient recovery from &ldquo;too old&rdquo; resource version errors.</li><li>All resource types (Pods, Deployments, Services, etc.) use the same underlying mechanism; only the API group/version and resource name differ in the URL paths.</li><li>The complete object (including status) is always returned because the API server&rsquo;s GET and LIST handlers return the full object by default unless specifically requested otherwise through accept headers or field selectors.</li></ul><h3 id=citations-1>Citations
<a class=anchor href=#citations-1>#</a></h3><p><strong>File:</strong> staging/src/k8s.io/client-go/ARCHITECTURE.md (L96-121)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>```mermaid
</span></span><span style=display:flex><span>graph TD
</span></span><span style=display:flex><span>    subgraph &#34;Kubernetes API&#34;
</span></span><span style=display:flex><span>        API_Server[API Server]
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    subgraph &#34;client-go: Informer Mechanism&#34;
</span></span><span style=display:flex><span>        Reflector(&#34;1. Reflector&#34;)
</span></span><span style=display:flex><span>        DeltaFIFO(&#34;2. DeltaFIFO&#34;)
</span></span><span style=display:flex><span>        Indexer[&#34;3. Indexer (Cache)&#34;]
</span></span><span style=display:flex><span>        EventHandlers(&#34;4. Event Handlers&#34;)
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    subgraph &#34;User Code&#34;
</span></span><span style=display:flex><span>        WorkQueue[&#34;5. Work Queue&#34;]
</span></span><span style=display:flex><span>        Controller(&#34;6. Controller&#34;)
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    API_Server -- LIST/WATCH --&gt; Reflector
</span></span><span style=display:flex><span>    Reflector -- Puts changes into --&gt; DeltaFIFO
</span></span><span style=display:flex><span>    DeltaFIFO -- Is popped by internal loop, which updates --&gt; Indexer
</span></span><span style=display:flex><span>    Indexer -- Update triggers --&gt; EventHandlers
</span></span><span style=display:flex><span>    EventHandlers -- Adds key to --&gt; WorkQueue
</span></span><span style=display:flex><span>    WorkQueue -- Is processed by --&gt; Controller
</span></span><span style=display:flex><span>    Controller -- Reads from cache via Lister --&gt; Indexer
</span></span></code></pre></div><pre tabindex=0><code>
**File:** staging/src/k8s.io/client-go/ARCHITECTURE.md (L123-128)
```markdown
A **`Reflector`** performs a `LIST` to get a consistent snapshot of a resource, identified by a
`resourceVersion`. It then starts a `WATCH` from that `resourceVersion` to receive a continuous
stream of subsequent changes. The `Reflector`&#39;s relist/rewatch loop is designed to solve the
**&#34;too old&#34; `resourceVersion` error** by re-listing. To make this recovery more efficient, the
`Reflector` consumes **watch bookmarks** from the server, which provide a more recent
`resourceVersion` to restart from.
</code></pre><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/reflector.go (L386-434)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ListAndWatch first lists all items and get the resource version at the moment of call,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and then use the resource version to watch.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// It returns error if ListAndWatch didn&#39;t even try to initialize watch.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Contextual logging: ListAndWatchWithContext should be used instead of ListAndWatch in code which supports contextual logging.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reflector</span>) <span style=color:#a6e22e>ListAndWatch</span>(<span style=color:#a6e22e>stopCh</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ListAndWatchWithContext</span>(<span style=color:#a6e22e>wait</span>.<span style=color:#a6e22e>ContextForChannel</span>(<span style=color:#a6e22e>stopCh</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ListAndWatchWithContext first lists all items and get the resource version at the moment of call,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and then use the resource version to watch.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// It returns error if ListAndWatchWithContext didn&#39;t even try to initialize watch.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reflector</span>) <span style=color:#a6e22e>ListAndWatchWithContext</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>FromContext</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>V</span>(<span style=color:#ae81ff>3</span>).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Listing and watching&#34;</span>, <span style=color:#e6db74>&#34;type&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>typeDescription</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>w</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fallbackToList</span> <span style=color:#f92672>:=</span> !<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>useWatchList</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Stop</span>()
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>useWatchList</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>watchList</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// stopCh was closed</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;The watchlist request ended with an error, falling back to the standard LIST/WATCH semantics because making progress is better than deadlocking&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fallbackToList</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// ensure that we won&#39;t accidentally pass some garbage down the watch.</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span> = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>fallbackToList</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>list</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>V</span>(<span style=color:#ae81ff>2</span>).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Caches populated&#34;</span>, <span style=color:#e6db74>&#34;type&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>typeDescription</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>watchWithResync</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>w</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/reflector.go (L510-523)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>timeoutSeconds</span> <span style=color:#f92672>:=</span> int64(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>minWatchTimeout</span>.<span style=color:#a6e22e>Seconds</span>() <span style=color:#f92672>*</span> (<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1.0</span>))
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>options</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>ResourceVersion</span>: <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>LastSyncResourceVersion</span>(),
</span></span><span style=display:flex><span>				<span style=color:#75715e>// We want to avoid situations of hanging watchers. Stop any watchers that do not</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// receive any events within the timeout window.</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>TimeoutSeconds</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>timeoutSeconds</span>,
</span></span><span style=display:flex><span>				<span style=color:#75715e>// To reduce load on kube-apiserver on watch restarts, you may enable watch bookmarks.</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Reflector doesn&#39;t assume bookmarks are returned at all (if the server do not support</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// watch bookmarks, it will ignore this field).</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>AllowWatchBookmarks</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>listerWatcher</span>.<span style=color:#a6e22e>WatchWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/reflector.go (L572-677)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// list simply lists all items and records a resource version obtained from the server at the moment of the call.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the resource version can be used for further progress notification (aka. watch).</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reflector</span>) <span style=color:#a6e22e>list</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>resourceVersion</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>options</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>{<span style=color:#a6e22e>ResourceVersion</span>: <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>relistResourceVersion</span>()}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;Reflector ListAndWatch&#34;</span>, <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>Field</span>{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>name</span>})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>LogIfLong</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>list</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>paginatedResult</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listCh</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>panicCh</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> recover(); <span style=color:#a6e22e>r</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>panicCh</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}()
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Attempt to gather list in chunks, if supported by listerWatcher, if not, the first</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// list request will return the full response.</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>pager</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>SimplePageFunc</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>opts</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>listerWatcher</span>.<span style=color:#a6e22e>ListWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>opts</span>)
</span></span><span style=display:flex><span>		}))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>switch</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>WatchListPageSize</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>PageSize</span> = <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>WatchListPageSize</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>paginatedResult</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// We got a paginated result initially. Assume this resource and server honor</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// paging requests (i.e. watch cache is probably disabled) and leave the default</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// pager size set.</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>ResourceVersion</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>ResourceVersion</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;0&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// User didn&#39;t explicitly request pagination.</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// With ResourceVersion != &#34;&#34;, we have a possibility to list from watch cache,</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// but we do that (for ResourceVersion != &#34;0&#34;) only if Limit is unset.</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// To avoid thundering herd on etcd (e.g. on master upgrades), we explicitly</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// switch off pagination to force listing from watch cache (if enabled).</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// With the existing semantic of RV (result is at least as fresh as provided RV),</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// this is correct and doesn&#39;t lead to going back in time.</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// We also don&#39;t turn off pagination for ResourceVersion=&#34;0&#34;, since watch cache</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// is ignoring Limit in that case anyway, and if watch cache is not enabled</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// we don&#39;t introduce regression.</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>PageSize</span> = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>list</span>, <span style=color:#a6e22e>paginatedResult</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>ListWithAlloc</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isExpiredError</span>(<span style=color:#a6e22e>err</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>isTooLargeResourceVersionError</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>setIsLastSyncResourceVersionUnavailable</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Retry immediately if the resource version used to list is unavailable.</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// The pager already falls back to full list if paginated list calls fail due to an &#34;Expired&#34; error on</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// continuation pages, but the pager might not be enabled, the full list might fail because the</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// resource version it is listing at is expired or the cache may not yet be synced to the provided</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// resource version. So we need to fallback to resourceVersion=&#34;&#34; in all to recover and ensure</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// the reflector makes forward progress.</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>list</span>, <span style=color:#a6e22e>paginatedResult</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>pager</span>.<span style=color:#a6e22e>ListWithAlloc</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>{<span style=color:#a6e22e>ResourceVersion</span>: <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>relistResourceVersion</span>()})
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		close(<span style=color:#a6e22e>listCh</span>)
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>panicCh</span>:
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>listCh</span>:
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#e6db74>&#34;Objects listed&#34;</span>, <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>Field</span>{<span style=color:#a6e22e>Key</span>: <span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>err</span>})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to list %v: %w&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>typeDescription</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// We check if the list was paginated and if so set the paginatedResult based on that.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// However, we want to do that only for the initial list (which is the only case</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// when we set ResourceVersion=&#34;0&#34;). The reasoning behind it is that later, in some</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// situations we may force listing directly from etcd (by setting ResourceVersion=&#34;&#34;)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// which will return paginated result, even if watch cache is enabled. However, in</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// that case, we still want to prefer sending requests to watch cache if possible.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Paginated result returned for request with ResourceVersion=&#34;0&#34; mean that watch</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// cache is disabled and there are a lot of objects of a given type. In such case,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// there is no need to prefer listing from watch cache.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>ResourceVersion</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>paginatedResult</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>paginatedResult</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>setIsLastSyncResourceVersionUnavailable</span>(<span style=color:#66d9ef>false</span>) <span style=color:#75715e>// list was successful</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listMetaInterface</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>ListAccessor</span>(<span style=color:#a6e22e>list</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to understand list result %#v: %v&#34;</span>, <span style=color:#a6e22e>list</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resourceVersion</span> = <span style=color:#a6e22e>listMetaInterface</span>.<span style=color:#a6e22e>GetResourceVersion</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#e6db74>&#34;Resource version extracted&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>items</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>ExtractListWithAlloc</span>(<span style=color:#a6e22e>list</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to understand list result %#v (%v)&#34;</span>, <span style=color:#a6e22e>list</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#e6db74>&#34;Objects extracted&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>syncWith</span>(<span style=color:#a6e22e>items</span>, <span style=color:#a6e22e>resourceVersion</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to sync list result: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#e6db74>&#34;SyncWith done&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>setLastSyncResourceVersion</span>(<span style=color:#a6e22e>resourceVersion</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>initTrace</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#e6db74>&#34;Resource version updated&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/reflector.go (L927-954)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>			<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Type</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Added</span>:
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleErrorWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;Unable to add watch event object to store&#34;</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;object&#34;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Modified</span>:
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleErrorWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;Unable to update watch event object to store&#34;</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;object&#34;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Deleted</span>:
</span></span><span style=display:flex><span>				<span style=color:#75715e>// TODO: Will any consumers need access to the &#34;last known</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// state&#34;, which is passed in event.Object? If so, may need</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// to change this.</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleErrorWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;Unable to delete watch event object from store&#34;</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;object&#34;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Bookmark</span>:
</span></span><span style=display:flex><span>				<span style=color:#75715e>// A `Bookmark` means watch has synced here, just update the resourceVersion</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>GetAnnotations</span>()[<span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>InitialEventsAnnotationKey</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;true&#34;</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>watchListBookmarkReceived</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>utilruntime</span>.<span style=color:#a6e22e>HandleErrorWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;Unknown watch event&#34;</span>, <span style=color:#e6db74>&#34;reflector&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;event&#34;</span>, <span style=color:#a6e22e>event</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>setLastSyncResourceVersion</span>(<span style=color:#a6e22e>resourceVersion</span>)
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/informers/core/v1/pod.go (L59-89)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>NewSharedIndexInformer</span>(
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ListWatch</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListWithContextFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFuncWithContext</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>apicorev1</span>.<span style=color:#a6e22e>Pod</span>{},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>resyncPeriod</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>indexers</span>,
</span></span><span style=display:flex><span>	)
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/informers/apps/v1/deployment.go (L59-89)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>NewSharedIndexInformer</span>(
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ListWatch</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListWithContextFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFuncWithContext</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>apiappsv1</span>.<span style=color:#a6e22e>Deployment</span>{},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>resyncPeriod</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>indexers</span>,
</span></span><span style=display:flex><span>	)
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/informers/core/v1/service.go (L59-89)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>NewSharedIndexInformer</span>(
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>ListWatch</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Services</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Services</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ListWithContextFunc</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Services</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>WatchFuncWithContext</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tweakListOptions</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>tweakListOptions</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Services</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>apicorev1</span>.<span style=color:#a6e22e>Service</span>{},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>resyncPeriod</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>indexers</span>,
</span></span><span style=display:flex><span>	)
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/rest/request.go (L551-583)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Request</span>) <span style=color:#a6e22e>URL</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>pathPrefix</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>namespaceSet</span> <span style=color:#f92672>&amp;&amp;</span> len(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>namespace</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span> = <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>p</span>, <span style=color:#e6db74>&#34;namespaces&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>namespace</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>resource</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span> = <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToLower</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>resource</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Join trims trailing slashes, so preserve r.pathPrefix&#39;s trailing slash for backwards compatibility if nothing was changed</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>resourceName</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>subpath</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>subresource</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span> = <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>resourceName</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>subresource</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>subpath</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>finalURL</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span>{}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>base</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#f92672>*</span><span style=color:#a6e22e>finalURL</span> = <span style=color:#f92672>*</span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>base</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>finalURL</span>.<span style=color:#a6e22e>Path</span> = <span style=color:#a6e22e>p</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>query</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Values</span>{}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>values</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>params</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>values</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// timeout is handled specially here.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>timeout</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;timeout&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>timeout</span>.<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>finalURL</span>.<span style=color:#a6e22e>RawQuery</span> = <span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Encode</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>finalURL</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/listwatch.go (L105-117)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ListerWatcher is any object that knows how to perform an initial list and start a watch on a resource.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Ideally, all implementations of ListerWatcher should also implement ListerWatcherWithContext.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ListerWatcher</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Lister</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Watcher</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ListerWatcherWithContext is any object that knows how to perform an initial list and start a watch on a resource.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ListerWatcherWithContext</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ListerWithContext</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>WatcherWithContext</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>File:</strong> staging/src/k8s.io/client-go/tools/cache/listwatch.go (L199-242)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewFilteredListWatchFromClient</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>Getter</span>, <span style=color:#a6e22e>resource</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>namespace</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>optionsModifier</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>)) <span style=color:#f92672>*</span><span style=color:#a6e22e>ListWatch</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listFunc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>optionsModifier</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Get</span>().
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>namespace</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>resource</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>VersionedParams</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ParameterCodec</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Get</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>watchFunc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>Watch</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>optionsModifier</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Get</span>().
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>namespace</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>resource</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>VersionedParams</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ParameterCodec</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>listFuncWithContext</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>optionsModifier</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Get</span>().
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>namespace</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>resource</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>VersionedParams</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ParameterCodec</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>ctx</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Get</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>watchFuncWithContext</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>) (<span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Interface</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>Watch</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>optionsModifier</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Get</span>().
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>namespace</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>resource</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>VersionedParams</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ParameterCodec</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ListWatch</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ListFunc</span>:             <span style=color:#a6e22e>listFunc</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WatchFunc</span>:            <span style=color:#a6e22e>watchFunc</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ListWithContextFunc</span>:  <span style=color:#a6e22e>listFuncWithContext</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>WatchFuncWithContext</span>: <span style=color:#a6e22e>watchFuncWithContext</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#一架构原理>一、架构原理</a><ul><li><a href=#核心组件说明>核心组件说明</a></li></ul></li><li><a href=#二sharedinformer-接口与实现>二、SharedInformer 接口与实现</a><ul><li><a href=#接口定义>接口定义</a></li><li><a href=#核心实现>核心实现</a></li><li><a href=#运行机制>运行机制</a></li><li><a href=#事件处理>事件处理</a></li></ul></li><li><a href=#三云平台使用-informer-的设计模式>三、云平台使用 Informer 的设计模式</a><ul><li><a href=#1-使用-sharedinformerfactory>1. 使用 SharedInformerFactory</a></li><li><a href=#2-标准-controller-模式>2. 标准 Controller 模式</a></li><li><a href=#3-简化示例>3. 简化示例</a></li></ul></li><li><a href=#四云平台设计建议>四、云平台设计建议</a><ul><li><a href=#架构设计要点>架构设计要点</a></li><li><a href=#最佳实践>最佳实践</a></li><li><a href=#代码实现示例结构>代码实现示例结构</a></li></ul></li><li><a href=#五关键注意事项>五、关键注意事项</a></li><li><a href=#notes>Notes</a><ul><li><a href=#citations>Citations</a></li></ul></li></ul><ul><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#the-two-api-requests-involved>The Two API Requests Involved</a><ul><li><a href=#1-list-request-initial-synchronization>1. LIST Request (Initial Synchronization)</a></li><li><a href=#2-watch-request-continuous-updates>2. WATCH Request (Continuous Updates)</a></li></ul></li><li><a href=#specific-implementations-for-pods-deployments-and-services>Specific Implementations for Pods, Deployments, and Services</a><ul><li><a href=#pod-informer>Pod Informer</a></li><li><a href=#deployment-informer>Deployment Informer</a></li><li><a href=#service-informer>Service Informer</a></li></ul></li><li><a href=#api-request-details>API Request Details</a><ul><li><a href=#url-construction>URL Construction</a></li><li><a href=#request-patterns>Request Patterns</a></li></ul></li><li><a href=#how-complete-information-including-status-is-retrieved>How Complete Information (Including Status) is Retrieved</a></li><li><a href=#notes-1>Notes</a><ul><li><a href=#citations-1>Citations</a></li></ul></li></ul></nav></div></aside></main></body></html>
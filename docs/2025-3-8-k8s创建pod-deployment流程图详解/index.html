<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="sequenceDiagram
    participant User as 用户
    participant Kubectl as Kubectl
    participant API as API Server
    participant CM as Controller Manager
    participant Etcd as etcd
    participant Scheduler as 调度器
    participant Kubelet as Kubelet
    participant CRI as 容器运行时
    participant CNI as 容器网络接口
    participant CSI as 容器存储接口

    User ->> Kubectl: 提交 Pod/Deployment 定义
    Kubectl ->> API: 发送创建请求
    API ->> Etcd: 存储资源信息
    
    alt 如果是高级资源(Deployment/ReplicaSet等)
        API ->> CM: 通知新资源创建
        CM ->> API: 创建对应的附属资源(如ReplicaSet/Pod)
        API ->> Etcd: 存储附属资源信息
    end
    
    API ->> Scheduler: 通知新建的未调度Pod
    Scheduler ->> API: 获取未调度的Pod信息
    Scheduler ->> Scheduler: 评估资源并分配节点
    Scheduler ->> API: 更新Pod的节点分配信息
    API ->> Etcd: 存储更新的Pod信息
    
    API ->> Kubelet: 通知分配到该节点的Pod
    Kubelet ->> API: 获取Pod信息
    Kubelet ->> CRI: 拉取并启动容器镜像
    Kubelet ->> CNI: 配置容器网络
    Kubelet ->> CSI: 挂载存储卷
    
    Kubelet ->> API: 更新Pod状态
    API ->> Etcd: 存储更新的Pod状态
    API ->> CM: 通知Pod状态变化
    CM ->> CM: 处理相关控制循环
    
    CM ->> API: 更新相关资源状态(如Deployment状态)
    API ->> Etcd: 存储更新的资源状态

  Kubernetes Pod 创建流程时序图详解
  #

基于我们之前讨论的 Kubernetes 时序图，以下是每个交互过程的详细解释："><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-3-08 k8s创建pod流程图详解"><meta property="og:description" content="sequenceDiagram participant User as 用户 participant Kubectl as Kubectl participant API as API Server participant CM as Controller Manager participant Etcd as etcd participant Scheduler as 调度器 participant Kubelet as Kubelet participant CRI as 容器运行时 participant CNI as 容器网络接口 participant CSI as 容器存储接口 User ->> Kubectl: 提交 Pod/Deployment 定义 Kubectl ->> API: 发送创建请求 API ->> Etcd: 存储资源信息 alt 如果是高级资源(Deployment/ReplicaSet等) API ->> CM: 通知新资源创建 CM ->> API: 创建对应的附属资源(如ReplicaSet/Pod) API ->> Etcd: 存储附属资源信息 end API ->> Scheduler: 通知新建的未调度Pod Scheduler ->> API: 获取未调度的Pod信息 Scheduler ->> Scheduler: 评估资源并分配节点 Scheduler ->> API: 更新Pod的节点分配信息 API ->> Etcd: 存储更新的Pod信息 API ->> Kubelet: 通知分配到该节点的Pod Kubelet ->> API: 获取Pod信息 Kubelet ->> CRI: 拉取并启动容器镜像 Kubelet ->> CNI: 配置容器网络 Kubelet ->> CSI: 挂载存储卷 Kubelet ->> API: 更新Pod状态 API ->> Etcd: 存储更新的Pod状态 API ->> CM: 通知Pod状态变化 CM ->> CM: 处理相关控制循环 CM ->> API: 更新相关资源状态(如Deployment状态) API ->> Etcd: 存储更新的资源状态 Kubernetes Pod 创建流程时序图详解 # 基于我们之前讨论的 Kubernetes 时序图，以下是每个交互过程的详细解释："><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-3-08 k8s创建pod流程图详解 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.96981f6e90b1a4f0d85debb3e4a213cb10d0d74ec1400abe38f6091541d78bef.js integrity="sha256-lpgfbpCxpPDYXeuz5KITyxDQ107BQAq+OPYJFUHXi+8=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-5-29-%E9%94%99%E9%A2%98%E5%88%86%E6%9E%902/>2025-5-29 错题分析2</a></li><li><a href=/docs/2025-5-29-%E9%94%99%E9%A2%98%E5%88%86%E6%9E%901/>2025-5-29 错题分析1</a></li><li><a href=/docs/2025-5-21-ingress%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/>2025-5-21 主Ingress副本变为0后报503问题分析</a></li><li><a href=/docs/2025-5-7-%E6%8E%A5%E5%8D%95app/>2025-5-07 接单app设计</a></li><li><a href=/docs/2025-5-7-%E5%A5%BD%E5%BF%83%E6%80%81-app/>2025-5-07 好心态app</a></li><li><a href=/docs/2025-4-28-cursor-agent-%E6%8F%90%E7%A4%BA%E5%99%A8/>2025-4-28 cursor agent 提示器</a></li><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-4-16 自研k8s平台</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-4-16 sleep睡眠应用</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-4-16 paas开发记录</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-4-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-4-16 BOSS直聘自动投递</a></li><li><a href=/docs/2025-4-14-github%E6%8E%A8%E9%80%81/>2025-4-14 github推送</a></li><li><a href=/docs/2025-3-30-metallb/>2025-3-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-3-24 自我介绍</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics高可用架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics 架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics 和 Thanos 对比</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanos高可用架构</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanos架构</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w pod压测复盘</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 火山云迁移工程师面试记录</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-3-14 vivo面试</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s删除pod或deployment的流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/ class=active>2025-3-08 k8s创建pod流程图详解</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-2-28 prometheus面试题</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 面试0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 高级运维面试题-linux部分</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 中级运维面试题</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224面试</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 面试0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 面试0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 面试2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8s题目</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 面试0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 面试2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 美国码农计划</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 美国码农薪酬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8s组件</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2025-06-16-fire%E8%A7%84%E5%88%99/>2025-06-16 Cursor RIPER-5规则</a></li><li><a href=/docs/2025-06-12-karmada/>2025-06-12 karmada介绍</a></li><li><a href=/docs/2025-06-12-flutter%E8%A7%84%E5%88%99/>2025-06-12 flutter规则</a></li><li><a href=/docs/2025-06-10-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91/>2025-06-10 独立开发</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeasz部署k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 顶级devops工具大盘点</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 清理docker镜像</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 构建容器镜像利器buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 是技术大神还是基础架构部的祸害</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 搭个日志手机系统不香吗</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 我只想做技术 走技术路线</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 常见linux运维面试题</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 大厂总结nginx高并发优化笔记</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 史上最牛jenkins pipeline流水线详解</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEG与istio集成</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginx如何解决惊群效应</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctl检测集群pod间连通性</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linux运维工程师50个常见面试题</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linux系统性能优化 七个实战经验</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awk文本处理器 8个案例</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruise原地升级解析</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8S面试题</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8s背后service是如何工作的</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8S的最后一块拼图</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istio部署</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfile定制专属镜像</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33款gitops与devops主流系统</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linux面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linux运维面试题</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8s面试题</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruise详细解释以及原地升级及全链路灰度发布方案</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8S之ingress-nginx原理及配置</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 使用cloudflare(CF)搭建dockerhub代理</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 单master单etcd改造为3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 面试总结</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 如何为K8S保驾护航</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8S如何获得 IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_status_update.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_control.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_pod_control.go源码解读</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8S调度器 extender.go 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8S控制器之sync.go 同步 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8S控制器之rollback.go 回滚 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8S控制器之recreate.go 重建 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8S控制器之 scheduler.go 调度器 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8S控制器之 rolling.go 滚动更新 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8S控制器之 progress.go 进度 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8S控制器之 deployment_controller.go源码解读</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S 调度器 scheduler_one.go 源码解读</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 彻悟容器网络</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 面试用 Golang 手撸 LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 自动屏蔽IP攻击</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 离线安装kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 磁盘数据恢复</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 清理残留的calico网络插件</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 流量何处来何处去</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 极大提高工作效率的 Linux 命令</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 文学的故乡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 搞懂K8S鉴权</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 容器网络原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 容器的文件系统 OverlayFS 原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 容器原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 容器内的 1 号进程</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 容器中域名解析以及不同dnspolicy对域名解析的影响</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 如何调试 crash 容器的网络</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 如何使用tekton快速搭建CI/CD平台</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 大规模并发下如何加快 Pod 启动速度</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 使用kubernees leases 轻松实现leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 二进制部署K8S加节点操作</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 两张图全面理解K8S原理</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 ssl证书自签发</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheus企业级监控使用总结</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 原理</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux 性能优化大全</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes 证书详解(鉴权)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes 证书详解(认证)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes 源码结构</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekey添加新节点</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8S面试宝典</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8S面试大全</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8s运维之清理磁盘</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8S调试POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8S的POD类型</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8s应用的最佳实践</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8S命令指南</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8S原地升级</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S 探针原理</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S 开发可不止 CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebs原理</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chart和repo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanel网络</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCD稳定性及性能优化实践</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCD备份</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Docker重要的网络知识点</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfile的copy和add的区别</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNS之光</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd 基本操作</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNI插件选型</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go 架构</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go 四种客户端</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICD思考</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calico网络自定义</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acme自动更新证书</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16个概念带你入门 Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 面试0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600条最强linux命令总结</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16张硬核图解k8s网络</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8s之kubelet源码解读</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 面试</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8s流量链路剖析</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S 流量链路剖析</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSI剖析演进</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNI剖析演进</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSI剖析演进</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNI剖析演进</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 面试</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8s架构师面试大全</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 使用 OpenFunction 在任何基础设施上运行无服务器工作负载</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 离线安装集群</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 操作系统说明</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 快速指南</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 开始使用 cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 多架构支持</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 公有云上部署</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 个性化集群参数配置</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router 网络组件</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl 命令行介绍</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB 负载均衡部署</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico 配置 BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-安装集群主要插件</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S 集群存储</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-安装网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-安装kube-ovn网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-安装flannel网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-安装cilium网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-安装calico网络组件</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-安装etcd集群</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-集群规划和基础参数设定</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-安装kube_node节点</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-安装kube_master节点</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-安装容器运行时</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-创建证书和环境准备</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 思考</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/2025-4-20-%E6%80%A7%E5%90%8C%E6%84%8Fapp/>2025 4 20 性同意app</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-3-08 k8s创建pod流程图详解</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#1-用户--kubectl-提交-poddeployment-定义>1. 用户 → Kubectl: 提交 Pod/Deployment 定义</a></li><li><a href=#2-kubectl--api-server-发送创建请求>2. Kubectl → API Server: 发送创建请求</a></li><li><a href=#3-api-server--etcd-存储资源信息>3. API Server → etcd: 存储资源信息</a></li><li><a href=#4-条件分支-高级资源处理>4. 条件分支: 高级资源处理</a></li><li><a href=#5-api-server--controller-manager-通知新资源创建>5. API Server → Controller Manager: 通知新资源创建</a></li><li><a href=#6-controller-manager--api-server-创建附属资源>6. Controller Manager → API Server: 创建附属资源</a></li><li><a href=#7-api-server--etcd-存储附属资源信息>7. API Server → etcd: 存储附属资源信息</a></li><li><a href=#8-api-server--scheduler-通知新建的未调度pod>8. API Server → Scheduler: 通知新建的未调度Pod</a></li><li><a href=#9-scheduler--api-server-获取未调度的pod信息>9. Scheduler → API Server: 获取未调度的Pod信息</a></li><li><a href=#10-scheduler内部-评估资源并分配节点>10. Scheduler内部: 评估资源并分配节点</a></li><li><a href=#11-scheduler--api-server-更新pod的节点分配信息>11. Scheduler → API Server: 更新Pod的节点分配信息</a></li><li><a href=#12-api-server--etcd-存储更新的pod信息>12. API Server → etcd: 存储更新的Pod信息</a></li><li><a href=#13-api-server--kubelet-通知分配到该节点的pod>13. API Server → Kubelet: 通知分配到该节点的Pod</a></li><li><a href=#14-kubelet--api-server-获取pod信息>14. Kubelet → API Server: 获取Pod信息</a></li><li><a href=#15-kubelet--cri-拉取并启动容器镜像>15. Kubelet → CRI: 拉取并启动容器镜像</a></li><li><a href=#16-kubelet--cni-配置容器网络>16. Kubelet → CNI: 配置容器网络</a></li><li><a href=#17-kubelet--csi-挂载存储卷>17. Kubelet → CSI: 挂载存储卷</a></li><li><a href=#18-kubelet--api-server-更新pod状态>18. Kubelet → API Server: 更新Pod状态</a></li><li><a href=#19-api-server--etcd-存储更新的pod状态>19. API Server → etcd: 存储更新的Pod状态</a></li><li><a href=#20-api-server--controller-manager-通知pod状态变化>20. API Server → Controller Manager: 通知Pod状态变化</a></li><li><a href=#21-controller-manager内部-处理相关控制循环>21. Controller Manager内部: 处理相关控制循环</a></li><li><a href=#22-controller-manager--api-server-更新资源状态>22. Controller Manager → API Server: 更新资源状态</a></li><li><a href=#23-api-server--etcd-存储更新的资源状态>23. API Server → etcd: 存储更新的资源状态</a></li></ul><ul><li><a href=#1-用户--kubectl-发起删除请求-kubectl-delete>1. 用户 → Kubectl: 发起删除请求 (kubectl delete)</a></li><li><a href=#2-kubectl--api-server-发送删除api请求>2. Kubectl → API Server: 发送删除API请求</a></li><li><a href=#3-api-server--api-server-添加删除时间戳deletiontimestamp>3. API Server → API Server: 添加删除时间戳(deletionTimestamp)</a></li><li><a href=#4-api-server--api-server-设置finalizers如有>4. API Server → API Server: 设置finalizers(如有)</a></li><li><a href=#5-api-server--etcd-更新资源状态为正在删除>5. API Server → etcd: 更新资源状态为"正在删除"</a></li><li><a href=#6-api-server--controller-manager-通知资源正在删除>6. API Server → Controller Manager: 通知资源正在删除</a></li><li><a href=#7-controller-manager--controller-manager-检查删除策略>7. Controller Manager → Controller Manager: 检查删除策略</a></li><li><a href=#8-controller-manager--api-server-删除所属的子资源>8. Controller Manager → API Server: 删除所属的子资源</a></li><li><a href=#9-api-server--kubelet-通知节点上的pod被标记删除>9. API Server → Kubelet: 通知节点上的Pod被标记删除</a></li><li><a href=#10-kubelet--kubelet-执行pod终止流程>10. Kubelet → Kubelet: 执行Pod终止流程</a></li><li><a href=#11-kubelet--kubelet-执行prestop钩子如有>11. Kubelet → Kubelet: 执行preStop钩子(如有)</a></li><li><a href=#12-kubelet--cri-发送终止信号sigterm>12. Kubelet → CRI: 发送终止信号(SIGTERM)</a></li><li><a href=#13-等待优雅终止期>13. 等待优雅终止期</a></li><li><a href=#14-kubelet--cri-发送强制终止信号sigkill>14. Kubelet → CRI: 发送强制终止信号(SIGKILL)</a></li><li><a href=#15-kubelet--cri-删除容器>15. Kubelet → CRI: 删除容器</a></li><li><a href=#16-kubelet--cni-清理网络资源>16. Kubelet → CNI: 清理网络资源</a></li><li><a href=#17-kubelet--csi-卸载并清理存储卷>17. Kubelet → CSI: 卸载并清理存储卷</a></li><li><a href=#18-kubelet--api-server-移除pod-finalizers>18. Kubelet → API Server: 移除Pod finalizers</a></li><li><a href=#19-kubelet--api-server-报告pod已终止>19. Kubelet → API Server: 报告Pod已终止</a></li><li><a href=#20-api-server--etcd-从etcd中物理删除pod数据>20. API Server → etcd: 从etcd中物理删除Pod数据</a></li><li><a href=#21-controller-manager--api-server-检查所有子资源是否已删除>21. Controller Manager → API Server: 检查所有子资源是否已删除</a></li><li><a href=#22-controller-manager--api-server-移除资源finalizers>22. Controller Manager → API Server: 移除资源finalizers</a></li><li><a href=#23-api-server--etcd-从etcd中物理删除资源数据>23. API Server → etcd: 从etcd中物理删除资源数据</a></li><li><a href=#24-api-server--kubectl-返回删除完成状态>24. API Server → Kubectl: 返回删除完成状态</a></li><li><a href=#25-kubectl--user-显示资源已被删除>25. Kubectl → User: 显示资源已被删除</a></li><li><a href=#删除流程关键点解释>删除流程关键点解释</a></li></ul></nav></aside></header><article class="markdown book-article"><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant User as 用户
    participant Kubectl as Kubectl
    participant API as API Server
    participant CM as Controller Manager
    participant Etcd as etcd
    participant Scheduler as 调度器
    participant Kubelet as Kubelet
    participant CRI as 容器运行时
    participant CNI as 容器网络接口
    participant CSI as 容器存储接口

    User -&gt;&gt; Kubectl: 提交 Pod/Deployment 定义
    Kubectl -&gt;&gt; API: 发送创建请求
    API -&gt;&gt; Etcd: 存储资源信息
    
    alt 如果是高级资源(Deployment/ReplicaSet等)
        API -&gt;&gt; CM: 通知新资源创建
        CM -&gt;&gt; API: 创建对应的附属资源(如ReplicaSet/Pod)
        API -&gt;&gt; Etcd: 存储附属资源信息
    end
    
    API -&gt;&gt; Scheduler: 通知新建的未调度Pod
    Scheduler -&gt;&gt; API: 获取未调度的Pod信息
    Scheduler -&gt;&gt; Scheduler: 评估资源并分配节点
    Scheduler -&gt;&gt; API: 更新Pod的节点分配信息
    API -&gt;&gt; Etcd: 存储更新的Pod信息
    
    API -&gt;&gt; Kubelet: 通知分配到该节点的Pod
    Kubelet -&gt;&gt; API: 获取Pod信息
    Kubelet -&gt;&gt; CRI: 拉取并启动容器镜像
    Kubelet -&gt;&gt; CNI: 配置容器网络
    Kubelet -&gt;&gt; CSI: 挂载存储卷
    
    Kubelet -&gt;&gt; API: 更新Pod状态
    API -&gt;&gt; Etcd: 存储更新的Pod状态
    API -&gt;&gt; CM: 通知Pod状态变化
    CM -&gt;&gt; CM: 处理相关控制循环
    
    CM -&gt;&gt; API: 更新相关资源状态(如Deployment状态)
    API -&gt;&gt; Etcd: 存储更新的资源状态
</code></pre><h1 id=kubernetes-pod-创建流程时序图详解>Kubernetes Pod 创建流程时序图详解
<a class=anchor href=#kubernetes-pod-%e5%88%9b%e5%bb%ba%e6%b5%81%e7%a8%8b%e6%97%b6%e5%ba%8f%e5%9b%be%e8%af%a6%e8%a7%a3>#</a></h1><p>基于我们之前讨论的 Kubernetes 时序图，以下是每个交互过程的详细解释：</p><h2 id=1-用户--kubectl-提交-poddeployment-定义>1. 用户 → Kubectl: 提交 Pod/Deployment 定义
<a class=anchor href=#1-%e7%94%a8%e6%88%b7--kubectl-%e6%8f%90%e4%ba%a4-poddeployment-%e5%ae%9a%e4%b9%89>#</a></h2><ul><li><strong>含义</strong>：用户通过命令行工具(<code>kubectl create/apply</code>)或YAML文件提交资源定义</li><li><strong>具体操作</strong>：如<code>kubectl apply -f deployment.yaml</code></li><li><strong>数据流</strong>：YAML/JSON格式的资源定义文件</li></ul><h2 id=2-kubectl--api-server-发送创建请求>2. Kubectl → API Server: 发送创建请求
<a class=anchor href=#2-kubectl--api-server-%e5%8f%91%e9%80%81%e5%88%9b%e5%bb%ba%e8%af%b7%e6%b1%82>#</a></h2><ul><li><strong>含义</strong>：kubectl将用户请求转换为REST API调用</li><li><strong>具体操作</strong>：格式化、验证资源定义并发送HTTP请求</li><li><strong>处理细节</strong>：包括认证令牌添加、API版本处理</li></ul><h2 id=3-api-server--etcd-存储资源信息>3. API Server → etcd: 存储资源信息
<a class=anchor href=#3-api-server--etcd-%e5%ad%98%e5%82%a8%e8%b5%84%e6%ba%90%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：API Server将资源定义持久化存储</li><li><strong>具体操作</strong>：API Server验证请求后写入etcd数据库</li><li><strong>存储内容</strong>：完整的资源规范(spec)和初始状态(status)</li></ul><h2 id=4-条件分支-高级资源处理>4. 条件分支: 高级资源处理
<a class=anchor href=#4-%e6%9d%a1%e4%bb%b6%e5%88%86%e6%94%af-%e9%ab%98%e7%ba%a7%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86>#</a></h2><ul><li><strong>含义</strong>：系统根据资源类型执行不同处理流程</li><li><strong>判断条件</strong>：资源是否为高级控制器(Deployment/StatefulSet等)</li></ul><h2 id=5-api-server--controller-manager-通知新资源创建>5. API Server → Controller Manager: 通知新资源创建
<a class=anchor href=#5-api-server--controller-manager-%e9%80%9a%e7%9f%a5%e6%96%b0%e8%b5%84%e6%ba%90%e5%88%9b%e5%bb%ba>#</a></h2><ul><li><strong>含义</strong>：API Server通知控制器有新资源需要处理</li><li><strong>具体操作</strong>：通过watch机制发送资源创建事件</li><li><strong>接收方</strong>：对应的控制器(如DeploymentController)</li></ul><h2 id=6-controller-manager--api-server-创建附属资源>6. Controller Manager → API Server: 创建附属资源
<a class=anchor href=#6-controller-manager--api-server-%e5%88%9b%e5%bb%ba%e9%99%84%e5%b1%9e%e8%b5%84%e6%ba%90>#</a></h2><ul><li><strong>含义</strong>：控制器创建层级关系中的子资源</li><li><strong>具体操作</strong>：Deployment创建ReplicaSet，ReplicaSet创建Pod</li><li><strong>处理逻辑</strong>：控制器实现了资源的"期望状态"逻辑</li></ul><h2 id=7-api-server--etcd-存储附属资源信息>7. API Server → etcd: 存储附属资源信息
<a class=anchor href=#7-api-server--etcd-%e5%ad%98%e5%82%a8%e9%99%84%e5%b1%9e%e8%b5%84%e6%ba%90%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：API Server将新创建的子资源信息写入数据库</li><li><strong>具体操作</strong>：保存ReplicaSet和Pod的定义</li><li><strong>关系维护</strong>：存储资源间的所有者引用(OwnerReferences)</li></ul><h2 id=8-api-server--scheduler-通知新建的未调度pod>8. API Server → Scheduler: 通知新建的未调度Pod
<a class=anchor href=#8-api-server--scheduler-%e9%80%9a%e7%9f%a5%e6%96%b0%e5%bb%ba%e7%9a%84%e6%9c%aa%e8%b0%83%e5%ba%a6pod>#</a></h2><ul><li><strong>含义</strong>：API Server告知调度器有新Pod需要调度</li><li><strong>具体操作</strong>：通过watch API发送Pod创建事件</li><li><strong>标识特征</strong>：Pod的spec.nodeName为空</li></ul><h2 id=9-scheduler--api-server-获取未调度的pod信息>9. Scheduler → API Server: 获取未调度的Pod信息
<a class=anchor href=#9-scheduler--api-server-%e8%8e%b7%e5%8f%96%e6%9c%aa%e8%b0%83%e5%ba%a6%e7%9a%84pod%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：调度器获取完整的Pod定义及相关信息</li><li><strong>具体操作</strong>：查询Pod详情和当前集群节点状态</li><li><strong>数据内容</strong>：Pod资源需求、亲和性规则、污点容忍等</li></ul><h2 id=10-scheduler内部-评估资源并分配节点>10. Scheduler内部: 评估资源并分配节点
<a class=anchor href=#10-scheduler%e5%86%85%e9%83%a8-%e8%af%84%e4%bc%b0%e8%b5%84%e6%ba%90%e5%b9%b6%e5%88%86%e9%85%8d%e8%8a%82%e7%82%b9>#</a></h2><ul><li><strong>含义</strong>：调度器执行调度算法选择最佳节点</li><li><strong>具体操作</strong>：过滤(Predicates)和打分(Priorities)</li><li><strong>决策因素</strong>：节点资源、亲和性、分布策略等</li></ul><h2 id=11-scheduler--api-server-更新pod的节点分配信息>11. Scheduler → API Server: 更新Pod的节点分配信息
<a class=anchor href=#11-scheduler--api-server-%e6%9b%b4%e6%96%b0pod%e7%9a%84%e8%8a%82%e7%82%b9%e5%88%86%e9%85%8d%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：调度器提交Pod调度决策</li><li><strong>具体操作</strong>：更新Pod的spec.nodeName字段</li><li><strong>更新方式</strong>：通过PATCH操作修改Pod定义</li></ul><h2 id=12-api-server--etcd-存储更新的pod信息>12. API Server → etcd: 存储更新的Pod信息
<a class=anchor href=#12-api-server--etcd-%e5%ad%98%e5%82%a8%e6%9b%b4%e6%96%b0%e7%9a%84pod%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：将调度决策持久化到数据库</li><li><strong>具体操作</strong>：更新etcd中的Pod记录</li><li><strong>变更内容</strong>：主要是nodeName字段的添加</li></ul><h2 id=13-api-server--kubelet-通知分配到该节点的pod>13. API Server → Kubelet: 通知分配到该节点的Pod
<a class=anchor href=#13-api-server--kubelet-%e9%80%9a%e7%9f%a5%e5%88%86%e9%85%8d%e5%88%b0%e8%af%a5%e8%8a%82%e7%82%b9%e7%9a%84pod>#</a></h2><ul><li><strong>含义</strong>：目标节点的Kubelet收到新Pod分配通知</li><li><strong>具体操作</strong>：通过node上的Kubelet watch API接收事件</li><li><strong>判断条件</strong>：Pod的spec.nodeName匹配本节点</li></ul><h2 id=14-kubelet--api-server-获取pod信息>14. Kubelet → API Server: 获取Pod信息
<a class=anchor href=#14-kubelet--api-server-%e8%8e%b7%e5%8f%96pod%e4%bf%a1%e6%81%af>#</a></h2><ul><li><strong>含义</strong>：Kubelet获取完整的Pod配置</li><li><strong>具体操作</strong>：查询Pod的详细定义</li><li><strong>数据内容</strong>：容器镜像、环境变量、卷配置等</li></ul><h2 id=15-kubelet--cri-拉取并启动容器镜像>15. Kubelet → CRI: 拉取并启动容器镜像
<a class=anchor href=#15-kubelet--cri-%e6%8b%89%e5%8f%96%e5%b9%b6%e5%90%af%e5%8a%a8%e5%ae%b9%e5%99%a8%e9%95%9c%e5%83%8f>#</a></h2><ul><li><strong>含义</strong>：Kubelet请求容器运行时创建容器</li><li><strong>具体操作</strong>：通过CRI接口调用Docker/containerd等</li><li><strong>执行内容</strong>：镜像拉取、容器创建和启动</li></ul><h2 id=16-kubelet--cni-配置容器网络>16. Kubelet → CNI: 配置容器网络
<a class=anchor href=#16-kubelet--cni-%e9%85%8d%e7%bd%ae%e5%ae%b9%e5%99%a8%e7%bd%91%e7%bb%9c>#</a></h2><ul><li><strong>含义</strong>：为Pod配置网络连接</li><li><strong>具体操作</strong>：调用CNI插件(如Calico、Flannel)</li><li><strong>配置内容</strong>：IP分配、路由规则、网络命名空间</li></ul><h2 id=17-kubelet--csi-挂载存储卷>17. Kubelet → CSI: 挂载存储卷
<a class=anchor href=#17-kubelet--csi-%e6%8c%82%e8%bd%bd%e5%ad%98%e5%82%a8%e5%8d%b7>#</a></h2><ul><li><strong>含义</strong>：为Pod挂载所需的存储卷</li><li><strong>具体操作</strong>：调用CSI驱动挂载PV</li><li><strong>执行内容</strong>：卷准备、挂载点创建、文件系统挂载</li></ul><h2 id=18-kubelet--api-server-更新pod状态>18. Kubelet → API Server: 更新Pod状态
<a class=anchor href=#18-kubelet--api-server-%e6%9b%b4%e6%96%b0pod%e7%8a%b6%e6%80%81>#</a></h2><ul><li><strong>含义</strong>：报告Pod当前运行状态</li><li><strong>具体操作</strong>：更新Pod的status字段</li><li><strong>状态内容</strong>：Pod阶段(phase)、容器状态、IP地址等</li></ul><h2 id=19-api-server--etcd-存储更新的pod状态>19. API Server → etcd: 存储更新的Pod状态
<a class=anchor href=#19-api-server--etcd-%e5%ad%98%e5%82%a8%e6%9b%b4%e6%96%b0%e7%9a%84pod%e7%8a%b6%e6%80%81>#</a></h2><ul><li><strong>含义</strong>：持久化Pod的最新状态</li><li><strong>具体操作</strong>：更新etcd中的Pod status记录</li><li><strong>更新频率</strong>：Kubelet定期发送状态更新</li></ul><h2 id=20-api-server--controller-manager-通知pod状态变化>20. API Server → Controller Manager: 通知Pod状态变化
<a class=anchor href=#20-api-server--controller-manager-%e9%80%9a%e7%9f%a5pod%e7%8a%b6%e6%80%81%e5%8f%98%e5%8c%96>#</a></h2><ul><li><strong>含义</strong>：控制器收到Pod状态变更事件</li><li><strong>具体操作</strong>：通过watch机制接收状态更新</li><li><strong>接收方</strong>：多个控制器(Deployment、ReplicaSet等)</li></ul><h2 id=21-controller-manager内部-处理相关控制循环>21. Controller Manager内部: 处理相关控制循环
<a class=anchor href=#21-controller-manager%e5%86%85%e9%83%a8-%e5%a4%84%e7%90%86%e7%9b%b8%e5%85%b3%e6%8e%a7%e5%88%b6%e5%be%aa%e7%8e%af>#</a></h2><ul><li><strong>含义</strong>：控制器执行协调逻辑</li><li><strong>具体操作</strong>：比较资源当前状态与期望状态</li><li><strong>处理内容</strong>：副本数调整、状态计算、异常处理</li></ul><h2 id=22-controller-manager--api-server-更新资源状态>22. Controller Manager → API Server: 更新资源状态
<a class=anchor href=#22-controller-manager--api-server-%e6%9b%b4%e6%96%b0%e8%b5%84%e6%ba%90%e7%8a%b6%e6%80%81>#</a></h2><ul><li><strong>含义</strong>：控制器更新高级资源的状态</li><li><strong>具体操作</strong>：更新Deployment/ReplicaSet的status</li><li><strong>状态内容</strong>：可用副本数、更新状态、条件等</li></ul><h2 id=23-api-server--etcd-存储更新的资源状态>23. API Server → etcd: 存储更新的资源状态
<a class=anchor href=#23-api-server--etcd-%e5%ad%98%e5%82%a8%e6%9b%b4%e6%96%b0%e7%9a%84%e8%b5%84%e6%ba%90%e7%8a%b6%e6%80%81>#</a></h2><ul><li><strong>含义</strong>：持久化高级资源的最新状态</li><li><strong>具体操作</strong>：更新etcd中的资源records</li><li><strong>完成循环</strong>：至此完成一个完整的控制循环</li></ul><p>这些步骤展示了Kubernetes声明式API和控制器模式的核心工作原理，体现了系统的松耦合架构和自动化协调能力。</p><p>主要参与者包括：</p><ul><li>用户</li><li>Kubectl</li><li>API Server</li><li>Controller Manager</li><li>etcd</li><li>Scheduler (可能不太相关，因为删除不需要调度)</li><li>Kubelet</li><li>容器运行时 (CRI)</li><li>容器网络接口 (CNI)</li><li>容器存储接口 (CSI)</li></ul><p>删除流程的主要步骤：</p><ol><li>用户通过 kubectl 发起删除请求</li><li>API Server 接收请求并更新 etcd 中的资源状态（添加删除时间戳）</li><li>如果是高级资源，Controller Manager 会处理附属资源的级联删除</li><li>Kubelet 观察到删除请求，开始终止容器</li><li>各种钩子和优雅终止期处理</li><li>清理网络和存储资源</li><li>完成删除后更新状态</li></ol><p>让我创建这个序列图：</p><h1 id=kubernetes-poddeployment-删除流程图>Kubernetes Pod/Deployment 删除流程图
<a class=anchor href=#kubernetes-poddeployment-%e5%88%a0%e9%99%a4%e6%b5%81%e7%a8%8b%e5%9b%be>#</a></h1><p>下面是 Kubernetes 中删除 Pod 或 Deployment 的完整流程序列图：</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant User as 用户
    participant Kubectl as Kubectl
    participant API as API Server
    participant CM as Controller Manager
    participant Etcd as etcd
    participant Kubelet as Kubelet
    participant CRI as 容器运行时
    participant CNI as 容器网络接口
    participant CSI as 容器存储接口

    User -&gt;&gt; Kubectl: 发起删除请求 (kubectl delete)
    Kubectl -&gt;&gt; API: 发送删除API请求
    
    API -&gt;&gt; API: 添加删除时间戳(deletionTimestamp)
    API -&gt;&gt; API: 设置finalizers(如有)
    API -&gt;&gt; Etcd: 更新资源状态为&#34;正在删除&#34;
    
    alt 如果是Deployment等高级资源
        API -&gt;&gt; CM: 通知资源正在删除
        CM -&gt;&gt; CM: 检查删除策略(级联/非级联)
        
        alt 级联删除(默认)
            CM -&gt;&gt; API: 删除所属的子资源(如ReplicaSet)
            API -&gt;&gt; Etcd: 更新子资源为&#34;正在删除&#34;
            
            CM -&gt;&gt; API: 删除所属的Pod
            API -&gt;&gt; Etcd: 更新Pod为&#34;正在删除&#34;
        end
    end
    
    API -&gt;&gt; Kubelet: 通知节点上的Pod被标记删除
    
    Kubelet -&gt;&gt; Kubelet: 执行Pod终止流程
    Kubelet -&gt;&gt; Kubelet: 执行preStop钩子(如有)
    
    Kubelet -&gt;&gt; CRI: 发送终止信号(SIGTERM)
    Note over CRI: 等待优雅终止期(默认30秒)
    
    alt 容器未在终止期内退出
        Kubelet -&gt;&gt; CRI: 发送强制终止信号(SIGKILL)
    end
    
    Kubelet -&gt;&gt; CRI: 删除容器
    Kubelet -&gt;&gt; CNI: 清理网络资源
    Kubelet -&gt;&gt; CSI: 卸载并清理存储卷
    
    Kubelet -&gt;&gt; API: 移除Pod finalizers(如有)
    Kubelet -&gt;&gt; API: 报告Pod已终止
    
    API -&gt;&gt; Etcd: 从etcd中物理删除Pod数据
    
    alt 如果是高级资源
        CM -&gt;&gt; API: 检查所有子资源是否已删除
        CM -&gt;&gt; API: 移除资源finalizers
        API -&gt;&gt; Etcd: 从etcd中物理删除资源数据
    end
    
    API -&gt;&gt; Kubectl: 返回删除完成状态
    Kubectl -&gt;&gt; User: 显示资源已被删除
</code></pre><p>我将按照时序图中的顺序来分析：</p><ol><li>用户 → Kubectl: 发起删除请求</li><li>Kubectl → API Server: 发送删除API请求</li><li>API Server内部处理: 添加deletionTimestamp和finalizers</li><li>API Server → etcd: 更新资源状态为"正在删除"</li><li>高级资源(如Deployment)的处理分支</li><li>Controller Manager处理级联删除</li><li>API Server → Kubelet: 通知Pod删除</li><li>Kubelet执行Pod终止流程</li><li>Kubelet → CRI: 容器终止流程</li><li>Kubelet → CNI和CSI: 网络和存储资源清理</li><li>Kubelet → API Server: 完成Pod终止</li><li>API Server → etcd: 物理删除资源</li><li>高级资源的finalizers处理</li><li>删除完成的通知返回</li></ol><h1 id=kubernetes-poddeployment-删除流程详解>Kubernetes Pod/Deployment 删除流程详解
<a class=anchor href=#kubernetes-poddeployment-%e5%88%a0%e9%99%a4%e6%b5%81%e7%a8%8b%e8%af%a6%e8%a7%a3>#</a></h1><p>下面是我生成的删除 Pod/Deployment 流程图中每个步骤的详细解释：</p><h2 id=1-用户--kubectl-发起删除请求-kubectl-delete>1. 用户 → Kubectl: 发起删除请求 (kubectl delete)
<a class=anchor href=#1-%e7%94%a8%e6%88%b7--kubectl-%e5%8f%91%e8%b5%b7%e5%88%a0%e9%99%a4%e8%af%b7%e6%b1%82-kubectl-delete>#</a></h2><ul><li><strong>含义</strong>：用户通过命令行发起资源删除操作</li><li><strong>具体操作</strong>：如<code>kubectl delete pod my-pod</code>或<code>kubectl delete deployment my-app</code></li><li><strong>选项</strong>：可以包含<code>--grace-period</code>、<code>--force</code>或<code>--cascade</code>等参数调整删除行为</li></ul><h2 id=2-kubectl--api-server-发送删除api请求>2. Kubectl → API Server: 发送删除API请求
<a class=anchor href=#2-kubectl--api-server-%e5%8f%91%e9%80%81%e5%88%a0%e9%99%a4api%e8%af%b7%e6%b1%82>#</a></h2><ul><li><strong>含义</strong>：kubectl将用户删除命令转化为API调用</li><li><strong>具体操作</strong>：发送DELETE请求到API Server对应端点</li><li><strong>API路径</strong>：例如<code>/api/v1/namespaces/{namespace}/pods/{name}</code></li><li><strong>参数传递</strong>：将删除选项作为查询参数传递</li></ul><h2 id=3-api-server--api-server-添加删除时间戳deletiontimestamp>3. API Server → API Server: 添加删除时间戳(deletionTimestamp)
<a class=anchor href=#3-api-server--api-server-%e6%b7%bb%e5%8a%a0%e5%88%a0%e9%99%a4%e6%97%b6%e9%97%b4%e6%88%b3deletiontimestamp>#</a></h2><ul><li><strong>含义</strong>：API Server将资源标记为正在删除，而非立即物理删除</li><li><strong>具体操作</strong>：在资源元数据中添加<code>metadata.deletionTimestamp</code>字段</li><li><strong>作用</strong>：让系统知道该资源已请求删除，但清理工作尚未完成</li></ul><h2 id=4-api-server--api-server-设置finalizers如有>4. API Server → API Server: 设置finalizers(如有)
<a class=anchor href=#4-api-server--api-server-%e8%ae%be%e7%bd%aefinalizers%e5%a6%82%e6%9c%89>#</a></h2><ul><li><strong>含义</strong>：保留或添加finalizers，防止资源被过早删除</li><li><strong>具体操作</strong>：确保<code>metadata.finalizers</code>数组包含所需的finalizer标记</li><li><strong>作用</strong>：确保所有必要的清理工作完成后才真正删除资源</li></ul><h2 id=5-api-server--etcd-更新资源状态为正在删除>5. API Server → etcd: 更新资源状态为"正在删除"
<a class=anchor href=#5-api-server--etcd-%e6%9b%b4%e6%96%b0%e8%b5%84%e6%ba%90%e7%8a%b6%e6%80%81%e4%b8%ba%e6%ad%a3%e5%9c%a8%e5%88%a0%e9%99%a4>#</a></h2><ul><li><strong>含义</strong>：将修改后的资源（带删除时间戳）持久化</li><li><strong>具体操作</strong>：更新etcd中对应键值</li><li><strong>状态变化</strong>：资源仍然存在，但带有删除标记</li></ul><h2 id=6-api-server--controller-manager-通知资源正在删除>6. API Server → Controller Manager: 通知资源正在删除
<a class=anchor href=#6-api-server--controller-manager-%e9%80%9a%e7%9f%a5%e8%b5%84%e6%ba%90%e6%ad%a3%e5%9c%a8%e5%88%a0%e9%99%a4>#</a></h2><ul><li><strong>含义</strong>：删除事件通过watch机制传递给控制器</li><li><strong>具体操作</strong>：Controller Manager接收到资源更新事件</li><li><strong>处理方式</strong>：相关控制器（如DeploymentController）开始处理删除逻辑</li></ul><h2 id=7-controller-manager--controller-manager-检查删除策略>7. Controller Manager → Controller Manager: 检查删除策略
<a class=anchor href=#7-controller-manager--controller-manager-%e6%a3%80%e6%9f%a5%e5%88%a0%e9%99%a4%e7%ad%96%e7%95%a5>#</a></h2><ul><li><strong>含义</strong>：确定如何处理资源层级关系</li><li><strong>具体操作</strong>：检查<code>DeleteOptions.PropagationPolicy</code></li><li><strong>策略类型</strong>：<ul><li><code>Foreground</code>：先删除子资源，再删除父资源</li><li><code>Background</code>：异步删除子资源（默认）</li><li><code>Orphan</code>：不删除子资源，只删除父资源</li></ul></li></ul><h2 id=8-controller-manager--api-server-删除所属的子资源>8. Controller Manager → API Server: 删除所属的子资源
<a class=anchor href=#8-controller-manager--api-server-%e5%88%a0%e9%99%a4%e6%89%80%e5%b1%9e%e7%9a%84%e5%ad%90%e8%b5%84%e6%ba%90>#</a></h2><ul><li><strong>含义</strong>：级联删除子资源（如ReplicaSet和Pod）</li><li><strong>具体操作</strong>：发送DELETE请求给这些子资源</li><li><strong>处理顺序</strong>：通常是从最高层向下删除（Deployment→ReplicaSet→Pod）</li></ul><h2 id=9-api-server--kubelet-通知节点上的pod被标记删除>9. API Server → Kubelet: 通知节点上的Pod被标记删除
<a class=anchor href=#9-api-server--kubelet-%e9%80%9a%e7%9f%a5%e8%8a%82%e7%82%b9%e4%b8%8a%e7%9a%84pod%e8%a2%ab%e6%a0%87%e8%ae%b0%e5%88%a0%e9%99%a4>#</a></h2><ul><li><strong>含义</strong>：Pod所在节点的Kubelet收到Pod删除事件</li><li><strong>具体操作</strong>：通过watch机制接收Pod更新（包含deletionTimestamp）</li><li><strong>触发时机</strong>：当Pod被标记删除时</li></ul><h2 id=10-kubelet--kubelet-执行pod终止流程>10. Kubelet → Kubelet: 执行Pod终止流程
<a class=anchor href=#10-kubelet--kubelet-%e6%89%a7%e8%a1%8cpod%e7%bb%88%e6%ad%a2%e6%b5%81%e7%a8%8b>#</a></h2><ul><li><strong>含义</strong>：Kubelet开始协调Pod删除过程</li><li><strong>具体操作</strong>：按顺序执行终止任务，确保有序清理</li></ul><h2 id=11-kubelet--kubelet-执行prestop钩子如有>11. Kubelet → Kubelet: 执行preStop钩子(如有)
<a class=anchor href=#11-kubelet--kubelet-%e6%89%a7%e8%a1%8cprestop%e9%92%a9%e5%ad%90%e5%a6%82%e6%9c%89>#</a></h2><ul><li><strong>含义</strong>：在发送终止信号前执行Pod中定义的preStop钩子</li><li><strong>具体操作</strong>：运行容器中配置的preStop命令或HTTP请求</li><li><strong>目的</strong>：允许应用程序优雅关闭（如关闭连接、保存状态）</li></ul><h2 id=12-kubelet--cri-发送终止信号sigterm>12. Kubelet → CRI: 发送终止信号(SIGTERM)
<a class=anchor href=#12-kubelet--cri-%e5%8f%91%e9%80%81%e7%bb%88%e6%ad%a2%e4%bf%a1%e5%8f%b7sigterm>#</a></h2><ul><li><strong>含义</strong>：请求容器内进程优雅终止</li><li><strong>具体操作</strong>：通过CRI向容器发送SIGTERM信号</li><li><strong>期望行为</strong>：应用程序捕获信号并执行清理操作后退出</li></ul><h2 id=13-等待优雅终止期>13. 等待优雅终止期
<a class=anchor href=#13-%e7%ad%89%e5%be%85%e4%bc%98%e9%9b%85%e7%bb%88%e6%ad%a2%e6%9c%9f>#</a></h2><ul><li><strong>含义</strong>：给容器内进程时间来处理SIGTERM信号</li><li><strong>具体操作</strong>：等待默认30秒（或自定义时间）</li><li><strong>可配置</strong>：通过Pod spec的<code>terminationGracePeriodSeconds</code>设置</li></ul><h2 id=14-kubelet--cri-发送强制终止信号sigkill>14. Kubelet → CRI: 发送强制终止信号(SIGKILL)
<a class=anchor href=#14-kubelet--cri-%e5%8f%91%e9%80%81%e5%bc%ba%e5%88%b6%e7%bb%88%e6%ad%a2%e4%bf%a1%e5%8f%b7sigkill>#</a></h2><ul><li><strong>含义</strong>：如果容器未在优雅终止期内退出，强制终止</li><li><strong>具体操作</strong>：发送SIGKILL信号，不可被捕获或忽略</li><li><strong>结果</strong>：立即终止容器进程，不执行任何清理</li></ul><h2 id=15-kubelet--cri-删除容器>15. Kubelet → CRI: 删除容器
<a class=anchor href=#15-kubelet--cri-%e5%88%a0%e9%99%a4%e5%ae%b9%e5%99%a8>#</a></h2><ul><li><strong>含义</strong>：移除容器实例</li><li><strong>具体操作</strong>：通过CRI接口调用运行时删除容器</li><li><strong>清理内容</strong>：容器文件系统、元数据等</li></ul><h2 id=16-kubelet--cni-清理网络资源>16. Kubelet → CNI: 清理网络资源
<a class=anchor href=#16-kubelet--cni-%e6%b8%85%e7%90%86%e7%bd%91%e7%bb%9c%e8%b5%84%e6%ba%90>#</a></h2><ul><li><strong>含义</strong>：释放Pod的网络资源</li><li><strong>具体操作</strong>：调用CNI插件的DEL命令</li><li><strong>清理内容</strong>：IP地址、路由、网络命名空间等</li></ul><h2 id=17-kubelet--csi-卸载并清理存储卷>17. Kubelet → CSI: 卸载并清理存储卷
<a class=anchor href=#17-kubelet--csi-%e5%8d%b8%e8%bd%bd%e5%b9%b6%e6%b8%85%e7%90%86%e5%ad%98%e5%82%a8%e5%8d%b7>#</a></h2><ul><li><strong>含义</strong>：解除卷挂载并清理本地卷资源</li><li><strong>具体操作</strong>：卸载文件系统，调用CSI接口</li><li><strong>注意</strong>：持久卷本身不会被删除，只解除与Pod的关联</li></ul><h2 id=18-kubelet--api-server-移除pod-finalizers>18. Kubelet → API Server: 移除Pod finalizers
<a class=anchor href=#18-kubelet--api-server-%e7%a7%bb%e9%99%a4pod-finalizers>#</a></h2><ul><li><strong>含义</strong>：标记Pod资源可以被物理删除</li><li><strong>具体操作</strong>：更新Pod移除<code>kubernetes.io/pvc-protection</code>等finalizers</li><li><strong>结果</strong>：移除阻止Pod物理删除的保护机制</li></ul><h2 id=19-kubelet--api-server-报告pod已终止>19. Kubelet → API Server: 报告Pod已终止
<a class=anchor href=#19-kubelet--api-server-%e6%8a%a5%e5%91%8apod%e5%b7%b2%e7%bb%88%e6%ad%a2>#</a></h2><ul><li><strong>含义</strong>：通知API Server Pod已完全终止</li><li><strong>具体操作</strong>：更新Pod状态为Terminated</li><li><strong>作用</strong>：触发后续清理流程</li></ul><h2 id=20-api-server--etcd-从etcd中物理删除pod数据>20. API Server → etcd: 从etcd中物理删除Pod数据
<a class=anchor href=#20-api-server--etcd-%e4%bb%8eetcd%e4%b8%ad%e7%89%a9%e7%90%86%e5%88%a0%e9%99%a4pod%e6%95%b0%e6%8d%ae>#</a></h2><ul><li><strong>含义</strong>：当所有finalizers被移除后，真正删除资源数据</li><li><strong>具体操作</strong>：从etcd中删除对应键值</li><li><strong>结果</strong>：Pod资源彻底从系统中移除</li></ul><h2 id=21-controller-manager--api-server-检查所有子资源是否已删除>21. Controller Manager → API Server: 检查所有子资源是否已删除
<a class=anchor href=#21-controller-manager--api-server-%e6%a3%80%e6%9f%a5%e6%89%80%e6%9c%89%e5%ad%90%e8%b5%84%e6%ba%90%e6%98%af%e5%90%a6%e5%b7%b2%e5%88%a0%e9%99%a4>#</a></h2><ul><li><strong>含义</strong>：对于高级资源，确认所有子资源已经清理完毕</li><li><strong>具体操作</strong>：检查是否存在ownerReferences指向该资源的对象</li><li><strong>作用</strong>：确保不留下任何"孤儿"资源</li></ul><h2 id=22-controller-manager--api-server-移除资源finalizers>22. Controller Manager → API Server: 移除资源finalizers
<a class=anchor href=#22-controller-manager--api-server-%e7%a7%bb%e9%99%a4%e8%b5%84%e6%ba%90finalizers>#</a></h2><ul><li><strong>含义</strong>：标记高级资源（如Deployment）可以被物理删除</li><li><strong>具体操作</strong>：移除资源上的所有finalizers</li><li><strong>结果</strong>：允许资源最终被物理删除</li></ul><h2 id=23-api-server--etcd-从etcd中物理删除资源数据>23. API Server → etcd: 从etcd中物理删除资源数据
<a class=anchor href=#23-api-server--etcd-%e4%bb%8eetcd%e4%b8%ad%e7%89%a9%e7%90%86%e5%88%a0%e9%99%a4%e8%b5%84%e6%ba%90%e6%95%b0%e6%8d%ae>#</a></h2><ul><li><strong>含义</strong>：彻底删除高级资源的所有数据</li><li><strong>具体操作</strong>：从etcd中删除对应键值</li><li><strong>结果</strong>：资源完全从系统中移除</li></ul><h2 id=24-api-server--kubectl-返回删除完成状态>24. API Server → Kubectl: 返回删除完成状态
<a class=anchor href=#24-api-server--kubectl-%e8%bf%94%e5%9b%9e%e5%88%a0%e9%99%a4%e5%ae%8c%e6%88%90%e7%8a%b6%e6%80%81>#</a></h2><ul><li><strong>含义</strong>：向客户端通知删除操作已完成</li><li><strong>具体操作</strong>：返回成功状态码和响应</li><li><strong>内容</strong>：可能包含删除资源的最终状态</li></ul><h2 id=25-kubectl--user-显示资源已被删除>25. Kubectl → User: 显示资源已被删除
<a class=anchor href=#25-kubectl--user-%e6%98%be%e7%a4%ba%e8%b5%84%e6%ba%90%e5%b7%b2%e8%a2%ab%e5%88%a0%e9%99%a4>#</a></h2><ul><li><strong>含义</strong>：向用户显示操作结果</li><li><strong>具体操作</strong>：通常显示"xxx deleted"消息</li><li><strong>额外信息</strong>：可能包含删除的资源名称和类型</li></ul><p>这个删除流程展示了Kubernetes如何通过一系列协调步骤，确保资源被安全、有序地清理，同时保持系统的一致性和可靠性。</p><h2 id=删除流程关键点解释>删除流程关键点解释
<a class=anchor href=#%e5%88%a0%e9%99%a4%e6%b5%81%e7%a8%8b%e5%85%b3%e9%94%ae%e7%82%b9%e8%a7%a3%e9%87%8a>#</a></h2><ol><li><p><strong>删除请求初始化</strong></p><ul><li>用户发起 <code>kubectl delete</code> 命令</li><li>API Server 不会立即物理删除资源，而是先标记删除</li></ul></li><li><p><strong>级联删除处理</strong></p><ul><li>资源会根据 <code>propagationPolicy</code> 决定删除行为</li><li><code>Foreground</code>: 先删除子资源，再删除父资源</li><li><code>Background</code>: 异步删除子资源（默认行为）</li><li><code>Orphan</code>: 只删除父资源，保留子资源</li></ul></li><li><p><strong>Finalizers 和保护机制</strong></p><ul><li>Finalizers 阻止资源被立即删除，确保清理工作完成</li><li>例如 <code>kubernetes.io/pv-protection</code> 保护正在使用的卷</li></ul></li><li><p><strong>Pod 终止流程</strong></p><ul><li>执行 preStop 钩子</li><li>发送 SIGTERM 并等待优雅终止期</li><li>如必要，发送 SIGKILL 强制终止</li><li>清理网络和存储资源</li></ul></li><li><p><strong>删除确认</strong></p><ul><li>所有 finalizers 清除后，资源才会从 etcd 中物理删除</li><li>控制器确认所有依赖资源已清理</li></ul></li></ol><p>这个流程展示了 Kubernetes 在资源删除过程中如何确保有序、可控和完整的清理，防止出现孤立资源和资源泄漏。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#1-用户--kubectl-提交-poddeployment-定义>1. 用户 → Kubectl: 提交 Pod/Deployment 定义</a></li><li><a href=#2-kubectl--api-server-发送创建请求>2. Kubectl → API Server: 发送创建请求</a></li><li><a href=#3-api-server--etcd-存储资源信息>3. API Server → etcd: 存储资源信息</a></li><li><a href=#4-条件分支-高级资源处理>4. 条件分支: 高级资源处理</a></li><li><a href=#5-api-server--controller-manager-通知新资源创建>5. API Server → Controller Manager: 通知新资源创建</a></li><li><a href=#6-controller-manager--api-server-创建附属资源>6. Controller Manager → API Server: 创建附属资源</a></li><li><a href=#7-api-server--etcd-存储附属资源信息>7. API Server → etcd: 存储附属资源信息</a></li><li><a href=#8-api-server--scheduler-通知新建的未调度pod>8. API Server → Scheduler: 通知新建的未调度Pod</a></li><li><a href=#9-scheduler--api-server-获取未调度的pod信息>9. Scheduler → API Server: 获取未调度的Pod信息</a></li><li><a href=#10-scheduler内部-评估资源并分配节点>10. Scheduler内部: 评估资源并分配节点</a></li><li><a href=#11-scheduler--api-server-更新pod的节点分配信息>11. Scheduler → API Server: 更新Pod的节点分配信息</a></li><li><a href=#12-api-server--etcd-存储更新的pod信息>12. API Server → etcd: 存储更新的Pod信息</a></li><li><a href=#13-api-server--kubelet-通知分配到该节点的pod>13. API Server → Kubelet: 通知分配到该节点的Pod</a></li><li><a href=#14-kubelet--api-server-获取pod信息>14. Kubelet → API Server: 获取Pod信息</a></li><li><a href=#15-kubelet--cri-拉取并启动容器镜像>15. Kubelet → CRI: 拉取并启动容器镜像</a></li><li><a href=#16-kubelet--cni-配置容器网络>16. Kubelet → CNI: 配置容器网络</a></li><li><a href=#17-kubelet--csi-挂载存储卷>17. Kubelet → CSI: 挂载存储卷</a></li><li><a href=#18-kubelet--api-server-更新pod状态>18. Kubelet → API Server: 更新Pod状态</a></li><li><a href=#19-api-server--etcd-存储更新的pod状态>19. API Server → etcd: 存储更新的Pod状态</a></li><li><a href=#20-api-server--controller-manager-通知pod状态变化>20. API Server → Controller Manager: 通知Pod状态变化</a></li><li><a href=#21-controller-manager内部-处理相关控制循环>21. Controller Manager内部: 处理相关控制循环</a></li><li><a href=#22-controller-manager--api-server-更新资源状态>22. Controller Manager → API Server: 更新资源状态</a></li><li><a href=#23-api-server--etcd-存储更新的资源状态>23. API Server → etcd: 存储更新的资源状态</a></li></ul><ul><li><a href=#1-用户--kubectl-发起删除请求-kubectl-delete>1. 用户 → Kubectl: 发起删除请求 (kubectl delete)</a></li><li><a href=#2-kubectl--api-server-发送删除api请求>2. Kubectl → API Server: 发送删除API请求</a></li><li><a href=#3-api-server--api-server-添加删除时间戳deletiontimestamp>3. API Server → API Server: 添加删除时间戳(deletionTimestamp)</a></li><li><a href=#4-api-server--api-server-设置finalizers如有>4. API Server → API Server: 设置finalizers(如有)</a></li><li><a href=#5-api-server--etcd-更新资源状态为正在删除>5. API Server → etcd: 更新资源状态为"正在删除"</a></li><li><a href=#6-api-server--controller-manager-通知资源正在删除>6. API Server → Controller Manager: 通知资源正在删除</a></li><li><a href=#7-controller-manager--controller-manager-检查删除策略>7. Controller Manager → Controller Manager: 检查删除策略</a></li><li><a href=#8-controller-manager--api-server-删除所属的子资源>8. Controller Manager → API Server: 删除所属的子资源</a></li><li><a href=#9-api-server--kubelet-通知节点上的pod被标记删除>9. API Server → Kubelet: 通知节点上的Pod被标记删除</a></li><li><a href=#10-kubelet--kubelet-执行pod终止流程>10. Kubelet → Kubelet: 执行Pod终止流程</a></li><li><a href=#11-kubelet--kubelet-执行prestop钩子如有>11. Kubelet → Kubelet: 执行preStop钩子(如有)</a></li><li><a href=#12-kubelet--cri-发送终止信号sigterm>12. Kubelet → CRI: 发送终止信号(SIGTERM)</a></li><li><a href=#13-等待优雅终止期>13. 等待优雅终止期</a></li><li><a href=#14-kubelet--cri-发送强制终止信号sigkill>14. Kubelet → CRI: 发送强制终止信号(SIGKILL)</a></li><li><a href=#15-kubelet--cri-删除容器>15. Kubelet → CRI: 删除容器</a></li><li><a href=#16-kubelet--cni-清理网络资源>16. Kubelet → CNI: 清理网络资源</a></li><li><a href=#17-kubelet--csi-卸载并清理存储卷>17. Kubelet → CSI: 卸载并清理存储卷</a></li><li><a href=#18-kubelet--api-server-移除pod-finalizers>18. Kubelet → API Server: 移除Pod finalizers</a></li><li><a href=#19-kubelet--api-server-报告pod已终止>19. Kubelet → API Server: 报告Pod已终止</a></li><li><a href=#20-api-server--etcd-从etcd中物理删除pod数据>20. API Server → etcd: 从etcd中物理删除Pod数据</a></li><li><a href=#21-controller-manager--api-server-检查所有子资源是否已删除>21. Controller Manager → API Server: 检查所有子资源是否已删除</a></li><li><a href=#22-controller-manager--api-server-移除资源finalizers>22. Controller Manager → API Server: 移除资源finalizers</a></li><li><a href=#23-api-server--etcd-从etcd中物理删除资源数据>23. API Server → etcd: 从etcd中物理删除资源数据</a></li><li><a href=#24-api-server--kubectl-返回删除完成状态>24. API Server → Kubectl: 返回删除完成状态</a></li><li><a href=#25-kubectl--user-显示资源已被删除>25. Kubectl → User: 显示资源已被删除</a></li><li><a href=#删除流程关键点解释>删除流程关键点解释</a></li></ul></nav></div></aside></main></body></html>
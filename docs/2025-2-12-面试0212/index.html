<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  如何做k8s资源的规划
  #

在K8s中进行资源规划是一个重要的任务，我来详细解释一下关键点：

  1. CPU和内存资源规划
  #


  1.1 资源请求(requests)和限制(limits)
  #

spec:
  containers:
  - name: app
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"

requests: 容器需要的最小资源量
limits: 容器能够使用的最大资源量
CPU单位：1 CPU = 1000m（毫核）
内存单位：Mi（兆字节）, Gi（吉字节）


  2. 命名空间资源配额
  #

apiVersion: v1
kind: ResourceQuota
metadata:
  name: compute-quota
  namespace: your-namespace
spec:
  hard:
    requests.cpu: "4"
    requests.memory: 4Gi
    limits.cpu: "8"
    limits.memory: 8Gi
    pods: "10"

  3. 资源规划的最佳实践
  #



监控历史数据

使用Prometheus + Grafana监控应用实际资源使用情况
观察峰值和平均值
留出30-50%的buffer以应对突发流量



合理设置requests和limits

requests设置为应用正常运行需要的资源量
limits设置为预期峰值的1.5-2倍
避免limits设置过低导致OOM



Pod水平自动扩缩容(HPA)


apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: your-app
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70

  4. 节点资源规划
  #


节点标签和污点

kubectl label nodes node1 workload-type=cpu-intensive
kubectl taint nodes node1 dedicated=cpu-intensive:NoSchedule

节点亲和性

spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: workload-type
            operator: In
            values:
            - cpu-intensive

  5. 资源规划检查清单
  #


应用层面


 确定应用的基准资源需求
 设置合适的requests和limits
 配置HPA策略


集群层面


 设置namespace资源配额
 规划节点池和节点规格
 配置节点亲和性策略


监控和优化


 部署监控系统
 定期检查资源使用情况
 根据实际情况调整资源配置


  6. 注意事项
  #



避免资源过度分配'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-2-12 面试0212"><meta property="og:description" content='如何做k8s资源的规划 # 在K8s中进行资源规划是一个重要的任务，我来详细解释一下关键点：
1. CPU和内存资源规划 # 1.1 资源请求(requests)和限制(limits) # spec: containers: - name: app resources: requests: memory: "256Mi" cpu: "250m" limits: memory: "512Mi" cpu: "500m" requests: 容器需要的最小资源量 limits: 容器能够使用的最大资源量 CPU单位：1 CPU = 1000m（毫核） 内存单位：Mi（兆字节）, Gi（吉字节） 2. 命名空间资源配额 # apiVersion: v1 kind: ResourceQuota metadata: name: compute-quota namespace: your-namespace spec: hard: requests.cpu: "4" requests.memory: 4Gi limits.cpu: "8" limits.memory: 8Gi pods: "10" 3. 资源规划的最佳实践 # 监控历史数据
使用Prometheus + Grafana监控应用实际资源使用情况 观察峰值和平均值 留出30-50%的buffer以应对突发流量 合理设置requests和limits
requests设置为应用正常运行需要的资源量 limits设置为预期峰值的1.5-2倍 避免limits设置过低导致OOM Pod水平自动扩缩容(HPA)
apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: name: app-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: your-app minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 4. 节点资源规划 # 节点标签和污点 kubectl label nodes node1 workload-type=cpu-intensive kubectl taint nodes node1 dedicated=cpu-intensive:NoSchedule 节点亲和性 spec: affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: workload-type operator: In values: - cpu-intensive 5. 资源规划检查清单 # 应用层面 确定应用的基准资源需求 设置合适的requests和limits 配置HPA策略 集群层面 设置namespace资源配额 规划节点池和节点规格 配置节点亲和性策略 监控和优化 部署监控系统 定期检查资源使用情况 根据实际情况调整资源配置 6. 注意事项 # 避免资源过度分配'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-2-12 面试0212 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.88a659fb8847c246a711980994cf17ddf51e31d05dde9d037cacf40daae9145c.js integrity="sha256-iKZZ+4hHwkanEZgJlM8X3fUeMdBd3p0DfKz0DarpFFw=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-5-7-%E6%8E%A5%E5%8D%95app/>2025-5-7 接单app设计</a></li><li><a href=/docs/2025-5-7-%E5%A5%BD%E5%BF%83%E6%80%81-app/>2025-5-7 好心态 app</a></li><li><a href=/docs/2025-4-28-cursor-agent-%E6%8F%90%E7%A4%BA%E5%99%A8/>2025-4-28 cursor agent 提示器</a></li><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-4-16 自研k8s平台</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-4-16 sleep睡眠应用</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-4-16 paas开发记录</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-4-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-4-16 BOSS直聘自动投递</a></li><li><a href=/docs/2025-4-14-github%E6%8E%A8%E9%80%81/>2025-4-14 github推送</a></li><li><a href=/docs/2025-3-30-metallb/>2025-3-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-3-24 自我介绍</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics高可用架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics 架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics 和 Thanos 对比</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanos高可用架构</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanos架构</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w pod压测复盘</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 火山云迁移工程师面试记录</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-3-14 vivo面试</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s删除pod或deployment的流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s创建pod流程图详解</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-2-28 prometheus面试题</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 面试0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 高级运维面试题-linux部分</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 中级运维面试题</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224面试</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 面试0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 面试0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 面试2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8s题目</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/ class=active>2025-2-12 面试0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 面试2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 美国码农计划</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 美国码农薪酬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8s组件</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeasz部署k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 顶级devops工具大盘点</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 清理docker镜像</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 构建容器镜像利器buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 是技术大神还是基础架构部的祸害</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 搭个日志手机系统不香吗</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 我只想做技术 走技术路线</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 常见linux运维面试题</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 大厂总结nginx高并发优化笔记</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 史上最牛jenkins pipeline流水线详解</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEG与istio集成</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginx如何解决惊群效应</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctl检测集群pod间连通性</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linux运维工程师50个常见面试题</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linux系统性能优化 七个实战经验</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awk文本处理器 8个案例</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruise原地升级解析</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8S面试题</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8s背后service是如何工作的</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8S的最后一块拼图</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istio部署</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfile定制专属镜像</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33款gitops与devops主流系统</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linux面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linux运维面试题</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8s面试题</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruise详细解释以及原地升级及全链路灰度发布方案</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8S之ingress-nginx原理及配置</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 使用cloudflare(CF)搭建dockerhub代理</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 单master单etcd改造为3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 面试总结</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 如何为K8S保驾护航</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8S如何获得 IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_status_update.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_control.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_pod_control.go源码解读</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8S调度器 extender.go 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8S控制器之sync.go 同步 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8S控制器之rollback.go 回滚 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8S控制器之recreate.go 重建 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8S控制器之 scheduler.go 调度器 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8S控制器之 rolling.go 滚动更新 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8S控制器之 progress.go 进度 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8S控制器之 deployment_controller.go源码解读</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S 调度器 scheduler_one.go 源码解读</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 彻悟容器网络</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 面试用 Golang 手撸 LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 自动屏蔽IP攻击</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 离线安装kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 磁盘数据恢复</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 清理残留的calico网络插件</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 流量何处来何处去</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 极大提高工作效率的 Linux 命令</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 文学的故乡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 搞懂K8S鉴权</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 容器网络原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 容器的文件系统 OverlayFS 原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 容器原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 容器内的 1 号进程</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 容器中域名解析以及不同dnspolicy对域名解析的影响</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 如何调试 crash 容器的网络</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 如何使用tekton快速搭建CI/CD平台</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 大规模并发下如何加快 Pod 启动速度</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 使用kubernees leases 轻松实现leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 二进制部署K8S加节点操作</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 两张图全面理解K8S原理</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 ssl证书自签发</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheus企业级监控使用总结</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 原理</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux 性能优化大全</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes 证书详解(鉴权)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes 证书详解(认证)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes 源码结构</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekey添加新节点</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8S面试宝典</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8S面试大全</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8s运维之清理磁盘</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8S调试POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8S的POD类型</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8s应用的最佳实践</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8S命令指南</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8S原地升级</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S 探针原理</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S 开发可不止 CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebs原理</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chart和repo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanel网络</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCD稳定性及性能优化实践</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCD备份</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Docker重要的网络知识点</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfile的copy和add的区别</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNS之光</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd 基本操作</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNI插件选型</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go 架构</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go 四种客户端</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICD思考</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calico网络自定义</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acme自动更新证书</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16个概念带你入门 Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 面试0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600条最强linux命令总结</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16张硬核图解k8s网络</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8s之kubelet源码解读</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 面试</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8s流量链路剖析</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S 流量链路剖析</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSI剖析演进</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNI剖析演进</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSI剖析演进</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNI剖析演进</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 面试</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8s架构师面试大全</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 使用 OpenFunction 在任何基础设施上运行无服务器工作负载</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 离线安装集群</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 操作系统说明</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 快速指南</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 开始使用 cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 多架构支持</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 公有云上部署</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 个性化集群参数配置</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router 网络组件</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl 命令行介绍</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB 负载均衡部署</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico 配置 BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-安装集群主要插件</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S 集群存储</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-安装网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-安装kube-ovn网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-安装flannel网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-安装cilium网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-安装calico网络组件</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-安装etcd集群</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-集群规划和基础参数设定</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-安装kube_node节点</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-安装kube_master节点</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-安装容器运行时</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-创建证书和环境准备</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 思考</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/2025-4-20-%E6%80%A7%E5%90%8C%E6%84%8Fapp/>2025 4 20 性同意app</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-2-12 面试0212</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#如何做k8s资源的规划>如何做k8s资源的规划</a><ul><li><a href=#1-cpu和内存资源规划>1. CPU和内存资源规划</a></li><li><a href=#2-命名空间资源配额>2. 命名空间资源配额</a></li><li><a href=#3-资源规划的最佳实践>3. 资源规划的最佳实践</a></li><li><a href=#4-节点资源规划>4. 节点资源规划</a></li><li><a href=#5-资源规划检查清单>5. 资源规划检查清单</a></li><li><a href=#6-注意事项>6. 注意事项</a></li></ul></li><li><a href=#k8s的组件有哪些>k8s的组件有哪些</a><ul><li><a href=#1-控制平面组件master节点>1. 控制平面组件（Master节点）</a></li><li><a href=#2-工作节点组件node节点>2. 工作节点组件（Node节点）</a></li><li><a href=#3-附加组件>3. 附加组件</a></li><li><a href=#4-组件间通信>4. 组件间通信</a></li><li><a href=#5-高可用配置建议>5. 高可用配置建议</a></li><li><a href=#6-监控要点>6. 监控要点</a></li></ul></li><li><a href=#scheduler和controller-manager的区别>scheduler和controller-manager的区别</a><ul><li><a href=#1-基本职责>1. 基本职责</a></li><li><a href=#2-主要功能对比>2. 主要功能对比</a></li><li><a href=#3-工作流程>3. 工作流程</a></li><li><a href=#4-实际应用示例>4. 实际应用示例</a></li><li><a href=#5-主要区别总结>5. 主要区别总结</a></li><li><a href=#6-使用建议>6. 使用建议</a></li></ul></li><li><a href=#ingress和service的区别>ingress和service的区别</a><ul><li><a href=#1-基本定义>1. 基本定义</a></li><li><a href=#2-主要区别>2. 主要区别</a></li><li><a href=#3-常见使用场景>3. 常见使用场景</a></li><li><a href=#4-高级特性对比>4. 高级特性对比</a></li><li><a href=#5-最佳实践>5. 最佳实践</a></li><li><a href=#6-使用建议-1>6. 使用建议</a></li></ul></li><li><a href=#打污点的命令>打污点的命令</a><ul><li><a href=#1-基本命令格式>1. 基本命令格式</a></li><li><a href=#2-常用污点效果effect>2. 常用污点效果(effect)</a></li><li><a href=#3-常用命令示例>3. 常用命令示例</a></li><li><a href=#4-实际应用场景>4. 实际应用场景</a></li><li><a href=#5-查看节点污点>5. 查看节点污点</a></li></ul></li><li><a href=#daemonset和deployment的区别>daemonset和deployment的区别</a><ul><li><a href=#1-基本定义和用途>1. 基本定义和用途</a></li><li><a href=#2-主要区别-1>2. 主要区别</a></li><li><a href=#3-典型应用场景>3. 典型应用场景</a></li><li><a href=#4-更新策略>4. 更新策略</a></li><li><a href=#5-使用建议>5. 使用建议</a></li><li><a href=#6-注意事项-1>6. 注意事项</a></li><li><a href=#1-订单服务应该使用deployment>1. 订单服务应该使用Deployment</a></li><li><a href=#2-配套的监控采集使用daemonset>2. 配套的监控采集使用DaemonSet</a></li></ul></li><li><a href=#k8s版本用的哪个版本>k8s版本用的哪个版本</a></li><li><a href=#scheduler调度的方式有哪些>scheduler调度的方式有哪些</a><ul><li><a href=#1-调度过程>1. 调度过程</a></li><li><a href=#2-常用调度方式>2. 常用调度方式</a></li><li><a href=#3-高级调度特性>3. 高级调度特性</a></li><li><a href=#4-资源限制调度>4. 资源限制调度</a></li><li><a href=#5-最佳实践-1>5. 最佳实践</a></li><li><a href=#6-注意事项-2>6. 注意事项</a></li><li><a href=#1-针对订单服务orderservice的调度策略>1. 针对订单服务(OrderService)的调度策略</a></li><li><a href=#2-配合资源配额quotayaml的调度策略>2. 配合资源配额(quota.yaml)的调度策略</a></li><li><a href=#3-调度策略建议>3. 调度策略建议</a></li></ul></li><li><a href=#集群层面的规划-根据业务规模-预估多少台机器>集群层面的规划 根据业务规模 预估多少台机器</a><ul><li><a href=#1-业务规模评估>1. 业务规模评估</a></li><li><a href=#2-节点规格选择>2. 节点规格选择</a></li><li><a href=#3-集群规模示例>3. 集群规模示例</a></li><li><a href=#4-规划注意事项>4. 规划注意事项</a></li><li><a href=#5-监控指标>5. 监控指标</a></li></ul></li><li><a href=#亲和性和非亲和性>亲和性和非亲和性？</a><ul><li><a href=#1-节点亲和性node-affinity>1. 节点亲和性(Node Affinity)</a></li><li><a href=#2-pod亲和性pod-affinity>2. Pod亲和性(Pod Affinity)</a></li><li><a href=#3-pod反亲和性pod-anti-affinity>3. Pod反亲和性(Pod Anti-affinity)</a></li><li><a href=#4-常见使用场景>4. 常见使用场景</a></li><li><a href=#5-最佳实践-2>5. 最佳实践</a></li><li><a href=#6-注意事项-3>6. 注意事项</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=如何做k8s资源的规划>如何做k8s资源的规划
<a class=anchor href=#%e5%a6%82%e4%bd%95%e5%81%9ak8s%e8%b5%84%e6%ba%90%e7%9a%84%e8%a7%84%e5%88%92>#</a></h2><p>在K8s中进行资源规划是一个重要的任务，我来详细解释一下关键点：</p><h3 id=1-cpu和内存资源规划>1. CPU和内存资源规划
<a class=anchor href=#1-cpu%e5%92%8c%e5%86%85%e5%ad%98%e8%b5%84%e6%ba%90%e8%a7%84%e5%88%92>#</a></h3><h4 id=11-资源请求requests和限制limits>1.1 资源请求(requests)和限制(limits)
<a class=anchor href=#11-%e8%b5%84%e6%ba%90%e8%af%b7%e6%b1%82requests%e5%92%8c%e9%99%90%e5%88%b6limits>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:deployment.yaml data-lang=yaml:deployment.yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;250m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span></code></pre></div><ul><li><strong>requests</strong>: 容器需要的最小资源量</li><li><strong>limits</strong>: 容器能够使用的最大资源量</li><li>CPU单位：1 CPU = 1000m（毫核）</li><li>内存单位：Mi（兆字节）, Gi（吉字节）</li></ul><h3 id=2-命名空间资源配额>2. 命名空间资源配额
<a class=anchor href=#2-%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4%e8%b5%84%e6%ba%90%e9%85%8d%e9%a2%9d>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:quota.yaml data-lang=yaml:quota.yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ResourceQuota</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>compute-quota</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>your-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hard</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests.cpu</span>: <span style=color:#e6db74>&#34;4&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests.memory</span>: <span style=color:#ae81ff>4Gi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits.cpu</span>: <span style=color:#e6db74>&#34;8&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits.memory</span>: <span style=color:#ae81ff>8Gi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pods</span>: <span style=color:#e6db74>&#34;10&#34;</span>
</span></span></code></pre></div><h3 id=3-资源规划的最佳实践>3. 资源规划的最佳实践
<a class=anchor href=#3-%e8%b5%84%e6%ba%90%e8%a7%84%e5%88%92%e7%9a%84%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><p><strong>监控历史数据</strong></p><ul><li>使用Prometheus + Grafana监控应用实际资源使用情况</li><li>观察峰值和平均值</li><li>留出30-50%的buffer以应对突发流量</li></ul></li><li><p><strong>合理设置requests和limits</strong></p><ul><li>requests设置为应用正常运行需要的资源量</li><li>limits设置为预期峰值的1.5-2倍</li><li>避免limits设置过低导致OOM</li></ul></li><li><p><strong>Pod水平自动扩缩容(HPA)</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:hpa.yaml data-lang=yaml:hpa.yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>autoscaling/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HorizontalPodAutoscaler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-hpa</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scaleTargetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>your-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>metrics</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resource</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cpu</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Utilization</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>averageUtilization</span>: <span style=color:#ae81ff>70</span>
</span></span></code></pre></div><h3 id=4-节点资源规划>4. 节点资源规划
<a class=anchor href=#4-%e8%8a%82%e7%82%b9%e8%b5%84%e6%ba%90%e8%a7%84%e5%88%92>#</a></h3><ol><li><strong>节点标签和污点</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:node-label.yaml data-lang=yaml:node-label.yaml><span style=display:flex><span><span style=color:#ae81ff>kubectl label nodes node1 workload-type=cpu-intensive</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>kubectl taint nodes node1 dedicated=cpu-intensive:NoSchedule</span>
</span></span></code></pre></div><ol start=2><li><strong>节点亲和性</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:pod-affinity.yaml data-lang=yaml:pod-affinity.yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>workload-type</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>cpu-intensive</span>
</span></span></code></pre></div><h3 id=5-资源规划检查清单>5. 资源规划检查清单
<a class=anchor href=#5-%e8%b5%84%e6%ba%90%e8%a7%84%e5%88%92%e6%a3%80%e6%9f%a5%e6%b8%85%e5%8d%95>#</a></h3><ol><li><strong>应用层面</strong></li></ol><ul><li><input disabled type=checkbox> 确定应用的基准资源需求</li><li><input disabled type=checkbox> 设置合适的requests和limits</li><li><input disabled type=checkbox> 配置HPA策略</li></ul><ol start=2><li><strong>集群层面</strong></li></ol><ul><li><input disabled type=checkbox> 设置namespace资源配额</li><li><input disabled type=checkbox> 规划节点池和节点规格</li><li><input disabled type=checkbox> 配置节点亲和性策略</li></ul><ol start=3><li><strong>监控和优化</strong></li></ol><ul><li><input disabled type=checkbox> 部署监控系统</li><li><input disabled type=checkbox> 定期检查资源使用情况</li><li><input disabled type=checkbox> 根据实际情况调整资源配置</li></ul><h3 id=6-注意事项>6. 注意事项
<a class=anchor href=#6-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>#</a></h3><ol><li><p><strong>避免资源过度分配</strong></p><ul><li>合理评估应用资源需求</li><li>定期清理未使用的资源</li></ul></li><li><p><strong>考虑成本优化</strong></p><ul><li>使用spot实例降低成本</li><li>配置集群自动扩缩容</li><li>优化资源利用率</li></ul></li><li><p><strong>确保高可用</strong></p><ul><li>合理设置Pod反亲和性</li><li>跨可用区部署</li><li>预留足够的资源buffer</li></ul></li></ol><p>通过以上方法进行资源规划，可以确保应用在K8s集群中稳定运行，同时实现资源的最优利用。记住要定期检查和调整资源配置，以适应业务的变化和增长。</p><h2 id=k8s的组件有哪些>k8s的组件有哪些
<a class=anchor href=#k8s%e7%9a%84%e7%bb%84%e4%bb%b6%e6%9c%89%e5%93%aa%e4%ba%9b>#</a></h2><p><strong>1、etcd 保存了整个集群的状态；</strong></p><p><strong>2、apiserver 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制；</strong></p><p><strong>3、controller manager 负责维护集群的状态，比如故障检测、自动扩展、滚动更新等；</strong></p><p><strong>4、scheduler 负责资源的调度，按照预定的调度策略将 Pod 调度到相应的机器上；</strong></p><p><strong>5、kubelet 负责维护容器的生命周期，同时也负责 Volume（CVI）和网络（CNI）的管理；</strong></p><p><strong>6、Container runtime 负责镜像管理以及 Pod 和容器的真正运行（CRI）；</strong></p><p><strong>7</strong>、<strong>kube-proxy</strong> <strong>负责为</strong> <strong>Service</strong> <strong>提供</strong> <strong>cluster</strong> <strong>内部的服务发现和负载均衡。</strong></p><p>让我详细介绍K8s的核心组件：</p><h3 id=1-控制平面组件master节点>1. 控制平面组件（Master节点）
<a class=anchor href=#1-%e6%8e%a7%e5%88%b6%e5%b9%b3%e9%9d%a2%e7%bb%84%e4%bb%b6master%e8%8a%82%e7%82%b9>#</a></h3><ol><li><strong>API Server</strong></li></ol><ul><li>集群的统一入口</li><li>提供REST API接口</li><li>负责组件间的通信</li><li>认证和授权</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># API Server配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kube-apiserver</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kube-apiserver</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>k8s.gcr.io/kube-apiserver:v1.24.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>kube-apiserver</span>
</span></span><span style=display:flex><span>    - --<span style=color:#ae81ff>advertise-address=192.168.1.10</span>
</span></span><span style=display:flex><span>    - --<span style=color:#ae81ff>allow-privileged=true</span>
</span></span><span style=display:flex><span>    - --<span style=color:#ae81ff>authorization-mode=Node,RBAC</span>
</span></span></code></pre></div><ol start=2><li><strong>etcd</strong></li></ol><ul><li>分布式键值存储</li><li>保存集群所有数据</li><li>高可用配置</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># etcd配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>etcd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>k8s.gcr.io/etcd:3.5.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>etcd</span>
</span></span><span style=display:flex><span>    - --<span style=color:#ae81ff>advertise-client-urls=https://192.168.1.10:2379</span>
</span></span><span style=display:flex><span>    - --<span style=color:#ae81ff>data-dir=/var/lib/etcd</span>
</span></span></code></pre></div><ol start=3><li><strong>Controller Manager</strong></li></ol><ul><li>维护集群状态</li><li>故障检测和自动恢复</li><li>包含多个控制器：<ul><li>Node Controller</li><li>Replication Controller</li><li>Endpoints Controller</li><li>Service Account & Token Controller</li></ul></li></ul><ol start=4><li><strong>Scheduler</strong></li></ol><ul><li>负责Pod调度</li><li>根据调度算法选择节点</li><li>考虑资源需求、亲和性等</li></ul><h3 id=2-工作节点组件node节点>2. 工作节点组件（Node节点）
<a class=anchor href=#2-%e5%b7%a5%e4%bd%9c%e8%8a%82%e7%82%b9%e7%bb%84%e4%bb%b6node%e8%8a%82%e7%82%b9>#</a></h3><ol><li><strong>Kubelet</strong></li></ol><ul><li>节点代理</li><li>管理容器生命周期</li><li>执行Pod规范</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Kubelet配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kubelet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeletConfiguration</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>address</span>: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>10250</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>healthzPort</span>: <span style=color:#ae81ff>10248</span>
</span></span></code></pre></div><ol start=2><li><strong>Kube-proxy</strong></li></ol><ul><li>网络代理</li><li>维护网络规则</li><li>实现Service概念</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Kube-proxy配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubeproxy.config.k8s.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeProxyConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;ipvs&#34;</span>  <span style=color:#75715e># 或者 &#34;iptables&#34;</span>
</span></span></code></pre></div><ol start=3><li><strong>Container Runtime</strong></li></ol><ul><li>容器运行时</li><li>如Docker、containerd</li><li>负责容器的实际运行</li></ul><h3 id=3-附加组件>3. 附加组件
<a class=anchor href=#3-%e9%99%84%e5%8a%a0%e7%bb%84%e4%bb%b6>#</a></h3><ol><li><strong>CoreDNS</strong></li></ol><ul><li>集群DNS服务</li><li>服务发现</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kube-dns</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>k8s-app</span>: <span style=color:#ae81ff>kube-dns</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>53</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>UDP</span>
</span></span></code></pre></div><ol start=2><li><strong>Dashboard</strong></li></ol><ul><li>Web UI界面</li><li>集群管理和监控</li></ul><ol start=3><li><strong>CNI网络插件</strong></li></ol><ul><li>如Calico、Flannel</li><li>提供网络方案</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Calico配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>calico-node</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span></code></pre></div><h3 id=4-组件间通信>4. 组件间通信
<a class=anchor href=#4-%e7%bb%84%e4%bb%b6%e9%97%b4%e9%80%9a%e4%bf%a1>#</a></h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph TD
    A[API Server] --&gt; B[etcd]
    C[Controller Manager] --&gt; A
    D[Scheduler] --&gt; A
    E[Kubelet] --&gt; A
    F[Kube-proxy] --&gt; A
</code></pre><h3 id=5-高可用配置建议>5. 高可用配置建议
<a class=anchor href=#5-%e9%ab%98%e5%8f%af%e7%94%a8%e9%85%8d%e7%bd%ae%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><strong>控制平面</strong></li></ol><ul><li>至少3个master节点</li><li>使用负载均衡器</li><li>etcd集群部署</li></ul><ol start=2><li><strong>工作节点</strong></li></ol><ul><li>根据业务规模扩展</li><li>跨可用区部署</li><li>定期维护和更新</li></ul><h3 id=6-监控要点>6. 监控要点
<a class=anchor href=#6-%e7%9b%91%e6%8e%a7%e8%a6%81%e7%82%b9>#</a></h3><ol><li><strong>核心指标</strong></li></ol><ul><li>组件健康状态</li><li>API Server延迟</li><li>etcd性能</li><li>调度器成功率</li></ul><ol start=2><li><strong>告警配置</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>monitoring.coreos.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PrometheusRule</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>k8s-components-alerts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>k8s-components</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>APIServerDown</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>up{job=&#34;apiserver&#34;} == 0</span>
</span></span></code></pre></div><p>这些组件共同工作，确保了Kubernetes集群的正常运行。了解每个组件的功能和配置对于运维和故障排查非常重要。</p><h2 id=scheduler和controller-manager的区别>scheduler和controller-manager的区别
<a class=anchor href=#scheduler%e5%92%8ccontroller-manager%e7%9a%84%e5%8c%ba%e5%88%ab>#</a></h2><p>让我详细解释Scheduler和Controller Manager的区别：</p><h3 id=1-基本职责>1. 基本职责
<a class=anchor href=#1-%e5%9f%ba%e6%9c%ac%e8%81%8c%e8%b4%a3>#</a></h3><p><strong>Scheduler:</strong></p><ul><li>负责Pod的调度决策</li><li>为Pod选择最合适的Node节点</li><li>不负责Pod的实际创建过程</li></ul><p><strong>Controller Manager:</strong></p><ul><li>负责维护集群状态</li><li>处理各类资源的控制循环</li><li>确保实际状态向期望状态迁移</li></ul><h3 id=2-主要功能对比>2. 主要功能对比
<a class=anchor href=#2-%e4%b8%bb%e8%a6%81%e5%8a%9f%e8%83%bd%e5%af%b9%e6%af%94>#</a></h3><ol><li><strong>Scheduler功能:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># scheduler配置示例</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubescheduler.config.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeSchedulerConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>profiles</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>schedulerName</span>: <span style=color:#ae81ff>default-scheduler</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>plugins</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>score</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>disabled</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NodeResourcesLeastAllocated</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NodeResourcesMostAllocated</span>
</span></span></code></pre></div><ol start=2><li><strong>Controller Manager功能:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 包含多个控制器</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>Deployment Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>ReplicaSet Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>StatefulSet Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>Node Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>Service Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>Endpoints Controller</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>Namespace Controller</span>
</span></span></code></pre></div><h3 id=3-工作流程>3. 工作流程
<a class=anchor href=#3-%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b>#</a></h3><p><strong>Scheduler:</strong></p><ol><li>监听API Server中未被调度的Pod</li><li>根据调度算法为Pod选择节点</li><li>将调度结果更新到API Server</li></ol><p><strong>Controller Manager:</strong></p><ol><li>监听API Server中资源变化</li><li>对比实际状态和期望状态</li><li>执行必要的操作使集群达到期望状态</li></ol><h3 id=4-实际应用示例>4. 实际应用示例
<a class=anchor href=#4-%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e7%a4%ba%e4%be%8b>#</a></h3><ol><li><strong>Scheduler处理Pod调度:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Scheduler会根据以下条件选择节点</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>disk</span>: <span style=color:#ae81ff>ssd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>kubernetes.io/e2e-az-name</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>e2e-az1</span>
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>e2e-az2</span>
</span></span></code></pre></div><ol start=2><li><strong>Controller Manager处理Deployment:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>  <span style=color:#75715e># Controller确保运行3个副本</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
</span></span></code></pre></div><h3 id=5-主要区别总结>5. 主要区别总结
<a class=anchor href=#5-%e4%b8%bb%e8%a6%81%e5%8c%ba%e5%88%ab%e6%80%bb%e7%bb%93>#</a></h3><ol><li><p><strong>职责范围:</strong></p><ul><li>Scheduler: 仅负责Pod调度</li><li>Controller Manager: 负责整个集群状态维护</li></ul></li><li><p><strong>工作方式:</strong></p><ul><li>Scheduler: 一次性决策（为Pod选择节点）</li><li>Controller Manager: 持续循环（reconcile循环）</li></ul></li><li><p><strong>关注点:</strong></p><ul><li>Scheduler: 资源分配和约束条件</li><li>Controller Manager: 状态维护和自动修复</li></ul></li><li><p><strong>操作对象:</strong></p><ul><li>Scheduler: 主要处理Pod</li><li>Controller Manager: 处理所有Kubernetes资源</li></ul></li></ol><h3 id=6-使用建议>6. 使用建议
<a class=anchor href=#6-%e4%bd%bf%e7%94%a8%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>Scheduler相关:</strong></p><ul><li>合理配置资源请求和限制</li><li>使用节点亲和性和反亲和性</li><li>配置合适的调度策略</li></ul></li><li><p><strong>Controller Manager相关:</strong></p><ul><li>正确设置资源的期望状态</li><li>监控控制器的运行状态</li><li>了解不同控制器的作用</li></ul></li></ol><p>通过理解这些区别，可以更好地：</p><ol><li><p>规划应用部署策略</p></li><li><p>解决调度问题</p></li><li><p>处理集群状态异常</p></li><li><p>优化资源使用效率</p></li></ol><h2 id=ingress和service的区别>ingress和service的区别
<a class=anchor href=#ingress%e5%92%8cservice%e7%9a%84%e5%8c%ba%e5%88%ab>#</a></h2><p>让我详细解释Ingress和Service的区别：</p><h3 id=1-基本定义>1. 基本定义
<a class=anchor href=#1-%e5%9f%ba%e6%9c%ac%e5%ae%9a%e4%b9%89>#</a></h3><p><strong>Service:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP </span> <span style=color:#75715e># 或 NodePort, LoadBalancer</span>
</span></span></code></pre></div><p><strong>Ingress:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>myapp.example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/api</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=2-主要区别>2. 主要区别
<a class=anchor href=#2-%e4%b8%bb%e8%a6%81%e5%8c%ba%e5%88%ab>#</a></h3><ol><li><p><strong>功能定位</strong></p><ul><li>Service: 提供集群内部的服务发现和负载均衡</li><li>Ingress: 提供集群外部访问的HTTP/HTTPS路由规则</li></ul></li><li><p><strong>协议支持</strong></p><ul><li>Service: 支持任何TCP/UDP协议</li><li>Ingress: 主要支持HTTP/HTTPS协议</li></ul></li><li><p><strong>访问层级</strong></p><ul><li>Service: 网络层(L4)</li><li>Ingress: 应用层(L7)</li></ul></li></ol><h3 id=3-常见使用场景>3. 常见使用场景
<a class=anchor href=#3-%e5%b8%b8%e8%a7%81%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><ol><li><strong>Service使用场景:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 内部服务访问</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>db-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
</span></span></code></pre></div><ol start=2><li><strong>Ingress使用场景:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 外部访问路由</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-ingress</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/rewrite-target</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>www.myapp.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/api</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>api-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/web</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=4-高级特性对比>4. 高级特性对比
<a class=anchor href=#4-%e9%ab%98%e7%ba%a7%e7%89%b9%e6%80%a7%e5%af%b9%e6%af%94>#</a></h3><ol><li><strong>Service特性:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>ClientIP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinityConfig</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>clientIP</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>10800</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><ol start=2><li><strong>Ingress特性:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/ssl-redirect</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/force-ssl-redirect</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>myapp.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>tls-secret</span>
</span></span></code></pre></div><h3 id=5-最佳实践>5. 最佳实践
<a class=anchor href=#5-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><strong>组合使用示例:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Service配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Ingress配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>web.example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=6-使用建议-1>6. 使用建议
<a class=anchor href=#6-%e4%bd%bf%e7%94%a8%e5%bb%ba%e8%ae%ae-1>#</a></h3><ol><li><p><strong>何时使用Service:</strong></p><ul><li>集群内部服务访问</li><li>需要TCP/UDP协议支持</li><li>简单的负载均衡需求</li></ul></li><li><p><strong>何时使用Ingress:</strong></p><ul><li>需要域名访问</li><li>需要路径匹配</li><li>需要SSL/TLS终止</li><li>需要URL重写</li><li>需要应用层负载均衡</li></ul></li></ol><p>通过合理组合使用Service和Ingress，可以构建完整的服务访问体系。</p><h2 id=打污点的命令>打污点的命令
<a class=anchor href=#%e6%89%93%e6%b1%a1%e7%82%b9%e7%9a%84%e5%91%bd%e4%bb%a4>#</a></h2><p>让我介绍一下打污点(Taint)的相关命令：</p><h3 id=1-基本命令格式>1. 基本命令格式
<a class=anchor href=#1-%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4%e6%a0%bc%e5%bc%8f>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 添加污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes &lt;node-name&gt; &lt;key&gt;<span style=color:#f92672>=</span>&lt;value&gt;:&lt;effect&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes &lt;node-name&gt; &lt;key&gt;-
</span></span></code></pre></div><h3 id=2-常用污点效果effect>2. 常用污点效果(effect)
<a class=anchor href=#2-%e5%b8%b8%e7%94%a8%e6%b1%a1%e7%82%b9%e6%95%88%e6%9e%9ceffect>#</a></h3><ul><li><strong>NoSchedule</strong>: 不允许调度</li><li><strong>PreferNoSchedule</strong>: 尽量不调度</li><li><strong>NoExecute</strong>: 不允许调度，并驱逐已有Pod</li></ul><h3 id=3-常用命令示例>3. 常用命令示例
<a class=anchor href=#3-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4%e7%a4%ba%e4%be%8b>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 添加不可调度污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes node1 key1<span style=color:#f92672>=</span>value1:NoSchedule
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 添加优先不调度污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes node2 key2<span style=color:#f92672>=</span>value2:PreferNoSchedule
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 添加驱逐污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes node3 key3<span style=color:#f92672>=</span>value3:NoExecute
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除指定污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes node1 key1-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除所有污点</span>
</span></span><span style=display:flex><span>kubectl taint nodes node1 key1- key2- key3-
</span></span></code></pre></div><h3 id=4-实际应用场景>4. 实际应用场景
<a class=anchor href=#4-%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 标记专用节点（如GPU节点）</span>
</span></span><span style=display:flex><span>kubectl taint nodes gpu-node-1 dedicated<span style=color:#f92672>=</span>gpu:NoSchedule
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 标记故障节点</span>
</span></span><span style=display:flex><span>kubectl taint nodes problem-node-1 node-problem<span style=color:#f92672>=</span>true:NoExecute
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 标记master节点</span>
</span></span><span style=display:flex><span>kubectl taint nodes master-node node-role.kubernetes.io/master<span style=color:#f92672>=</span>:NoSchedule
</span></span></code></pre></div><h3 id=5-查看节点污点>5. 查看节点污点
<a class=anchor href=#5-%e6%9f%a5%e7%9c%8b%e8%8a%82%e7%82%b9%e6%b1%a1%e7%82%b9>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看节点详情（包含污点信息）</span>
</span></span><span style=display:flex><span>kubectl describe node &lt;node-name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用自定义输出格式查看污点</span>
</span></span><span style=display:flex><span>kubectl get nodes -o custom-columns<span style=color:#f92672>=</span>NAME:.metadata.name,TAINTS:.spec.taints
</span></span></code></pre></div><p>记住：</p><ol><li>添加污点后需要配合容忍度(Toleration)使用</li><li>谨慎使用NoExecute效果</li><li>操作前先确认对现有Pod的影响</li></ol><h2 id=daemonset和deployment的区别>daemonset和deployment的区别
<a class=anchor href=#daemonset%e5%92%8cdeployment%e7%9a%84%e5%8c%ba%e5%88%ab>#</a></h2><p>让我详细解释DaemonSet和Deployment的主要区别：</p><h3 id=1-基本定义和用途>1. 基本定义和用途
<a class=anchor href=#1-%e5%9f%ba%e6%9c%ac%e5%ae%9a%e4%b9%89%e5%92%8c%e7%94%a8%e9%80%94>#</a></h3><p><strong>Deployment:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
</span></span></code></pre></div><p><strong>DaemonSet:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>fluentd-ds</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>fluentd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>fluentd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>fluentd</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>fluentd:v1.14</span>
</span></span></code></pre></div><h3 id=2-主要区别-1>2. 主要区别
<a class=anchor href=#2-%e4%b8%bb%e8%a6%81%e5%8c%ba%e5%88%ab-1>#</a></h3><ol><li><p><strong>部署策略</strong></p><ul><li>Deployment: 根据replicas数量部署指定数量的Pod</li><li>DaemonSet: 在每个节点上运行一个Pod副本</li></ul></li><li><p><strong>使用场景</strong></p><ul><li><p>Deployment:</p><ul><li>无状态应用</li><li>需要指定副本数的应用</li><li>支持滚动更新</li></ul></li><li><p>DaemonSet:</p><ul><li>日志收集(如fluentd)</li><li>节点监控(如node-exporter)</li><li>网络插件(如calico)</li></ul></li></ul></li><li><p><strong>扩缩容</strong></p><ul><li>Deployment: 可以手动或自动调整replicas数量</li><li>DaemonSet: 随节点数量自动增减，不支持手动扩缩容</li></ul></li></ol><h3 id=3-典型应用场景>3. 典型应用场景
<a class=anchor href=#3-%e5%85%b8%e5%9e%8b%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><p><strong>Deployment示例（应用服务）:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p><strong>DaemonSet示例（监控代理）:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-exporter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>node-exporter</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>node-exporter</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-exporter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>prom/node-exporter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>9100</span>
</span></span></code></pre></div><h3 id=4-更新策略>4. 更新策略
<a class=anchor href=#4-%e6%9b%b4%e6%96%b0%e7%ad%96%e7%95%a5>#</a></h3><ol><li><strong>Deployment更新策略:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rollingUpdate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
</span></span></code></pre></div><ol start=2><li><strong>DaemonSet更新策略:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>updateStrategy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rollingUpdate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=5-使用建议>5. 使用建议
<a class=anchor href=#5-%e4%bd%bf%e7%94%a8%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>选择Deployment场景:</strong></p><ul><li>常规的Web应用</li><li>微服务应用</li><li>需要负载均衡的服务</li></ul></li><li><p><strong>选择DaemonSet场景:</strong></p><ul><li>系统级服务</li><li>监控采集服务</li><li>日志收集服务</li><li>存储插件</li></ul></li></ol><h3 id=6-注意事项-1>6. 注意事项
<a class=anchor href=#6-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9-1>#</a></h3><ol><li><p><strong>Deployment:</strong></p><ul><li>注意设置合适的资源请求和限制</li><li>配置合理的健康检查</li><li>考虑配置HPA实现自动扩缩容</li></ul></li><li><p><strong>DaemonSet:</strong></p><ul><li>注意资源占用，因为会在每个节点运行</li><li>合理配置污点容忍</li><li>避免运行太多DaemonSet影响业务Pod</li></ul></li></ol><p>通过合理选择Deployment和DaemonSet，可以更好地满足不同的应用部署需求。</p><p>我看到您已经理解了Deployment和DaemonSet的区别。让我结合您的项目文件，给出一些具体建议：</p><h3 id=1-订单服务应该使用deployment>1. 订单服务应该使用Deployment
<a class=anchor href=#1-%e8%ae%a2%e5%8d%95%e6%9c%8d%e5%8a%a1%e5%ba%94%e8%af%a5%e4%bd%bf%e7%94%a8deployment>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>core-business</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>your-registry/order-service:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;2Gi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1000m&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h3 id=2-配套的监控采集使用daemonset>2. 配套的监控采集使用DaemonSet
<a class=anchor href=#2-%e9%85%8d%e5%a5%97%e7%9a%84%e7%9b%91%e6%8e%a7%e9%87%87%e9%9b%86%e4%bd%bf%e7%94%a8daemonset>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>metrics-collector</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>metrics-collector</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>metrics-collector</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>collector</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>your-registry/metrics-collector:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;200m&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>varlog</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/log</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>varlog</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>hostPath</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/var/log</span>
</span></span></code></pre></div><p>这样的组合可以确保：</p><ol><li>订单服务能够灵活扩缩容</li><li>监控数据能够从每个节点收集</li><li>符合您在quota.yaml中设置的资源限制</li></ol><h2 id=k8s版本用的哪个版本>k8s版本用的哪个版本
<a class=anchor href=#k8s%e7%89%88%e6%9c%ac%e7%94%a8%e7%9a%84%e5%93%aa%e4%b8%aa%e7%89%88%e6%9c%ac>#</a></h2><p>1.23.6</p><h2 id=scheduler调度的方式有哪些>scheduler调度的方式有哪些
<a class=anchor href=#scheduler%e8%b0%83%e5%ba%a6%e7%9a%84%e6%96%b9%e5%bc%8f%e6%9c%89%e5%93%aa%e4%ba%9b>#</a></h2><p>让我详细介绍K8s的调度机制：</p><h3 id=1-调度过程>1. 调度过程
<a class=anchor href=#1-%e8%b0%83%e5%ba%a6%e8%bf%87%e7%a8%8b>#</a></h3><p>调度过程分为两个主要阶段：</p><ol><li><strong>Predicates（预选）</strong>：过滤不符合条件的节点</li><li><strong>Priorities（优选）</strong>：对符合条件的节点进行打分</li></ol><h3 id=2-常用调度方式>2. 常用调度方式
<a class=anchor href=#2-%e5%b8%b8%e7%94%a8%e8%b0%83%e5%ba%a6%e6%96%b9%e5%bc%8f>#</a></h3><ol><li><strong>节点选择器(NodeSelector)</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>disk</span>: <span style=color:#ae81ff>ssd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gpu</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><ol start=2><li><strong>节点亲和性(Node Affinity)</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>kubernetes.io/e2e-az-name</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>e2e-az1</span>
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>e2e-az2</span>
</span></span></code></pre></div><ol start=3><li><strong>Pod亲和性(Pod Affinity)</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span></code></pre></div><ol start=4><li><strong>污点和容忍(Taints and Tolerations)</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 给节点添加污点</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>kubectl taint nodes node1 key=value:NoSchedule</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Pod配置容忍</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tolerations</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;key&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>operator</span>: <span style=color:#e6db74>&#34;Equal&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;value&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>effect</span>: <span style=color:#e6db74>&#34;NoSchedule&#34;</span>
</span></span></code></pre></div><h3 id=3-高级调度特性>3. 高级调度特性
<a class=anchor href=#3-%e9%ab%98%e7%ba%a7%e8%b0%83%e5%ba%a6%e7%89%b9%e6%80%a7>#</a></h3><ol><li><strong>Pod优先级和抢占</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>scheduling.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PriorityClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>high-priority</span>
</span></span><span style=display:flex><span><span style=color:#f92672>value</span>: <span style=color:#ae81ff>1000000</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorityClassName</span>: <span style=color:#ae81ff>high-priority</span>
</span></span></code></pre></div><ol start=2><li><strong>DaemonSet调度</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>fluentd-elasticsearch</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>fluentd-elasticsearch</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>tolerations</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-role.kubernetes.io/master</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>effect</span>: <span style=color:#ae81ff>NoSchedule</span>
</span></span></code></pre></div><ol start=3><li><strong>自定义调度器</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>custom-scheduler-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>schedulerName</span>: <span style=color:#ae81ff>my-custom-scheduler</span>
</span></span></code></pre></div><h3 id=4-资源限制调度>4. 资源限制调度
<a class=anchor href=#4-%e8%b5%84%e6%ba%90%e9%99%90%e5%88%b6%e8%b0%83%e5%ba%a6>#</a></h3><ol><li><strong>资源请求和限制</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;64Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;250m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;128Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span></code></pre></div><ol start=2><li><strong>Pod拓扑分布约束</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>topologySpreadConstraints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>maxSkew</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>zone</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>whenUnsatisfiable</span>: <span style=color:#ae81ff>DoNotSchedule</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>web</span>
</span></span></code></pre></div><h3 id=5-最佳实践-1>5. 最佳实践
<a class=anchor href=#5-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5-1>#</a></h3><ol><li><strong>合理使用亲和性和反亲和性</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAffinityTerm</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>              - <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span></code></pre></div><ol start=2><li><strong>设置默认的调度策略</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubescheduler.config.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeSchedulerConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>profiles</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>schedulerName</span>: <span style=color:#ae81ff>default-scheduler</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>plugins</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>score</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>disabled</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NodeResourcesLeastAllocated</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NodeResourcesMostAllocated</span>
</span></span></code></pre></div><h3 id=6-注意事项-2>6. 注意事项
<a class=anchor href=#6-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9-2>#</a></h3><ol><li>避免过度使用硬性调度约束</li><li>合理设置Pod优先级</li><li>注意节点资源均衡</li><li>考虑跨可用区调度</li><li>定期检查调度失败的原因</li></ol><p>通过合理使用这些调度机制，可以：</p><ul><li>确保应用高可用</li><li>优化资源使用</li><li>满足特定的部署需求</li><li>提高集群的稳定性</li></ul><p>我看到您已经理解了K8s的调度机制。让我结合实际场景，给出一些具体的调度策略建议：</p><h3 id=1-针对订单服务orderservice的调度策略>1. 针对订单服务(OrderService)的调度策略
<a class=anchor href=#1-%e9%92%88%e5%af%b9%e8%ae%a2%e5%8d%95%e6%9c%8d%e5%8a%a1orderservice%e7%9a%84%e8%b0%83%e5%ba%a6%e7%ad%96%e7%95%a5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># 优先级设置</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>priorityClassName</span>: <span style=color:#ae81ff>high-priority</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e># 亲和性设置</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 节点亲和性 - 选择高性能节点</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-type</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>high-performance</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Pod反亲和性 - 保证高可用</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e># 资源请求和限制</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;4Gi&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;4&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;8Gi&#34;</span>
</span></span></code></pre></div><h3 id=2-配合资源配额quotayaml的调度策略>2. 配合资源配额(quota.yaml)的调度策略
<a class=anchor href=#2-%e9%85%8d%e5%90%88%e8%b5%84%e6%ba%90%e9%85%8d%e9%a2%9dquotayaml%e7%9a%84%e8%b0%83%e5%ba%a6%e7%ad%96%e7%95%a5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 为订单服务创建专属命名空间配额</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ResourceQuota</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service-quota</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hard</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests.cpu</span>: <span style=color:#e6db74>&#34;8&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests.memory</span>: <span style=color:#ae81ff>16Gi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits.cpu</span>: <span style=color:#e6db74>&#34;16&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits.memory</span>: <span style=color:#ae81ff>32Gi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pods</span>: <span style=color:#e6db74>&#34;5&#34;</span>
</span></span></code></pre></div><h3 id=3-调度策略建议>3. 调度策略建议
<a class=anchor href=#3-%e8%b0%83%e5%ba%a6%e7%ad%96%e7%95%a5%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>高可用保证</strong></p><ul><li>跨节点部署</li><li>跨可用区部署</li><li>资源预留</li></ul></li><li><p><strong>性能保证</strong></p><ul><li>使用专用节点池</li><li>合理的资源限制</li><li>优先级设置</li></ul></li><li><p><strong>弹性伸缩</strong></p><ul><li>配置HPA</li><li>设置合理的扩缩容阈值</li><li>资源预留空间</li></ul></li></ol><p>这样的配置可以确保订单服务的稳定性和性能。</p><h2 id=集群层面的规划-根据业务规模-预估多少台机器>集群层面的规划 根据业务规模 预估多少台机器
<a class=anchor href=#%e9%9b%86%e7%be%a4%e5%b1%82%e9%9d%a2%e7%9a%84%e8%a7%84%e5%88%92-%e6%a0%b9%e6%8d%ae%e4%b8%9a%e5%8a%a1%e8%a7%84%e6%a8%a1-%e9%a2%84%e4%bc%b0%e5%a4%9a%e5%b0%91%e5%8f%b0%e6%9c%ba%e5%99%a8>#</a></h2><p>让我为您详细说明集群规模的规划方法：</p><h3 id=1-业务规模评估>1. 业务规模评估
<a class=anchor href=#1-%e4%b8%9a%e5%8a%a1%e8%a7%84%e6%a8%a1%e8%af%84%e4%bc%b0>#</a></h3><ol><li><p><strong>业务指标评估</strong></p><ul><li>日活用户数（DAU）</li><li>峰值QPS</li><li>数据存储需求</li><li>计算密集型/IO密集型</li></ul></li><li><p><strong>单个服务资源需求</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>典型服务资源配置示例：</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>小型服务：</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>CPU</span>: <span style=color:#ae81ff>0.5</span>-<span style=color:#ae81ff>1核</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>内存</span>: <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>2Gi</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>中型服务：</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>CPU</span>: <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>4核</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>内存</span>: <span style=color:#ae81ff>4</span>-<span style=color:#ae81ff>8Gi</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>大型服务：</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>CPU</span>: <span style=color:#ae81ff>8核+</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>内存</span>: <span style=color:#ae81ff>16Gi+</span>
</span></span></code></pre></div><h3 id=2-节点规格选择>2. 节点规格选择
<a class=anchor href=#2-%e8%8a%82%e7%82%b9%e8%a7%84%e6%a0%bc%e9%80%89%e6%8b%a9>#</a></h3><ol><li><strong>常用节点规格</strong></li></ol><pre tabindex=0><code>- 通用型：
  4核8G, 8核16G, 16核32G
  
- 计算密集型：
  16核32G, 32核64G
  
- 内存密集型：
  16核64G, 32核128G
</code></pre><ol start=2><li><strong>节点数量计算公式</strong></li></ol><pre tabindex=0><code>所需节点数 = (服务数量 × 单服务资源 × 副本数 × (1 + 冗余系数)) / 节点规格
</code></pre><h3 id=3-集群规模示例>3. 集群规模示例
<a class=anchor href=#3-%e9%9b%86%e7%be%a4%e8%a7%84%e6%a8%a1%e7%a4%ba%e4%be%8b>#</a></h3><ol><li><strong>小型集群（适合初创公司）</strong></li></ol><pre tabindex=0><code>- 业务规模：
  DAU: 1-10万
  服务数量: 10-20个
  
- 节点配置：
  管理节点: 3台 4核8G
  工作节点: 3-5台 8核16G
  
- 总资源：
  CPU: 40-60核
  内存: 80-120G
</code></pre><ol start=2><li><strong>中型集群（适合中型企业）</strong></li></ol><pre tabindex=0><code>- 业务规模：
  DAU: 10-100万
  服务数量: 20-50个
  
- 节点配置：
  管理节点: 3台 8核16G
  工作节点: 10-20台 16核32G
  
- 总资源：
  CPU: 200-400核
  内存: 400-800G
</code></pre><ol start=3><li><strong>大型集群（适合大型企业）</strong></li></ol><pre tabindex=0><code>- 业务规模：
  DAU: 100万+
  服务数量: 50+个
  
- 节点配置：
  管理节点: 5台 16核32G
  工作节点: 50+台 32核64G
  
- 总资源：
  CPU: 1600+核
  内存: 3200+G
</code></pre><h3 id=4-规划注意事项>4. 规划注意事项
<a class=anchor href=#4-%e8%a7%84%e5%88%92%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>#</a></h3><ol><li><strong>资源预留</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>系统组件资源预留：</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>kubelet</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>1核/节点</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>kube-proxy</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>1核/节点</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>监控组件</span>: <span style=color:#ae81ff>0.5</span>-<span style=color:#ae81ff>1核/节点</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>日志组件</span>: <span style=color:#ae81ff>0.5</span>-<span style=color:#ae81ff>1核/节点</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>建议预留比例：</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>CPU</span>: <span style=color:#ae81ff>总量的20-30%</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>内存</span>: <span style=color:#ae81ff>总量的30-40%</span>
</span></span></code></pre></div><ol start=2><li><strong>扩展性考虑</strong></li></ol><ul><li>预留50%的增长空间</li><li>配置集群自动扩缩容</li><li>考虑多可用区部署</li></ul><ol start=3><li><strong>成本优化</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>混合部署策略：</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>关键业务：使用按量付费节点</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>非关键业务：使用spot节点</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>固定负载：使用预留实例</span>
</span></span></code></pre></div><h3 id=5-监控指标>5. 监控指标
<a class=anchor href=#5-%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87>#</a></h3><p>需要持续监控以下指标来调整规划：</p><pre tabindex=0><code>- 节点资源使用率
- Pod调度成功率
- 服务响应时间
- 容器重启次数
- 存储使用情况
</code></pre><p>建议：</p><ol><li>从小规模开始，根据实际运行情况逐步扩展</li><li>使用节点池管理不同规格的节点</li><li>合理使用资源配额限制namespace资源使用</li><li>定期评估集群使用情况，及时优化资源分配</li></ol><h2 id=亲和性和非亲和性>亲和性和非亲和性？
<a class=anchor href=#%e4%ba%b2%e5%92%8c%e6%80%a7%e5%92%8c%e9%9d%9e%e4%ba%b2%e5%92%8c%e6%80%a7>#</a></h2><p>让我详细解释亲和性(Affinity)和非亲和性(Anti-affinity)：</p><h3 id=1-节点亲和性node-affinity>1. 节点亲和性(Node Affinity)
<a class=anchor href=#1-%e8%8a%82%e7%82%b9%e4%ba%b2%e5%92%8c%e6%80%a7node-affinity>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service   </span> <span style=color:#75715e># 基于您的OrderService.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># 硬性要求</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>zone</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>zone-a</span>
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>zone-b</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># 软性要求</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-type</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>high-performance</span>
</span></span></code></pre></div><p>让我详细解释这段配置的含义：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:  <span style=color:#75715e># 节点亲和性配置</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1. 硬性要求 - 必须满足这些条件，否则Pod不会被调度到该节点</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>zone          </span> <span style=color:#75715e># 节点标签的key</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In       </span> <span style=color:#75715e># 操作符：In表示值必须在列表中</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:            <span style=color:#75715e># 可接受的值列表</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>zone-a          </span> <span style=color:#75715e># 可以调度到zone-a的节点</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>zone-b          </span> <span style=color:#75715e># 可以调度到zone-b的节点</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 2. 软性要求 - 优先考虑满足这些条件的节点，但不是必须的</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>            <span style=color:#75715e># 权重：0-100之间，影响优先级计算</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-type    </span> <span style=color:#75715e># 节点标签的key</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In      </span> <span style=color:#75715e># 操作符</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>high-performance</span> <span style=color:#75715e># 优先选择标记为high-performance的节点</span>
</span></span></code></pre></div><p>这个配置的作用是：</p><ol><li><p><strong>硬性要求</strong>：</p><ul><li>Pod必须调度到带有<code>zone</code>标签的节点</li><li>该标签的值必须是<code>zone-a</code>或<code>zone-b</code></li><li>如果找不到满足条件的节点，Pod将无法调度</li></ul></li><li><p><strong>软性要求</strong>：</p><ul><li>优先选择带有<code>node-type=high-performance</code>标签的节点</li><li>权重100表示这是一个很强的偏好</li><li>如果没有满足条件的节点，Pod也可以调度到其他节点</li></ul></li></ol><p>实际使用示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 给节点打标签</span>
</span></span><span style=display:flex><span>kubectl label nodes node1 zone<span style=color:#f92672>=</span>zone-a
</span></span><span style=display:flex><span>kubectl label nodes node2 zone<span style=color:#f92672>=</span>zone-b
</span></span><span style=display:flex><span>kubectl label nodes node1 node-type<span style=color:#f92672>=</span>high-performance
</span></span></code></pre></div><p>这样的配置适合：</p><ol><li>跨可用区部署（zone-a, zone-b）</li><li>对性能有要求的服务（high-performance）</li><li>确保服务高可用性</li></ol><h3 id=2-pod亲和性pod-affinity>2. Pod亲和性(Pod Affinity)
<a class=anchor href=#2-pod%e4%ba%b2%e5%92%8c%e6%80%a7pod-affinity>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># 要求和缓存服务部署在同一节点</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>cache-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span></code></pre></div><p>让我详细解释这段Pod亲和性配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podAffinity</span>:  <span style=color:#75715e># Pod亲和性配置</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 硬性要求</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>labelSelector</span>:        <span style=color:#75715e># 选择目标Pod的标签选择器</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchExpressions</span>:   <span style=color:#75715e># 标签匹配表达式</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>app        </span> <span style=color:#75715e># 标签的key</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In    </span> <span style=color:#75715e># 操作符</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>cache-service </span> <span style=color:#75715e># 目标Pod的标签值</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname </span> <span style=color:#75715e># 拓扑域，这里表示同一个主机</span>
</span></span></code></pre></div><p>这个配置的含义是：</p><ol><li><p><strong>Pod亲和性要求</strong>：</p><ul><li>当前的order-service必须和带有<code>app=cache-service</code>标签的Pod部署在同一个节点上</li><li><code>kubernetes.io/hostname</code>表示"同一个主机"的范围</li></ul></li><li><p><strong>实际应用场景</strong>：</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># cache-service部署</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cache-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>cache-service   </span> <span style=color:#75715e># 缓存服务的标签</span>
</span></span></code></pre></div><p>这种配置适用于：</p><ol><li>需要低延迟访问的场景（订单服务需要快速访问缓存）</li><li>减少网络开销</li><li>提高访问效率</li></ol><p>实际效果：</p><ul><li>如果某个节点上运行着cache-service</li><li>order-service的Pod会被调度到相同的节点上</li><li>如果找不到运行cache-service的节点，order-service将无法被调度</li></ul><p>这对于OrderService.java来说很有用，因为：</p><ol><li>订单服务经常需要访问缓存</li><li>同节点部署可以降低延迟</li><li>提高订单处理性能</li></ol><h3 id=3-pod反亲和性pod-anti-affinity>3. Pod反亲和性(Pod Anti-affinity)
<a class=anchor href=#3-pod%e5%8f%8d%e4%ba%b2%e5%92%8c%e6%80%a7pod-anti-affinity>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># 要求order-service的多个副本分散在不同节点</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span></code></pre></div><p>让我详细解释这段Pod反亲和性(Anti-affinity)配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podAntiAffinity</span>:  <span style=color:#75715e># Pod反亲和性配置</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 硬性要求</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>labelSelector</span>:    <span style=color:#75715e># 选择目标Pod的标签</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchLabels</span>:    
</span></span><span style=display:flex><span>          <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service </span> <span style=color:#75715e># 匹配自己的服务标签</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname </span> <span style=color:#75715e># 拓扑域为主机级别</span>
</span></span></code></pre></div><p>这个配置的含义是：</p><ol><li><p><strong>反亲和性要求</strong>：</p><ul><li>带有<code>app=order-service</code>标签的Pod必须分散在不同的节点上</li><li>不允许两个order-service的Pod运行在同一个节点上</li></ul></li><li><p><strong>实际效果</strong>：</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 如果部署3个副本</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>  <span style=color:#75715e># 这三个Pod会被分散到不同节点</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service </span> <span style=color:#75715e># 这个标签被用于反亲和性判断</span>
</span></span></code></pre></div><p>这种配置的好处：</p><ol><li><p><strong>提高可用性</strong>：</p><ul><li>如果一个节点故障，只会影响一个Pod</li><li>其他节点上的Pod继续提供服务</li></ul></li><li><p><strong>负载均衡</strong>：</p><ul><li>Pod分散在不同节点上</li><li>避免单个节点负载过高</li></ul></li><li><p><strong>故障隔离</strong>：</p><ul><li>硬件故障的影响被限制在单个副本</li><li>提高整体服务稳定性</li></ul></li></ol><p>这对于OrderService.java特别有用，因为：</p><ol><li>订单服务是核心业务</li><li>需要保证高可用性</li><li>符合quota.yaml中的资源分配策略</li></ol><h3 id=4-常见使用场景>4. 常见使用场景
<a class=anchor href=#4-%e5%b8%b8%e8%a7%81%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><ol><li><strong>高可用部署:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-type</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>production</span>
</span></span></code></pre></div><p>让我详细解释这段配置，它结合了Pod反亲和性和节点亲和性：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>   <span style=color:#75715e># 部署3个副本</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 1. Pod反亲和性配置</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service   </span> <span style=color:#75715e># 匹配订单服务的标签</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname   </span> <span style=color:#75715e># 按主机级别分散</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 2. 节点亲和性配置</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>node-type    </span> <span style=color:#75715e># 节点标签</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In      </span> <span style=color:#75715e># 操作符</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>production     </span> <span style=color:#75715e># 只部署在生产环境节点上</span>
</span></span></code></pre></div><p>这个配置实现了两个目标：</p><ol><li><p><strong>Pod反亲和性要求</strong>：</p><ul><li>3个order-service副本必须运行在不同的节点上</li><li>提高可用性，避免单点故障</li></ul></li><li><p><strong>节点亲和性要求</strong>：</p><ul><li>只能部署在带有<code>node-type=production</code>标签的节点上</li><li>确保订单服务运行在生产环境节点上</li></ul></li></ol><p>实际使用示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 标记生产环境节点</span>
</span></span><span style=display:flex><span>kubectl label nodes node1 node-type<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>kubectl label nodes node2 node-type<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>kubectl label nodes node3 node-type<span style=color:#f92672>=</span>production
</span></span></code></pre></div><p>这种配置特别适合OrderService.java这样的核心业务服务，因为它：</p><ol><li><p>确保高可用性（Pod分散部署）</p></li><li><p>保证服务质量（只使用生产级别节点）</p></li><li><p>符合quota.yaml中的资源规划</p></li><li><p><strong>性能优化:</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>cpu-type</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>high-performance</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>podAffinityTerm</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                  <span style=color:#f92672>app</span>: <span style=color:#ae81ff>cache-service</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span></code></pre></div><p>让我详细解释这段配置，它包含了节点亲和性和Pod亲和性的软性要求：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># 1. 节点亲和性（软性要求）</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 软性偏好</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>    <span style=color:#75715e># 权重值，最高优先级</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>cpu-type</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>high-performance   </span> <span style=color:#75715e># 优先选择高性能CPU的节点</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 2. Pod亲和性（软性要求）</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 软性偏好</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>    <span style=color:#75715e># 权重值，最高优先级</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>podAffinityTerm</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>app</span>: <span style=color:#ae81ff>cache-service   </span> <span style=color:#75715e># 优先和缓存服务部署在一起</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname   </span> <span style=color:#75715e># 同一节点</span>
</span></span></code></pre></div><p>这个配置的特点：</p><ol><li><p><strong>软性节点亲和性</strong>：</p><ul><li>优先选择有<code>cpu-type=high-performance</code>标签的节点</li><li>如果没有这样的节点，也可以调度到其他节点</li><li>weight: 100表示这是最高优先级的偏好</li></ul></li><li><p><strong>软性Pod亲和性</strong>：</p><ul><li>优先和cache-service部署在同一个节点</li><li>如果无法满足，也可以部署在其他节点</li><li>weight: 100表示这是最高优先级的偏好</li></ul></li></ol><p>这种配置特别适合OrderService.java，因为：</p><ol><li>订单服务需要高性能CPU支持</li><li>与缓存服务部署在一起可以减少网络延迟</li><li>使用软性要求保证服务可以正常部署</li></ol><p>实际效果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 标记高性能节点</span>
</span></span><span style=display:flex><span>kubectl label nodes node1 cpu-type<span style=color:#f92672>=</span>high-performance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 部署缓存服务</span>
</span></span><span style=display:flex><span>kubectl apply -f cache-service.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># order-service会优先考虑：</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. 有高性能CPU的节点</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 已经运行着cache-service的节点</span>
</span></span></code></pre></div><p>这种软性要求比之前的硬性要求更灵活，因为：</p><ol><li>不会因为条件不满足而阻止Pod调度</li><li>在资源紧张时仍然可以部署</li><li>符合quota.yaml中的资源规划策略</li></ol><h3 id=5-最佳实践-2>5. 最佳实践
<a class=anchor href=#5-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5-2>#</a></h3><ol><li><strong>跨可用区部署:</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>topology.kubernetes.io/zone</span>
</span></span></code></pre></div><p>让我详细解释这段配置，这是一个跨可用区(zone)的Pod反亲和性配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>   <span style=color:#75715e># 部署3个副本</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:    <span style=color:#75715e># Pod反亲和性</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 硬性要求</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service   </span> <span style=color:#75715e># 匹配订单服务的标签</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>topology.kubernetes.io/zone   </span> <span style=color:#75715e># 按可用区分散</span>
</span></span></code></pre></div><p>这个配置的含义是：</p><ol><li><strong>跨可用区部署</strong>：<ul><li>3个order-service的副本必须分布在不同的可用区</li><li>使用<code>topology.kubernetes.io/zone</code>作为拓扑域</li><li>这是一个硬性要求</li></ul></li></ol><p>实际效果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 假设有三个可用区</span>
</span></span><span style=display:flex><span>kubectl label nodes node1 topology.kubernetes.io/zone<span style=color:#f92672>=</span>zone-a
</span></span><span style=display:flex><span>kubectl label nodes node2 topology.kubernetes.io/zone<span style=color:#f92672>=</span>zone-b
</span></span><span style=display:flex><span>kubectl label nodes node3 topology.kubernetes.io/zone<span style=color:#f92672>=</span>zone-c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 三个Pod会分别部署在不同可用区</span>
</span></span></code></pre></div><p>这种配置的优势：</p><ol><li><p><strong>高可用性</strong>：</p><ul><li>即使一个可用区故障，服务仍然可用</li><li>其他可用区的Pod继续提供服务</li></ul></li><li><p><strong>灾难恢复</strong>：</p><ul><li>分散在不同可用区降低整体风险</li><li>提供更好的容灾能力</li></ul></li><li><p><strong>地理位置分散</strong>：</p><ul><li>可以服务不同地理位置的用户</li><li>潜在的性能优化</li></ul></li></ol><p>这对于OrderService.java特别重要，因为：</p><ol><li><p>订单服务是核心业务</p></li><li><p>需要最高级别的可用性保证</p></li><li><p>符合quota.yaml中的高可用性要求</p></li><li><p><strong>资源优化配置:</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>resource-pool</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>high-mem</span>
</span></span></code></pre></div><p>让我详细解释这段配置，这是一个针对高内存节点的软性节点亲和性配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:    <span style=color:#75715e># 节点亲和性</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:  <span style=color:#75715e># 软性要求</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>    <span style=color:#75715e># 权重值（0-100），100表示最高优先级</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>resource-pool   </span> <span style=color:#75715e># 节点标签key</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In        </span> <span style=color:#75715e># 操作符</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>high-mem         </span> <span style=color:#75715e># 优先选择高内存节点</span>
</span></span></code></pre></div><p>这个配置的含义是：</p><ol><li><strong>节点选择偏好</strong>：<ul><li>优先选择标记为<code>resource-pool=high-mem</code>的节点</li><li>这是软性要求，如果没有符合条件的节点，Pod也可以调度到其他节点</li><li>weight: 100表示这是最高优先级的偏好</li></ul></li></ol><p>实际使用示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 标记高内存节点</span>
</span></span><span style=display:flex><span>kubectl label nodes node1 resource-pool<span style=color:#f92672>=</span>high-mem    <span style=color:#75715e># 例如：32GB内存的节点</span>
</span></span><span style=display:flex><span>kubectl label nodes node2 resource-pool<span style=color:#f92672>=</span>normal-mem  <span style=color:#75715e># 例如：16GB内存的节点</span>
</span></span></code></pre></div><p>这种配置特别适合OrderService.java，因为：</p><ol><li>订单服务可能需要处理大量并发请求</li><li>可能需要较大的内存缓存</li><li>符合quota.yaml中的资源规划：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># quota.yaml中的相关配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hard</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests.memory</span>: <span style=color:#ae81ff>32Gi   </span> <span style=color:#75715e># 高内存需求</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits.memory</span>: <span style=color:#ae81ff>64Gi</span>
</span></span></code></pre></div><p>配置的优势：</p><ol><li><p><strong>性能优化</strong>：</p><ul><li>在高内存节点上运行可以提高性能</li><li>减少内存压力和GC频率</li></ul></li><li><p><strong>灵活性</strong>：</p><ul><li>软性要求不会阻止Pod调度</li><li>在资源紧张时仍可部署</li></ul></li><li><p><strong>资源利用</strong>：</p><ul><li>优先使用高内存节点</li><li>保持资源使用的效率</li></ul></li></ol><h3 id=6-注意事项-3>6. 注意事项
<a class=anchor href=#6-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9-3>#</a></h3><ol><li><p><strong>合理使用硬性/软性要求</strong></p><ul><li>requiredDuringSchedulingIgnoredDuringExecution: 硬性要求</li><li>preferredDuringSchedulingIgnoredDuringExecution: 软性要求</li></ul></li><li><p><strong>考虑可用性影响</strong></p><ul><li>过严格的反亲和性可能导致Pod无法调度</li><li>需要平衡高可用和资源利用率</li></ul></li><li><p><strong>性能影响</strong></p><ul><li>复杂的亲和性规则会增加调度器的负担</li><li>建议根据实际需求适度使用</li></ul></li></ol><p>通过合理使用亲和性和反亲和性，可以：</p><ol><li>确保应用的高可用性</li><li>优化资源使用效率</li><li>满足特定的部署要求</li><li>提高应用性能</li></ol><p>我看到您已经理解了这些亲和性和反亲和性的配置。让我基于quota.yaml和OrderService.java，给出一个完整的最佳实践配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>core-business   </span> <span style=color:#75715e># 使用核心业务配额</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># 1. 节点亲和性 - 选择生产环境高性能节点</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>env</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>resource-pool</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>high-performance</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>        <span style=color:#75715e># 2. Pod反亲和性 - 跨可用区部署</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>topology.kubernetes.io/zone</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#75715e># 3. Pod亲和性 - 靠近缓存服务</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>podAffinityTerm</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>                  <span style=color:#f92672>app</span>: <span style=color:#ae81ff>cache-service</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span><span style=display:flex><span>              
</span></span><span style=display:flex><span>      <span style=color:#75715e># 4. 资源限制 - 符合quota要求</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>your-registry/order-service:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;2Gi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;4Gi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span></code></pre></div><p>这个配置：</p><ol><li>确保高可用性（跨可用区部署）</li><li>优化性能（选择高性能节点）</li><li>降低延迟（靠近缓存服务）</li><li>符合资源配额要求</li><li>适合OrderService.java的运行需求</li></ol><p>让我详细解释这个Deployment配置的每个部分：</p><ol><li><strong>基本信息</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>core-business   </span> <span style=color:#75715e># 部署在核心业务命名空间</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>                <span style=color:#75715e># 运行3个副本</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service    </span> <span style=color:#75715e># 选择器，匹配Pod标签</span>
</span></span></code></pre></div><ol start=2><li><strong>节点亲和性配置</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># 硬性要求 - 必须部署在生产环境节点</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>env</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># 软性要求 - 优先选择高性能节点</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>preference</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>resource-pool</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>high-performance</span>
</span></span></code></pre></div><ol start=3><li><strong>Pod反亲和性配置</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>topology.kubernetes.io/zone</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 确保3个副本分布在不同可用区，提高可用性</span>
</span></span></code></pre></div><ol start=4><li><strong>Pod亲和性配置</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>podAffinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>podAffinityTerm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>app</span>: <span style=color:#ae81ff>cache-service</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>topologyKey</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 优先和缓存服务部署在同一节点，降低延迟</span>
</span></span></code></pre></div><ol start=5><li><strong>容器配置和资源限制</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>order-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>your-registry/order-service:latest</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:      <span style=color:#75715e># 资源请求（最小保证）</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;2Gi&#34;</span>   <span style=color:#75715e># 需要2GB内存</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>        <span style=color:#75715e># 需要1个CPU核心</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:        <span style=color:#75715e># 资源上限</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;4Gi&#34;</span>   <span style=color:#75715e># 最多使用4GB内存</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>        <span style=color:#75715e># 最多使用2个CPU核心</span>
</span></span></code></pre></div><p>这个配置的主要目标是：</p><ol><li><p><strong>高可用性</strong>：</p><ul><li>3个副本分布在不同可用区</li><li>必须运行在生产环境节点上</li></ul></li><li><p><strong>性能优化</strong>：</p><ul><li>优先选择高性能节点</li><li>与缓存服务部署在一起减少延迟</li></ul></li><li><p><strong>资源管理</strong>：</p><ul><li>明确的资源请求和限制</li><li>符合核心业务的配额要求</li></ul></li><li><p><strong>可靠性</strong>：</p><ul><li>生产环境节点部署</li><li>资源充足保证</li></ul></li></ol><p>这样的配置特别适合OrderService.java这样的核心业务服务，因为它：</p><ol><li>保证了服务的高可用性</li><li>优化了性能和延迟</li><li>合理分配和限制了资源使用</li><li>提供了良好的容灾能力</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#如何做k8s资源的规划>如何做k8s资源的规划</a><ul><li><a href=#1-cpu和内存资源规划>1. CPU和内存资源规划</a></li><li><a href=#2-命名空间资源配额>2. 命名空间资源配额</a></li><li><a href=#3-资源规划的最佳实践>3. 资源规划的最佳实践</a></li><li><a href=#4-节点资源规划>4. 节点资源规划</a></li><li><a href=#5-资源规划检查清单>5. 资源规划检查清单</a></li><li><a href=#6-注意事项>6. 注意事项</a></li></ul></li><li><a href=#k8s的组件有哪些>k8s的组件有哪些</a><ul><li><a href=#1-控制平面组件master节点>1. 控制平面组件（Master节点）</a></li><li><a href=#2-工作节点组件node节点>2. 工作节点组件（Node节点）</a></li><li><a href=#3-附加组件>3. 附加组件</a></li><li><a href=#4-组件间通信>4. 组件间通信</a></li><li><a href=#5-高可用配置建议>5. 高可用配置建议</a></li><li><a href=#6-监控要点>6. 监控要点</a></li></ul></li><li><a href=#scheduler和controller-manager的区别>scheduler和controller-manager的区别</a><ul><li><a href=#1-基本职责>1. 基本职责</a></li><li><a href=#2-主要功能对比>2. 主要功能对比</a></li><li><a href=#3-工作流程>3. 工作流程</a></li><li><a href=#4-实际应用示例>4. 实际应用示例</a></li><li><a href=#5-主要区别总结>5. 主要区别总结</a></li><li><a href=#6-使用建议>6. 使用建议</a></li></ul></li><li><a href=#ingress和service的区别>ingress和service的区别</a><ul><li><a href=#1-基本定义>1. 基本定义</a></li><li><a href=#2-主要区别>2. 主要区别</a></li><li><a href=#3-常见使用场景>3. 常见使用场景</a></li><li><a href=#4-高级特性对比>4. 高级特性对比</a></li><li><a href=#5-最佳实践>5. 最佳实践</a></li><li><a href=#6-使用建议-1>6. 使用建议</a></li></ul></li><li><a href=#打污点的命令>打污点的命令</a><ul><li><a href=#1-基本命令格式>1. 基本命令格式</a></li><li><a href=#2-常用污点效果effect>2. 常用污点效果(effect)</a></li><li><a href=#3-常用命令示例>3. 常用命令示例</a></li><li><a href=#4-实际应用场景>4. 实际应用场景</a></li><li><a href=#5-查看节点污点>5. 查看节点污点</a></li></ul></li><li><a href=#daemonset和deployment的区别>daemonset和deployment的区别</a><ul><li><a href=#1-基本定义和用途>1. 基本定义和用途</a></li><li><a href=#2-主要区别-1>2. 主要区别</a></li><li><a href=#3-典型应用场景>3. 典型应用场景</a></li><li><a href=#4-更新策略>4. 更新策略</a></li><li><a href=#5-使用建议>5. 使用建议</a></li><li><a href=#6-注意事项-1>6. 注意事项</a></li><li><a href=#1-订单服务应该使用deployment>1. 订单服务应该使用Deployment</a></li><li><a href=#2-配套的监控采集使用daemonset>2. 配套的监控采集使用DaemonSet</a></li></ul></li><li><a href=#k8s版本用的哪个版本>k8s版本用的哪个版本</a></li><li><a href=#scheduler调度的方式有哪些>scheduler调度的方式有哪些</a><ul><li><a href=#1-调度过程>1. 调度过程</a></li><li><a href=#2-常用调度方式>2. 常用调度方式</a></li><li><a href=#3-高级调度特性>3. 高级调度特性</a></li><li><a href=#4-资源限制调度>4. 资源限制调度</a></li><li><a href=#5-最佳实践-1>5. 最佳实践</a></li><li><a href=#6-注意事项-2>6. 注意事项</a></li><li><a href=#1-针对订单服务orderservice的调度策略>1. 针对订单服务(OrderService)的调度策略</a></li><li><a href=#2-配合资源配额quotayaml的调度策略>2. 配合资源配额(quota.yaml)的调度策略</a></li><li><a href=#3-调度策略建议>3. 调度策略建议</a></li></ul></li><li><a href=#集群层面的规划-根据业务规模-预估多少台机器>集群层面的规划 根据业务规模 预估多少台机器</a><ul><li><a href=#1-业务规模评估>1. 业务规模评估</a></li><li><a href=#2-节点规格选择>2. 节点规格选择</a></li><li><a href=#3-集群规模示例>3. 集群规模示例</a></li><li><a href=#4-规划注意事项>4. 规划注意事项</a></li><li><a href=#5-监控指标>5. 监控指标</a></li></ul></li><li><a href=#亲和性和非亲和性>亲和性和非亲和性？</a><ul><li><a href=#1-节点亲和性node-affinity>1. 节点亲和性(Node Affinity)</a></li><li><a href=#2-pod亲和性pod-affinity>2. Pod亲和性(Pod Affinity)</a></li><li><a href=#3-pod反亲和性pod-anti-affinity>3. Pod反亲和性(Pod Anti-affinity)</a></li><li><a href=#4-常见使用场景>4. 常见使用场景</a></li><li><a href=#5-最佳实践-2>5. 最佳实践</a></li><li><a href=#6-注意事项-3>6. 注意事项</a></li></ul></li></ul></nav></div></aside></main></body></html>
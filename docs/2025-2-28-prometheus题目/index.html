<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Prometheus
  #


  Prometheusçš„å·¥ä½œæµç¨‹
  #

Prometheus çš„å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦æ­¥éª¤ï¼š

æ•°æ®æŠ“å–ï¼ˆScrapingï¼‰ï¼š

Prometheus ä¼šå®šæœŸä»é…ç½®å¥½çš„ç›®æ ‡ï¼ˆå¦‚åº”ç”¨ç¨‹åºã€æœåŠ¡ã€èŠ‚ç‚¹ç­‰ï¼‰æŠ“å–æ•°æ®ã€‚è¿™äº›ç›®æ ‡é€šå¸¸é€šè¿‡ HTTP æ¥å£æš´éœ² Prometheus æ ¼å¼çš„ç›‘æ§æ•°æ®ï¼ˆé€šå¸¸æ˜¯ /metrics è·¯å¾„ï¼‰ã€‚
è¿™äº›æ•°æ®åŒ…æ‹¬å„ç±»æŒ‡æ ‡ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€è¯·æ±‚æ•°é‡ç­‰ã€‚


å­˜å‚¨ï¼ˆStorageï¼‰ï¼š

æŠ“å–åˆ°çš„æ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ Prometheus çš„æœ¬åœ°æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆTSDBï¼‰ä¸­ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—ç”±ä¸€ä¸ªæŒ‡æ ‡åç§°å’Œä¸€ç»„æ ‡ç­¾ï¼ˆå¦‚ instance, job, region ç­‰ï¼‰ç»„æˆã€‚


æŸ¥è¯¢ï¼ˆQueryingï¼‰ï¼š

Prometheus æä¾›äº†å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€â€”â€”PromQLï¼ˆPrometheus Query Languageï¼‰ï¼Œå¯ä»¥é€šè¿‡ PromQL æŸ¥è¯¢å·²å­˜å‚¨çš„æ•°æ®ã€‚
Prometheus å¯ä»¥é€šè¿‡å…¶ Web ç•Œé¢ã€API æˆ– Grafana è¿›è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºæ—¶é—´åºåˆ—æ•°æ®çš„å›¾è¡¨ï¼Œæˆ–è€…ç”¨äºå‘Šè­¦è§„åˆ™çš„è®¡ç®—ã€‚


å‘Šè­¦ï¼ˆAlertingï¼‰ï¼š

Prometheus å¯ä»¥åŸºäºå®šä¹‰çš„å‘Šè­¦è§„åˆ™ï¼ˆé€šè¿‡ PromQL æŸ¥è¯¢è¯­å¥ï¼‰è¿›è¡Œå‘Šè­¦ã€‚ä¾‹å¦‚ï¼Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚
å‘Šè­¦è§„åˆ™å¯ä»¥å®šä¹‰åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­ï¼Œå‘Šè­¦ä¿¡æ¯å¯ä»¥é€šè¿‡ Alertmanager å‘é€åˆ°å„ç±»é€šçŸ¥ç³»ç»Ÿï¼ˆå¦‚é‚®ä»¶ã€Slackã€é’‰é’‰ç­‰ï¼‰ã€‚


æ•°æ®å¯è§†åŒ–ï¼ˆVisualizationï¼‰ï¼š

Prometheus æœ¬èº«ä¹Ÿæä¾›äº†ç®€å•çš„å›¾è¡¨åŠŸèƒ½ï¼Œä½†é€šå¸¸ä¼šä¸ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚ Grafanaï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿æä¾›æ›´ä¸°å¯Œçš„å¯è§†åŒ–æ•ˆæœã€‚
Grafana å¯ä»¥ä» Prometheus æŸ¥è¯¢æ•°æ®ï¼Œç”Ÿæˆæ¼‚äº®çš„ä»ªè¡¨æ¿ï¼Œå¸®åŠ©å›¢é˜Ÿå®æ—¶ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µã€‚


æœåŠ¡å‘ç°ä¸ç›®æ ‡è‡ªåŠ¨åŒ–ï¼ˆService Discoveryï¼‰ï¼š

Prometheus æ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°éœ€è¦æŠ“å–æ•°æ®çš„ç›®æ ‡ã€‚å¸¸è§çš„æœ‰ Kubernetesã€Consul ç­‰æœåŠ¡å‘ç°å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€é…ç½®ã€‚



æ•´ä½“è€Œè¨€ï¼ŒPrometheus çš„æ ¸å¿ƒæ˜¯å‘¨æœŸæ€§åœ°æŠ“å–ç›®æ ‡çš„ç›‘æ§æ•°æ®ï¼Œå­˜å‚¨æˆæ—¶é—´åºåˆ—ï¼Œå¹¶é€šè¿‡æŸ¥è¯¢ã€å‘Šè­¦å’Œå¯è§†åŒ–ç­‰åŠŸèƒ½å¸®åŠ©ç”¨æˆ·ç›‘æ§å’Œç»´æŠ¤ç³»ç»Ÿçš„å¥åº·ã€‚"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-2-28 prometheusé¢è¯•é¢˜"><meta property="og:description" content="Prometheus # Prometheusçš„å·¥ä½œæµç¨‹ # Prometheus çš„å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦æ­¥éª¤ï¼š
æ•°æ®æŠ“å–ï¼ˆScrapingï¼‰ï¼š Prometheus ä¼šå®šæœŸä»é…ç½®å¥½çš„ç›®æ ‡ï¼ˆå¦‚åº”ç”¨ç¨‹åºã€æœåŠ¡ã€èŠ‚ç‚¹ç­‰ï¼‰æŠ“å–æ•°æ®ã€‚è¿™äº›ç›®æ ‡é€šå¸¸é€šè¿‡ HTTP æ¥å£æš´éœ² Prometheus æ ¼å¼çš„ç›‘æ§æ•°æ®ï¼ˆé€šå¸¸æ˜¯ /metrics è·¯å¾„ï¼‰ã€‚ è¿™äº›æ•°æ®åŒ…æ‹¬å„ç±»æŒ‡æ ‡ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€è¯·æ±‚æ•°é‡ç­‰ã€‚ å­˜å‚¨ï¼ˆStorageï¼‰ï¼š æŠ“å–åˆ°çš„æ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ Prometheus çš„æœ¬åœ°æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆTSDBï¼‰ä¸­ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—ç”±ä¸€ä¸ªæŒ‡æ ‡åç§°å’Œä¸€ç»„æ ‡ç­¾ï¼ˆå¦‚ instance, job, region ç­‰ï¼‰ç»„æˆã€‚ æŸ¥è¯¢ï¼ˆQueryingï¼‰ï¼š Prometheus æä¾›äº†å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€â€”â€”PromQLï¼ˆPrometheus Query Languageï¼‰ï¼Œå¯ä»¥é€šè¿‡ PromQL æŸ¥è¯¢å·²å­˜å‚¨çš„æ•°æ®ã€‚ Prometheus å¯ä»¥é€šè¿‡å…¶ Web ç•Œé¢ã€API æˆ– Grafana è¿›è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºæ—¶é—´åºåˆ—æ•°æ®çš„å›¾è¡¨ï¼Œæˆ–è€…ç”¨äºå‘Šè­¦è§„åˆ™çš„è®¡ç®—ã€‚ å‘Šè­¦ï¼ˆAlertingï¼‰ï¼š Prometheus å¯ä»¥åŸºäºå®šä¹‰çš„å‘Šè­¦è§„åˆ™ï¼ˆé€šè¿‡ PromQL æŸ¥è¯¢è¯­å¥ï¼‰è¿›è¡Œå‘Šè­¦ã€‚ä¾‹å¦‚ï¼Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚ å‘Šè­¦è§„åˆ™å¯ä»¥å®šä¹‰åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­ï¼Œå‘Šè­¦ä¿¡æ¯å¯ä»¥é€šè¿‡ Alertmanager å‘é€åˆ°å„ç±»é€šçŸ¥ç³»ç»Ÿï¼ˆå¦‚é‚®ä»¶ã€Slackã€é’‰é’‰ç­‰ï¼‰ã€‚ æ•°æ®å¯è§†åŒ–ï¼ˆVisualizationï¼‰ï¼š Prometheus æœ¬èº«ä¹Ÿæä¾›äº†ç®€å•çš„å›¾è¡¨åŠŸèƒ½ï¼Œä½†é€šå¸¸ä¼šä¸ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚ Grafanaï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿æä¾›æ›´ä¸°å¯Œçš„å¯è§†åŒ–æ•ˆæœã€‚ Grafana å¯ä»¥ä» Prometheus æŸ¥è¯¢æ•°æ®ï¼Œç”Ÿæˆæ¼‚äº®çš„ä»ªè¡¨æ¿ï¼Œå¸®åŠ©å›¢é˜Ÿå®æ—¶ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µã€‚ æœåŠ¡å‘ç°ä¸ç›®æ ‡è‡ªåŠ¨åŒ–ï¼ˆService Discoveryï¼‰ï¼š Prometheus æ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°éœ€è¦æŠ“å–æ•°æ®çš„ç›®æ ‡ã€‚å¸¸è§çš„æœ‰ Kubernetesã€Consul ç­‰æœåŠ¡å‘ç°å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€é…ç½®ã€‚ æ•´ä½“è€Œè¨€ï¼ŒPrometheus çš„æ ¸å¿ƒæ˜¯å‘¨æœŸæ€§åœ°æŠ“å–ç›®æ ‡çš„ç›‘æ§æ•°æ®ï¼Œå­˜å‚¨æˆæ—¶é—´åºåˆ—ï¼Œå¹¶é€šè¿‡æŸ¥è¯¢ã€å‘Šè­¦å’Œå¯è§†åŒ–ç­‰åŠŸèƒ½å¸®åŠ©ç”¨æˆ·ç›‘æ§å’Œç»´æŠ¤ç³»ç»Ÿçš„å¥åº·ã€‚"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-2-28 prometheusé¢è¯•é¢˜ | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.1a5becdf9b12587671e0a18c1cf5fae4147c67649d7de8d4211c6063e9085a8c.js integrity="sha256-Glvs35sSWHZx4KGMHPX65BR8Z2SdfejUIRxgY+kIWow=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametricsé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics å’Œ Thanos å¯¹æ¯”</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanosé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanosæ¶æ„</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w podå‹æµ‹å¤ç›˜</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 ç«å±±äº‘è¿ç§»å·¥ç¨‹å¸ˆé¢è¯•è®°å½•</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-3-14 vivoé¢è¯•</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istioæµé‡åˆ†æ</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calicoä¸‰ç§æ¨¡å¼ä¸‹æµé‡ä¼ è¾“</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 å¡”èµé¢è¯•</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 è¿½è§…é¢è¯•</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8såˆ é™¤podæˆ–deploymentçš„æµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8såˆ›å»ºpodæµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/ class=active>2025-2-28 prometheusé¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 é¢è¯•0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 é«˜çº§è¿ç»´é¢è¯•é¢˜-linuxéƒ¨åˆ†</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 ä¸­çº§è¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224é¢è¯•</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 é¢è¯•0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 é¢è¯•0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 é¢è¯•2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8sé¢˜ç›®</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 é¢è¯•0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 é¢è¯•2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 ç¾å›½ç å†œè®¡åˆ’</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 ç¾å›½ç å†œè–ªé…¬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8sç»„ä»¶</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8så¸¸è§æ•…éšœæŒ‡å—</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 è¦ä¸è¦åˆ›ä¸š</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 æ—©æœŸæ¨¡å¼</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 å¤§å °æ²³-æˆ‘çš„ä¿å§†</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 åˆåˆ›å…¬å¸</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 åˆ›ä¸šè€…äº¤æµ</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 åˆ›ä¸šç‚¹å­</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealosè·æŠ•</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack sshè¿æ¥</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpasséƒ¨ç½²openstack devstackå½¢å¼</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart éƒ¨ç½²flaskåº”ç”¨</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 å—å­˜å‚¨å’Œå¯¹è±¡å‚¨å­˜åŒºåˆ«</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstackéœ€è¦å‡ å°è™šæ‹Ÿæœº</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstackå’ŒkubernetesåŒºåˆ«</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nanoæ“ä½œ</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpassæ“ä½œ</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeaszéƒ¨ç½²k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 é¡¶çº§devopså·¥å…·å¤§ç›˜ç‚¹</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 æ¸…ç†dockeré•œåƒ</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 æ„å»ºå®¹å™¨é•œåƒåˆ©å™¨buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 æ˜¯æŠ€æœ¯å¤§ç¥è¿˜æ˜¯åŸºç¡€æ¶æ„éƒ¨çš„ç¥¸å®³</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 æ­ä¸ªæ—¥å¿—æ‰‹æœºç³»ç»Ÿä¸é¦™å—</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 æˆ‘åªæƒ³åšæŠ€æœ¯ èµ°æŠ€æœ¯è·¯çº¿</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 å¸¸è§linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 å¤§å‚æ€»ç»“nginxé«˜å¹¶å‘ä¼˜åŒ–ç¬”è®°</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 å²ä¸Šæœ€ç‰›jenkins pipelineæµæ°´çº¿è¯¦è§£</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEGä¸istioé›†æˆ</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginxå¦‚ä½•è§£å†³æƒŠç¾¤æ•ˆåº”</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctlæ£€æµ‹é›†ç¾¤podé—´è¿é€šæ€§</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linuxè¿ç»´å·¥ç¨‹å¸ˆ50ä¸ªå¸¸è§é¢è¯•é¢˜</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linuxç³»ç»Ÿæ€§èƒ½ä¼˜åŒ– ä¸ƒä¸ªå®æˆ˜ç»éªŒ</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awkæ–‡æœ¬å¤„ç†å™¨ 8ä¸ªæ¡ˆä¾‹</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruiseåŸåœ°å‡çº§è§£æ</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8Sé¢è¯•é¢˜</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8sèƒŒåserviceæ˜¯å¦‚ä½•å·¥ä½œçš„</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8Sçš„æœ€åä¸€å—æ‹¼å›¾</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istioéƒ¨ç½²</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfileå®šåˆ¶ä¸“å±é•œåƒ</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33æ¬¾gitopsä¸devopsä¸»æµç³»ç»Ÿ</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linuxé¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8sé¢è¯•é¢˜</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruiseè¯¦ç»†è§£é‡Šä»¥åŠåŸåœ°å‡çº§åŠå…¨é“¾è·¯ç°åº¦å‘å¸ƒæ–¹æ¡ˆ</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8Sä¹‹ingress-nginxåŸç†åŠé…ç½®</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 ä½¿ç”¨cloudflare(CF)æ­å»ºdockerhubä»£ç†</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 å•masterå•etcdæ”¹é€ ä¸º3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 é¢è¯•æ€»ç»“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 å¦‚ä½•ä¸ºK8Sä¿é©¾æŠ¤èˆª</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8Så¦‚ä½•è·å¾— IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_status_update.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_pod_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8Sè°ƒåº¦å™¨ extender.go æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹sync.go åŒæ­¥ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹rollback.go å›æ»š æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹recreate.go é‡å»º æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ scheduler.go è°ƒåº¦å™¨ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ rolling.go æ»šåŠ¨æ›´æ–° æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ progress.go è¿›åº¦ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ deployment_controller.goæºç è§£è¯»</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S è°ƒåº¦å™¨ scheduler_one.go æºç è§£è¯»</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 å½»æ‚Ÿå®¹å™¨ç½‘ç»œ</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 é¢è¯•ç”¨ Golang æ‰‹æ’¸ LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 è‡ªåŠ¨å±è”½IPæ”»å‡»</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 ç¦»çº¿å®‰è£…kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 ç£ç›˜æ•°æ®æ¢å¤</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 æ¸…ç†æ®‹ç•™çš„calicoç½‘ç»œæ’ä»¶</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 æµé‡ä½•å¤„æ¥ä½•å¤„å»</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 æå¤§æé«˜å·¥ä½œæ•ˆç‡çš„ Linux å‘½ä»¤</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 æ–‡å­¦çš„æ•…ä¹¡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 ææ‡‚K8Sé‰´æƒ</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 å®¹å™¨ç½‘ç»œåŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ OverlayFS åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 å®¹å™¨åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 å®¹å™¨å†…çš„ 1 å·è¿›ç¨‹</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 å®¹å™¨ä¸­åŸŸåè§£æä»¥åŠä¸åŒdnspolicyå¯¹åŸŸåè§£æçš„å½±å“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 å¦‚ä½•è°ƒè¯• crash å®¹å™¨çš„ç½‘ç»œ</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 å¦‚ä½•ä½¿ç”¨tektonå¿«é€Ÿæ­å»ºCI/CDå¹³å°</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 å¤§è§„æ¨¡å¹¶å‘ä¸‹å¦‚ä½•åŠ å¿« Pod å¯åŠ¨é€Ÿåº¦</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 ä½¿ç”¨kubernees leases è½»æ¾å®ç°leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 äºŒè¿›åˆ¶éƒ¨ç½²K8SåŠ èŠ‚ç‚¹æ“ä½œ</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 ä¸¤å¼ å›¾å…¨é¢ç†è§£K8SåŸç†</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 sslè¯ä¹¦è‡ªç­¾å‘</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheusä¼ä¸šçº§ç›‘æ§ä½¿ç”¨æ€»ç»“</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 åŸç†</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux æ€§èƒ½ä¼˜åŒ–å¤§å…¨</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(é‰´æƒ)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(è®¤è¯)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes æºç ç»“æ„</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekeyæ·»åŠ æ–°èŠ‚ç‚¹</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8Sé¢è¯•å®å…¸</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8Sé¢è¯•å¤§å…¨</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8sè¿ç»´ä¹‹æ¸…ç†ç£ç›˜</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8Sè°ƒè¯•POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8Sçš„PODç±»å‹</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8såº”ç”¨çš„æœ€ä½³å®è·µ</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8Så‘½ä»¤æŒ‡å—</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8SåŸåœ°å‡çº§</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S æ¢é’ˆåŸç†</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S å¼€å‘å¯ä¸æ­¢ CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebsåŸç†</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chartå’Œrepo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanelç½‘ç»œ</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCDç¨³å®šæ€§åŠæ€§èƒ½ä¼˜åŒ–å®è·µ</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCDå¤‡ä»½</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Dockeré‡è¦çš„ç½‘ç»œçŸ¥è¯†ç‚¹</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfileçš„copyå’Œaddçš„åŒºåˆ«</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNSä¹‹å…‰</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd åŸºæœ¬æ“ä½œ</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNIæ’ä»¶é€‰å‹</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go æ¶æ„</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go å››ç§å®¢æˆ·ç«¯</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICDæ€è€ƒ</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calicoç½‘ç»œè‡ªå®šä¹‰</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acmeè‡ªåŠ¨æ›´æ–°è¯ä¹¦</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16ä¸ªæ¦‚å¿µå¸¦ä½ å…¥é—¨ Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 é¢è¯•0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600æ¡æœ€å¼ºlinuxå‘½ä»¤æ€»ç»“</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16å¼ ç¡¬æ ¸å›¾è§£k8sç½‘ç»œ</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8sä¹‹kubeletæºç è§£è¯»</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 ä¸¤å¼ å›¾å…¨é¢ç†è§£k8såŸç†</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 é¢è¯•</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8sæµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S æµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 é¢è¯•</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8sé¢è¯•å®å…¸</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8sæ¶æ„å¸ˆé¢è¯•å¤§å…¨</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 ä½¿ç”¨ OpenFunction åœ¨ä»»ä½•åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œæ— æœåŠ¡å™¨å·¥ä½œè´Ÿè½½</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 ç¦»çº¿å®‰è£…é›†ç¾¤</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 æ“ä½œç³»ç»Ÿè¯´æ˜</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 å¿«é€ŸæŒ‡å—</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 å¼€å§‹ä½¿ç”¨ cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 å¤šæ¶æ„æ”¯æŒ</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 å…¬æœ‰äº‘ä¸Šéƒ¨ç½²</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 ä¸ªæ€§åŒ–é›†ç¾¤å‚æ•°é…ç½®</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl å‘½ä»¤è¡Œä»‹ç»</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB è´Ÿè½½å‡è¡¡éƒ¨ç½²</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico é…ç½® BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-å®‰è£…é›†ç¾¤ä¸»è¦æ’ä»¶</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S é›†ç¾¤å­˜å‚¨</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…kube-ovnç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…flannelç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ciliumç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…calicoç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-å®‰è£…etcdé›†ç¾¤</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-é›†ç¾¤è§„åˆ’å’ŒåŸºç¡€å‚æ•°è®¾å®š</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-å®‰è£…kube_nodeèŠ‚ç‚¹</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-å®‰è£…kube_masterèŠ‚ç‚¹</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-åˆ›å»ºè¯ä¹¦å’Œç¯å¢ƒå‡†å¤‡</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 æ€è€ƒ</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-2-28 prometheusé¢è¯•é¢˜</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#prometheus>Prometheus</a></li><li><a href=#prometheusçš„å·¥ä½œæµç¨‹>Prometheusçš„å·¥ä½œæµç¨‹</a></li><li><a href=#metricçš„å‡ ç§ç±»å‹åˆ†åˆ«æ˜¯ä»€ä¹ˆ>Metricçš„å‡ ç§ç±»å‹ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ˜†</a><ul><li><a href=#æ€»ç»“>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°>Prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°â˜†</a><ul><li><a href=#1-kubernetes-æœåŠ¡å‘ç°>1. <strong>Kubernetes æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#2-consul-æœåŠ¡å‘ç°>2. <strong>Consul æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#3-ec2-æœåŠ¡å‘ç°>3. <strong>EC2 æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#4-gcegoogle-compute-engineæœåŠ¡å‘ç°>4. <strong>GCEï¼ˆGoogle Compute Engineï¼‰æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#5-azure-æœåŠ¡å‘ç°>5. <strong>Azure æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#6-dns-æœåŠ¡å‘ç°>6. <strong>DNS æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#7-file-æœåŠ¡å‘ç°>7. <strong>File æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#8-static-æœåŠ¡å‘ç°>8. <strong>Static æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#9-openstack-æœåŠ¡å‘ç°>9. <strong>OpenStack æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#æ€»ç»“-1>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#prometheuså¸¸ç”¨å‡½æ•°>Prometheuså¸¸ç”¨å‡½æ•°</a><ul><li><a href=#1-èšåˆå‡½æ•°aggregation-functions>1. <strong>èšåˆå‡½æ•°ï¼ˆAggregation Functionsï¼‰</strong></a></li><li><a href=#2-ç»Ÿè®¡å‡½æ•°statistical-functions>2. <strong>ç»Ÿè®¡å‡½æ•°ï¼ˆStatistical Functionsï¼‰</strong></a></li><li><a href=#3-æ—¶é—´å‡½æ•°time-functions>3. <strong>æ—¶é—´å‡½æ•°ï¼ˆTime Functionsï¼‰</strong></a></li><li><a href=#4-æ•°å€¼å¤„ç†å‡½æ•°mathematical-functions>4. <strong>æ•°å€¼å¤„ç†å‡½æ•°ï¼ˆMathematical Functionsï¼‰</strong></a></li><li><a href=#5-å­—ç¬¦ä¸²å¤„ç†å‡½æ•°string-functions>5. <strong>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼ˆString Functionsï¼‰</strong></a></li><li><a href=#6-æŸ¥è¯¢æ—¶é—´å‡½æ•°time-interval-functions>6. <strong>æŸ¥è¯¢æ—¶é—´å‡½æ•°ï¼ˆTime Interval Functionsï¼‰</strong></a></li><li><a href=#7-ç‡å‡½æ•°rate-functions>7. <strong>ç‡å‡½æ•°ï¼ˆRate Functionsï¼‰</strong></a></li><li><a href=#8-é€»è¾‘å‡½æ•°logical-functions>8. <strong>é€»è¾‘å‡½æ•°ï¼ˆLogical Functionsï¼‰</strong></a></li><li><a href=#9-è¿‡æ»¤ä¸æ¡ä»¶filters--conditionals>9. <strong>è¿‡æ»¤ä¸æ¡ä»¶ï¼ˆFilters & Conditionalsï¼‰</strong></a></li><li><a href=#10-ç™¾åˆ†æ¯”è®¡ç®—percentile-calculation>10. <strong>ç™¾åˆ†æ¯”è®¡ç®—ï¼ˆPercentile Calculationï¼‰</strong></a></li><li><a href=#æ€»ç»“-2>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#thanosæ¶æ„>thanosæ¶æ„â˜†</a><ul><li><a href=#thanos-æ¶æ„æ¦‚è¿°>Thanos æ¶æ„æ¦‚è¿°</a></li><li><a href=#thanos-æ¶æ„å›¾>Thanos æ¶æ„å›¾</a></li><li><a href=#thanos-æ ¸å¿ƒåŠŸèƒ½>Thanos æ ¸å¿ƒåŠŸèƒ½</a></li><li><a href=#thanos-çš„ä½¿ç”¨åœºæ™¯>Thanos çš„ä½¿ç”¨åœºæ™¯</a></li><li><a href=#æ€»ç»“-3>æ€»ç»“</a></li></ul></li><li><a href=#thanosä¸victoriametricså¯¹æ¯”>thanosä¸VictoriaMetricså¯¹æ¯”</a></li><li><a href=#1-æ¦‚è¿°><strong>1. æ¦‚è¿°</strong></a></li><li><a href=#2-æ¶æ„å¯¹æ¯”><strong>2. æ¶æ„å¯¹æ¯”</strong></a><ul><li><a href=#thanos><strong>Thanos</strong></a></li><li><a href=#victoriametrics><strong>VictoriaMetrics</strong></a></li></ul></li><li><a href=#3-å…³é”®ç‰¹æ€§å¯¹æ¯”><strong>3. å…³é”®ç‰¹æ€§å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-æ€»ç»“><strong>5. æ€»ç»“</strong></a></li><li><a href=#thanos-sidecarå’ŒreceiveåŒºåˆ«>thanos sidecarå’ŒreceiveåŒºåˆ«â˜†</a><ul><li><a href=#thanos-sidecar-vs-thanos-receive-å¯¹æ¯”><strong>Thanos Sidecar vs Thanos Receive å¯¹æ¯”</strong></a></li></ul></li><li><a href=#1-ä¸»è¦ç”¨é€”><strong>1. ä¸»è¦ç”¨é€”</strong></a></li><li><a href=#2-æ¶æ„å¯¹æ¯”-1><strong>2. æ¶æ„å¯¹æ¯”</strong></a><ul><li><a href=#thanos-sidecar><strong>Thanos Sidecar</strong></a></li><li><a href=#thanos-receive><strong>Thanos Receive</strong></a></li></ul></li><li><a href=#3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-1><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-é€‰å‹å»ºè®®><strong>5. é€‰å‹å»ºè®®</strong></a></li><li><a href=#thanos-ruleç»„ä»¶å’ŒprometheusåŒºåˆ«>thanos ruleç»„ä»¶å’ŒprometheusåŒºåˆ«</a><ul><li><a href=#thanos-rule-vs-prometheusåŒºåˆ«ä¸å¯¹æ¯”><strong>Thanos Rule vs Prometheusï¼šåŒºåˆ«ä¸å¯¹æ¯”</strong></a></li></ul></li><li><a href=#1-ä¸»è¦ç”¨é€”-1><strong>1. ä¸»è¦ç”¨é€”</strong></a></li><li><a href=#2-ç»„ä»¶ä»‹ç»><strong>2. ç»„ä»¶ä»‹ç»</strong></a><ul><li><a href=#-prometheus><strong>ğŸ“Œ Prometheus</strong></a></li><li><a href=#-thanos-rule><strong>ğŸ“Œ Thanos Rule</strong></a></li></ul></li><li><a href=#3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”-1><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-2><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-æ€»ç»“-1><strong>5. æ€»ç»“</strong></a></li><li><a href=#prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª>Prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª</a></li><li><a href=#-prometheus-å‘Šè­¦æµç¨‹><strong>ğŸ“Œ Prometheus å‘Šè­¦æµç¨‹</strong></a></li><li><a href=#-å¯èƒ½çš„å»¶è¿Ÿç‚¹><strong>ğŸ“Œ å¯èƒ½çš„å»¶è¿Ÿç‚¹</strong></a></li><li><a href=#-å¦‚ä½•ä¼˜åŒ–-prometheus-å‘Šè­¦å»¶è¿Ÿ><strong>ğŸ“Œ å¦‚ä½•ä¼˜åŒ– Prometheus å‘Šè­¦å»¶è¿Ÿï¼Ÿ</strong></a><ul><li><a href=#1-è°ƒæ•´><strong>1. è°ƒæ•´ <code>scrape_interval</code></strong></a></li><li><a href=#2-è°ƒæ•´><strong>2. è°ƒæ•´ <code>evaluation_interval</code></strong></a></li><li><a href=#3-è°ƒæ•´><strong>3. è°ƒæ•´ <code>for</code> å‚æ•°</strong></a></li><li><a href=#4-è°ƒæ•´-alertmanager-é…ç½®><strong>4. è°ƒæ•´ Alertmanager é…ç½®</strong></a></li><li><a href=#5-ä¼˜åŒ–é€šçŸ¥æ–¹å¼><strong>5. ä¼˜åŒ–é€šçŸ¥æ–¹å¼</strong></a></li></ul></li><li><a href=#-ç»“è®º><strong>ğŸ“Œ ç»“è®º</strong></a><ul><li><a href=#-ä¼˜åŒ–å»ºè®®>ğŸš€ <strong>ä¼˜åŒ–å»ºè®®</strong></a></li><li><a href=#-æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®><strong>ğŸ”¥ æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®</strong></a></li></ul></li><li><a href=#å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåš>å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåšâ˜†</a></li><li><a href=#-å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†</strong></a></li><li><a href=#-å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®</strong></a><ul><li><a href=#ç¤ºä¾‹-1å±è”½><strong>ç¤ºä¾‹ 1ï¼šå±è”½ <code>InstanceDown</code> å‘Šè­¦ï¼Œè‹¥ <code>ClusterDown</code> å‘Šè­¦å·²è§¦å‘</strong></a></li><li><a href=#ç¤ºä¾‹-2æŸä¸ªæœåŠ¡><strong>ç¤ºä¾‹ 2ï¼šæŸä¸ªæœåŠ¡ <code>APIHighLatency</code> æ—¶ï¼Œå±è”½ <code>APIErrorRate</code></strong></a></li></ul></li><li><a href=#-é…ç½®><strong>ğŸ“Œ é…ç½® <code>Alertmanager.yml</code> è§„åˆ™</strong></a><ul><li><a href=#å®Œæ•´ç¤ºä¾‹><strong>å®Œæ•´ç¤ºä¾‹</strong></a></li></ul></li><li><a href=#-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶</strong></a></li><li><a href=#-æ€»ç»“><strong>ğŸ“Œ æ€»ç»“</strong></a><ul><li><a href=#prometheus-å‘Šè­¦æŠ‘åˆ¶inhibition><strong>Prometheus å‘Šè­¦æŠ‘åˆ¶ï¼ˆInhibitionï¼‰</strong></a></li></ul></li><li><a href=#-é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤><strong>ğŸ“Œ é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½-instancedown-å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ InstanceDown å‘Šè­¦</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ <code>NodeDown</code>ï¼ˆèŠ‚ç‚¹å®•æœºï¼‰å‘Šè­¦</strong></a></li><li><a href=#heading><strong>ğŸ“Œ <code>inhibit_rules</code> é…ç½®å®Œæ•´ç¤ºä¾‹</strong></a></li><li><a href=#-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶-1><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶ï¼Ÿ</strong></a><ul><li><a href=#æ–¹å¼-1ä½¿ç”¨><strong>æ–¹å¼ 1ï¼šä½¿ç”¨ <code>amtool</code></strong></a></li><li><a href=#æ–¹å¼-2æŸ¥çœ‹-alertmanager-ui><strong>æ–¹å¼ 2ï¼šæŸ¥çœ‹ Alertmanager UI</strong></a></li></ul></li><li><a href=#-ç»“è®º-1><strong>ğŸ“Œ ç»“è®º</strong></a></li><li><a href=#å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåš>å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåšâ˜†</a></li><li><a href=#prometheus-å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ><strong>Prometheus å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ</strong></a></li><li><a href=#-1-prometheus-é«˜å¯ç”¨><strong>ğŸ“Œ 1. Prometheus é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆ-1prometheus-åŒå®ä¾‹ä¸»å¤‡><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šPrometheus åŒå®ä¾‹ï¼ˆä¸»å¤‡ï¼‰</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2prometheus--thanos-victoriametrics><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šPrometheus + Thanos/ VictoriaMetrics</strong></a></li></ul></li><li><a href=#-2-alertmanager-é«˜å¯ç”¨><strong>ğŸ“Œ 2. Alertmanager é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆalertmanager-é›†ç¾¤><strong>ğŸ”¹ æ–¹æ¡ˆï¼šAlertmanager é›†ç¾¤</strong></a></li></ul></li><li><a href=#-3-é€šçŸ¥æ¸ é“é«˜å¯ç”¨><strong>ğŸ“Œ 3. é€šçŸ¥æ¸ é“é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆ-1å¤šä¸ªé€šçŸ¥é€šé“><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šå¤šä¸ªé€šçŸ¥é€šé“</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2webhook-é«˜å¯ç”¨><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šWebhook é«˜å¯ç”¨</strong></a></li></ul></li><li><a href=#-4-å…¨å±€é«˜å¯ç”¨æ¶æ„><strong>ğŸ“Œ 4. å…¨å±€é«˜å¯ç”¨æ¶æ„</strong></a></li><li><a href=#-ç»“è®º-2><strong>ğŸ“Œ ç»“è®º</strong></a></li><li><a href=#podæŒ‡æ ‡wsså’ŒrssåŒºåˆ«>PodæŒ‡æ ‡WSSå’ŒRSSåŒºåˆ«â˜†</a></li><li><a href=#-rssresident-set-size><strong>ğŸ“Œ RSSï¼ˆResident Set Sizeï¼‰</strong></a></li><li><a href=#-wssworking-set-size><strong>ğŸ“Œ WSSï¼ˆWorking Set Sizeï¼‰</strong></a></li><li><a href=#-wss-vs-rss-æ€»ç»“><strong>ğŸ“Œ WSS vs. RSS æ€»ç»“</strong></a></li><li><a href=#-kubernetes-ç›¸å…³><strong>ğŸ“Œ Kubernetes ç›¸å…³</strong></a></li><li><a href=#ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡>ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡</a></li><li><a href=#-1-latencyå»¶è¿Ÿ><strong>ğŸ“Œ 1. Latencyï¼ˆå»¶è¿Ÿï¼‰</strong></a></li><li><a href=#-2-trafficæµé‡><strong>ğŸ“Œ 2. Trafficï¼ˆæµé‡ï¼‰</strong></a></li><li><a href=#-3-errorsé”™è¯¯ç‡><strong>ğŸ“Œ 3. Errorsï¼ˆé”™è¯¯ç‡ï¼‰</strong></a></li><li><a href=#-4-saturationé¥±å’Œåº¦><strong>ğŸ“Œ 4. Saturationï¼ˆé¥±å’Œåº¦ï¼‰</strong></a></li><li><a href=#-æ€»ç»“-1><strong>ğŸ“Œ æ€»ç»“</strong></a></li><li><a href=#åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹å¦‚ä½•ä¼˜åŒ–prometheusæ€§èƒ½>åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¼˜åŒ–Prometheusæ€§èƒ½</a><ul><li><a href=#1-åˆ†å¸ƒå¼æ¶æ„è®¾è®¡><strong>1. åˆ†å¸ƒå¼æ¶æ„è®¾è®¡</strong></a></li><li><a href=#2-æ•°æ®å­˜å‚¨ä¼˜åŒ–><strong>2. æ•°æ®å­˜å‚¨ä¼˜åŒ–</strong></a></li><li><a href=#3-æŸ¥è¯¢ä¼˜åŒ–><strong>3. æŸ¥è¯¢ä¼˜åŒ–</strong></a></li><li><a href=#4-è°ƒæ•´-scrape-é…ç½®><strong>4. è°ƒæ•´ Scrape é…ç½®</strong></a></li><li><a href=#5-ä½¿ç”¨-external-storage><strong>5. ä½¿ç”¨ External Storage</strong></a></li><li><a href=#6-ä¼˜åŒ–-alerting-å’Œ-rules><strong>6. ä¼˜åŒ– Alerting å’Œ Rules</strong></a></li><li><a href=#7-é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡><strong>7. é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡</strong></a></li><li><a href=#æ€»ç»“-4><strong>æ€»ç»“ï¼š</strong></a></li></ul></li><li><a href=#å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”>å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”â˜†</a><ul><li><a href=#1-ä½¿ç”¨-prometheus--alertmanager-é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”><strong>1. ä½¿ç”¨ Prometheus + Alertmanager é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#2-é›†æˆè‡ªåŠ¨åŒ–å·¥å…·å¦‚-ansibleterraformè¿›è¡Œå“åº”><strong>2. é›†æˆè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ Ansibleã€Terraformï¼‰è¿›è¡Œå“åº”</strong></a></li><li><a href=#3-é›†æˆ-chatops-è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”><strong>3. é›†æˆ ChatOps è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#4-ä½¿ç”¨-kubernetes-operator-è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤><strong>4. ä½¿ç”¨ Kubernetes Operator è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤</strong></a></li><li><a href=#5-ä½¿ç”¨-pagerdutyopsgenie-ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”><strong>5. ä½¿ç”¨ PagerDutyã€OpsGenie ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#æ€»ç»“-5><strong>æ€»ç»“ï¼š</strong></a></li></ul></li><li><a href=#prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†>Prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†</a><ul><li><a href=#1-prometheus-æ•°æ®å­˜å‚¨æ¶æ„><strong>1. Prometheus æ•°æ®å­˜å‚¨æ¶æ„</strong></a></li><li><a href=#2-æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†><strong>2. æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†</strong></a></li><li><a href=#3-æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“><strong>3. æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“</strong></a></li><li><a href=#4-æŒä¹…åŒ–å­˜å‚¨><strong>4. æŒä¹…åŒ–å­˜å‚¨</strong></a></li></ul></li><li><a href=#kubectl-topè¾“å‡ºä¸linux-freeå‘½ä»¤ä¸ä¸€è‡´åŸå› >kubectl topè¾“å‡ºä¸Linux freeå‘½ä»¤ä¸ä¸€è‡´åŸå› â˜†</a><ul><li><a href=#1-æ•°æ®æ¥æºçš„å·®å¼‚><strong>1. æ•°æ®æ¥æºçš„å·®å¼‚</strong></a></li><li><a href=#2-èµ„æºçš„è®¡ç®—æ–¹å¼><strong>2. èµ„æºçš„è®¡ç®—æ–¹å¼</strong></a></li><li><a href=#3-èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–><strong>3. èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–</strong></a></li><li><a href=#4-æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ><strong>4. æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ</strong></a></li><li><a href=#æ€»ç»“-6><strong>æ€»ç»“</strong></a></li></ul></li><li><a href=#ç”¨åˆ°äº†å“ªäº›exporteråŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨-prometheus-ç›‘æ§ä¸­exporter-æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶å®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡å¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥-prometheus-èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„-prometheus-exporter-åŠå…¶åŠŸèƒ½>ç”¨åˆ°äº†å“ªäº›exporterï¼ŒåŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨ Prometheus ç›‘æ§ä¸­ï¼Œ<strong>Exporter</strong> æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶ï¼Œå®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡ï¼Œå¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥ Prometheus èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Prometheus Exporter åŠå…¶åŠŸèƒ½ï¼š</a><ul><li><a href=#1-node-exporter>1. <strong>Node Exporter</strong></a></li><li><a href=#2-kube-state-metrics>2. <strong>kube-state-metrics</strong></a></li><li><a href=#3-cadvisor>3. <strong>cAdvisor</strong></a></li><li><a href=#4-blackbox-exporter>4. <strong>Blackbox Exporter</strong></a></li><li><a href=#5-mysql-exporter>5. <strong>MySQL Exporter</strong></a></li><li><a href=#6-postgresql-exporter>6. <strong>PostgreSQL Exporter</strong></a></li><li><a href=#7-jmx-exporter>7. <strong>JMX Exporter</strong></a></li><li><a href=#8-redis-exporter>8. <strong>Redis Exporter</strong></a></li><li><a href=#9-mongodb-exporter>9. <strong>MongoDB Exporter</strong></a></li><li><a href=#10-elasticsearch-exporter>10. <strong>Elasticsearch Exporter</strong></a></li><li><a href=#11-nginx-exporter>11. <strong>Nginx Exporter</strong></a></li><li><a href=#12-kafka-exporter>12. <strong>Kafka Exporter</strong></a></li><li><a href=#æ€»ç»“-7><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li><li><a href=#æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporter>æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporterâ˜†</a><ul><li><a href=#è‡ªå®šä¹‰-exporter-å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤>è‡ªå®šä¹‰ Exporter å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤ï¼š</a></li><li><a href=#ç¤ºä¾‹ç”¨-go-å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰-exporter>ç¤ºä¾‹ï¼šç”¨ Go å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ Exporter</a></li><li><a href=#å…³é”®ç‚¹>å…³é”®ç‚¹ï¼š</a></li><li><a href=#å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜>å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜ï¼š</a></li></ul></li><li><a href=#target-downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤>target downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤ï¼Ÿ</a><ul><li><a href=#1-æ£€æŸ¥-prometheus-æ—¥å¿—>1. <strong>æ£€æŸ¥ Prometheus æ—¥å¿—</strong></a></li><li><a href=#2-æ£€æŸ¥ç½‘ç»œè¿æ¥>2. <strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong></a></li><li><a href=#3-æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€>3. <strong>æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€</strong></a></li><li><a href=#4-æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®>4. <strong>æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®</strong></a></li><li><a href=#5-ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜>5. <strong>ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜</strong></a></li><li><a href=#6-èº«ä»½éªŒè¯é—®é¢˜>6. <strong>èº«ä»½éªŒè¯é—®é¢˜</strong></a></li><li><a href=#7-æ£€æŸ¥-prometheus-é…ç½®æ–‡ä»¶>7. <strong>æ£€æŸ¥ Prometheus é…ç½®æ–‡ä»¶</strong></a></li><li><a href=#8-æŸ¥çœ‹-prometheus-ç›®æ ‡çŠ¶æ€>8. <strong>æŸ¥çœ‹ Prometheus ç›®æ ‡çŠ¶æ€</strong></a></li><li><a href=#9-é‡å¯-prometheus>9. <strong>é‡å¯ Prometheus</strong></a></li><li><a href=#10-ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—>10. <strong>ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—</strong></a></li><li><a href=#æ•…éšœæ’é™¤ç¤ºä¾‹>æ•…éšœæ’é™¤ç¤ºä¾‹ï¼š</a></li><li><a href=#æ€»ç»“-8>æ€»ç»“</a></li></ul></li><li><a href=#exporter-åœæ­¢å·¥ä½œå¦‚ä½•ç›‘æ§>Exporter åœæ­¢å·¥ä½œï¼Œå¦‚ä½•ç›‘æ§ï¼Ÿ</a><ul><li><a href=#1-prometheus-è‡ªèº«çš„ç›‘æ§>1. <strong>Prometheus è‡ªèº«çš„ç›‘æ§</strong></a></li><li><a href=#2-exporter-çš„å¥åº·æ£€æŸ¥>2. <strong>Exporter çš„å¥åº·æ£€æŸ¥</strong></a></li><li><a href=#3-exporter-è¿›ç¨‹ç›‘æ§>3. <strong>Exporter è¿›ç¨‹ç›‘æ§</strong></a></li><li><a href=#4-å¤–éƒ¨æœåŠ¡ç›‘æ§>4. <strong>å¤–éƒ¨æœåŠ¡ç›‘æ§</strong></a></li><li><a href=#5-æ—¥å¿—ç›‘æ§>5. <strong>æ—¥å¿—ç›‘æ§</strong></a></li><li><a href=#6-è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½>6. <strong>è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½</strong></a></li><li><a href=#7-å¤–éƒ¨ç›‘æ§å·¥å…·>7. <strong>å¤–éƒ¨ç›‘æ§å·¥å…·</strong></a></li><li><a href=#8-åˆ†ææŒ‡æ ‡ä¸¢å¤±>8. <strong>åˆ†ææŒ‡æ ‡ä¸¢å¤±</strong></a></li><li><a href=#æ€»ç»“-9>æ€»ç»“</a></li></ul></li><li><a href=#prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹>Prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a><ul><li><a href=#1-prometheus-æ‹‰å–æ¨¡å¼pull-model>1. <strong>Prometheus æ‹‰å–æ¨¡å¼ï¼ˆPull Modelï¼‰</strong></a></li><li><a href=#2-zabbix-æ¨é€æ¨¡å¼push-model>2. <strong>Zabbix æ¨é€æ¨¡å¼ï¼ˆPush Modelï¼‰</strong></a></li><li><a href=#3-å¯¹æ¯”æ€»ç»“>3. <strong>å¯¹æ¯”æ€»ç»“</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-3>4. <strong>é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#æ€»ç»“-10>æ€»ç»“</a></li></ul></li><li><a href=#prometheus-operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™>Prometheus operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™</a><ul><li><a href=#1-æ·»åŠ -targets-æœåŠ¡å‘ç°>1. æ·»åŠ  Targets (æœåŠ¡å‘ç°)</a></li><li><a href=#2-æ·»åŠ å‘Šè­¦è§„åˆ™>2. æ·»åŠ å‘Šè­¦è§„åˆ™</a></li><li><a href=#3-å‘Šè­¦é€šçŸ¥>3. å‘Šè­¦é€šçŸ¥</a></li><li><a href=#æ€»ç»“-11>æ€»ç»“</a></li></ul></li><li><a href=#k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨prometheusç›‘æ§>k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨Prometheusç›‘æ§</a><ul><li><a href=#1-ç¡®ä¿å¤–éƒ¨-exporter-å¯è®¿é—®>1. ç¡®ä¿å¤–éƒ¨ Exporter å¯è®¿é—®</a></li><li><a href=#2-é…ç½®-prometheus-æ¥æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>2. é…ç½® Prometheus æ¥æŠ“å–å¤–éƒ¨ Exporter æ•°æ®</a></li><li><a href=#3-éªŒè¯-prometheus-æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>3. éªŒè¯ Prometheus æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨ Exporter æ•°æ®</a></li><li><a href=#4-é…ç½®å‘Šè­¦å¯é€‰>4. é…ç½®å‘Šè­¦ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#5-é…ç½®å‘Šè­¦é€šçŸ¥å¯é€‰>5. é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#æ€»ç»“-12>æ€»ç»“ï¼š</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=prometheus>Prometheus
<a class=anchor href=#prometheus>#</a></h2><h2 id=prometheusçš„å·¥ä½œæµç¨‹>Prometheusçš„å·¥ä½œæµç¨‹
<a class=anchor href=#prometheus%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b>#</a></h2><p>Prometheus çš„å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦æ­¥éª¤ï¼š</p><ol><li><strong>æ•°æ®æŠ“å–ï¼ˆScrapingï¼‰</strong>ï¼š<ul><li>Prometheus ä¼šå®šæœŸä»é…ç½®å¥½çš„ç›®æ ‡ï¼ˆå¦‚åº”ç”¨ç¨‹åºã€æœåŠ¡ã€èŠ‚ç‚¹ç­‰ï¼‰æŠ“å–æ•°æ®ã€‚è¿™äº›ç›®æ ‡é€šå¸¸é€šè¿‡ HTTP æ¥å£æš´éœ² Prometheus æ ¼å¼çš„ç›‘æ§æ•°æ®ï¼ˆé€šå¸¸æ˜¯ <code>/metrics</code> è·¯å¾„ï¼‰ã€‚</li><li>è¿™äº›æ•°æ®åŒ…æ‹¬å„ç±»æŒ‡æ ‡ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€è¯·æ±‚æ•°é‡ç­‰ã€‚</li></ul></li><li><strong>å­˜å‚¨ï¼ˆStorageï¼‰</strong>ï¼š<ul><li>æŠ“å–åˆ°çš„æ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ Prometheus çš„æœ¬åœ°æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆTSDBï¼‰ä¸­ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—ç”±ä¸€ä¸ªæŒ‡æ ‡åç§°å’Œä¸€ç»„æ ‡ç­¾ï¼ˆå¦‚ <code>instance</code>, <code>job</code>, <code>region</code> ç­‰ï¼‰ç»„æˆã€‚</li></ul></li><li><strong>æŸ¥è¯¢ï¼ˆQueryingï¼‰</strong>ï¼š<ul><li>Prometheus æä¾›äº†å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€â€”â€”PromQLï¼ˆPrometheus Query Languageï¼‰ï¼Œå¯ä»¥é€šè¿‡ PromQL æŸ¥è¯¢å·²å­˜å‚¨çš„æ•°æ®ã€‚</li><li>Prometheus å¯ä»¥é€šè¿‡å…¶ Web ç•Œé¢ã€API æˆ– Grafana è¿›è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºæ—¶é—´åºåˆ—æ•°æ®çš„å›¾è¡¨ï¼Œæˆ–è€…ç”¨äºå‘Šè­¦è§„åˆ™çš„è®¡ç®—ã€‚</li></ul></li><li><strong>å‘Šè­¦ï¼ˆAlertingï¼‰</strong>ï¼š<ul><li>Prometheus å¯ä»¥åŸºäºå®šä¹‰çš„å‘Šè­¦è§„åˆ™ï¼ˆé€šè¿‡ PromQL æŸ¥è¯¢è¯­å¥ï¼‰è¿›è¡Œå‘Šè­¦ã€‚ä¾‹å¦‚ï¼Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚</li><li>å‘Šè­¦è§„åˆ™å¯ä»¥å®šä¹‰åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­ï¼Œå‘Šè­¦ä¿¡æ¯å¯ä»¥é€šè¿‡ Alertmanager å‘é€åˆ°å„ç±»é€šçŸ¥ç³»ç»Ÿï¼ˆå¦‚é‚®ä»¶ã€Slackã€é’‰é’‰ç­‰ï¼‰ã€‚</li></ul></li><li><strong>æ•°æ®å¯è§†åŒ–ï¼ˆVisualizationï¼‰</strong>ï¼š<ul><li>Prometheus æœ¬èº«ä¹Ÿæä¾›äº†ç®€å•çš„å›¾è¡¨åŠŸèƒ½ï¼Œä½†é€šå¸¸ä¼šä¸ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚ Grafanaï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿æä¾›æ›´ä¸°å¯Œçš„å¯è§†åŒ–æ•ˆæœã€‚</li><li>Grafana å¯ä»¥ä» Prometheus æŸ¥è¯¢æ•°æ®ï¼Œç”Ÿæˆæ¼‚äº®çš„ä»ªè¡¨æ¿ï¼Œå¸®åŠ©å›¢é˜Ÿå®æ—¶ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µã€‚</li></ul></li><li><strong>æœåŠ¡å‘ç°ä¸ç›®æ ‡è‡ªåŠ¨åŒ–ï¼ˆService Discoveryï¼‰</strong>ï¼š<ul><li>Prometheus æ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°éœ€è¦æŠ“å–æ•°æ®çš„ç›®æ ‡ã€‚å¸¸è§çš„æœ‰ Kubernetesã€Consul ç­‰æœåŠ¡å‘ç°å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€é…ç½®ã€‚</li></ul></li></ol><p>æ•´ä½“è€Œè¨€ï¼ŒPrometheus çš„æ ¸å¿ƒæ˜¯å‘¨æœŸæ€§åœ°æŠ“å–ç›®æ ‡çš„ç›‘æ§æ•°æ®ï¼Œå­˜å‚¨æˆæ—¶é—´åºåˆ—ï¼Œå¹¶é€šè¿‡æŸ¥è¯¢ã€å‘Šè­¦å’Œå¯è§†åŒ–ç­‰åŠŸèƒ½å¸®åŠ©ç”¨æˆ·ç›‘æ§å’Œç»´æŠ¤ç³»ç»Ÿçš„å¥åº·ã€‚</p><p>å¦‚æœä½ æœ‰æŸä¸ªå…·ä½“ç¯èŠ‚çš„ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶é—®ï¼</p><h2 id=metricçš„å‡ ç§ç±»å‹åˆ†åˆ«æ˜¯ä»€ä¹ˆ>Metricçš„å‡ ç§ç±»å‹ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ˜†
<a class=anchor href=#metric%e7%9a%84%e5%87%a0%e7%a7%8d%e7%b1%bb%e5%9e%8b%e5%88%86%e5%88%ab%e6%98%af%e4%bb%80%e4%b9%88>#</a></h2><p>Prometheus ä¸­æœ‰å››ç§ä¸»è¦çš„ <strong>Metricï¼ˆåº¦é‡ï¼‰ç±»å‹</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li><p><strong>Counterï¼ˆè®¡æ•°å™¨ï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šè®¡æ•°å™¨æ˜¯ä¸€ç§åªå¢ä¸å‡çš„åº¦é‡ç±»å‹ã€‚å®ƒè¡¨ç¤ºä¸€ä¸ªç´¯ç§¯å€¼ï¼Œæ¯”å¦‚è¯·æ±‚çš„æ€»æ•°ã€å¤„ç†çš„ä»»åŠ¡æ•°ç­‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå®ƒçš„å€¼å§‹ç»ˆæ˜¯é€’å¢çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹è¢«é‡ç½®ï¼ˆå¦‚é‡å¯åº”ç”¨ï¼‰ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šHTTP è¯·æ±‚çš„æ€»æ•°ã€é”™è¯¯å‘ç”Ÿæ¬¡æ•°ç­‰ã€‚</li><li><strong>å¸¸è§ç”¨é€”</strong>ï¼šè¡¨ç¤ºæŸç§äº‹ä»¶æˆ–çŠ¶æ€å‘ç”Ÿçš„æ€»æ¬¡æ•°ã€‚</li></ul><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total{method=&#34;GET&#34;, status=&#34;200&#34;}
</code></pre></li><li><p><strong>Gaugeï¼ˆä»ªè¡¨ï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šä»ªè¡¨åº¦é‡ç±»å‹è¡¨ç¤ºä¸€ä¸ªå¯ä»¥ä»»æ„å¢å‡çš„å€¼ã€‚å®ƒé€‚ç”¨äºé‚£äº›å¯èƒ½ä¼šå¢åŠ æˆ–å‡å°‘çš„åº¦é‡ï¼Œæ¯”å¦‚å½“å‰å†…å­˜ä½¿ç”¨é‡ã€CPU ä½¿ç”¨ç‡ç­‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå®ƒçš„å€¼å¯ä»¥ä¸Šå‡æˆ–ä¸‹é™ï¼Œé€‚åˆè¡¨ç¤ºæŸäº›ç¬æ—¶çš„ã€å¯å˜çš„æ•°å€¼ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šå½“å‰æ¸©åº¦ã€å†…å­˜ä½¿ç”¨ã€ç£ç›˜ç©ºé—´ç­‰ã€‚</li><li><strong>å¸¸è§ç”¨é€”</strong>ï¼šè¡¨ç¤ºæŸäº›åŠ¨æ€çš„ã€ç¬æ—¶çš„æ•°å€¼ã€‚</li></ul><pre tabindex=0><code class=language-prometheus data-lang=prometheus>memory_usage_bytes
</code></pre></li><li><p><strong>Histogramï¼ˆç›´æ–¹å›¾ï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šç›´æ–¹å›¾ç”¨äºè®°å½•ä¸€ç³»åˆ—çš„åˆ†å¸ƒæ•°æ®ï¼ŒæŒ‰æŒ‡å®šçš„æ¡¶ï¼ˆbucketï¼‰æ¥èšåˆæ ·æœ¬æ•°æ®ã€‚å®ƒèƒ½å¤Ÿæä¾›æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼ˆå¦‚è¯·æ±‚å»¶è¿Ÿçš„åˆ†å¸ƒï¼‰ï¼Œå¹¶å¯ä»¥é€šè¿‡ç»Ÿè®¡æ•°æ®è®¡ç®—å‡ºä¸€äº›èšåˆæŒ‡æ ‡ï¼ˆå¦‚å¹³å‡å€¼ã€ç™¾åˆ†ä½æ•°ç­‰ï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå®ƒä¼šæä¾›æ¡¶å†…çš„è®¡æ•°å€¼ï¼Œå¯ä»¥è®¡ç®—å‡ºå€¼çš„åˆ†å¸ƒï¼ˆå¦‚è¯·æ±‚å»¶è¿Ÿçš„ 95th ç™¾åˆ†ä½ï¼‰ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šHTTP è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œæ•°æ®åº“æŸ¥è¯¢æ—¶é—´ç­‰ã€‚</li><li><strong>å¸¸è§ç”¨é€”</strong>ï¼šåˆ†å¸ƒæ•°æ®çš„åº¦é‡ï¼Œä¾‹å¦‚è¯·æ±‚å»¶è¿Ÿã€å¤„ç†æ—¶é—´ç­‰ã€‚</li></ul><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_request_duration_seconds_bucket{le=&#34;0.1&#34;}
</code></pre></li><li><p><strong>Summaryï¼ˆæ‘˜è¦ï¼‰</strong>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šæ‘˜è¦ä¸ç›´æ–¹å›¾ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥ç»Ÿè®¡åˆ†å¸ƒæ•°æ®çš„ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ‘˜è¦è®°å½•çš„æ˜¯åœ¨æŸä¸€æ—¶é—´æ®µå†…å‘ç”Ÿçš„æ ·æœ¬çš„æ‘˜è¦ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚ç´¯è®¡æ€»æ•°ã€ç´¯è®¡å’Œã€æœ€å¤§å€¼ç­‰ï¼Œè€Œç›´æ–¹å›¾åˆ™é€šè¿‡åˆ†æ¡¶ç»Ÿè®¡æ•°æ®åˆ†å¸ƒã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šæ‘˜è¦åº¦é‡æä¾›äº†ç›´æ¥çš„ç»Ÿè®¡å€¼ï¼Œå¦‚ç™¾åˆ†ä½æ•°ï¼ˆp50, p90, p99ç­‰ï¼‰ï¼Œä¸éœ€è¦æ ¹æ®æ¡¶è®¡ç®—ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šè¯·æ±‚çš„å»¶è¿Ÿç™¾åˆ†ä½æ•°ï¼ŒAPI å“åº”æ—¶é—´ç­‰ã€‚</li><li><strong>å¸¸è§ç”¨é€”</strong>ï¼šéœ€è¦ç²¾ç¡®è®¡ç®—ç™¾åˆ†ä½æ•°å’Œå…¶ä»–ç»Ÿè®¡é‡æ—¶ï¼Œå¦‚è¯·æ±‚å“åº”æ—¶é—´çš„åˆ†ä½æ•°ã€‚</li></ul><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_request_duration_seconds{quantile=&#34;0.95&#34;}
</code></pre></li></ol><h3 id=æ€»ç»“>æ€»ç»“ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h3><ul><li><strong>Counter</strong>ï¼šåªå¢ä¸å‡ï¼Œè¡¨ç¤ºç´¯è®¡æ€»æ•°ã€‚</li><li><strong>Gauge</strong>ï¼šå¯ä»¥å¢å‡ï¼Œè¡¨ç¤ºå½“å‰çŠ¶æ€çš„ç¬æ—¶å€¼ã€‚</li><li><strong>Histogram</strong>ï¼šç”¨äºè¡¨ç¤ºæ•°æ®çš„åˆ†å¸ƒï¼ŒæŒ‰æ¡¶èšåˆæ•°æ®ã€‚</li><li><strong>Summary</strong>ï¼šç±»ä¼¼äºç›´æ–¹å›¾ï¼Œä½†ç›´æ¥æä¾›ç™¾åˆ†ä½æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</li></ul><p>è¿™å››ç§ç±»å‹æ˜¯ Prometheus åº¦é‡çš„æ ¸å¿ƒæ„æˆï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ ç›‘æ§ç³»ç»Ÿçš„ä¸åŒæ–¹é¢ï¼Œå¹¶ä»å¤šä¸ªè§’åº¦åˆ†ææ•°æ®ã€‚å¦‚æœæœ‰æŸä¸ªåº¦é‡ç±»å‹çš„å…·ä½“åº”ç”¨åœºæ™¯æˆ–è€…ç»†èŠ‚éœ€è¦è¿›ä¸€æ­¥äº†è§£ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼</p><h2 id=prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°>Prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°â˜†
<a class=anchor href=#prometheus%e6%9c%89%e5%93%aa%e5%87%a0%e7%a7%8d%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h2><p>Prometheus æä¾›äº†å¤šç§æœåŠ¡å‘ç°ï¼ˆService Discoveryï¼‰æœºåˆ¶ï¼Œä½¿å…¶èƒ½å¤Ÿè‡ªåŠ¨å‘ç°å¹¶æŠ“å–ç›®æ ‡ï¼ˆå¦‚åº”ç”¨ã€æœåŠ¡å™¨ç­‰ï¼‰çš„ç›‘æ§æ•°æ®ã€‚æœåŠ¡å‘ç°å¯ä»¥å¤§å¤§ç®€åŒ–é…ç½®ç®¡ç†ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨æ€ç¯å¢ƒä¸­ï¼ˆå¦‚ Kubernetes æˆ–äº‘å¹³å°ï¼‰éå¸¸æœ‰ç”¨ã€‚Prometheus æ”¯æŒä»¥ä¸‹å‡ ç§æœåŠ¡å‘ç°æ–¹å¼ï¼š</p><h3 id=1-kubernetes-æœåŠ¡å‘ç°>1. <strong>Kubernetes æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#1-kubernetes-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šåœ¨ Kubernetes ç¯å¢ƒä¸­ï¼ŒPrometheus å¯ä»¥é€šè¿‡ Kubernetes API è‡ªåŠ¨å‘ç°é›†ç¾¤ä¸­çš„æœåŠ¡ã€Pod å’ŒèŠ‚ç‚¹ã€‚å®ƒèƒ½å¤Ÿå‘ç° K8s ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç›®æ ‡ï¼ˆå¦‚é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ã€å‘½åç©ºé—´ç­‰è¿›è¡Œç­›é€‰ï¼‰ã€‚</li><li><strong>é…ç½®</strong>ï¼šPrometheus é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>kubernetes_sd_configs</code> é…ç½®é¡¹æ¥å®ç°ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå®¹å™¨åŒ–çš„ç¯å¢ƒï¼Œå°¤å…¶æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡å‘ç°ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;kubernetes-pods&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubernetes_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>api_server</span>: <span style=color:#e6db74>&#39;https://k8s-api-server&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>role</span>: <span style=color:#ae81ff>pod</span>
</span></span></code></pre></div><h3 id=2-consul-æœåŠ¡å‘ç°>2. <strong>Consul æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#2-consul-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus æ”¯æŒé€šè¿‡ Consul è¿›è¡ŒæœåŠ¡å‘ç°ã€‚Consul æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼å·¥å…·ï¼Œå®ƒå¯ä»¥ç®¡ç†æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚Prometheus ä¼šä» Consul è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨å¹¶è¿›è¡ŒæŠ“å–ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>consul_sd_configs</code> é…ç½®é¡¹ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºä½¿ç”¨ Consul ä½œä¸ºæœåŠ¡æ³¨å†Œå’Œå‘ç°çš„ç¯å¢ƒã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;consul&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>consul_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>server</span>: <span style=color:#e6db74>&#39;localhost:8500&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>services</span>: [<span style=color:#e6db74>&#39;my-service&#39;</span>]
</span></span></code></pre></div><h3 id=3-ec2-æœåŠ¡å‘ç°>3. <strong>EC2 æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#3-ec2-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šåœ¨ AWS ç¯å¢ƒä¸­ï¼ŒPrometheus å¯ä»¥é€šè¿‡ AWS EC2 æœåŠ¡å‘ç°ï¼Œè‡ªåŠ¨æŠ“å– EC2 å®ä¾‹çš„æŒ‡æ ‡ã€‚å®ƒé€šè¿‡ AWS API è·å–å½“å‰è¿è¡Œçš„ EC2 å®ä¾‹ä¿¡æ¯ï¼ŒåŸºäºæ ‡ç­¾ã€å®ä¾‹çŠ¶æ€ç­‰è¿›è¡Œç­›é€‰ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>ec2_sd_configs</code> é…ç½®é¡¹æ¥å®ç°ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºåœ¨ AWS EC2 ä¸Šè¿è¡Œçš„æœåŠ¡æˆ–å®ä¾‹ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;ec2&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ec2_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>region</span>: <span style=color:#e6db74>&#39;us-west-2&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>access_key</span>: <span style=color:#e6db74>&#39;AWS_ACCESS_KEY&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>secret_key</span>: <span style=color:#e6db74>&#39;AWS_SECRET_KEY&#39;</span>
</span></span></code></pre></div><h3 id=4-gcegoogle-compute-engineæœåŠ¡å‘ç°>4. <strong>GCEï¼ˆGoogle Compute Engineï¼‰æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#4-gcegoogle-compute-engine%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus å¯ä»¥åœ¨ Google Cloud ç¯å¢ƒä¸­ä½¿ç”¨ GCE æœåŠ¡å‘ç°æ¥è‡ªåŠ¨å‘ç° Google Compute Engine å®ä¾‹ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>gce_sd_configs</code> é…ç½®é¡¹æ¥å®ç°ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äº Google Cloud å¹³å°çš„è™šæ‹Ÿæœºå®ä¾‹ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;gce&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gce_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>project</span>: <span style=color:#e6db74>&#39;my-gcp-project&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>zone</span>: <span style=color:#e6db74>&#39;us-central1-a&#39;</span>
</span></span></code></pre></div><h3 id=5-azure-æœåŠ¡å‘ç°>5. <strong>Azure æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#5-azure-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus æ”¯æŒåœ¨ Azure ç¯å¢ƒä¸­è‡ªåŠ¨å‘ç°è™šæ‹Ÿæœºã€è™šæ‹Ÿæœºè§„æ¨¡é›†ç­‰æœåŠ¡å®ä¾‹ã€‚é€šè¿‡ Azure API è·å–å®ä¾‹çš„ IP åœ°å€ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>azure_sd_configs</code> é…ç½®é¡¹æ¥å®ç°ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºåœ¨ Azure äº‘å¹³å°ä¸Šéƒ¨ç½²çš„æœåŠ¡ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;azure&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>azure_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>subscription_id</span>: <span style=color:#e6db74>&#39;your-subscription-id&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>tenant_id</span>: <span style=color:#e6db74>&#39;your-tenant-id&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>client_id</span>: <span style=color:#e6db74>&#39;your-client-id&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>client_secret</span>: <span style=color:#e6db74>&#39;your-client-secret&#39;</span>
</span></span></code></pre></div><h3 id=6-dns-æœåŠ¡å‘ç°>6. <strong>DNS æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#6-dns-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus å¯ä»¥ä½¿ç”¨ DNS æŸ¥è¯¢æ¥å‘ç°ç›®æ ‡ã€‚é€šè¿‡é…ç½® DNS åç§°è§£æè·å–éœ€è¦ç›‘æ§çš„ç›®æ ‡ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>dns_sd_configs</code> é…ç½®é¡¹ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºä½¿ç”¨ DNS è¿›è¡ŒåŠ¨æ€æœåŠ¡å‘ç°çš„ç¯å¢ƒã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;dns&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dns_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>names</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#39;myservice.local&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#e6db74>&#39;A&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><h3 id=7-file-æœåŠ¡å‘ç°>7. <strong>File æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#7-file-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus å¯ä»¥é€šè¿‡è¯»å–å¤–éƒ¨æ–‡ä»¶ï¼ˆå¦‚ JSON æˆ– YAML æ ¼å¼ï¼‰æ¥è¿›è¡Œé™æ€æœåŠ¡å‘ç°ã€‚æ–‡ä»¶ä¸­çš„ç›®æ ‡å¯ä»¥åŠ¨æ€æ›´æ–°ï¼ŒPrometheus ä¼šå®šæœŸé‡æ–°åŠ è½½è¿™äº›æ–‡ä»¶ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>file_sd_configs</code> é…ç½®é¡¹ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºè¾ƒä¸ºé™æ€çš„ç¯å¢ƒï¼Œæˆ–è€…å½“ç›®æ ‡å®ä¾‹åˆ—è¡¨å­˜å‚¨åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­çš„æƒ…å†µã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;file&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>file_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>files</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#39;/path/to/targets.json&#39;</span>
</span></span></code></pre></div><h3 id=8-static-æœåŠ¡å‘ç°>8. <strong>Static æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#8-static-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus ä¹Ÿæ”¯æŒé€šè¿‡é™æ€é…ç½®æ¥å‘ç°ç›®æ ‡ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºç›®æ ‡åˆ—è¡¨ä¸é¢‘ç¹å˜åŒ–çš„åœºæ™¯ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>static_configs</code> é…ç½®é¡¹ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ—å‡ºç›®æ ‡ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºç›®æ ‡æ•°é‡è¾ƒå°‘ä¸”è¾ƒä¸ºå›ºå®šçš„ç¯å¢ƒã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;static&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9090&#39;</span>, <span style=color:#e6db74>&#39;localhost:8080&#39;</span>]
</span></span></code></pre></div><h3 id=9-openstack-æœåŠ¡å‘ç°>9. <strong>OpenStack æœåŠ¡å‘ç°</strong>ï¼š
<a class=anchor href=#9-openstack-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><ul><li><strong>æè¿°</strong>ï¼šPrometheus æ”¯æŒ OpenStack ç¯å¢ƒä¸­çš„æœåŠ¡å‘ç°ã€‚é€šè¿‡ä¸ OpenStack API äº¤äº’ï¼Œè‡ªåŠ¨å‘ç°ç›¸å…³çš„æœåŠ¡å®ä¾‹å’ŒèŠ‚ç‚¹ã€‚</li><li><strong>é…ç½®</strong>ï¼šé€šè¿‡ <code>openstack_sd_configs</code> é…ç½®é¡¹æ¥å®ç°ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äº OpenStack ç¯å¢ƒçš„æœåŠ¡å‘ç°ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;openstack&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>openstack_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>auth_url</span>: <span style=color:#e6db74>&#39;https://openstack.example.com&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>username</span>: <span style=color:#e6db74>&#39;username&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#39;password&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>project_name</span>: <span style=color:#e6db74>&#39;project&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>region</span>: <span style=color:#e6db74>&#39;region&#39;</span>
</span></span></code></pre></div><h3 id=æ€»ç»“-1>æ€»ç»“ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-1>#</a></h3><p>Prometheus æ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼Œæ¶µç›–äº†äº‘å¹³å°ã€å®¹å™¨å¹³å°ã€ä¼ ç»ŸæœåŠ¡å™¨å’Œé™æ€é…ç½®ç­‰å¤šç§åœºæ™¯ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ç¯å¢ƒé€‰æ‹©åˆé€‚çš„æœåŠ¡å‘ç°æ–¹å¼ï¼Œå¸®åŠ© Prometheus è‡ªåŠ¨å‘ç°å’ŒæŠ“å–ç›®æ ‡ã€‚</p><p>å¦‚æœä½ å¯¹æŸç§æœåŠ¡å‘ç°æ–¹å¼æœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦å…·ä½“ç¤ºä¾‹ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼</p><h2 id=prometheuså¸¸ç”¨å‡½æ•°>Prometheuså¸¸ç”¨å‡½æ•°
<a class=anchor href=#prometheus%e5%b8%b8%e7%94%a8%e5%87%bd%e6%95%b0>#</a></h2><p>Prometheus æä¾›äº†ä¸°å¯Œçš„å‡½æ•°å’Œæ“ä½œç¬¦ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ PromQL æŸ¥è¯¢è¯­è¨€ä¸­å¤„ç†å’Œåˆ†ææ—¶é—´åºåˆ—æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Prometheus å‡½æ•°ï¼š</p><h3 id=1-èšåˆå‡½æ•°aggregation-functions>1. <strong>èšåˆå‡½æ•°ï¼ˆAggregation Functionsï¼‰</strong>
<a class=anchor href=#1-%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0aggregation-functions>#</a></h3><p>èšåˆå‡½æ•°ç”¨äºæŒ‰æŸäº›ç»´åº¦èšåˆæ•°æ®ï¼Œé€šå¸¸ç”¨äºå°†å¤šä¸ªæ—¶é—´åºåˆ—åˆå¹¶ä¸ºä¸€ä¸ªæ›´å…·æ¦‚æ‹¬æ€§çš„åº¦é‡ã€‚</p><ul><li><p><code>avg()</code></p><p>ï¼šè®¡ç®—å¹³å‡å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>avg(http_requests_total)
</code></pre></li><li><p><code>sum()</code></p><p>ï¼šè®¡ç®—æ€»å’Œ</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>sum(http_requests_total)
</code></pre></li><li><p><code>min()</code></p><p>ï¼šè®¡ç®—æœ€å°å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>min(http_requests_total)
</code></pre></li><li><p><code>max()</code></p><p>ï¼šè®¡ç®—æœ€å¤§å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>max(http_requests_total)
</code></pre></li><li><p><code>count()</code></p><p>ï¼šè®¡ç®—æ•°é‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>count(http_requests_total)
</code></pre></li><li><p><code>count_values()</code></p><p>ï¼šè®¡ç®—ä¸åŒæ ‡ç­¾å€¼çš„æ•°é‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>count_values(&#34;method&#34;, http_requests_total)
</code></pre></li><li><p><code>topk(k, expr)</code></p><p>ï¼šè¿”å›å€¼æ’åå‰</p><pre tabindex=0><code>k
</code></pre><p>çš„æ—¶é—´åºåˆ—</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>topk(3, http_requests_total)
</code></pre></li><li><p><code>bottomk(k, expr)</code></p><p>ï¼šè¿”å›å€¼æ’åå</p><pre tabindex=0><code>k
</code></pre><p>çš„æ—¶é—´åºåˆ—</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>bottomk(3, http_requests_total)
</code></pre></li></ul><h3 id=2-ç»Ÿè®¡å‡½æ•°statistical-functions>2. <strong>ç»Ÿè®¡å‡½æ•°ï¼ˆStatistical Functionsï¼‰</strong>
<a class=anchor href=#2-%e7%bb%9f%e8%ae%a1%e5%87%bd%e6%95%b0statistical-functions>#</a></h3><ul><li><p><code>rate()</code></p><p>ï¼šè®¡ç®—æ—¶é—´åºåˆ—åœ¨æŸä¸ªæ—¶é—´æ®µå†…çš„é€Ÿç‡ï¼ˆé€‚ç”¨äºè®¡æ•°å™¨ç±»å‹ï¼‰</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>rate(http_requests_total[5m])
</code></pre></li><li><p><code>irate()</code></p><p>ï¼šè®¡ç®—ç¬æ—¶é€Ÿç‡ï¼Œé€‚ç”¨äºè®¡æ•°å™¨ç±»å‹</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>irate(http_requests_total[1m])
</code></pre></li><li><p><code>increase()</code></p><p>ï¼šè®¡ç®—è®¡æ•°å™¨ç±»å‹çš„å¢é‡å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>increase(http_requests_total[1h])
</code></pre></li><li><p><code>delta()</code></p><p>ï¼šè®¡ç®—æŸæ—¶é—´æ®µå†…çš„å€¼çš„å˜åŒ–é‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>delta(http_requests_total[5m])
</code></pre></li><li><p><code>avg_over_time()</code></p><p>ï¼šè®¡ç®—æŸä¸ªæ—¶é—´åŒºé—´å†…çš„å¹³å‡å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>avg_over_time(http_requests_total[1h])
</code></pre></li><li><p><code>min_over_time()</code></p><p>ï¼šè®¡ç®—æŸä¸ªæ—¶é—´åŒºé—´å†…çš„æœ€å°å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>min_over_time(http_requests_total[1h])
</code></pre></li><li><p><code>max_over_time()</code></p><p>ï¼šè®¡ç®—æŸä¸ªæ—¶é—´åŒºé—´å†…çš„æœ€å¤§å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>max_over_time(http_requests_total[1h])
</code></pre></li></ul><h3 id=3-æ—¶é—´å‡½æ•°time-functions>3. <strong>æ—¶é—´å‡½æ•°ï¼ˆTime Functionsï¼‰</strong>
<a class=anchor href=#3-%e6%97%b6%e9%97%b4%e5%87%bd%e6%95%b0time-functions>#</a></h3><p>æ—¶é—´å‡½æ•°ç”¨äºæ“ä½œæ—¶é—´æˆ³å’Œæ—¶é—´åºåˆ—ã€‚</p><ul><li><p><code>time()</code></p><p>ï¼šè¿”å›å½“å‰çš„æ—¶é—´æˆ³ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>time()
</code></pre></li><li><p><code>timestamp()</code></p><p>ï¼šè¿”å›æ—¶é—´åºåˆ—çš„æ—¶é—´æˆ³</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>timestamp(http_requests_total)
</code></pre></li></ul><h3 id=4-æ•°å€¼å¤„ç†å‡½æ•°mathematical-functions>4. <strong>æ•°å€¼å¤„ç†å‡½æ•°ï¼ˆMathematical Functionsï¼‰</strong>
<a class=anchor href=#4-%e6%95%b0%e5%80%bc%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0mathematical-functions>#</a></h3><p>è¿™äº›å‡½æ•°ç”¨äºè¿›è¡Œå¸¸è§çš„æ•°å­¦è¿ç®—ã€‚</p><ul><li><p><code>abs()</code></p><p>ï¼šè¿”å›ç»å¯¹å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>abs(http_requests_total)
</code></pre></li><li><p><code>ceil()</code></p><p>ï¼šè¿”å›å¤§äºæˆ–ç­‰äºè¯¥å€¼çš„æœ€å°æ•´æ•°</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>ceil(http_requests_total)
</code></pre></li><li><p><code>floor()</code></p><p>ï¼šè¿”å›å°äºæˆ–ç­‰äºè¯¥å€¼çš„æœ€å¤§æ•´æ•°</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>floor(http_requests_total)
</code></pre></li><li><p><code>round()</code></p><p>ï¼šè¿”å›å››èˆäº”å…¥çš„å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>round(http_requests_total)
</code></pre></li><li><p><code>sqrt()</code></p><p>ï¼šè®¡ç®—å¹³æ–¹æ ¹</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>sqrt(http_requests_total)
</code></pre></li></ul><h3 id=5-å­—ç¬¦ä¸²å¤„ç†å‡½æ•°string-functions>5. <strong>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼ˆString Functionsï¼‰</strong>
<a class=anchor href=#5-%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0string-functions>#</a></h3><p>å­—ç¬¦ä¸²å‡½æ•°ä¸»è¦ç”¨äºå¯¹æ ‡ç­¾å€¼æˆ–å­—ç¬¦ä¸²å‹æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p><ul><li><p><code>label_replace()</code></p><p>ï¼šç”¨äºæ›¿æ¢æ ‡ç­¾ä¸­çš„éƒ¨åˆ†å†…å®¹</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>label_replace(http_requests_total, &#34;method&#34;, &#34;$1&#34;, &#34;status&#34;, &#34;(.*)&#34;)
</code></pre></li><li><p><code>label_join()</code></p><p>ï¼šå°†å¤šä¸ªæ ‡ç­¾å€¼è¿æ¥ä¸ºä¸€ä¸ªæ–°æ ‡ç­¾</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>label_join(http_requests_total, &#34;method&#34;, &#34;-&#34;, &#34;status&#34;, &#34;code&#34;)
</code></pre></li></ul><h3 id=6-æŸ¥è¯¢æ—¶é—´å‡½æ•°time-interval-functions>6. <strong>æŸ¥è¯¢æ—¶é—´å‡½æ•°ï¼ˆTime Interval Functionsï¼‰</strong>
<a class=anchor href=#6-%e6%9f%a5%e8%af%a2%e6%97%b6%e9%97%b4%e5%87%bd%e6%95%b0time-interval-functions>#</a></h3><p>è¿™äº›å‡½æ•°ç”¨äºå¤„ç†æ—¶é—´åŒºé—´ã€‚</p><ul><li><p><code>avg_over_time()</code></p><p>ï¼šè®¡ç®—æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„å¹³å‡å€¼</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>avg_over_time(http_requests_total[1h])
</code></pre></li><li><p><code>rate()</code></p><p>ï¼šè®¡ç®—åœ¨æŸæ®µæ—¶é—´å†…çš„é€Ÿç‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>rate(http_requests_total[5m])
</code></pre></li></ul><h3 id=7-ç‡å‡½æ•°rate-functions>7. <strong>ç‡å‡½æ•°ï¼ˆRate Functionsï¼‰</strong>
<a class=anchor href=#7-%e7%8e%87%e5%87%bd%e6%95%b0rate-functions>#</a></h3><p>ç”¨äºè®¡ç®—å•ä½æ—¶é—´å†…çš„æ•°æ®å˜åŒ–é‡ã€‚</p><ul><li><p><code>rate()</code></p><p>ï¼šé€‚ç”¨äºè®¡æ•°å™¨ç±»å‹ï¼Œè®¡ç®—å•ä½æ—¶é—´å†…çš„å˜åŒ–é€Ÿç‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>rate(http_requests_total[5m])
</code></pre></li><li><p><code>irate()</code></p><p>ï¼šå³æ—¶é€Ÿç‡ï¼Œé€‚ç”¨äºè®¡æ•°å™¨ç±»å‹ï¼Œè®¡ç®—æœ€è¿‘ä¸¤ä¸ªæ•°æ®ç‚¹çš„é€Ÿç‡</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>irate(http_requests_total[1m])
</code></pre></li></ul><h3 id=8-é€»è¾‘å‡½æ•°logical-functions>8. <strong>é€»è¾‘å‡½æ•°ï¼ˆLogical Functionsï¼‰</strong>
<a class=anchor href=#8-%e9%80%bb%e8%be%91%e5%87%bd%e6%95%b0logical-functions>#</a></h3><p>è¿™äº›å‡½æ•°å¸®åŠ©è¿›è¡Œé€»è¾‘åˆ¤æ–­å’Œæ“ä½œã€‚</p><ul><li><p><code>and</code></p><p>ï¼šç”¨äºä¸¤ä¸ªè¡¨è¾¾å¼çš„ä¸æ“ä½œ</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total{status=&#34;200&#34;} and http_requests_total{status=&#34;500&#34;}
</code></pre></li><li><p><code>or</code></p><p>ï¼šç”¨äºä¸¤ä¸ªè¡¨è¾¾å¼çš„æˆ–æ“ä½œ</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total{status=&#34;200&#34;} or http_requests_total{status=&#34;404&#34;}
</code></pre></li><li><p><code>unless</code></p><p>ï¼šæ’é™¤æŸäº›æ¡ä»¶</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total unless http_requests_total{status=&#34;500&#34;}
</code></pre></li></ul><h3 id=9-è¿‡æ»¤ä¸æ¡ä»¶filters--conditionals>9. <strong>è¿‡æ»¤ä¸æ¡ä»¶ï¼ˆFilters & Conditionalsï¼‰</strong>
<a class=anchor href=#9-%e8%bf%87%e6%bb%a4%e4%b8%8e%e6%9d%a1%e4%bb%b6filters--conditionals>#</a></h3><ul><li><p><code>on()</code></p><p>ï¼šç”¨äºæ¡ä»¶åŒ¹é…ï¼Œå¯ä»¥æŒ‡å®šæŸäº›æ ‡ç­¾å‚ä¸åŒ¹é…</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total{status=&#34;200&#34;} on(method) http_requests_total{status=&#34;500&#34;}
</code></pre></li><li><p><code>ignoring()</code></p><p>ï¼šå¿½ç•¥ç‰¹å®šçš„æ ‡ç­¾è¿›è¡Œæ¡ä»¶åŒ¹é…</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>http_requests_total{status=&#34;200&#34;} ignoring(method) http_requests_total{status=&#34;500&#34;}
</code></pre></li></ul><h3 id=10-ç™¾åˆ†æ¯”è®¡ç®—percentile-calculation>10. <strong>ç™¾åˆ†æ¯”è®¡ç®—ï¼ˆPercentile Calculationï¼‰</strong>
<a class=anchor href=#10-%e7%99%be%e5%88%86%e6%af%94%e8%ae%a1%e7%ae%97percentile-calculation>#</a></h3><ul><li><p><code>histogram_quantile()</code></p><p>ï¼šç”¨äºè®¡ç®—ç›´æ–¹å›¾çš„æŒ‡å®šåˆ†ä½æ•°ï¼ˆå¦‚ 95th ç™¾åˆ†ä½ï¼‰</p><pre tabindex=0><code class=language-prometheus data-lang=prometheus>histogram_quantile(0.95, http_request_duration_seconds_bucket)
</code></pre></li></ul><h3 id=æ€»ç»“-2>æ€»ç»“ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-2>#</a></h3><p>Prometheus æä¾›äº†å¤šç§å‡½æ•°æ¥å¸®åŠ©ä½ å¤„ç†å’Œåˆ†æç›‘æ§æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡è¿™äº›å‡½æ•°æ¥è¿›è¡Œèšåˆã€æ—¶é—´åºåˆ—è®¡ç®—ã€ç»Ÿè®¡åˆ†æä»¥åŠè¿›è¡Œå¤æ‚çš„æŸ¥è¯¢å’Œå¯è§†åŒ–ã€‚</p><p>å¦‚æœä½ å¯¹æŸä¸ªå‡½æ•°æˆ–ç”¨æ³•æœ‰ç–‘é—®ï¼Œéšæ—¶å¯ä»¥é—®æˆ‘ï¼</p><h2 id=thanosæ¶æ„>thanosæ¶æ„â˜†
<a class=anchor href=#thanos%e6%9e%b6%e6%9e%84>#</a></h2><p><strong>Thanos</strong> æ˜¯ä¸€ä¸ªç”¨äºæ‰©å±• <strong>Prometheus</strong> çš„é«˜å¯ç”¨æ€§ã€é•¿æœŸå­˜å‚¨å’Œå…¨çƒæŸ¥è¯¢çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒé€šè¿‡æ— ç¼åœ°é›†æˆ Prometheus å’Œå…¶ä»–ç»„ä»¶ï¼Œæä¾›äº†åˆ†å¸ƒå¼ã€å¯æ‰©å±•çš„ç›‘æ§æ¶æ„ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤§è§„æ¨¡éƒ¨ç½²å’Œå¤šé›†ç¾¤ç¯å¢ƒã€‚</p><h3 id=thanos-æ¶æ„æ¦‚è¿°>Thanos æ¶æ„æ¦‚è¿°
<a class=anchor href=#thanos-%e6%9e%b6%e6%9e%84%e6%a6%82%e8%bf%b0>#</a></h3><p>Thanos çš„æ¶æ„è®¾è®¡åŸºäºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p><ol><li><p><strong>Prometheus</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šPrometheus ä»ç„¶æ˜¯æ•°æ®çš„æŠ“å–å’Œå­˜å‚¨æ ¸å¿ƒï¼Œè´Ÿè´£ä»å„ç±»ç›®æ ‡ï¼ˆå¦‚æœåŠ¡ã€åº”ç”¨ã€èŠ‚ç‚¹ç­‰ï¼‰æŠ“å–æ—¶é—´åºåˆ—æ•°æ®ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šThanos å¹¶ä¸æ›¿ä»£ Prometheusï¼Œè€Œæ˜¯å¢å¼ºå…¶åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¯ç”¨ã€é•¿æœŸå­˜å‚¨å’Œå¤šé›†ç¾¤ç®¡ç†æ–¹é¢ã€‚</li></ul></li><li><p><strong>Thanos Sidecar</strong>ï¼š</p><ul><li><p>ä½œç”¨</p><p>ï¼šThanos Sidecar æ˜¯è¿è¡Œåœ¨ Prometheus å®ä¾‹æ—è¾¹çš„ä¸€ä¸ªä»£ç†ï¼Œå®ƒè´Ÿè´£ï¼š</p><ul><li>å°† Prometheus ä¸­çš„æ—¶é—´åºåˆ—æ•°æ®ä¸Šä¼ åˆ°è¿œç¨‹å­˜å‚¨ï¼ˆå¦‚ S3ã€GCSã€HDFS ç­‰ï¼‰ã€‚</li><li>å°† Prometheus æ•°æ®æš´éœ²ç»™ Thanos Query å’Œå…¶ä»–ç»„ä»¶ã€‚</li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šSidecar æ˜¯ Thanos æ¶æ„ä¸­çš„å…³é”®ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒå¸®åŠ© Prometheus å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶ä¸”ä¸º Thanos Query æä¾›æ•°æ®æºã€‚</p></li></ul><p><strong>Sidecar é…ç½®</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- --<span style=color:#ae81ff>tsdb.path=/prometheus</span>
</span></span><span style=display:flex><span>- --<span style=color:#ae81ff>objstore.config=&#34;type: S3\nconfig:\n  bucket: my-bucket&#34;</span>
</span></span></code></pre></div></li><li><p><strong>Thanos Store</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šThanos Store æ˜¯ä¸€ä¸ªå­˜å‚¨ç»„ä»¶ï¼Œè´Ÿè´£ä»è¿œç¨‹å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ S3ã€GCS ç­‰ï¼‰è¯»å–å†å²æ•°æ®ã€‚å®ƒå……å½“äº† Prometheus æ•°æ®çš„é•¿æœŸå­˜å‚¨ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šStore ä¸»è¦ç”¨äºæŸ¥è¯¢è¿‡å»çš„å†å²æ•°æ®ï¼Œå¹¶æä¾›äº†ç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®ä¸åŒæ—¶é—´çª—å£å†…çš„æ•°æ®ã€‚</li></ul></li><li><p><strong>Thanos Query</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šThanos Query æ˜¯ä¸€ä¸ªç”¨äºèšåˆæŸ¥è¯¢çš„ç»„ä»¶ï¼Œå®ƒå…è®¸è·¨å¤šä¸ª Prometheus å’Œ Thanos å­˜å‚¨å®ä¾‹æ‰§è¡Œå…¨å±€æŸ¥è¯¢ã€‚å®ƒä»å¤šä¸ª Prometheus å®ä¾‹å’Œ Thanos Store è·å–æ•°æ®ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æŸ¥è¯¢ç»“æœã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šThanos Query å®ç°äº†é«˜æ•ˆçš„åˆ†å¸ƒå¼æŸ¥è¯¢ï¼Œæ”¯æŒä»ä¸åŒ Prometheus å®ä¾‹å’Œ Store ä¸­è¯»å–æ•°æ®ï¼Œå¯ä»¥è·¨å¤šä¸ªé›†ç¾¤æˆ–å¤šæ•°æ®æºæ‰§è¡Œè”åˆæŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>Thanos Compact</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šThanos Compact è´Ÿè´£åˆå¹¶ã€å‹ç¼©å’Œä¼˜åŒ–å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ä¸­çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå°†å¤šä¸ªæ—¶é—´å—ï¼ˆBlockï¼‰åˆå¹¶ä¸ºæ›´å¤§çš„å­˜å‚¨å—ï¼Œä»¥å‡å°‘å­˜å‚¨ç¢ç‰‡å¹¶ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå®ƒå®šæœŸè¿è¡Œï¼Œä»¥ç¡®ä¿æ•°æ®åœ¨å­˜å‚¨å±‚é¢çš„ä¼˜åŒ–å’Œå‹ç¼©ã€‚</li></ul></li><li><p><strong>Thanos Ruler</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šThanos Ruler æ˜¯åŸºäº Prometheus çš„è§„åˆ™å¼•æ“ï¼Œå®ƒå…è®¸ä½ åœ¨ Thanos é›†ç¾¤ä¸­è¿è¡Œ Prometheus è§„åˆ™ã€å‘Šè­¦è§„åˆ™å’Œå½•åˆ¶è§„åˆ™ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå®ƒæä¾›äº†ä¸€ç§åœ¨å…¨å±€èŒƒå›´å†…æ‰§è¡Œå‘Šè­¦å’Œè§„åˆ™è¯„ä¼°çš„æœºåˆ¶ã€‚Thanos Ruler æ”¯æŒåœ¨å¤šä¸ª Prometheus å®ä¾‹ä¹‹é—´å…±äº«è§„åˆ™å’Œå‘Šè­¦ä¿¡æ¯ã€‚</li></ul></li></ol><h3 id=thanos-æ¶æ„å›¾>Thanos æ¶æ„å›¾
<a class=anchor href=#thanos-%e6%9e%b6%e6%9e%84%e5%9b%be>#</a></h3><pre tabindex=0><code>+----------------------+       +----------------------+       +----------------------+
|    Prometheus        |&lt;-----&gt;|    Thanos Sidecar    |&lt;-----&gt;|  Remote Object Store |
+----------------------+       +----------------------+       +----------------------+
        |                            |                          |
        |                            v                          v
        |                      +--------------------+       +------------------+
        |                      |   Thanos Query     |&lt;-----&gt;|    Thanos Store  |
        |                      +--------------------+       +------------------+
        |                               |
        |                               v
        |                        +------------------+
        |                        |   Thanos Ruler   |
        |                        +------------------+
        |
        v
   +------------------+
   | Thanos Compact   |
   +------------------+
</code></pre><h3 id=thanos-æ ¸å¿ƒåŠŸèƒ½>Thanos æ ¸å¿ƒåŠŸèƒ½
<a class=anchor href=#thanos-%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd>#</a></h3><ol><li><strong>é«˜å¯ç”¨æ€§å’Œæ°´å¹³æ‰©å±•</strong>ï¼š<ul><li>Thanos æä¾›è·¨å¤šä¸ª Prometheus å®ä¾‹å’Œå¤šä¸ªé›†ç¾¤çš„æŸ¥è¯¢èƒ½åŠ›ï¼Œå¸®åŠ©å®ç° Prometheus é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</li><li>å¤šä¸ª Prometheus å®ä¾‹å¯ä»¥åˆ†åˆ«åœ¨ä¸åŒçš„åŒºåŸŸæˆ–é›†ç¾¤ä¸­éƒ¨ç½²ï¼ŒThanos Query å¯ä»¥å°†å…¶èšåˆæˆä¸€ä¸ªå…¨å±€è§†å›¾ã€‚</li></ul></li><li><strong>é•¿æœŸå­˜å‚¨</strong>ï¼š<ul><li>é€šè¿‡å°†æ•°æ®æŒä¹…åŒ–åˆ°è¿œç¨‹å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ S3ã€GCSã€Azure Blob ç­‰ï¼‰ï¼ŒThanos æä¾›äº†å¯é ä¸”æˆæœ¬æ•ˆç›Šé«˜çš„é•¿æœŸå­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</li><li>å¯¹å†å²æ•°æ®çš„è®¿é—®å¯ä»¥é€šè¿‡ Thanos Store ç»„ä»¶æ¥æŸ¥è¯¢ã€‚</li></ul></li><li><strong>å…¨çƒæŸ¥è¯¢</strong>ï¼š<ul><li>Thanos Query æä¾›å…¨å±€è§†å›¾ï¼Œæ”¯æŒè·¨å¤šä¸ªé›†ç¾¤æˆ– Prometheus å®ä¾‹æ‰§è¡Œç»Ÿä¸€æŸ¥è¯¢ã€‚</li><li>å³ä½¿æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ª Prometheus å®ä¾‹ä¸Šï¼ŒThanos Query ä¹Ÿèƒ½é€šè¿‡èšåˆå„ä¸ªæ•°æ®æºçš„ç»“æœï¼Œæä¾›ç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£ã€‚</li></ul></li><li><strong>å‹ç¼©ä¸å­˜å‚¨ä¼˜åŒ–</strong>ï¼š<ul><li>Thanos Compact åŠŸèƒ½å¯ä»¥å°†å­˜å‚¨ä¸­çš„å¤šä¸ªæ•°æ®å—åˆå¹¶å’Œå‹ç¼©ï¼Œé™ä½å­˜å‚¨æˆæœ¬ï¼ŒåŒæ—¶æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul></li><li><strong>è§„åˆ™å’Œå‘Šè­¦</strong>ï¼š<ul><li>Thanos Ruler å…è®¸åœ¨ Thanos é›†ç¾¤ä¸­æ‰§è¡Œ Prometheus è§„åˆ™å’Œå‘Šè­¦ï¼Œå¹¶æ”¯æŒè·¨ Prometheus å®ä¾‹å…±äº«è§„åˆ™å’Œå‘Šè­¦é…ç½®ã€‚</li></ul></li><li><strong>æ•°æ®æµæ§åˆ¶</strong>ï¼š<ul><li>ä½¿ç”¨ Thanos Sidecarï¼Œç”¨æˆ·å¯ä»¥å°† Prometheus æ•°æ®æ¨é€åˆ°è¿œç¨‹å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥å®ç°å¤šä¸ª Prometheus å®ä¾‹ä¹‹é—´çš„æ•°æ®å¤åˆ¶å’Œå¤‡ä»½ã€‚</li></ul></li></ol><h3 id=thanos-çš„ä½¿ç”¨åœºæ™¯>Thanos çš„ä½¿ç”¨åœºæ™¯
<a class=anchor href=#thanos-%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><ol><li><strong>è·¨åœ°åŸŸå’Œè·¨é›†ç¾¤ç›‘æ§</strong>ï¼š<ul><li>Thanos éå¸¸é€‚åˆåœ¨å¤šé›†ç¾¤ã€å¤šåŒºåŸŸéƒ¨ç½² Prometheus å®ä¾‹çš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿèšåˆæ¥è‡ªä¸åŒé›†ç¾¤çš„æ•°æ®ï¼Œè¿›è¡Œè·¨åŒºåŸŸæŸ¥è¯¢ã€‚</li></ul></li><li><strong>é•¿æœŸå­˜å‚¨è§£å†³æ–¹æ¡ˆ</strong>ï¼š<ul><li>Thanos å¯ä»¥å°† Prometheus çš„æ•°æ®æŒä¹…åŒ–åˆ°å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ AWS S3ã€Google Cloud Storage ç­‰ï¼‰ï¼Œå®ç°é«˜æ•ˆä¸”æˆæœ¬ä½çš„é•¿æœŸå­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</li></ul></li><li><strong>é«˜å¯ç”¨å’Œé«˜å®¹é”™</strong>ï¼š<ul><li>é€šè¿‡åœ¨å¤šä¸ªèŠ‚ç‚¹æˆ–é›†ç¾¤ä¸­è¿è¡Œ Prometheus å’Œ Thanosï¼Œå®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™èƒ½åŠ›ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li></ul></li><li><strong>è·¨å¤šä¸ª Prometheus å®ä¾‹çš„å…¨å±€æŸ¥è¯¢</strong>ï¼š<ul><li>å¯¹äºéœ€è¦è·¨å¤šä¸ª Prometheus å®ä¾‹è¿›è¡Œå…¨å±€æŸ¥è¯¢çš„åœºæ™¯ï¼ŒThanos æä¾›äº†æ— ç¼çš„æŸ¥è¯¢èƒ½åŠ›ã€‚</li></ul></li></ol><h3 id=æ€»ç»“-3>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93-3>#</a></h3><p>Thanos é€šè¿‡ä¸ Prometheus ç´§å¯†é›†æˆï¼Œæä¾›äº†å¯¹å¤§è§„æ¨¡ã€è·¨åŒºåŸŸã€å¤šé›†ç¾¤éƒ¨ç½²ç¯å¢ƒçš„æ”¯æŒã€‚å®ƒè§£å†³äº† Prometheus åœ¨é«˜å¯ç”¨ã€é•¿æœŸå­˜å‚¨ã€åˆ†å¸ƒå¼æŸ¥è¯¢ç­‰æ–¹é¢çš„ç“¶é¢ˆï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ‰©å±•è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å…¨çƒæŸ¥è¯¢å’Œå¤§è§„æ¨¡ç›‘æ§ç¯å¢ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>å¦‚æœä½ æœ‰ä»»ä½•å…³äº Thanos çš„å…·ä½“é—®é¢˜ï¼Œæˆ–è€…éœ€è¦è¿›ä¸€æ­¥äº†è§£é…ç½®å’Œå®è·µï¼Œéšæ—¶é—®æˆ‘ï¼</p><h2 id=thanosä¸victoriametricså¯¹æ¯”>thanosä¸VictoriaMetricså¯¹æ¯”
<a class=anchor href=#thanos%e4%b8%8evictoriametrics%e5%af%b9%e6%af%94>#</a></h2><p>Thanos å’Œ VictoriaMetrics éƒ½æ˜¯ Prometheus ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç›‘æ§å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡ã€æ¶æ„å’Œé€‚ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š</p><hr><h2 id=1-æ¦‚è¿°><strong>1. æ¦‚è¿°</strong>
<a class=anchor href=#1-%e6%a6%82%e8%bf%b0>#</a></h2><table><thead><tr><th>ç‰¹æ€§</th><th><strong>Thanos</strong></th><th><strong>VictoriaMetrics</strong></th></tr></thead><tbody><tr><td><strong>ä¸»è¦ç”¨é€”</strong></td><td>åˆ†å¸ƒå¼é•¿æ—¶é—´å­˜å‚¨ã€å…¨å±€æŸ¥è¯¢ã€æ•°æ®å»é‡</td><td>é«˜æ€§èƒ½ã€ä½èµ„æºæ¶ˆè€—çš„æ—¶é—´åºåˆ—æ•°æ®åº“</td></tr><tr><td><strong>ä¸ Prometheus å…³ç³»</strong></td><td>Prometheus çš„æ‰©å±•ç»„ä»¶</td><td>å…¼å®¹ Prometheus çš„ç‹¬ç«‹ TSDB</td></tr><tr><td><strong>æ¶æ„</strong></td><td>ç»„ä»¶åŒ–ï¼ˆå¤šä¸ªç‹¬ç«‹ç»„ä»¶ï¼‰</td><td>å•ä½“åº”ç”¨ï¼ˆè½»é‡çº§ï¼‰</td></tr><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>å¯¹è±¡å­˜å‚¨ï¼ˆS3ã€GCSã€OSSç­‰ï¼‰</td><td>æœ¬åœ°ç£ç›˜/å¯¹è±¡å­˜å‚¨ï¼ˆå¯é€‰ï¼‰</td></tr></tbody></table><hr><h2 id=2-æ¶æ„å¯¹æ¯”><strong>2. æ¶æ„å¯¹æ¯”</strong>
<a class=anchor href=#2-%e6%9e%b6%e6%9e%84%e5%af%b9%e6%af%94>#</a></h2><h3 id=thanos><strong>Thanos</strong>
<a class=anchor href=#thanos>#</a></h3><ul><li>ä½œä¸º Prometheus çš„æ‰©å±•ç»„ä»¶ï¼Œå¢åŠ é«˜å¯ç”¨æ€§ã€é•¿æ—¶é—´å­˜å‚¨å’Œå…¨å±€æŸ¥è¯¢åŠŸèƒ½ã€‚</li><li>ä¸»è¦ç»„ä»¶ï¼š<ul><li><strong>Thanos Sidecar</strong>ï¼šé™„åŠ åˆ° Prometheusï¼Œæä¾›é•¿æœŸå­˜å‚¨å’ŒæŸ¥è¯¢èƒ½åŠ›ã€‚</li><li><strong>Thanos Store</strong>ï¼šä»å¯¹è±¡å­˜å‚¨ï¼ˆS3/GCSç­‰ï¼‰è¯»å–å†å²æ•°æ®ã€‚</li><li><strong>Thanos Query</strong>ï¼šæ”¯æŒè·¨å¤šä¸ª Prometheus å®ä¾‹çš„å…¨å±€æŸ¥è¯¢ã€‚</li><li><strong>Thanos Compact</strong>ï¼šåˆå¹¶å’Œå»é‡æ•°æ®ï¼Œä¼˜åŒ–å­˜å‚¨ç©ºé—´ã€‚</li><li><strong>Thanos Ruler</strong>ï¼šç±»ä¼¼ Prometheus Rulesï¼Œå¯åœ¨å…¨å±€èŒƒå›´å†…æ‰§è¡Œå‘Šè­¦è§„åˆ™ã€‚</li></ul></li></ul><h3 id=victoriametrics><strong>VictoriaMetrics</strong>
<a class=anchor href=#victoriametrics>#</a></h3><ul><li>ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ TSDBï¼Œæ”¯æŒé«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢ã€‚</li><li>ä¸»è¦ç»„ä»¶ï¼š<ul><li><strong>VictoriaMetricsï¼ˆå•æœºç‰ˆï¼‰</strong>ï¼šé«˜æ•ˆçš„å•å®ä¾‹å­˜å‚¨ï¼Œå¯æ›¿ä»£ Prometheus TSDBã€‚</li><li><strong>VictoriaMetrics Cluster</strong>ï¼šæ”¯æŒå¤§è§„æ¨¡é›†ç¾¤éƒ¨ç½²ï¼Œæä¾›å¯æ‰©å±•æ€§ã€‚</li><li><strong>vmalert</strong>ï¼šæ›¿ä»£ Prometheus Alertmanagerï¼Œå®ç°å‘Šè­¦è§„åˆ™æ‰§è¡Œã€‚</li><li><strong>vmagent</strong>ï¼šæ”¶é›†å’Œè½¬å‘ç›‘æ§æ•°æ®ï¼Œç›¸å½“äº Prometheus Remote Writeã€‚</li></ul></li></ul><hr><h2 id=3-å…³é”®ç‰¹æ€§å¯¹æ¯”><strong>3. å…³é”®ç‰¹æ€§å¯¹æ¯”</strong>
<a class=anchor href=#3-%e5%85%b3%e9%94%ae%e7%89%b9%e6%80%a7%e5%af%b9%e6%af%94>#</a></h2><table><thead><tr><th>ç‰¹æ€§</th><th><strong>Thanos</strong></th><th><strong>VictoriaMetrics</strong></th></tr></thead><tbody><tr><td><strong>é«˜å¯ç”¨æ€§</strong></td><td>ä¾èµ–å¤šä¸ª Prometheus å®ä¾‹åŠå¯¹è±¡å­˜å‚¨</td><td>åŸç”Ÿæ”¯æŒ HAï¼Œä¸éœ€è¦å¤šä¸ª Prometheus</td></tr><tr><td><strong>æ•°æ®å»é‡</strong></td><td>ä¾èµ– <code>--query.replica-label</code> è¿›è¡Œå»é‡</td><td>å†…ç½®é«˜æ•ˆå»é‡æœºåˆ¶</td></tr><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>å¯¹è±¡å­˜å‚¨ï¼ˆS3/GCS/OSSç­‰ï¼‰</td><td>æœ¬åœ°å­˜å‚¨ + å¯é€‰è¿œç¨‹å­˜å‚¨</td></tr><tr><td><strong>æŸ¥è¯¢æ€§èƒ½</strong></td><td>ä¾èµ–å¯¹è±¡å­˜å‚¨ï¼ŒæŸ¥è¯¢é€Ÿåº¦å—é™äºå­˜å‚¨ç³»ç»Ÿ</td><td>è¯»å–æœ¬åœ°ç£ç›˜ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ›´å¿«</td></tr><tr><td><strong>é›†ç¾¤éƒ¨ç½²</strong></td><td>éœ€è¦å¤šä¸ªç»„ä»¶ååŒå·¥ä½œ</td><td>å•æœºé«˜æ•ˆï¼Œæ”¯æŒé›†ç¾¤æ¨¡å¼</td></tr><tr><td><strong>èµ„æºå ç”¨</strong></td><td>éœ€è¦è¿è¡Œå¤šä¸ªç»„ä»¶ï¼Œèµ„æºå¼€é”€è¾ƒå¤§</td><td>ä½èµ„æºå ç”¨ï¼Œé«˜å‹ç¼©æ¯”</td></tr><tr><td><strong>å†™å…¥æ–¹å¼</strong></td><td>é€šè¿‡ Prometheus Remote Write é—´æ¥å†™å…¥</td><td>ç›´æ¥æ”¯æŒ Remote Write</td></tr><tr><td><strong>æ•°æ®å‹ç¼©</strong></td><td>ä¾èµ– Prometheus çš„å­˜å‚¨æ ¼å¼</td><td>åŸç”Ÿé«˜å‹ç¼©ç‡</td></tr><tr><td><strong>è¿ç»´å¤æ‚åº¦</strong></td><td>ç»„ä»¶è¾ƒå¤šï¼Œé…ç½®å¤æ‚</td><td>éƒ¨ç½²ç®€å•ï¼Œå•è¿›ç¨‹è¿è¡Œ</td></tr></tbody></table><hr><h2 id=4-é€‚ç”¨åœºæ™¯><strong>4. é€‚ç”¨åœºæ™¯</strong>
<a class=anchor href=#4-%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h2><table><thead><tr><th>éœ€æ±‚</th><th><strong>æ¨èä½¿ç”¨</strong></th></tr></thead><tbody><tr><td><strong>å·²æœ‰ Prometheus éƒ¨ç½²ï¼Œå¸Œæœ›æ‰©å±•é•¿æœŸå­˜å‚¨å’ŒæŸ¥è¯¢èƒ½åŠ›</strong></td><td>âœ… Thanos</td></tr><tr><td><strong>å¸Œæœ›ä¸€ä¸ªé«˜æ•ˆã€ç‹¬ç«‹çš„ TSDB å–ä»£ Prometheus å­˜å‚¨</strong></td><td>âœ… VictoriaMetrics</td></tr><tr><td><strong>éœ€è¦å¯¹è±¡å­˜å‚¨ï¼ˆS3/OSSï¼‰å­˜å‚¨å†å²æ•°æ®</strong></td><td>âœ… Thanos</td></tr><tr><td><strong>å¸Œæœ›ä½èµ„æºå ç”¨ã€é«˜æ€§èƒ½æŸ¥è¯¢</strong></td><td>âœ… VictoriaMetrics</td></tr><tr><td><strong>å¤š Prometheus å®ä¾‹ç»Ÿä¸€æŸ¥è¯¢</strong></td><td>âœ… Thanos</td></tr><tr><td><strong>å•å®ä¾‹é«˜ååã€é«˜å‹ç¼©æ¯”çš„å­˜å‚¨</strong></td><td>âœ… VictoriaMetrics</td></tr></tbody></table><hr><h2 id=5-æ€»ç»“><strong>5. æ€»ç»“</strong>
<a class=anchor href=#5-%e6%80%bb%e7%bb%93>#</a></h2><ul><li><strong>Thanos é€‚åˆæ‰©å±• Prometheus</strong>ï¼Œå¢åŠ é«˜å¯ç”¨æ€§ã€é•¿æ—¶é—´å­˜å‚¨å’Œå…¨å±€æŸ¥è¯¢èƒ½åŠ›ï¼Œé€‚ç”¨äº <strong>å¤š Prometheus å®ä¾‹çš„ä¼ä¸šçº§ç›‘æ§</strong>ã€‚</li><li><strong>VictoriaMetrics é€‚åˆä½œä¸ºç‹¬ç«‹çš„ TSDB</strong>ï¼Œæä¾›é«˜æ€§èƒ½ã€ä½èµ„æºå ç”¨çš„æ—¶é—´åºåˆ—å­˜å‚¨ï¼Œé€‚ç”¨äº <strong>å¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’Œé«˜æ•ˆæŸ¥è¯¢</strong>ã€‚</li></ul><p><strong>å¦‚æœä½ çš„ Prometheus å·²ç»éƒ¨ç½²å¹¶å¸Œæœ›æ‰©å±•å­˜å‚¨èƒ½åŠ›ï¼ŒThanos æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœä½ å¸Œæœ›ä¸€ä¸ªæ›´é«˜æ•ˆã€æ›´æ˜“ç®¡ç†çš„æ—¶åºæ•°æ®åº“ï¼ŒVictoriaMetrics æ›´åˆé€‚ã€‚</strong></p><h2 id=thanos-sidecarå’ŒreceiveåŒºåˆ«>thanos sidecarå’ŒreceiveåŒºåˆ«â˜†
<a class=anchor href=#thanos-sidecar%e5%92%8creceive%e5%8c%ba%e5%88%ab>#</a></h2><h3 id=thanos-sidecar-vs-thanos-receive-å¯¹æ¯”><strong>Thanos Sidecar vs Thanos Receive å¯¹æ¯”</strong>
<a class=anchor href=#thanos-sidecar-vs-thanos-receive-%e5%af%b9%e6%af%94>#</a></h3><p>Thanos Sidecar å’Œ Thanos Receive éƒ½æ˜¯ Thanos ç”Ÿæ€ä¸­çš„ç»„ä»¶ï¼Œä½†å®ƒä»¬çš„ç”¨é€”å’Œå·¥ä½œæ–¹å¼ä¸åŒï¼Œä¸»è¦åŒºåˆ«åœ¨äº <strong>æ•°æ®å†™å…¥æ–¹å¼</strong> å’Œ <strong>å­˜å‚¨ç›®æ ‡</strong>ã€‚ä¸‹é¢æ˜¯å®ƒä»¬çš„è¯¦ç»†å¯¹æ¯”ï¼š</p><hr><h2 id=1-ä¸»è¦ç”¨é€”><strong>1. ä¸»è¦ç”¨é€”</strong>
<a class=anchor href=#1-%e4%b8%bb%e8%a6%81%e7%94%a8%e9%80%94>#</a></h2><table><thead><tr><th>ç»„ä»¶</th><th><strong>Thanos Sidecar</strong></th><th><strong>Thanos Receive</strong></th></tr></thead><tbody><tr><td><strong>ä½œç”¨</strong></td><td>è¿æ¥ Prometheusï¼Œæä¾›å¯¹è±¡å­˜å‚¨ä¸Šä¼ å’ŒæŸ¥è¯¢èƒ½åŠ›</td><td>ç›´æ¥æ¥æ”¶ Prometheus Remote Write æ•°æ®ï¼Œæ›¿ä»£ Prometheus å­˜å‚¨</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td><strong>å·²æœ‰ Prometheus</strong>ï¼Œæƒ³è¦æ‰©å±•é•¿æœŸå­˜å‚¨</td><td><strong>æ— æœ¬åœ° Prometheus</strong>ï¼Œéœ€è¦é›†ä¸­æ¥æ”¶å’Œå­˜å‚¨æ•°æ®</td></tr><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>ä¾èµ–æœ¬åœ° Prometheus å­˜å‚¨ï¼Œå®šæœŸä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨</td><td>ç›´æ¥å­˜å‚¨ TSDB æ•°æ®ï¼Œå¹¶æ”¯æŒæ°´å¹³æ‰©å±•</td></tr><tr><td><strong>æŸ¥è¯¢æ–¹å¼</strong></td><td>é€šè¿‡ <code>thanos query</code> è¯»å–å¯¹è±¡å­˜å‚¨çš„æ•°æ®</td><td>é€šè¿‡ <code>thanos query</code> ç›´æ¥æŸ¥è¯¢ Receive å­˜å‚¨çš„æ•°æ®</td></tr></tbody></table><hr><h2 id=2-æ¶æ„å¯¹æ¯”-1><strong>2. æ¶æ„å¯¹æ¯”</strong>
<a class=anchor href=#2-%e6%9e%b6%e6%9e%84%e5%af%b9%e6%af%94-1>#</a></h2><h3 id=thanos-sidecar><strong>Thanos Sidecar</strong>
<a class=anchor href=#thanos-sidecar>#</a></h3><ul><li><p>ä¾é™„äº Prometheus</p><p>ï¼Œä½œä¸ºä¸€ä¸ªé™„åŠ ç»„ä»¶è¿è¡Œï¼Œè´Ÿè´£ï¼š</p><ul><li>æä¾› <strong>Prometheus è¿è¡Œæ—¶æ•°æ®</strong> çš„æŸ¥è¯¢ APIï¼ˆç±»ä¼¼ Prometheus Query APIï¼‰ã€‚</li><li>å®šæœŸå°† <strong>Prometheus çš„å†å²æ•°æ®ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨</strong>ï¼ˆå¦‚ S3ã€GCSï¼‰ã€‚</li><li>ä½¿ Thanos Query å¯ä»¥åŒæ—¶æŸ¥è¯¢å¤šä¸ª Prometheus å®ä¾‹çš„æ•°æ®ã€‚</li></ul></li><li><p>ä½† <strong>ä¸ä¼šç›´æ¥æ¥æ”¶ Remote Write</strong> æ•°æ®ï¼Œä»ç„¶ä¾èµ– Prometheus è¿›è¡Œé‡‡é›†å’Œå­˜å‚¨ã€‚</p></li></ul><h3 id=thanos-receive><strong>Thanos Receive</strong>
<a class=anchor href=#thanos-receive>#</a></h3><ul><li><p>ç‹¬ç«‹è¿è¡Œ</p><p>ï¼Œç”¨äº</p><p>ç›´æ¥æ¥æ”¶ Prometheus Remote Write æ•°æ®</p><p>ï¼Œä¸»è¦åŠŸèƒ½ï¼š</p><ul><li>ä½œä¸º <strong>Prometheus çš„æ›¿ä»£å­˜å‚¨</strong>ï¼Œä¸éœ€è¦æœ¬åœ° Prometheus ã€‚</li><li>é€‚ç”¨äº <strong>å¤šä¸ª Prometheus å®ä¾‹é›†ä¸­å­˜å‚¨æ•°æ®</strong>ï¼Œæå‡å¯æ‰©å±•æ€§ã€‚</li><li><strong>å¤šå‰¯æœ¬æ¨¡å¼</strong>ï¼Œé€‚ç”¨äº <strong>HA éƒ¨ç½²</strong>ï¼Œé€šè¿‡ <code>--receive.replication-factor</code> æ§åˆ¶å‰¯æœ¬æ•°ã€‚</li><li>å¯ä»¥ç›´æ¥è¢« <code>thanos query</code> ç»„ä»¶æŸ¥è¯¢ï¼Œæ— éœ€é¢å¤– Sidecarã€‚</li></ul></li></ul><hr><h2 id=3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong>
<a class=anchor href=#3-%e8%af%a6%e7%bb%86%e5%8a%9f%e8%83%bd%e5%af%b9%e6%af%94>#</a></h2><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Thanos Sidecar</strong></th><th><strong>Thanos Receive</strong></th></tr></thead><tbody><tr><td><strong>æ˜¯å¦ä¾èµ– Prometheus</strong></td><td>âœ… æ˜¯ï¼Œä¾é™„ Prometheus</td><td>âŒ å¦ï¼Œç‹¬ç«‹è¿è¡Œ</td></tr><tr><td><strong>æ˜¯å¦æ”¯æŒ Prometheus Remote Write</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… ç›´æ¥æ”¯æŒ</td></tr><tr><td><strong>æ•°æ®å­˜å‚¨æ–¹å¼</strong></td><td>æœ¬åœ° Prometheus -> å¯¹è±¡å­˜å‚¨ï¼ˆS3/GCS/OSSï¼‰</td><td>ç›´æ¥å­˜å‚¨ TSDB æ•°æ®ï¼ˆæ”¯æŒå¯¹è±¡å­˜å‚¨ï¼‰</td></tr><tr><td><strong>æŸ¥è¯¢æ–¹å¼</strong></td><td>é€šè¿‡ Thanos Query è®¿é—® Sidecar æä¾›çš„ Prometheus API</td><td>é€šè¿‡ Thanos Query ç›´æ¥æŸ¥è¯¢</td></tr><tr><td><strong>é«˜å¯ç”¨æ€§</strong></td><td>âŒ éœ€è¦å¤šä¸ª Prometheus å®ä¾‹æ‰èƒ½é«˜å¯ç”¨</td><td>âœ… å¤šå®ä¾‹+æ•°æ®å¤åˆ¶ï¼Œå¤©ç„¶æ”¯æŒé«˜å¯ç”¨</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>éœ€è¦é•¿æœŸå­˜å‚¨ï¼Œ<strong>å·²æœ‰ Prometheus</strong></td><td>éœ€è¦é›†ä¸­å­˜å‚¨ï¼Œ<strong>å¤šä¸ª Prometheus ç»Ÿä¸€ Remote Write</strong></td></tr><tr><td><strong>å†™å…¥æ¨¡å¼</strong></td><td>Prometheus æœ¬åœ°å­˜å‚¨æ•°æ®ï¼ŒSidecar ä»…æä¾›æŸ¥è¯¢å’Œå­˜å‚¨ä¸Šä¼ </td><td>ç›´æ¥ä½œä¸º Remote Write ç›®æ ‡ï¼Œå­˜å‚¨ Prometheus é‡‡é›†æ•°æ®</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é€‚ç”¨äº Prometheus <strong>æœ¬åœ°å­˜å‚¨æ‰©å±•</strong></td><td>é€‚ç”¨äº <strong>å¤šé›†ç¾¤ Remote Write</strong> å­˜å‚¨æ–¹æ¡ˆ</td></tr></tbody></table><hr><h2 id=4-é€‚ç”¨åœºæ™¯-1><strong>4. é€‚ç”¨åœºæ™¯</strong>
<a class=anchor href=#4-%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af-1>#</a></h2><table><thead><tr><th><strong>éœ€æ±‚</strong></th><th><strong>æ¨èä½¿ç”¨</strong></th></tr></thead><tbody><tr><td><strong>å·²æœ‰ Prometheusï¼Œæƒ³æ‰©å±•å­˜å‚¨èƒ½åŠ›ï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰</strong></td><td>âœ… <strong>Thanos Sidecar</strong></td></tr><tr><td><strong>æƒ³ç”¨ Remote Write ä»£æ›¿ Prometheus æœ¬åœ°å­˜å‚¨</strong></td><td>âœ… <strong>Thanos Receive</strong></td></tr><tr><td><strong>æŸ¥è¯¢å¤šä¸ª Prometheus å®ä¾‹çš„æ•°æ®</strong></td><td>âœ… <strong>Thanos Sidecar</strong>ï¼ˆæ­é… Thanos Queryï¼‰</td></tr><tr><td><strong>è·¨å¤šä¸ª Prometheus ç»Ÿä¸€å­˜å‚¨æ•°æ®ï¼Œç®€åŒ–æ¶æ„</strong></td><td>âœ… <strong>Thanos Receive</strong></td></tr><tr><td><strong>å¸Œæœ› Prometheus åªè´Ÿè´£é‡‡é›†ï¼Œä¸å­˜å‚¨æ•°æ®</strong></td><td>âœ… <strong>Thanos Receive</strong></td></tr></tbody></table><hr><h2 id=5-é€‰å‹å»ºè®®><strong>5. é€‰å‹å»ºè®®</strong>
<a class=anchor href=#5-%e9%80%89%e5%9e%8b%e5%bb%ba%e8%ae%ae>#</a></h2><ul><li><strong>å¦‚æœä½ å·²ç»åœ¨ç”¨ Prometheusï¼Œå¹¶ä¸”åªæƒ³å¢åŠ é•¿æœŸå­˜å‚¨ï¼ˆS3/GCS/OSSï¼‰ï¼Œé‚£ä¹ˆ Thanos Sidecar æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</strong></li><li><strong>å¦‚æœä½ çš„ Prometheus é‡‡é›†èŠ‚ç‚¹éå¸¸å¤šï¼Œå¸Œæœ›ç”¨ Remote Write é›†ä¸­å­˜å‚¨æ•°æ®ï¼Œæˆ–è€…å¸Œæœ› Prometheus åªè´Ÿè´£æ•°æ®é‡‡é›†ï¼Œè€Œå­˜å‚¨å’ŒæŸ¥è¯¢äº¤ç»™ä¸€ä¸ªç‹¬ç«‹ç³»ç»Ÿï¼Œé‚£ä¹ˆ Thanos Receive æ›´é€‚åˆã€‚</strong></li></ul><p><strong>æœ€ç»ˆé€‰å‹å–å†³äºä½ çš„æ¶æ„éœ€æ±‚ï¼Œå¦‚æœæ˜¯ä¼ ç»Ÿ Prometheus æ–¹æ¡ˆæ‰©å±•ï¼ŒSidecar å¤Ÿç”¨ï¼›å¦‚æœæ˜¯å¤§è§„æ¨¡ç›‘æ§å­˜å‚¨ï¼ŒReceive æ›´åˆé€‚ï¼</strong> ğŸš€</p><h2 id=thanos-ruleç»„ä»¶å’ŒprometheusåŒºåˆ«>thanos ruleç»„ä»¶å’ŒprometheusåŒºåˆ«
<a class=anchor href=#thanos-rule%e7%bb%84%e4%bb%b6%e5%92%8cprometheus%e5%8c%ba%e5%88%ab>#</a></h2><h3 id=thanos-rule-vs-prometheusåŒºåˆ«ä¸å¯¹æ¯”><strong>Thanos Rule vs Prometheusï¼šåŒºåˆ«ä¸å¯¹æ¯”</strong>
<a class=anchor href=#thanos-rule-vs-prometheus%e5%8c%ba%e5%88%ab%e4%b8%8e%e5%af%b9%e6%af%94>#</a></h3><p>Thanos Rule ç»„ä»¶å’Œ Prometheus åœ¨è§„åˆ™è¯„ä¼°ï¼ˆRule Evaluationï¼‰æ–¹é¢æœ‰ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬åœ¨ <strong>å­˜å‚¨æ–¹å¼</strong>ã€<strong>é€‚ç”¨åœºæ™¯</strong> å’Œ <strong>æŸ¥è¯¢æ–¹å¼</strong> ä¸Šå­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚</p><hr><h2 id=1-ä¸»è¦ç”¨é€”-1><strong>1. ä¸»è¦ç”¨é€”</strong>
<a class=anchor href=#1-%e4%b8%bb%e8%a6%81%e7%94%a8%e9%80%94-1>#</a></h2><table><thead><tr><th>ç»„ä»¶</th><th><strong>Thanos Rule</strong></th><th><strong>Prometheus</strong></th></tr></thead><tbody><tr><td><strong>ä½œç”¨</strong></td><td>è¿œç¨‹è¯„ä¼°è§„åˆ™ï¼Œç”Ÿæˆæ–°çš„æ—¶é—´åºåˆ—æ•°æ®</td><td>æœ¬åœ°è¯„ä¼°è§„åˆ™ï¼Œç”Ÿæˆæ–°çš„æ—¶é—´åºåˆ—æ•°æ®</td></tr><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td><strong>Remote Write æˆ–å¯¹è±¡å­˜å‚¨</strong>ï¼ˆTSDBï¼‰</td><td>æœ¬åœ°å­˜å‚¨ TSDB</td></tr><tr><td><strong>æŸ¥è¯¢æ–¹å¼</strong></td><td>é€šè¿‡ Thanos Query è®¿é—®å­˜å‚¨çš„è§„åˆ™ç»“æœ</td><td>é€šè¿‡ PromQL æŸ¥è¯¢æœ¬åœ°æ•°æ®</td></tr><tr><td><strong>é«˜å¯ç”¨æ€§</strong></td><td>âœ… é€šè¿‡å¤šä¸ªå®ä¾‹ + HA éƒ¨ç½²</td><td>âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤šä¸ª Prometheus å®ä¾‹</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td><strong>åˆ†å¸ƒå¼ç›‘æ§ï¼Œå¤šé›†ç¾¤è§„åˆ™è¯„ä¼°</strong></td><td><strong>å•ä¸ª Prometheus è§„åˆ™è¯„ä¼°</strong></td></tr></tbody></table><hr><h2 id=2-ç»„ä»¶ä»‹ç»><strong>2. ç»„ä»¶ä»‹ç»</strong>
<a class=anchor href=#2-%e7%bb%84%e4%bb%b6%e4%bb%8b%e7%bb%8d>#</a></h2><h3 id=-prometheus><strong>ğŸ“Œ Prometheus</strong>
<a class=anchor href=#-prometheus>#</a></h3><ul><li><strong>ä¸»è¦èŒè´£</strong>ï¼š<ul><li>é‡‡é›†æ—¶åºæ•°æ®ï¼Œå¹¶å­˜å‚¨åœ¨æœ¬åœ° <strong>TSDB</strong>ã€‚</li><li><strong>Rule è§„åˆ™è¯„ä¼°</strong>ï¼Œå°† <strong>PromQL è®¡ç®—åçš„ç»“æœå­˜å‚¨åœ¨æœ¬åœ° TSDB</strong>ã€‚</li><li><strong>å‘Šè­¦ï¼ˆAlertingï¼‰è¯„ä¼°</strong>ï¼Œå¹¶é€šè¿‡ Alertmanager å‘é€å‘Šè­¦ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>æœ¬åœ°å­˜å‚¨é™åˆ¶</strong>ï¼Œå†å²æ•°æ®æ— æ³•é•¿æœŸå­˜å‚¨ï¼ˆé™¤éä½¿ç”¨è¿œç¨‹å­˜å‚¨ï¼‰ã€‚</li><li><strong>è§„åˆ™è¯„ä¼°ä»…é™æœ¬åœ°</strong>ï¼Œæ— æ³•è·¨å¤šä¸ª Prometheus å®ä¾‹ã€‚</li></ul></li></ul><hr><h3 id=-thanos-rule><strong>ğŸ“Œ Thanos Rule</strong>
<a class=anchor href=#-thanos-rule>#</a></h3><ul><li><p>ä½œç”¨</p><p>ï¼š</p><ul><li>ç±»ä¼¼äº Prometheus Rulesï¼Œä½†å®ƒæ˜¯ <strong>ç‹¬ç«‹çš„è¿œç¨‹è§„åˆ™è¯„ä¼°ç»„ä»¶</strong>ã€‚</li><li>å¯ä»¥ <strong>ä»å¤šä¸ª Prometheus / Thanos Store è¯»å–æ•°æ®</strong> è¿›è¡Œè§„åˆ™è¯„ä¼°ã€‚</li><li>è¯„ä¼°ç»“æœå¯ä»¥ <strong>å†™å…¥å¯¹è±¡å­˜å‚¨</strong> æˆ– <strong>Prometheus Remote Write</strong>ã€‚</li></ul></li><li><p>å…³é”®ç‰¹ç‚¹</p><p>ï¼š</p><ul><li><strong>è§„åˆ™è¯„ä¼°è„±ç¦» Prometheus</strong>ï¼Œå¯ä»¥<strong>è·¨å¤šä¸ª Prometheus è¿è¡Œ</strong>ã€‚</li><li><strong>æ”¯æŒ HA éƒ¨ç½²</strong>ï¼Œå¤šä¸ª Thanos Rule å®ä¾‹å¯ä»¥åŒæ—¶è¿è¡Œï¼Œä¸ä¼šé‡å¤å†™å…¥æ•°æ®ã€‚</li><li><strong>é¿å… Prometheus å•ç‚¹é—®é¢˜</strong>ï¼Œå³ä½¿ Prometheus å®ä¾‹å®•æœºï¼ŒThanos Rule ä»èƒ½ç»§ç»­å·¥ä½œã€‚</li></ul></li></ul><hr><h2 id=3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”-1><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong>
<a class=anchor href=#3-%e8%af%a6%e7%bb%86%e5%8a%9f%e8%83%bd%e5%af%b9%e6%af%94-1>#</a></h2><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Thanos Rule</strong></th><th><strong>Prometheus</strong></th></tr></thead><tbody><tr><td><strong>æ˜¯å¦é‡‡é›†æ•°æ®</strong></td><td>âŒ ä¸é‡‡é›†æ•°æ®</td><td>âœ… é‡‡é›†æ•°æ®</td></tr><tr><td><strong>æ˜¯å¦å­˜å‚¨æ•°æ®</strong></td><td>âœ… é€šè¿‡ Remote Write æˆ–å¯¹è±¡å­˜å‚¨</td><td>âœ… æœ¬åœ° TSDB</td></tr><tr><td><strong>è§„åˆ™è¯„ä¼°æ–¹å¼</strong></td><td>è¯»å–å¤šä¸ªæ•°æ®æºï¼Œé›†ä¸­è®¡ç®—</td><td>ä»…èƒ½è¯„ä¼°æœ¬åœ°æ•°æ®</td></tr><tr><td><strong>è·¨é›†ç¾¤æ”¯æŒ</strong></td><td>âœ… å¯ä»¥è¯„ä¼°å¤šä¸ª Prometheus æ•°æ®</td><td>âŒ ä»…é™å•ä¸ª Prometheus</td></tr><tr><td><strong>HAï¼ˆé«˜å¯ç”¨æ€§ï¼‰</strong></td><td>âœ… å¤šä¸ªå®ä¾‹å¯ç”¨ï¼Œä¸å½±å“è¯„ä¼°</td><td>âŒ å•ç‚¹æ•…éšœï¼Œéœ€æ‰‹åŠ¨ç®¡ç†å¤šä¸ª Prometheus</td></tr><tr><td><strong>å‘Šè­¦è§„åˆ™ï¼ˆAlertsï¼‰</strong></td><td>âœ… é€šè¿‡ Alertmanager å‘é€</td><td>âœ… é€šè¿‡ Alertmanager å‘é€</td></tr></tbody></table><hr><h2 id=4-é€‚ç”¨åœºæ™¯-2><strong>4. é€‚ç”¨åœºæ™¯</strong>
<a class=anchor href=#4-%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af-2>#</a></h2><table><thead><tr><th><strong>éœ€æ±‚</strong></th><th><strong>æ¨èä½¿ç”¨</strong></th></tr></thead><tbody><tr><td><strong>åªç®¡ç†ä¸€ä¸ª Prometheus å®ä¾‹ï¼Œç›´æ¥ç”¨è§„åˆ™è®¡ç®—</strong></td><td>âœ… <strong>Prometheus</strong></td></tr><tr><td><strong>å¸Œæœ›è·¨å¤šä¸ª Prometheus è¿›è¡Œè§„åˆ™è¯„ä¼°</strong></td><td>âœ… <strong>Thanos Rule</strong></td></tr><tr><td><strong>éœ€è¦é«˜å¯ç”¨çš„è§„åˆ™è¯„ä¼°ï¼ˆHA æ–¹æ¡ˆï¼‰</strong></td><td>âœ… <strong>Thanos Rule</strong></td></tr><tr><td><strong>å¸Œæœ›æŠŠè®¡ç®—ç»“æœå†™å…¥è¿œç¨‹å­˜å‚¨</strong></td><td>âœ… <strong>Thanos Rule</strong></td></tr><tr><td><strong>Prometheus éœ€è¦æ‰©å±•é•¿æœŸå­˜å‚¨</strong></td><td>âœ… <strong>Thanos Rule</strong>ï¼ˆæ­é… Thanos Storeï¼‰</td></tr></tbody></table><hr><h2 id=5-æ€»ç»“-1><strong>5. æ€»ç»“</strong>
<a class=anchor href=#5-%e6%80%bb%e7%bb%93-1>#</a></h2><ul><li><strong>Prometheus</strong> é€‚ç”¨äº <strong>å•ä¸ªå®ä¾‹</strong> è¿›è¡Œè§„åˆ™è¯„ä¼°å’Œå‘Šè­¦ï¼Œä¸é€‚åˆåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</li><li><strong>Thanos Rule</strong> é€‚ç”¨äº <strong>å¤šä¸ª Prometheus ç»Ÿä¸€è¯„ä¼°è§„åˆ™</strong>ï¼Œè§£å†³ Prometheus <strong>è§„åˆ™è®¡ç®—çš„ HA é—®é¢˜</strong>ï¼Œå¹¶å¯å°†ç»“æœå­˜å‚¨åˆ°è¿œç¨‹å­˜å‚¨æˆ–å¯¹è±¡å­˜å‚¨ã€‚</li></ul><p>ğŸ‘‰ <strong>å¦‚æœæ˜¯å•ä¸ª Prometheusï¼Œç›´æ¥ç”¨ Prometheus Rules å³å¯ã€‚</strong> ğŸ‘‰ <strong>å¦‚æœæ˜¯å¤šä¸ª Prometheusï¼Œå¹¶ä¸”å¸Œæœ›è·¨é›†ç¾¤è¯„ä¼°è§„åˆ™ï¼Œå»ºè®®ä½¿ç”¨ Thanos Ruleï¼</strong> ğŸš€</p><h2 id=prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª>Prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª
<a class=anchor href=#prometheus%e5%91%8a%e8%ad%a6%e4%bb%8e%e8%a7%a6%e5%8f%91%e5%88%b0%e6%94%b6%e5%88%b0%e9%80%9a%e7%9f%a5%e5%bb%b6%e8%bf%9f%e5%9c%a8%e5%93%aa>#</a></h2><p>Prometheus å‘Šè­¦ï¼ˆAlertingï¼‰ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥çš„æ•´ä¸ªæµç¨‹å¯èƒ½ä¼šå‡ºç° <strong>å»¶è¿Ÿ</strong>ï¼Œä¸»è¦æ¶‰åŠå¤šä¸ªç¯èŠ‚ï¼ŒåŒ…æ‹¬ <strong>è§„åˆ™è¯„ä¼°</strong>ã€<strong>æ•°æ®å­˜å‚¨</strong>ã€<strong>å‘Šè­¦å‘é€</strong> ç­‰ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªç¯èŠ‚çš„å¯èƒ½å»¶è¿Ÿç‚¹å’Œä¼˜åŒ–æ–¹æ¡ˆã€‚</p><hr><h2 id=-prometheus-å‘Šè­¦æµç¨‹><strong>ğŸ“Œ Prometheus å‘Šè­¦æµç¨‹</strong>
<a class=anchor href=#-prometheus-%e5%91%8a%e8%ad%a6%e6%b5%81%e7%a8%8b>#</a></h2><ol><li>æ•°æ®é‡‡é›†ï¼ˆScrapeï¼‰<ul><li>Prometheus å®šæœŸä» Exporter æˆ–åº”ç”¨ç¨‹åºç«¯ç‚¹æ‹‰å–ç›‘æ§æ•°æ®ã€‚</li></ul></li><li>è§„åˆ™è¯„ä¼°ï¼ˆRule Evaluationï¼‰<ul><li>Prometheus æ ¹æ® <code>alerting rules</code> è¯„ä¼°æ•°æ®ï¼Œå†³å®šæ˜¯å¦è§¦å‘å‘Šè­¦ã€‚</li></ul></li><li>å‘Šè­¦è§¦å‘ï¼ˆAlert Firingï¼‰<ul><li>æ»¡è¶³å‘Šè­¦æ¡ä»¶çš„è§„åˆ™è¢«æ ‡è®°ä¸º <code>firing</code>ï¼ˆè§¦å‘ï¼‰ã€‚</li></ul></li><li>Alertmanager å¤„ç†<ul><li>Prometheus å°†å‘Šè­¦æ¨é€ç»™ Alertmanagerï¼ŒAlertmanager è¿›è¡Œåˆ†ç»„ã€æŠ‘åˆ¶ã€è·¯ç”±ç­‰å¤„ç†ã€‚</li></ul></li><li>é€šçŸ¥å‘é€<ul><li>Alertmanager é€šè¿‡ Webhookã€é‚®ä»¶ã€Slackã€é’‰é’‰ç­‰æ¸ é“å‘é€å‘Šè­¦ã€‚</li></ul></li></ol><hr><h2 id=-å¯èƒ½çš„å»¶è¿Ÿç‚¹><strong>ğŸ“Œ å¯èƒ½çš„å»¶è¿Ÿç‚¹</strong>
<a class=anchor href=#-%e5%8f%af%e8%83%bd%e7%9a%84%e5%bb%b6%e8%bf%9f%e7%82%b9>#</a></h2><table><thead><tr><th><strong>ç¯èŠ‚</strong></th><th><strong>å¯èƒ½çš„å»¶è¿Ÿæ¥æº</strong></th><th><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®é‡‡é›†ï¼ˆScrapeï¼‰</strong></td><td>- Prometheus æŠ“å–é—´éš” (<code>scrape_interval</code>) è¿‡é•¿ - ç›®æ ‡ Exporter å“åº”æ…¢æˆ–ä¸¢å¤±æ•°æ®</td><td>- è°ƒæ•´ <code>scrape_interval</code>ï¼Œç¡®ä¿è¶³å¤Ÿé¢‘ç¹æŠ“å–æ•°æ® - ç¡®ä¿ Exporter ç«¯ç‚¹ç¨³å®š</td></tr><tr><td><strong>è§„åˆ™è¯„ä¼°ï¼ˆRule Evaluationï¼‰</strong></td><td>- <code>evaluation_interval</code> è¿‡é•¿ - PromQL æŸ¥è¯¢è¿‡äºå¤æ‚ï¼Œè®¡ç®—æ—¶é—´é•¿</td><td>- è°ƒæ•´ <code>evaluation_interval</code>ï¼Œå»ºè®®è®¾ä¸º 15s~30s - ä¼˜åŒ– PromQLï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—</td></tr><tr><td><strong>å‘Šè­¦è§¦å‘ï¼ˆAlert Firingï¼‰</strong></td><td>- <code>for</code> é€‰é¡¹ï¼ˆæŒç»­æ—¶é—´ï¼‰å¯¼è‡´å»¶è¿Ÿ - Prometheus TSDB å­˜å‚¨æŸ¥è¯¢æ•ˆç‡ä½</td><td>- ç¡®ä¿ <code>for</code> æ—¶é—´åˆé€‚ï¼Œä¸è¦è¿‡é•¿ - å¢å¼ºå­˜å‚¨æ€§èƒ½ï¼ˆå¦‚ Thanos / VictoriaMetricsï¼‰</td></tr><tr><td><strong>Prometheus -> Alertmanager</strong></td><td>- Prometheus å‘ Alertmanager å‘é€å‘Šè­¦æ‰¹é‡å¤„ç†æœ‰å»¶è¿Ÿ</td><td>- ç¡®ä¿ Prometheus èƒ½å¤Ÿå¿«é€Ÿæ¨é€å‘Šè­¦ï¼ˆæŸ¥çœ‹ <code>alert_relabel_configs</code>ï¼‰</td></tr><tr><td><strong>Alertmanager å¤„ç†</strong></td><td>- å‘Šè­¦åˆ†ç»„ (<code>group_wait</code>) æ—¶é—´è¿‡é•¿ - å‘Šè­¦æŠ‘åˆ¶ (<code>inhibit_rules</code>) å½±å“ - <code>group_interval</code> å½±å“åç»­é€šçŸ¥</td><td>- è°ƒæ•´ <code>group_wait</code> (å»ºè®® 10s) - é¿å… <code>group_interval</code> è¿‡é•¿</td></tr><tr><td><strong>é€šçŸ¥å‘é€ï¼ˆEmail/é’‰é’‰/Slack ç­‰ï¼‰</strong></td><td>- API è°ƒç”¨æ…¢ï¼ˆå¦‚ Webhook è¶…æ—¶ï¼‰ - ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚é‚®ä»¶ã€é’‰é’‰ç­‰ï¼‰å¤„ç†æ…¢</td><td>- ä¼˜åŒ–é€šçŸ¥æ¸ é“ï¼ˆå¦‚ä½¿ç”¨æ›´å¿«çš„ Webhook æœåŠ¡å™¨ï¼‰ - ç¡®ä¿ Alertmanager é…ç½®çš„é€šçŸ¥æ–¹å¼é«˜æ•ˆ</td></tr></tbody></table><hr><h2 id=-å¦‚ä½•ä¼˜åŒ–-prometheus-å‘Šè­¦å»¶è¿Ÿ><strong>ğŸ“Œ å¦‚ä½•ä¼˜åŒ– Prometheus å‘Šè­¦å»¶è¿Ÿï¼Ÿ</strong>
<a class=anchor href=#-%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96-prometheus-%e5%91%8a%e8%ad%a6%e5%bb%b6%e8%bf%9f>#</a></h2><h3 id=1-è°ƒæ•´><strong>1. è°ƒæ•´ <code>scrape_interval</code></strong>
<a class=anchor href=#1-%e8%b0%83%e6%95%b4>#</a></h3><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPrometheus å¯èƒ½æ¯ <strong>60s</strong> æŠ“å–ä¸€æ¬¡æ•°æ®ï¼ˆ<code>scrape_interval=60s</code>ï¼‰ã€‚</p></li><li><p>è¿™æ„å‘³ç€å‘Šè­¦å¯èƒ½æœ€å¤šå»¶è¿Ÿ <strong>1 åˆ†é’Ÿ</strong>ã€‚</p></li><li><p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#34;node_exporter&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s </span> <span style=color:#75715e># æŠ“å–é—´éš”ç¼©çŸ­ï¼Œæé«˜å‘Šè­¦å®æ—¶æ€§</span>
</span></span></code></pre></div></li></ul><h3 id=2-è°ƒæ•´><strong>2. è°ƒæ•´ <code>evaluation_interval</code></strong>
<a class=anchor href=#2-%e8%b0%83%e6%95%b4>#</a></h3><ul><li><p>Prometheus é»˜è®¤æ¯ <strong>60s</strong> è¯„ä¼°ä¸€æ¬¡å‘Šè­¦è§„åˆ™ï¼ˆ<code>evaluation_interval=60s</code>ï¼‰ã€‚</p></li><li><p>è¿™æ ·å¯èƒ½å¯¼è‡´æ•°æ®åˆ·æ–°æ…¢ï¼Œå¢åŠ å»¶è¿Ÿã€‚</p></li><li><p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>15s </span> <span style=color:#75715e># è§„åˆ™è¯„ä¼°æ—¶é—´ç¼©çŸ­</span>
</span></span></code></pre></div></li></ul><h3 id=3-è°ƒæ•´><strong>3. è°ƒæ•´ <code>for</code> å‚æ•°</strong>
<a class=anchor href=#3-%e8%b0%83%e6%95%b4>#</a></h3><ul><li><pre tabindex=0><code>for
</code></pre><p>å‚æ•°ç”¨äºé¿å…çŸ­æš‚æ³¢åŠ¨å¯¼è‡´çš„è¯¯æŠ¥ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>InstanceDown</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>up == 0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>for</span>: <span style=color:#ae81ff>2m </span> <span style=color:#75715e># åªæœ‰è¿ç»­ 2 åˆ†é’Ÿå®•æœºæ‰ä¼šè§¦å‘å‘Šè­¦</span>
</span></span></code></pre></div></li><li><p>å¦‚æœ <code>for: 5m</code>ï¼Œæ„å‘³ç€å³ä½¿ Prometheus ç«‹å³æ£€æµ‹åˆ°é—®é¢˜ï¼Œä¹Ÿè¦ <strong>ç­‰ 5 åˆ†é’Ÿ</strong> æ‰ä¼šä¸ŠæŠ¥å‘Šè­¦ã€‚</p></li><li><p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼šå¦‚æœä¸šåŠ¡ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‚å½“å‡å°‘ <code>for</code> æ—¶é—´ï¼Œæ¯”å¦‚ <code>for: 30s</code>ã€‚</p></li></ul><h3 id=4-è°ƒæ•´-alertmanager-é…ç½®><strong>4. è°ƒæ•´ Alertmanager é…ç½®</strong>
<a class=anchor href=#4-%e8%b0%83%e6%95%b4-alertmanager-%e9%85%8d%e7%bd%ae>#</a></h3><ul><li><p>Alertmanager é»˜è®¤æœ‰ <code>group_wait</code> å’Œ <code>group_interval</code> æœºåˆ¶ï¼Œå¯èƒ½å¯¼è‡´å‘Šè­¦å»¶è¿Ÿã€‚</p></li><li><p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_wait</span>: <span style=color:#ae81ff>10s </span> <span style=color:#75715e># ç»„å†…é¦–ä¸ªå‘Šè­¦å»¶è¿Ÿ 10s å‘é€</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_interval</span>: <span style=color:#ae81ff>30s </span> <span style=color:#75715e># ç»„å†…åç»­å‘Šè­¦æ¯ 30s å‘é€ä¸€æ¬¡</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>repeat_interval</span>: <span style=color:#ae81ff>3h </span> <span style=color:#75715e># 3 å°æ—¶åé‡æ–°å‘é€ç›¸åŒçš„å‘Šè­¦</span>
</span></span></code></pre></div></li></ul><h3 id=5-ä¼˜åŒ–é€šçŸ¥æ–¹å¼><strong>5. ä¼˜åŒ–é€šçŸ¥æ–¹å¼</strong>
<a class=anchor href=#5-%e4%bc%98%e5%8c%96%e9%80%9a%e7%9f%a5%e6%96%b9%e5%bc%8f>#</a></h3><ul><li><strong>Webhook æ–¹å¼</strong> æ¯” <strong>é‚®ä»¶</strong> å’Œ <strong>é’‰é’‰æœºå™¨äºº</strong> æ›´å¿«ã€‚</li><li>ä¼˜åŒ–æ–¹æ¡ˆï¼š<ul><li>å°½é‡ä½¿ç”¨ <strong>ç›´æ¥çš„ Webhook</strong>ï¼Œé¿å…è¿‡å¤šä»£ç†ã€‚</li><li>é¿å… API æœåŠ¡å™¨è¶…æ—¶ï¼Œå¢åŠ  Alertmanager å‘é€å¤±è´¥çš„é‡è¯•æœºåˆ¶ã€‚</li></ul></li></ul><hr><h2 id=-ç»“è®º><strong>ğŸ“Œ ç»“è®º</strong>
<a class=anchor href=#-%e7%bb%93%e8%ae%ba>#</a></h2><p>Prometheus å‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥çš„å»¶è¿Ÿï¼Œå¯èƒ½å‘ç”Ÿåœ¨å¤šä¸ªç¯èŠ‚ï¼š</p><ol><li><strong>æ•°æ®é‡‡é›†é—´éš”ï¼ˆscrape_intervalï¼‰</strong></li><li><strong>è§„åˆ™è¯„ä¼°é¢‘ç‡ï¼ˆevaluation_intervalï¼‰</strong></li><li><strong>å‘Šè­¦è§¦å‘å»¶è¿Ÿï¼ˆfor å‚æ•°ï¼‰</strong></li><li><strong>Alertmanager åˆ†ç»„/æŠ‘åˆ¶æœºåˆ¶ï¼ˆgroup_waitã€group_intervalï¼‰</strong></li><li><strong>é€šçŸ¥æ–¹å¼çš„ API å»¶è¿Ÿ</strong></li></ol><h3 id=-ä¼˜åŒ–å»ºè®®>ğŸš€ <strong>ä¼˜åŒ–å»ºè®®</strong>
<a class=anchor href=#-%e4%bc%98%e5%8c%96%e5%bb%ba%e8%ae%ae>#</a></h3><p>âœ… <code>scrape_interval: 15s</code>ï¼ˆæé«˜æ•°æ®é‡‡é›†é¢‘ç‡ï¼‰
âœ… <code>evaluation_interval: 15s</code>ï¼ˆæ›´å¿«è¯„ä¼°å‘Šè­¦è§„åˆ™ï¼‰
âœ… <code>for: 30s</code>ï¼ˆå‡å°‘å‘Šè­¦å»¶è¿Ÿï¼‰
âœ… <code>group_wait: 10s</code> + <code>group_interval: 30s</code>ï¼ˆä¼˜åŒ– Alertmanagerï¼‰
âœ… <strong>ä½¿ç”¨ Webhook ä»£æ›¿é’‰é’‰/é‚®ä»¶ï¼Œæé«˜å‘Šè­¦æ¨é€é€Ÿåº¦</strong></p><hr><h3 id=-æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®><strong>ğŸ”¥ æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®</strong>
<a class=anchor href=#-%e6%8e%a8%e8%8d%90%e4%bc%98%e5%8c%96%e5%90%8e%e7%9a%84%e7%a4%ba%e4%be%8b%e9%85%8d%e7%bd%ae>#</a></h3><h4 id=prometheus-é…ç½®><strong>Prometheus é…ç½®</strong>
<a class=anchor href=#prometheus-%e9%85%8d%e7%bd%ae>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s </span> <span style=color:#75715e># é»˜è®¤é‡‡é›†é—´éš”</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>15s </span> <span style=color:#75715e># è§„åˆ™è¯„ä¼°é—´éš”</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>rule_files</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;alert.rules.yml&#34;</span>
</span></span></code></pre></div><h4 id=alertmanager-é…ç½®><strong>Alertmanager é…ç½®</strong>
<a class=anchor href=#alertmanager-%e9%85%8d%e7%bd%ae>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_by</span>: [<span style=color:#e6db74>&#39;alertname&#39;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_wait</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_interval</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>repeat_interval</span>: <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#39;webhook&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;webhook&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>webhook_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://webhook-server/alert&#34;</span>
</span></span></code></pre></div><p>è¿™æ ·å¯ä»¥ <strong>æœ€å¤§ç¨‹åº¦å‡å°‘ Prometheus å‘Šè­¦å»¶è¿Ÿ</strong> ğŸš€ğŸš€ğŸš€</p><h2 id=å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåš>å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåšâ˜†
<a class=anchor href=#%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6%e6%80%8e%e4%b9%88%e5%81%9a>#</a></h2><p>åœ¨ <strong>Prometheus Alertmanager</strong> ä¸­ï¼Œå‘Šè­¦æŠ‘åˆ¶ï¼ˆInhibitionï¼‰ç”¨äº<strong>é˜»æ­¢æŸäº›å‘Šè­¦åœ¨ç‰¹å®šæƒ…å†µä¸‹å‘é€é€šçŸ¥</strong>ã€‚é€šå¸¸ç”¨äºå‡å°‘é‡å¤å‘Šè­¦ï¼Œæˆ–è€…åœ¨<strong>æ›´ä¸¥é‡çš„å‘Šè­¦å‘ç”Ÿæ—¶ï¼Œå±è”½ä¸é‡è¦çš„å‘Šè­¦</strong>ã€‚</p><hr><h2 id=-å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†</strong>
<a class=anchor href=#-%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86>#</a></h2><ul><li><strong>æŠ‘åˆ¶è§„åˆ™ï¼ˆInhibit Rulesï¼‰</strong> å…è®¸ä½ å®šä¹‰ <strong>&ldquo;A å‘Šè­¦å­˜åœ¨æ—¶ï¼ŒB å‘Šè­¦å°±ä¸ä¼šå‘é€é€šçŸ¥&rdquo;</strong>ã€‚</li><li>ä¾‹å¦‚ï¼š<ul><li><strong>å¦‚æœæŸä¸ªé›†ç¾¤å·² <code>Down</code>ï¼Œå°±ä¸è¦å‘é€ <code>InstanceDown</code> å‘Šè­¦</strong>ã€‚</li><li><strong>å¦‚æœä¸»æ•°æ®åº“å·²å´©æºƒï¼Œå°±ä¸å†å‘é€å•ä¸ª API å¤±è´¥çš„å‘Šè­¦</strong>ã€‚</li></ul></li><li><strong>Alertmanager åªä¼šå¯¹å·²æ¥æ”¶åˆ°çš„å‘Šè­¦è¿›è¡ŒæŠ‘åˆ¶</strong>ï¼Œä¸ä¼šå½±å“ Prometheus çš„å‘Šè­¦è§¦å‘ã€‚</li></ul><hr><h2 id=-å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®</strong>
<a class=anchor href=#-%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6%e8%a7%84%e5%88%99%e9%85%8d%e7%bd%ae>#</a></h2><h3 id=ç¤ºä¾‹-1å±è”½><strong>ç¤ºä¾‹ 1ï¼šå±è”½ <code>InstanceDown</code> å‘Šè­¦ï¼Œè‹¥ <code>ClusterDown</code> å‘Šè­¦å·²è§¦å‘</strong>
<a class=anchor href=#%e7%a4%ba%e4%be%8b-1%e5%b1%8f%e8%94%bd>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>inhibit_rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;ClusterDown&#34;</span>  <span style=color:#75715e># å½“ &#34;ClusterDown&#34; å‘Šè­¦è§¦å‘æ—¶</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;InstanceDown&#34;</span>  <span style=color:#75715e># è¯¥å‘Šè­¦ä¼šè¢«æŠ‘åˆ¶</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>equal</span>: [<span style=color:#e6db74>&#34;cluster&#34;</span>]  <span style=color:#75715e># å¿…é¡»åŒ¹é…ç›¸åŒçš„ cluster æ ‡ç­¾</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>è§£é‡Š</strong>ï¼š</p><ul><li>å¦‚æœ <strong><code>ClusterDown</code></strong> å‘ç”Ÿï¼ˆæ•´ä¸ªé›†ç¾¤å®•æœºï¼‰ï¼Œåˆ™ä¸ä¼šå‘é€ <strong><code>InstanceDown</code></strong>ï¼ˆå•ä¸ªå®ä¾‹å®•æœºï¼‰çš„å‘Šè­¦ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æ˜¯ç›¸åŒçš„é—®é¢˜å¯¼è‡´çš„ã€‚</li></ul><hr><h3 id=ç¤ºä¾‹-2æŸä¸ªæœåŠ¡><strong>ç¤ºä¾‹ 2ï¼šæŸä¸ªæœåŠ¡ <code>APIHighLatency</code> æ—¶ï¼Œå±è”½ <code>APIErrorRate</code></strong>
<a class=anchor href=#%e7%a4%ba%e4%be%8b-2%e6%9f%90%e4%b8%aa%e6%9c%8d%e5%8a%a1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>inhibit_rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;APIHighLatency&#34;</span>  <span style=color:#75715e># API å“åº”æ…¢</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;APIErrorRate&#34;</span>  <span style=color:#75715e># API é”™è¯¯ç‡å‡é«˜</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>equal</span>: [<span style=color:#e6db74>&#34;service&#34;</span>]  <span style=color:#75715e># ä»…åœ¨ç›¸åŒæœåŠ¡åçš„æƒ…å†µä¸‹ç”Ÿæ•ˆ</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>è§£é‡Š</strong>ï¼š</p><ul><li><strong>API å“åº”å˜æ…¢ï¼ˆ<code>APIHighLatency</code>ï¼‰å¯èƒ½ä¼šå¯¼è‡´ API å¤±è´¥ï¼ˆ<code>APIErrorRate</code>ï¼‰</strong>ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å»¶è¿Ÿè¿‡é«˜æ—¶å±è”½é”™è¯¯ç‡å‘Šè­¦ã€‚</li></ul><hr><h2 id=-é…ç½®><strong>ğŸ“Œ é…ç½® <code>Alertmanager.yml</code> è§„åˆ™</strong>
<a class=anchor href=#-%e9%85%8d%e7%bd%ae>#</a></h2><h3 id=å®Œæ•´ç¤ºä¾‹><strong>å®Œæ•´ç¤ºä¾‹</strong>
<a class=anchor href=#%e5%ae%8c%e6%95%b4%e7%a4%ba%e4%be%8b>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_by</span>: [<span style=color:#e6db74>&#39;alertname&#39;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_wait</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_interval</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>repeat_interval</span>: <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#39;default&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;default&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>webhook_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://webhook-server/alert&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>inhibit_rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;ClusterDown&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;InstanceDown&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>equal</span>: [<span style=color:#e6db74>&#34;cluster&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;APIHighLatency&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target_match</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alertname</span>: <span style=color:#e6db74>&#34;APIErrorRate&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>equal</span>: [<span style=color:#e6db74>&#34;service&#34;</span>]
</span></span></code></pre></div><hr><h2 id=-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶</strong>
<a class=anchor href=#-%e5%a6%82%e4%bd%95%e6%b5%8b%e8%af%95%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6>#</a></h2><ol><li><p>è§¦å‘ <code>ClusterDown</code></p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>ALERT ClusterDown</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>IF count(up == 0) &gt; 5</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>FOR 1m</span>
</span></span></code></pre></div></li><li><p>è§¦å‘ <code>InstanceDown</code></p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>ALERT InstanceDown</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>IF up == 0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>FOR 1m</span>
</span></span></code></pre></div></li><li><p>æŸ¥çœ‹ Alertmanager ç•Œé¢</p><ul><li><strong>è‹¥ <code>ClusterDown</code> è§¦å‘ï¼Œ<code>InstanceDown</code> å°†è¢«æŠ‘åˆ¶ï¼ˆä¸ä¼šå‘é€šçŸ¥ï¼‰</strong>ã€‚</li><li>åœ¨ Alertmanager çš„ <strong><code>/alerts</code> é¡µé¢</strong>ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>InstanceDown</code> çŠ¶æ€å˜ä¸º <code>Suppressed</code>ï¼ˆå·²æŠ‘åˆ¶ï¼‰ã€‚</li></ul></li></ol><hr><h2 id=-æ€»ç»“><strong>ğŸ“Œ æ€»ç»“</strong>
<a class=anchor href=#-%e6%80%bb%e7%bb%93>#</a></h2><p>âœ… <strong>å‘Šè­¦æŠ‘åˆ¶çš„ä½œç”¨</strong>ï¼š</p><ul><li>å‡å°‘ <strong>é‡å¤å‘Šè­¦</strong>ï¼Œé¿å…å‘Šè­¦é£æš´ã€‚</li><li>è®©æ›´ä¸¥é‡çš„å‘Šè­¦ä¼˜å…ˆçº§æ›´é«˜ï¼Œé˜²æ­¢è¢«æ— å…³å‘Šè­¦å¹²æ‰°ã€‚</li></ul><p>âœ… <strong>å…³é”®é…ç½®</strong></p><ul><li><code>source_match</code>: è§¦å‘æŠ‘åˆ¶çš„å‘Šè­¦ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ã€‚</li><li><code>target_match</code>: è¢«æŠ‘åˆ¶çš„å‘Šè­¦ï¼ˆä¼˜å…ˆçº§ä½ï¼‰ã€‚</li><li><code>equal</code>: éœ€è¦åŒ¹é…çš„æ ‡ç­¾ï¼ˆå¦‚ <code>cluster</code>ã€<code>service</code>ï¼‰ã€‚</li></ul><p>ğŸ’¡ <strong>æœ€ç»ˆæ•ˆæœ</strong>ï¼š
ğŸ’¥<strong>å¦‚æœé›†ç¾¤å´©æºƒï¼ˆ<code>ClusterDown</code>ï¼‰æ—¶ï¼Œæ‰€æœ‰å®ä¾‹å®•æœºå‘Šè­¦ï¼ˆ<code>InstanceDown</code>ï¼‰éƒ½ä¼šè¢«æŠ‘åˆ¶</strong>ï¼Œè¿™æ ·ä¸ä¼šæ”¶åˆ°é‡å¤çš„å®ä¾‹å‘Šè­¦ã€‚ ğŸš€</p><h3 id=prometheus-å‘Šè­¦æŠ‘åˆ¶inhibition><strong>Prometheus å‘Šè­¦æŠ‘åˆ¶ï¼ˆInhibitionï¼‰</strong>
<a class=anchor href=#prometheus-%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6inhibition>#</a></h3><p>å‘Šè­¦æŠ‘åˆ¶ï¼ˆ<strong>Inhibition</strong>ï¼‰ç”¨äº<strong>å±è”½</strong>æŸäº›å‘Šè­¦ï¼Œé˜²æ­¢é«˜ä¼˜å…ˆçº§çš„å‘Šè­¦è§¦å‘æ—¶ï¼Œä½ä¼˜å…ˆçº§çš„å‘Šè­¦åŒæ—¶è§¦å‘ï¼Œé€ æˆä¿¡æ¯å†—ä½™æˆ–æ··ä¹±ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li><strong>å±è”½</strong>â€œæœåŠ¡å®ä¾‹ä¸å¯ç”¨â€å‘Šè­¦ <strong>ï¼ˆInstanceDownï¼‰</strong>ï¼Œå½“æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨æ—¶ <strong>ï¼ˆClusterDownï¼‰</strong> è§¦å‘ã€‚</li><li><strong>å±è”½</strong>â€œç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜â€å‘Šè­¦ <strong>ï¼ˆDiskUsageHighï¼‰</strong>ï¼Œå½“ç£ç›˜å·²æ»¡æ—¶ <strong>ï¼ˆDiskFullï¼‰</strong> è§¦å‘ã€‚</li></ul><hr><h2 id=-é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤><strong>ğŸ“Œ é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤</strong>
<a class=anchor href=#-%e9%85%8d%e7%bd%ae%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6%e7%9a%84%e6%ad%a5%e9%aa%a4>#</a></h2><p>å‘Šè­¦æŠ‘åˆ¶éœ€è¦åœ¨ <strong>Alertmanager</strong> ä¸­é…ç½® <code>inhibit_rules</code>ï¼Œå…¶è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><strong>source_match</strong>ï¼šæŒ‡å®š<strong>é«˜ä¼˜å…ˆçº§</strong>çš„å‘Šè­¦ï¼ˆå¦‚æœæ­¤å‘Šè­¦è§¦å‘ï¼Œåˆ™å±è”½å…¶ä»–å‘Šè­¦ï¼‰ã€‚</li><li><strong>target_match</strong>ï¼šæŒ‡å®š<strong>ä½ä¼˜å…ˆçº§</strong>çš„å‘Šè­¦ï¼ˆå½“ <code>source_match</code> è§¦å‘æ—¶ï¼Œè¯¥å‘Šè­¦ä¼šè¢«å±è”½ï¼‰ã€‚</li><li><strong>equal</strong>ï¼šéœ€è¦åŒ¹é…çš„æ ‡ç­¾ï¼Œç¡®ä¿åŒä¸€æœåŠ¡æˆ–åŒä¸€å®ä¾‹çš„å‘Šè­¦æ‰ä¼šè¢«æŠ‘åˆ¶ã€‚</li></ul><hr><h2 id=-ç¤ºä¾‹å±è”½-instancedown-å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ InstanceDown å‘Šè­¦</strong>
<a class=anchor href=#-%e7%a4%ba%e4%be%8b%e5%b1%8f%e8%94%bd-instancedown-%e5%91%8a%e8%ad%a6>#</a></h2><p><strong>åœºæ™¯ï¼š</strong></p><ul><li><code>ClusterDown</code>ï¼ˆæ•´ä¸ªé›†ç¾¤å®•æœºï¼‰è§¦å‘æ—¶ï¼Œä¸å†å•ç‹¬å‘Šè­¦ <code>InstanceDown</code>ï¼ˆå•ä¸ªå®ä¾‹ä¸å¯ç”¨ï¼‰ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šé¿å…åŒä¸€äº‹ä»¶é‡å¤å‘é€å¤šä¸ªå‘Šè­¦ï¼Œå‡å°‘å™ªéŸ³ã€‚</li></ul><pre tabindex=0><code>yaml


å¤åˆ¶ç¼–è¾‘
inhibit_rules:
  - source_match:
      alertname: &#34;ClusterDown&#34;  # é«˜ä¼˜å…ˆçº§å‘Šè­¦
    target_match:
      alertname: &#34;InstanceDown&#34;  # ä½ä¼˜å…ˆçº§å‘Šè­¦
    equal: [&#34;cluster&#34;]  # åªæŠ‘åˆ¶åŒä¸€ä¸ª cluster çš„å‘Šè­¦
</code></pre><p>ğŸ”¹ <strong>æ•ˆæœ</strong>ï¼šå½“ <code>ClusterDown</code> è§¦å‘æ—¶ï¼Œ<code>InstanceDown</code> å‘Šè­¦ä¸ä¼šå‘é€ã€‚</p><hr><h2 id=-ç¤ºä¾‹å±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦</strong>
<a class=anchor href=#-%e7%a4%ba%e4%be%8b%e5%b1%8f%e8%94%bd%e7%a3%81%e7%9b%98%e4%bd%bf%e7%94%a8%e7%8e%87%e9%ab%98%e5%91%8a%e8%ad%a6>#</a></h2><p><strong>åœºæ™¯ï¼š</strong></p><ul><li><code>DiskFull</code>ï¼ˆç£ç›˜å·²æ»¡ï¼‰è§¦å‘æ—¶ï¼Œä¸å†å‘Šè­¦ <code>DiskUsageHigh</code>ï¼ˆç£ç›˜ä½¿ç”¨ç‡é«˜ï¼‰ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šé¿å…ç›¸åŒåŸå› å¯¼è‡´çš„å¤šæ¡å‘Šè­¦ï¼Œå‡å°‘ä¸å¿…è¦çš„å‘Šè­¦æµé‡ã€‚</li></ul><pre tabindex=0><code>yaml


å¤åˆ¶ç¼–è¾‘
inhibit_rules:
  - source_match:
      alertname: &#34;DiskFull&#34;  # é«˜çº§åˆ«å‘Šè­¦
    target_match:
      alertname: &#34;DiskUsageHigh&#34;  # ä½çº§åˆ«å‘Šè­¦
    equal: [&#34;instance&#34;, &#34;device&#34;]  # åªæŠ‘åˆ¶ç›¸åŒ instance å’Œ device çš„å‘Šè­¦
</code></pre><p>ğŸ”¹ <strong>æ•ˆæœ</strong>ï¼šç£ç›˜å·²æ»¡æ—¶ï¼Œä¸ä¼šå†æ”¶åˆ°ç£ç›˜ä½¿ç”¨ç‡é«˜çš„å‘Šè­¦ã€‚</p><hr><h2 id=-ç¤ºä¾‹å±è”½><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ <code>NodeDown</code>ï¼ˆèŠ‚ç‚¹å®•æœºï¼‰å‘Šè­¦</strong>
<a class=anchor href=#-%e7%a4%ba%e4%be%8b%e5%b1%8f%e8%94%bd>#</a></h2><p><strong>åœºæ™¯ï¼š</strong></p><ul><li><code>NetworkDown</code>ï¼ˆç½‘ç»œä¸å¯ç”¨ï¼‰è§¦å‘æ—¶ï¼Œä¸å†å‘Šè­¦ <code>NodeDown</code>ï¼ˆèŠ‚ç‚¹å®•æœºï¼‰ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šé¿å…è¯¯æŠ¥ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ä¼šå¯¼è‡´æ‰€æœ‰èŠ‚ç‚¹çš„ <code>NodeDown</code> å‘Šè­¦ã€‚</li></ul><pre tabindex=0><code>yaml


å¤åˆ¶ç¼–è¾‘
inhibit_rules:
  - source_match:
      alertname: &#34;NetworkDown&#34;
    target_match:
      alertname: &#34;NodeDown&#34;
    equal: [&#34;datacenter&#34;]
</code></pre><p>ğŸ”¹ <strong>æ•ˆæœ</strong>ï¼šå½“ <code>NetworkDown</code> è§¦å‘æ—¶ï¼ŒåŒä¸€æ•°æ®ä¸­å¿ƒçš„ <code>NodeDown</code> å‘Šè­¦ä¼šè¢«å±è”½ã€‚</p><hr><h2 id=heading><strong>ğŸ“Œ <code>inhibit_rules</code> é…ç½®å®Œæ•´ç¤ºä¾‹</strong>
<a class=anchor href=#heading>#</a></h2><pre tabindex=0><code>yaml


å¤åˆ¶ç¼–è¾‘
route:
  receiver: &#34;default&#34;

inhibit_rules:
  - source_match:
      alertname: &#34;ClusterDown&#34;
    target_match:
      alertname: &#34;InstanceDown&#34;
    equal: [&#34;cluster&#34;]

  - source_match:
      alertname: &#34;DiskFull&#34;
    target_match:
      alertname: &#34;DiskUsageHigh&#34;
    equal: [&#34;instance&#34;, &#34;device&#34;]

  - source_match:
      alertname: &#34;NetworkDown&#34;
    target_match:
      alertname: &#34;NodeDown&#34;
    equal: [&#34;datacenter&#34;]
</code></pre><p>ğŸ“Œ <strong>è§£é‡Š</strong></p><ol><li><strong><code>ClusterDown</code> è§¦å‘æ—¶ï¼Œä¸å†è§¦å‘ <code>InstanceDown</code></strong>ã€‚</li><li><strong><code>DiskFull</code> è§¦å‘æ—¶ï¼Œä¸å†è§¦å‘ <code>DiskUsageHigh</code></strong>ã€‚</li><li><strong><code>NetworkDown</code> è§¦å‘æ—¶ï¼Œä¸å†è§¦å‘ <code>NodeDown</code></strong>ã€‚</li></ol><hr><h2 id=-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶-1><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶ï¼Ÿ</strong>
<a class=anchor href=#-%e5%a6%82%e4%bd%95%e6%b5%8b%e8%af%95%e5%91%8a%e8%ad%a6%e6%8a%91%e5%88%b6-1>#</a></h2><h3 id=æ–¹å¼-1ä½¿ç”¨><strong>æ–¹å¼ 1ï¼šä½¿ç”¨ <code>amtool</code></strong>
<a class=anchor href=#%e6%96%b9%e5%bc%8f-1%e4%bd%bf%e7%94%a8>#</a></h3><pre tabindex=0><code>sh


å¤åˆ¶ç¼–è¾‘
amtool silence query  # æŸ¥çœ‹å½“å‰æŠ‘åˆ¶çš„å‘Šè­¦
</code></pre><h3 id=æ–¹å¼-2æŸ¥çœ‹-alertmanager-ui><strong>æ–¹å¼ 2ï¼šæŸ¥çœ‹ Alertmanager UI</strong>
<a class=anchor href=#%e6%96%b9%e5%bc%8f-2%e6%9f%a5%e7%9c%8b-alertmanager-ui>#</a></h3><ol><li><p>è®¿é—® Alertmanager Web UIï¼š</p><pre tabindex=0><code>cpp


å¤åˆ¶ç¼–è¾‘
http://&lt;alertmanager-ip&gt;:9093
</code></pre></li><li><p>è¿›å…¥ <strong>&ldquo;Silences&rdquo;ï¼ˆæŠ‘åˆ¶ï¼‰</strong> é¡µé¢ï¼ŒæŸ¥çœ‹å“ªäº›å‘Šè­¦è¢«å±è”½ã€‚</p></li></ol><hr><h2 id=-ç»“è®º-1><strong>ğŸ“Œ ç»“è®º</strong>
<a class=anchor href=#-%e7%bb%93%e8%ae%ba-1>#</a></h2><p>âœ… <strong>å‘Šè­¦æŠ‘åˆ¶ï¼ˆInhibitionï¼‰</strong> å¯ä»¥é˜²æ­¢ä½ä¼˜å…ˆçº§çš„å‘Šè­¦é‡å¤è§¦å‘ï¼Œæé«˜å‘Šè­¦çš„å‡†ç¡®æ€§ã€‚
âœ… <strong><code>inhibit_rules</code></strong> é€šè¿‡ <strong>source_matchã€target_match å’Œ equal</strong> åŒ¹é…è§„åˆ™ï¼Œå†³å®šå“ªäº›å‘Šè­¦éœ€è¦è¢«å±è”½ã€‚
âœ… <strong>å¸¸è§ç”¨ä¾‹</strong>ï¼š</p><ul><li><strong>é›†ç¾¤å®•æœºæ—¶å±è”½å•ä¸ªå®ä¾‹å‘Šè­¦</strong>ã€‚</li><li><strong>ç£ç›˜æ»¡æ—¶å±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜çš„å‘Šè­¦</strong>ã€‚</li><li><strong>ç½‘ç»œä¸å¯ç”¨æ—¶å±è”½æ‰€æœ‰èŠ‚ç‚¹å®•æœºçš„å‘Šè­¦</strong>ã€‚</li></ul><p>è¿™æ ·å¯ä»¥<strong>å‡å°‘å‘Šè­¦å™ªéŸ³ï¼Œæé«˜è¿ç»´æ•ˆç‡</strong> ğŸš€ğŸš€ğŸš€ï¼</p><h2 id=å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåš>å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåšâ˜†
<a class=anchor href=#%e5%91%8a%e8%ad%a6%e6%9e%b6%e6%9e%84%e9%ab%98%e5%8f%af%e7%94%a8%e6%80%8e%e4%b9%88%e5%81%9a>#</a></h2><h2 id=prometheus-å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ><strong>Prometheus å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ</strong>
<a class=anchor href=#prometheus-%e5%91%8a%e8%ad%a6%e7%b3%bb%e7%bb%9f%e9%ab%98%e5%8f%af%e7%94%a8%e6%9e%b6%e6%9e%84%e6%96%b9%e6%a1%88>#</a></h2><p>Prometheus çš„å‘Šè­¦ç³»ç»Ÿä¸»è¦ç”± <strong>Prometheus + Alertmanager</strong> ç»„æˆï¼Œè¦ä¿è¯å…¶é«˜å¯ç”¨ï¼ˆHAï¼‰ï¼Œéœ€è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>Prometheus é«˜å¯ç”¨</strong>ï¼ˆæ•°æ®é‡‡é›†ã€å­˜å‚¨çš„ HAï¼‰</li><li><strong>Alertmanager é«˜å¯ç”¨</strong>ï¼ˆå‘Šè­¦å¤„ç†ã€å»é‡çš„ HAï¼‰</li><li><strong>é€šçŸ¥æ¸ é“é«˜å¯ç”¨</strong>ï¼ˆWebhookã€é‚®ä»¶ã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰</li></ol><hr><h2 id=-1-prometheus-é«˜å¯ç”¨><strong>ğŸ“Œ 1. Prometheus é«˜å¯ç”¨</strong>
<a class=anchor href=#-1-prometheus-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h2><p>Prometheus è´Ÿè´£<strong>æ•°æ®é‡‡é›†</strong>å’Œ<strong>å‘Šè­¦è§„åˆ™æ‰§è¡Œ</strong>ï¼Œè¦ä¿è¯å®ƒçš„é«˜å¯ç”¨ï¼Œä¸»è¦è€ƒè™‘ï¼š</p><ul><li><strong>ä¸»å¤‡éƒ¨ç½²ï¼ˆçƒ­å¤‡ï¼‰</strong></li><li><strong>æ°´å¹³æ‰©å±•ï¼ˆè”é‚¦é›†ç¾¤ï¼‰</strong></li><li><strong>å­˜å‚¨å±‚é«˜å¯ç”¨</strong></li></ul><h3 id=-æ–¹æ¡ˆ-1prometheus-åŒå®ä¾‹ä¸»å¤‡><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šPrometheus åŒå®ä¾‹ï¼ˆä¸»å¤‡ï¼‰</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-1prometheus-%e5%8f%8c%e5%ae%9e%e4%be%8b%e4%b8%bb%e5%a4%87>#</a></h3><ul><li><strong>æ¶æ„ï¼š</strong> éƒ¨ç½²ä¸¤å°ç‹¬ç«‹çš„ Prometheus å®ä¾‹ï¼Œç›‘æ§ç›¸åŒçš„ç›®æ ‡ã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> ç®€å•æ˜“å®ç°ï¼Œé€‚ç”¨äºå°å‹ç¯å¢ƒã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> éœ€è¦è´Ÿè½½å‡è¡¡æˆ–æ‰‹åŠ¨åˆ‡æ¢ï¼Œå­˜å‚¨ä¸å…±äº«ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>       â”‚  Exporter â”‚
</span></span><span style=display:flex><span>       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>            â”‚
</span></span><span style=display:flex><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>  â”‚ Prometheus (ä¸»)  â”‚   â”‚ Alertmanager â”‚
</span></span><span style=display:flex><span>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>  â”‚ Prometheus (å¤‡)  â”‚
</span></span><span style=display:flex><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><p>âœ… <strong>å¦‚ä½•åšï¼Ÿ</strong></p><ol><li><strong>é…ç½®ä¸¤ä¸ª Prometheus å®ä¾‹</strong>ï¼Œè®©å®ƒä»¬éƒ½æ‹‰å–ç›¸åŒçš„ç›‘æ§æ•°æ®ã€‚</li><li><strong>å‰ç«¯ï¼ˆå¦‚ Grafanaï¼‰é…ç½®è´Ÿè½½å‡è¡¡</strong>ï¼Œå¦‚æœä¸€ä¸ª Prometheus å®•æœºï¼Œä½¿ç”¨å¦ä¸€ä¸ªã€‚</li></ol><hr><h3 id=-æ–¹æ¡ˆ-2prometheus--thanos-victoriametrics><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šPrometheus + Thanos/ VictoriaMetrics</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-2prometheus--thanos-victoriametrics>#</a></h3><ul><li><strong>æ¶æ„ï¼š</strong> Prometheus é‡‡é›†æ•°æ®ï¼ŒThanos/VictoriaMetrics è´Ÿè´£è¿œç¨‹å­˜å‚¨å’Œ HA æŸ¥è¯¢ã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> é«˜å¯ç”¨ã€åˆ†å¸ƒå¼å­˜å‚¨ã€æ”¯æŒå†å²æ•°æ®æŸ¥è¯¢ã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> éœ€è¦é¢å¤–ç»„ä»¶ï¼ˆThanos/VictoriaMetricsï¼‰ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>       â”‚   Exporter  â”‚
</span></span><span style=display:flex><span>       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>             â”‚
</span></span><span style=display:flex><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span> â”‚    Prometheus-1     â”‚
</span></span><span style=display:flex><span> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span> â”‚    Prometheus-2     â”‚
</span></span><span style=display:flex><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>            â”‚
</span></span><span style=display:flex><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>  â”‚ Thanos Query    â”‚
</span></span><span style=display:flex><span>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>  â”‚ Thanos Store    â”‚
</span></span><span style=display:flex><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><p>âœ… <strong>å¦‚ä½•åšï¼Ÿ</strong></p><ol><li><strong>éƒ¨ç½²å¤šä¸ª Prometheus å®ä¾‹</strong>ï¼Œé‡‡é›†ç›¸åŒæ•°æ®ã€‚</li><li><strong>ä½¿ç”¨ Thanos Query/VictoriaMetrics</strong>ï¼Œè®©æŸ¥è¯¢å±‚èƒ½è‡ªåŠ¨èšåˆå¤šä¸ª Prometheus æ•°æ®ã€‚</li></ol><hr><h2 id=-2-alertmanager-é«˜å¯ç”¨><strong>ğŸ“Œ 2. Alertmanager é«˜å¯ç”¨</strong>
<a class=anchor href=#-2-alertmanager-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h2><p>Alertmanager è´Ÿè´£<strong>å‘Šè­¦çš„å»é‡ã€åˆ†ç»„ã€é€šçŸ¥</strong>ï¼Œå¦‚æœå•ç‚¹æ•…éšœï¼Œå‘Šè­¦å°±å¯èƒ½ä¸¢å¤±ã€‚</p><h3 id=-æ–¹æ¡ˆalertmanager-é›†ç¾¤><strong>ğŸ”¹ æ–¹æ¡ˆï¼šAlertmanager é›†ç¾¤</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88alertmanager-%e9%9b%86%e7%be%a4>#</a></h3><ul><li><strong>æ¶æ„ï¼š</strong> å¤šä¸ª Alertmanager è¿›ç¨‹ï¼Œé€šè¿‡ <code>mesh</code> äº’ç›¸åŒæ­¥çŠ¶æ€ã€‚</li><li><strong>ä¼˜ç‚¹ï¼š</strong> äº’ç›¸åŒæ­¥ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœï¼Œå‘Šè­¦ä¸ä¼šä¸¢å¤±ã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong> éœ€è¦é¢å¤–è´Ÿè½½å‡è¡¡ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>       â”‚    Prometheus   â”‚
</span></span><span style=display:flex><span>       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>       â”‚  å‘é€å‘Šè­¦        â”‚
</span></span><span style=display:flex><span>       â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>                â”‚
</span></span><span style=display:flex><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span> â”‚   Alertmanager (å®ä¾‹ 1)      â”‚
</span></span><span style=display:flex><span> â”‚   Alertmanager (å®ä¾‹ 2)      â”‚   (é›†ç¾¤æ¨¡å¼)
</span></span><span style=display:flex><span> â”‚   Alertmanager (å®ä¾‹ 3)      â”‚
</span></span><span style=display:flex><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>                â”‚
</span></span><span style=display:flex><span>        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>        â”‚  Webhook    â”‚
</span></span><span style=display:flex><span>        â”‚  é‚®ä»¶é€šçŸ¥   â”‚
</span></span><span style=display:flex><span>        â”‚  ä¼ä¸šå¾®ä¿¡   â”‚
</span></span><span style=display:flex><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><p>âœ… <strong>å¦‚ä½•åšï¼Ÿ</strong></p><ol><li><strong>å¤šä¸ª Alertmanager å®ä¾‹</strong> é€šè¿‡ <code>--cluster.peer=&lt;other-instance></code> äº’ç›¸åŒæ­¥ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡ï¼ˆå¦‚ Nginx/LBï¼‰</strong> è®© Prometheus ä»¥ HA æ–¹å¼è®¿é—® Alertmanagerã€‚</li><li><strong>æŒä¹…åŒ–å­˜å‚¨</strong> é¿å… Alertmanager é‡å¯åä¸¢å¤±çŠ¶æ€ã€‚</li></ol><hr><h2 id=-3-é€šçŸ¥æ¸ é“é«˜å¯ç”¨><strong>ğŸ“Œ 3. é€šçŸ¥æ¸ é“é«˜å¯ç”¨</strong>
<a class=anchor href=#-3-%e9%80%9a%e7%9f%a5%e6%b8%a0%e9%81%93%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h2><p>å¦‚æœé€šçŸ¥æ–¹å¼ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ Webhookã€é‚®ä»¶æœåŠ¡å™¨å®•æœºï¼‰ï¼Œå¯èƒ½å¯¼è‡´å‘Šè­¦ä¸¢å¤±ã€‚</p><h3 id=-æ–¹æ¡ˆ-1å¤šä¸ªé€šçŸ¥é€šé“><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šå¤šä¸ªé€šçŸ¥é€šé“</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-1%e5%a4%9a%e4%b8%aa%e9%80%9a%e7%9f%a5%e9%80%9a%e9%81%93>#</a></h3><ul><li><p>é…ç½®</p><p>å¤šä¸ªé€šçŸ¥é€šé“</p><p>ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä¸»è¦é€šçŸ¥ï¼š<strong>é‚®ä»¶</strong></li><li>å¤‡ç”¨é€šçŸ¥ï¼š<strong>ä¼ä¸šå¾®ä¿¡</strong></li><li>ç´§æ€¥é€šçŸ¥ï¼š<strong>çŸ­ä¿¡</strong></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;email&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>email_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#34;admin@example.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;wechat&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>wechat_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#34;DevOps_Group&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;sms&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>webhook_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://sms-provider/api/send&#34;</span>
</span></span></code></pre></div><p>âœ… <strong>å¦‚ä½•åšï¼Ÿ</strong></p><ul><li><strong>å®šä¹‰å¤šä¸ª <code>receiver</code></strong>ï¼Œå¹¶åœ¨ <code>route</code> é‡Œé…ç½®æ•…éšœè½¬ç§»é€»è¾‘ã€‚</li></ul><hr><h3 id=-æ–¹æ¡ˆ-2webhook-é«˜å¯ç”¨><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šWebhook é«˜å¯ç”¨</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-2webhook-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h3><ul><li>å¦‚æœ Webhook æœåŠ¡å™¨å´©æºƒï¼Œå‘Šè­¦å¯èƒ½ä¸¢å¤±ã€‚</li><li>æ–¹æ¡ˆï¼š<ul><li>ä½¿ç”¨ <strong>è´Ÿè½½å‡è¡¡ï¼ˆNginxã€HAProxyï¼‰</strong> ä»£ç†å¤šä¸ª Webhook æœåŠ¡å™¨ã€‚</li><li>é‡‡ç”¨ <strong>Kafka/RabbitMQ</strong> ä½œä¸º Webhook ç¼“å†²é˜Ÿåˆ—ï¼Œé˜²æ­¢ç¬æ—¶æµé‡è¿‡è½½ã€‚</li></ul></li></ul><hr><h2 id=-4-å…¨å±€é«˜å¯ç”¨æ¶æ„><strong>ğŸ“Œ 4. å…¨å±€é«˜å¯ç”¨æ¶æ„</strong>
<a class=anchor href=#-4-%e5%85%a8%e5%b1%80%e9%ab%98%e5%8f%af%e7%94%a8%e6%9e%b6%e6%9e%84>#</a></h2><p><strong>æœ€ç»ˆçš„ Prometheus å‘Šè­¦é«˜å¯ç”¨æ¶æ„å¦‚ä¸‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>       â”‚    Exporters      â”‚
</span></span><span style=display:flex><span>       â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>                â”‚
</span></span><span style=display:flex><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span> â”‚  Prometheus (å®ä¾‹ 1)         â”‚
</span></span><span style=display:flex><span> â”‚  Prometheus (å®ä¾‹ 2)         â”‚  (é«˜å¯ç”¨)
</span></span><span style=display:flex><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>                â”‚
</span></span><span style=display:flex><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>       â”‚ Thanos Query  â”‚  (å¯é€‰)
</span></span><span style=display:flex><span>       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>               â”‚
</span></span><span style=display:flex><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span> â”‚  Alertmanager (å®ä¾‹ 1)   â”‚
</span></span><span style=display:flex><span> â”‚  Alertmanager (å®ä¾‹ 2)   â”‚  (é›†ç¾¤)
</span></span><span style=display:flex><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style=display:flex><span>              â”‚
</span></span><span style=display:flex><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span> â”‚  é‚®ä»¶ / å¾®ä¿¡ / Webhook  â”‚  (å¤šé€šé“)
</span></span><span style=display:flex><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><hr><h2 id=-ç»“è®º-2><strong>ğŸ“Œ ç»“è®º</strong>
<a class=anchor href=#-%e7%bb%93%e8%ae%ba-2>#</a></h2><p>âœ… <strong>Prometheus é«˜å¯ç”¨</strong></p><ul><li><strong>æ–¹æ¡ˆ 1ï¼šåŒå®ä¾‹ä¸»å¤‡</strong></li><li><strong>æ–¹æ¡ˆ 2ï¼šThanos/VictoriaMetrics åˆ†å¸ƒå¼</strong></li></ul><p>âœ… <strong>Alertmanager é«˜å¯ç”¨</strong></p><ul><li><strong>Alertmanager é›†ç¾¤</strong>ï¼ŒåŒæ­¥çŠ¶æ€</li><li><strong>è´Ÿè½½å‡è¡¡ï¼ˆNginx/LBï¼‰</strong></li></ul><p>âœ… <strong>é€šçŸ¥æ¸ é“é«˜å¯ç”¨</strong></p><ul><li><strong>å¤šé€šé“ï¼ˆé‚®ä»¶ã€å¾®ä¿¡ã€çŸ­ä¿¡ï¼‰</strong></li><li><strong>Webhook è´Ÿè½½å‡è¡¡ + æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafkaï¼‰</strong></li></ul><p>ğŸš€ <strong>è¿™æ ·å¯ä»¥ç¡®ä¿æ•´ä¸ªå‘Šè­¦ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœï¼</strong></p><h2 id=podæŒ‡æ ‡wsså’ŒrssåŒºåˆ«>PodæŒ‡æ ‡WSSå’ŒRSSåŒºåˆ«â˜†
<a class=anchor href=#pod%e6%8c%87%e6%a0%87wss%e5%92%8crss%e5%8c%ba%e5%88%ab>#</a></h2><p>åœ¨ Kubernetes æˆ– Linux ç³»ç»Ÿä¸­ï¼Œ<strong>RSSï¼ˆResident Set Sizeï¼‰</strong> å’Œ <strong>WSSï¼ˆWorking Set Sizeï¼‰</strong> æ˜¯è¡¡é‡ Pod æˆ–è¿›ç¨‹å†…å­˜ä½¿ç”¨çš„é‡è¦æŒ‡æ ‡ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„å«ä¹‰å’Œä½¿ç”¨åœºæ™¯ã€‚</p><hr><h2 id=-rssresident-set-size><strong>ğŸ“Œ RSSï¼ˆResident Set Sizeï¼‰</strong>
<a class=anchor href=#-rssresident-set-size>#</a></h2><ul><li><strong>RSS æ˜¯è¿›ç¨‹å®é™…å ç”¨ç‰©ç†å†…å­˜çš„å¤§å°</strong>ï¼Œä¸åŒ…æ‹¬äº¤æ¢ï¼ˆswapï¼‰å‡ºå»çš„éƒ¨åˆ†ã€‚</li><li>å®ƒåŒ…æ‹¬ï¼š<ul><li><strong>ç§æœ‰åŒ¿åé¡µ</strong>ï¼ˆheapã€stack ç­‰ï¼‰</li><li><strong>å…±äº«åº“çš„å·²åŠ è½½éƒ¨åˆ†</strong></li></ul></li><li>ä¸åŒ…æ‹¬ï¼š<ul><li><strong>æœªè¢«è®¿é—®çš„å†…å­˜é¡µ</strong></li><li><strong>Swap åˆ°ç£ç›˜çš„éƒ¨åˆ†</strong></li><li><strong>æ–‡ä»¶æ˜ å°„çš„æœªåŠ è½½éƒ¨åˆ†</strong></li></ul></li></ul><p>âœ… <strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>è§‚å¯Ÿ Pod çš„å®é™…ç‰©ç†å†…å­˜å ç”¨ï¼Œé¿å…è¶…å‡ºèŠ‚ç‚¹å¯ç”¨å†…å­˜ã€‚</li><li>ç”¨äº Kubernetes <code>memory.usage</code> ç›‘æ§ã€‚</li></ul><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼šæŸ¥çœ‹ Pod RSS</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl exec -it &lt;pod-name&gt; -- cat /proc/1/status | grep VmRSS
</span></span></code></pre></div><p>æˆ–è€…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps -o rss,vsz,pid,cmd | grep &lt;process_name&gt;
</span></span></code></pre></div><hr><h2 id=-wssworking-set-size><strong>ğŸ“Œ WSSï¼ˆWorking Set Sizeï¼‰</strong>
<a class=anchor href=#-wssworking-set-size>#</a></h2><ul><li><strong>WSS æ˜¯è¿›ç¨‹åœ¨ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„å†…å­˜å¤§å°</strong>ã€‚</li><li>åªç»Ÿè®¡<strong>æ´»è·ƒ</strong>çš„å†…å­˜é¡µï¼Œæœªè®¿é—®çš„éƒ¨åˆ†ä¸ç®— WSSã€‚</li><li>åŒ…æ‹¬ï¼š<ul><li>è¿›ç¨‹åœ¨çŸ­æ—¶é—´çª—å£å†…è®¿é—®çš„é¡µã€‚</li><li>å¯èƒ½ä¼šè¢«é¢‘ç¹è°ƒå…¥ç‰©ç†å†…å­˜çš„éƒ¨åˆ†ã€‚</li></ul></li></ul><p>âœ… <strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>è¯„ä¼°è¿›ç¨‹å®é™…éœ€è¦çš„å†…å­˜ï¼Œé¿å…è¿‡åº¦åˆ†é…æˆ– OOMï¼ˆOut of Memoryï¼‰ã€‚</li><li>ç”¨äº Kubernetes <code>memory.working_set_bytes</code> æŒ‡æ ‡ã€‚</li></ul><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>cgroup</code> ç›‘æ§ WSS</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /sys/fs/cgroup/memory/kubepods/burstable/pod*/memory.working_set_bytes
</span></span></code></pre></div><hr><h2 id=-wss-vs-rss-æ€»ç»“><strong>ğŸ“Œ WSS vs. RSS æ€»ç»“</strong>
<a class=anchor href=#-wss-vs-rss-%e6%80%bb%e7%bb%93>#</a></h2><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th><th>è®¡ç®—æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>RSS</strong></td><td>å®é™…å ç”¨çš„ç‰©ç†å†…å­˜</td><td><code>VmRSS</code></td><td>ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé¿å…è¶…é…</td></tr><tr><td><strong>WSS</strong></td><td>é¢‘ç¹è®¿é—®çš„å†…å­˜</td><td><code>memory.working_set_bytes</code></td><td>ä¼°ç®—åº”ç”¨å®é™…éœ€è¦çš„å†…å­˜</td></tr></tbody></table><hr><h2 id=-kubernetes-ç›¸å…³><strong>ğŸ“Œ Kubernetes ç›¸å…³</strong>
<a class=anchor href=#-kubernetes-%e7%9b%b8%e5%85%b3>#</a></h2><ul><li><code>memory.usage_bytes</code> â‰ˆ RSS</li><li><code>memory.working_set_bytes</code> â‰ˆ WSS</li><li>ç›‘æ§æ—¶ï¼Œå¦‚æœ <strong>RSS è¿œå¤§äº WSS</strong>ï¼Œè¯´æ˜æœ‰<strong>å¾ˆå¤šæœªä½¿ç”¨çš„å†…å­˜</strong>ï¼Œå¯ä»¥ä¼˜åŒ–èµ„æºåˆ†é…ã€‚</li></ul><hr><p>ğŸš€ <strong>æ€»ç»“</strong></p><ul><li><strong>RSS = è¿›ç¨‹å®é™…å ç”¨çš„ç‰©ç†å†…å­˜</strong></li><li><strong>WSS = è¿›ç¨‹æ´»è·ƒè®¿é—®çš„å†…å­˜</strong></li><li><strong>WSS &lt; RSS</strong>ï¼Œå› ä¸º RSS è¿˜åŒ…æ‹¬æœªä½¿ç”¨ä½†é©»ç•™åœ¨ç‰©ç†å†…å­˜ä¸­çš„éƒ¨åˆ†ã€‚</li></ul><h2 id=ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡>ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡
<a class=anchor href=#%e7%9b%91%e6%8e%a7%e5%9b%9b%e4%b8%aa%e9%bb%84%e9%87%91%e6%8c%87%e6%a0%87>#</a></h2><p><strong>ç›‘æ§çš„å››ä¸ªé»„é‡‘æŒ‡æ ‡ï¼ˆFour Golden Signalsï¼‰</strong> æ˜¯ Google SREï¼ˆSite Reliability Engineeringï¼‰å®è·µä¸­æå‡ºçš„æ ¸å¿ƒç›‘æ§åŸåˆ™ï¼Œç”¨äºè¡¡é‡ç³»ç»Ÿçš„å¥åº·çŠ¶å†µå’Œæ€§èƒ½ã€‚è¿™å››ä¸ªæŒ‡æ ‡åˆ†åˆ«æ˜¯ï¼š<strong>Latencyï¼ˆå»¶è¿Ÿï¼‰ã€Trafficï¼ˆæµé‡ï¼‰ã€Errorsï¼ˆé”™è¯¯ï¼‰ã€Saturationï¼ˆé¥±å’Œåº¦ï¼‰</strong>ã€‚</p><hr><h2 id=-1-latencyå»¶è¿Ÿ><strong>ğŸ“Œ 1. Latencyï¼ˆå»¶è¿Ÿï¼‰</strong>
<a class=anchor href=#-1-latency%e5%bb%b6%e8%bf%9f>#</a></h2><p><strong>å®šä¹‰</strong>ï¼šæŒ‡è¯·æ±‚ä»å‘å‡ºåˆ°æ”¶åˆ°å“åº”çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>æˆåŠŸè¯·æ±‚çš„å»¶è¿Ÿï¼ˆæˆåŠŸå“åº”æ—¶é—´ï¼‰</strong></li><li><strong>å¤±è´¥è¯·æ±‚çš„å»¶è¿Ÿï¼ˆé”™è¯¯å“åº”æ—¶é—´ï¼‰</strong></li></ul><p><strong>ç›‘æ§æ–¹å¼</strong>ï¼š</p><ul><li>P99/P95/P50ï¼ˆç™¾åˆ†ä½ï¼‰å»¶è¿Ÿï¼š<ul><li>P99 å»¶è¿Ÿï¼šæœ€æ…¢çš„ 1% è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œä»£è¡¨æœ€å·®ç”¨æˆ·ä½“éªŒ</li><li>P95 å»¶è¿Ÿï¼šæœ€æ…¢çš„ 5% è¯·æ±‚</li><li>P50 å»¶è¿Ÿï¼ˆä¸­ä½æ•°ï¼‰ï¼šä¸€åŠè¯·æ±‚çš„å»¶è¿Ÿæƒ…å†µ</li></ul></li><li><strong>åŒºåˆ†æ­£å¸¸è¯·æ±‚å’Œå¤±è´¥è¯·æ±‚çš„å»¶è¿Ÿ</strong></li><li><strong>ç›‘æ§ HTTP/gRPC å“åº”æ—¶é—´</strong></li></ul><p><strong>Prometheus ç›‘æ§ç¤ºä¾‹</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))</span>
</span></span></code></pre></div><hr><h2 id=-2-trafficæµé‡><strong>ğŸ“Œ 2. Trafficï¼ˆæµé‡ï¼‰</strong>
<a class=anchor href=#-2-traffic%e6%b5%81%e9%87%8f>#</a></h2><p><strong>å®šä¹‰</strong>ï¼šç³»ç»Ÿçš„è¯·æ±‚é€Ÿç‡æˆ–å¸¦å®½ä½¿ç”¨æƒ…å†µï¼Œåæ˜ äº†è´Ÿè½½ã€‚</p><p><strong>ç›‘æ§æ–¹å¼</strong>ï¼š</p><ul><li><p>HTTP/gRPC è¯·æ±‚æ•°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(http_requests_total[5m])</span>
</span></span></code></pre></div></li><li><p>ååé‡ï¼ˆTPS/QPSï¼‰ï¼š</p><ul><li>TPSï¼ˆTransaction Per Secondï¼‰ï¼šäº‹åŠ¡å¤„ç†é€Ÿç‡</li><li>QPSï¼ˆQuery Per Secondï¼‰ï¼šæŸ¥è¯¢é€Ÿç‡</li></ul></li><li><p>å¸¦å®½ç›‘æ§ï¼ˆæµé‡å¤§å°ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(node_network_receive_bytes_total[5m])</span>
</span></span></code></pre></div></li></ul><hr><h2 id=-3-errorsé”™è¯¯ç‡><strong>ğŸ“Œ 3. Errorsï¼ˆé”™è¯¯ç‡ï¼‰</strong>
<a class=anchor href=#-3-errors%e9%94%99%e8%af%af%e7%8e%87>#</a></h2><p><strong>å®šä¹‰</strong>ï¼šè¯·æ±‚å¤±è´¥ç‡æˆ–é”™è¯¯æ•°ï¼Œè¡¡é‡ç³»ç»Ÿçš„å¥åº·çŠ¶å†µã€‚</p><p><strong>ç›‘æ§æ–¹å¼</strong>ï¼š</p><ul><li><p>HTTP 5xx é”™è¯¯ç‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(http_requests_total{status=~&#34;5..&#34;}[5m]) / rate(http_requests_total[5m])</span>
</span></span></code></pre></div></li><li><p><strong>gRPC é”™è¯¯ç åˆ†å¸ƒ</strong></p></li><li><p><strong>åº”ç”¨çº§é”™è¯¯ï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢å¤±è´¥</strong></p></li><li><p><strong>Kubernetes äº‹ä»¶ã€OOMï¼ˆOut Of Memoryï¼‰ç›‘æ§</strong></p></li></ul><hr><h2 id=-4-saturationé¥±å’Œåº¦><strong>ğŸ“Œ 4. Saturationï¼ˆé¥±å’Œåº¦ï¼‰</strong>
<a class=anchor href=#-4-saturation%e9%a5%b1%e5%92%8c%e5%ba%a6>#</a></h2><p><strong>å®šä¹‰</strong>ï¼šç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼Œè¡¡é‡ç“¶é¢ˆæ˜¯å¦å‡ºç°ã€‚</p><p><strong>ç›‘æ§æ–¹å¼</strong>ï¼š</p><ul><li><p>CPU åˆ©ç”¨ç‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(node_cpu_seconds_total{mode=&#34;user&#34;}[5m]) / sum(rate(node_cpu_seconds_total[5m]))</span>
</span></span></code></pre></div></li><li><p>å†…å­˜ä½¿ç”¨ç‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>node_memory_Active_bytes / node_memory_MemTotal_bytes</span>
</span></span></code></pre></div></li><li><p>ç£ç›˜ I/O</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(node_disk_read_bytes_total[5m])</span>
</span></span></code></pre></div></li><li><p>ç½‘ç»œå¸¦å®½</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(node_network_transmit_bytes_total[5m])</span>
</span></span></code></pre></div></li></ul><hr><h2 id=-æ€»ç»“-1><strong>ğŸ“Œ æ€»ç»“</strong>
<a class=anchor href=#-%e6%80%bb%e7%bb%93-1>#</a></h2><table><thead><tr><th>æŒ‡æ ‡</th><th>è§£é‡Š</th><th>ç›‘æ§æ–¹å¼</th></tr></thead><tbody><tr><td><strong>Latencyï¼ˆå»¶è¿Ÿï¼‰</strong></td><td>è¯·æ±‚å¤„ç†æ—¶é—´</td><td>HTTP å“åº”æ—¶é—´ã€P99 å»¶è¿Ÿ</td></tr><tr><td><strong>Trafficï¼ˆæµé‡ï¼‰</strong></td><td>è¯·æ±‚é‡ã€å¸¦å®½</td><td>QPSã€TPSã€ç½‘ç»œæµé‡</td></tr><tr><td><strong>Errorsï¼ˆé”™è¯¯ç‡ï¼‰</strong></td><td>å¤±è´¥è¯·æ±‚å æ¯”</td><td>HTTP 5xxã€gRPC é”™è¯¯ç‡</td></tr><tr><td><strong>Saturationï¼ˆé¥±å’Œåº¦ï¼‰</strong></td><td>èµ„æºåˆ©ç”¨ç‡</td><td>CPUã€å†…å­˜ã€ç£ç›˜ I/O</td></tr></tbody></table><p>ğŸš€ <strong>æœ€ä½³å®è·µ</strong></p><ul><li>ç»“åˆ Prometheus + Grafana è¿›è¡Œå¯è§†åŒ–ç›‘æ§</li><li>è®¾å®šå‘Šè­¦é˜ˆå€¼ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸</li><li>ä½¿ç”¨ <strong>ç™¾åˆ†ä½ï¼ˆP99/P95ï¼‰</strong> è¡¡é‡ç”¨æˆ·ä½“éªŒ</li><li>ç»“åˆ <strong>è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPA/VPAï¼‰</strong> è¿›è¡Œä¼˜åŒ–</li></ul><p>è¿™äº›æŒ‡æ ‡å¯ä»¥å¸®åŠ© SRE/DevOps å·¥ç¨‹å¸ˆå¿«é€Ÿè¯†åˆ«ç³»ç»Ÿç“¶é¢ˆï¼Œæå‡ç¨³å®šæ€§ï¼ğŸ’ª</p><h2 id=åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹å¦‚ä½•ä¼˜åŒ–prometheusæ€§èƒ½>åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¼˜åŒ–Prometheusæ€§èƒ½
<a class=anchor href=#%e5%9c%a8%e5%a4%a7%e8%a7%84%e6%a8%a1%e7%8e%af%e5%a2%83%e4%b8%8b%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96prometheus%e6%80%a7%e8%83%bd>#</a></h2><p>åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹ï¼ŒPrometheus çš„æ€§èƒ½ä¼˜åŒ–éå¸¸é‡è¦ï¼Œå› ä¸ºéšç€ç›‘æ§æ•°æ®é‡çš„å¢åŠ ï¼ŒPrometheus å¯èƒ½ä¼šé¢ä¸´å­˜å‚¨å’ŒæŸ¥è¯¢å»¶è¿Ÿç­‰é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æå‡ Prometheus çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼š</p><h3 id=1-åˆ†å¸ƒå¼æ¶æ„è®¾è®¡><strong>1. åˆ†å¸ƒå¼æ¶æ„è®¾è®¡</strong>
<a class=anchor href=#1-%e5%88%86%e5%b8%83%e5%bc%8f%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1>#</a></h3><p>åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­ï¼Œå•ä¸ª Prometheus å®ä¾‹å¯èƒ½æ— æ³•æ‰¿è½½åºå¤§çš„ç›‘æ§æ•°æ®é‡ã€‚å› æ­¤ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„è¿›è¡Œæ°´å¹³æ‰©å±•æ˜¯éå¸¸é‡è¦çš„ã€‚</p><ul><li><p><strong>ä½¿ç”¨ Prometheus é«˜å¯ç”¨æ€§æ¶æ„</strong>ï¼šé€šè¿‡å¤šä¸ª Prometheus å®ä¾‹æ¥æé«˜å®¹é”™èƒ½åŠ›å’Œæ‰©å±•æ€§ã€‚å¯ä»¥é€šè¿‡ <strong>Prometheus Federationï¼ˆè”é‚¦ï¼‰</strong> æˆ– <strong>Thanos</strong>ã€<strong>Cortex</strong> ç­‰å·¥å…·æ¥å®ç°æ•°æ®çš„èšåˆå’Œè·¨é›†ç¾¤æŸ¥è¯¢ã€‚</p></li><li><p><strong>Federationï¼ˆè”é‚¦ï¼‰</strong>ï¼šPrometheus çš„è”é‚¦æ¨¡å¼å…è®¸ä½ åœ¨å¤šä¸ª Prometheus å®ä¾‹é—´èšåˆæ•°æ®ã€‚ä¸» Prometheus å®ä¾‹ä»å­å®ä¾‹ä¸­æ‹‰å–éƒ¨åˆ†æ•°æ®ï¼Œæä¾›å…¨å±€è§†å›¾ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;federation&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>honor_labels</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;prometheus-01:9090&#39;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;prometheus-02:9090&#39;</span>
</span></span></code></pre></div></li><li><p><strong>Thanos æˆ– Cortex</strong>ï¼šå®ƒä»¬æ˜¯ Prometheus çš„æ‰©å±•ç³»ç»Ÿï¼Œé€šè¿‡å°†æ•°æ®åˆ†ç‰‡å’Œå­˜å‚¨åœ¨å¤–éƒ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼Œæä¾›æ›´å¥½çš„æ‰©å±•æ€§å’Œé•¿æœŸå­˜å‚¨ã€‚</p></li></ul><hr><h3 id=2-æ•°æ®å­˜å‚¨ä¼˜åŒ–><strong>2. æ•°æ®å­˜å‚¨ä¼˜åŒ–</strong>
<a class=anchor href=#2-%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e4%bc%98%e5%8c%96>#</a></h3><p>å­˜å‚¨æ˜¯ Prometheus æ€§èƒ½ç“¶é¢ˆçš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚é€šè¿‡åˆç†é…ç½®å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆæé«˜ Prometheus æ€§èƒ½ã€‚</p><ul><li><p><strong>è°ƒæ•´ Retention æ—¶é—´</strong>ï¼šå‡å°‘æ•°æ®ä¿ç•™æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸éœ€è¦å­˜å‚¨å†å²æ•°æ®æ—¶ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®è¾ƒçŸ­çš„ <code>--storage.tsdb.retention.time</code> æ¥æ§åˆ¶ä¿ç•™çš„æ•°æ®æ—¶é—´ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>--<span style=color:#ae81ff>storage.tsdb.retention.time=15d</span>
</span></span></code></pre></div></li><li><p><strong>è°ƒæ•´ Block å¤§å°</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒPrometheus ä¼šå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªå—ï¼ˆblocksï¼‰ï¼Œæ¯ä¸ªå—é»˜è®¤å¤§å°ä¸º 2GBã€‚ä½ å¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´ <code>--storage.tsdb.block-duration</code> å‚æ•°ï¼Œä»¥å¢åŠ æˆ–å‡å°‘æ¯ä¸ªå—çš„å¤§å°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>--<span style=color:#ae81ff>storage.tsdb.block-duration=2h</span>
</span></span></code></pre></div></li><li><p><strong>ä½¿ç”¨ SSD å­˜å‚¨</strong>ï¼šå°† Prometheus æ•°æ®å­˜å‚¨æ”¾åœ¨ SSD ä¸Šå¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å†™å…¥å’ŒæŸ¥è¯¢è´Ÿè½½è¾ƒé«˜çš„æƒ…å†µä¸‹ã€‚</p></li><li><p><strong>é€‚å½“è°ƒæ•´ WALï¼ˆWrite-Ahead Logï¼‰è®¾ç½®</strong>ï¼šé€šè¿‡é…ç½® Prometheus çš„å†™å‰æ—¥å¿—ï¼Œå¯ä»¥å‡å°‘ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°ï¼Œæé«˜å†™å…¥æ€§èƒ½ã€‚</p></li></ul><hr><h3 id=3-æŸ¥è¯¢ä¼˜åŒ–><strong>3. æŸ¥è¯¢ä¼˜åŒ–</strong>
<a class=anchor href=#3-%e6%9f%a5%e8%af%a2%e4%bc%98%e5%8c%96>#</a></h3><p>å¯¹äºå¤§è§„æ¨¡çš„ç¯å¢ƒï¼ŒPrometheus æŸ¥è¯¢çš„æ•ˆç‡è‡³å…³é‡è¦ã€‚é€šè¿‡ä¼˜åŒ–æŸ¥è¯¢ï¼Œå‡å°‘é«˜å¼€é”€æŸ¥è¯¢çš„æ¬¡æ•°ï¼Œå¯ä»¥å¤§å¤§æé«˜æ€§èƒ½ã€‚</p><ul><li><p><strong>é¿å…é«˜æ—¶é—´èŒƒå›´çš„æŸ¥è¯¢</strong>ï¼šæŸ¥è¯¢è¿‡é•¿æ—¶é—´èŒƒå›´çš„æ•°æ®ä¼šå¢åŠ æŸ¥è¯¢è´Ÿè½½ï¼Œåº”å°½é‡é¿å…ä¸€æ¬¡æ€§æŸ¥è¯¢è¿‡å¤šæ—¶é—´çš„æ•°æ®ã€‚</p></li><li><p><strong>åˆ†ç‰‡æŸ¥è¯¢ï¼ˆSubqueriesï¼‰</strong>ï¼šé€šè¿‡åˆ†å‰²å¤æ‚æŸ¥è¯¢ä¸ºå¤šä¸ªè¾ƒå°çš„æŸ¥è¯¢æ¥é¿å…æ€§èƒ½ç“¶é¢ˆï¼Œåˆ†ç‰‡æŸ¥è¯¢å¯ä»¥å‡è½»æ•°æ®åº“è´Ÿè½½ã€‚</p></li><li><p><strong>é¢„è®¡ç®—å’Œèšåˆ</strong>ï¼šä½¿ç”¨ <strong>Recording Rules</strong> æ¥æå‰è®¡ç®—å’Œå­˜å‚¨æŸäº›å¸¸è§çš„èšåˆæ•°æ®ï¼Œä»¥å‡å°‘æŸ¥è¯¢æ—¶çš„è®¡ç®—å‹åŠ›ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>rule_files</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;recording_rules.yml&#34;</span>
</span></span></code></pre></div></li><li><p><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šä½¿ç”¨ <strong>Prometheus Query Caching</strong> æ¥ç¼“å­˜çƒ­ç‚¹æŸ¥è¯¢çš„ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</p></li></ul><hr><h3 id=4-è°ƒæ•´-scrape-é…ç½®><strong>4. è°ƒæ•´ Scrape é…ç½®</strong>
<a class=anchor href=#4-%e8%b0%83%e6%95%b4-scrape-%e9%85%8d%e7%bd%ae>#</a></h3><p>Prometheus çš„æ‹‰å–é¢‘ç‡å’Œæ•°æ®é‡ä¹Ÿä¼šå½±å“æ€§èƒ½ã€‚è°ƒæ•´é‡‡é›†ï¼ˆscrapeï¼‰é…ç½®ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘è´Ÿè½½ã€‚</p><ul><li><p><strong>å‡å°‘ Scrape é¢‘ç‡</strong>ï¼šæ ¹æ®éœ€æ±‚é€‚å½“å¢åŠ  <code>scrape_interval</code>ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸éœ€è¦å®æ—¶æ›´æ–°çš„æŒ‡æ ‡ï¼Œå¯ä»¥è®¾ç½®è¾ƒé•¿çš„é—´éš”æ—¶é—´ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;my_job&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>60s </span> <span style=color:#75715e># é»˜è®¤ä¸º 15s</span>
</span></span></code></pre></div></li><li><p><strong>ä½¿ç”¨é‡‡é›†è¿‡æ»¤</strong>ï¼šé€šè¿‡è¿‡æ»¤ä¸éœ€è¦çš„æŒ‡æ ‡ï¼Œå‡å°‘ Prometheus æ‹‰å–çš„æ•°æ®é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ <code>metric_relabel_configs</code> æ¥æ’é™¤ä¸å¿…è¦çš„æŒ‡æ ‡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>metric_relabel_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__name__]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*_unused_metric&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#ae81ff>drop</span>
</span></span></code></pre></div></li><li><p><strong>å¢åŠ  Target æ•°é‡</strong>ï¼šåœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹ï¼Œç¡®ä¿ Prometheus è¶³å¤Ÿå¼ºå¤§ä»¥å¤„ç†å¤šä¸ª target çš„æ•°æ®æ‹‰å–ï¼Œå¯ä»¥é€šè¿‡ <code>scrape_timeout</code> å’Œ <code>scrape_interval</code> é…ç½®æ¥å¹³è¡¡æ‹‰å–æ•°æ®çš„é€Ÿç‡ã€‚</p></li></ul><hr><h3 id=5-ä½¿ç”¨-external-storage><strong>5. ä½¿ç”¨ External Storage</strong>
<a class=anchor href=#5-%e4%bd%bf%e7%94%a8-external-storage>#</a></h3><p>å¯¹äºé•¿æœŸå­˜å‚¨éœ€æ±‚è¾ƒé«˜çš„ç¯å¢ƒï¼Œå¯ä»¥å°† Prometheus æ•°æ®å­˜å‚¨è¿ç§»åˆ°å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚ <strong>Thanos</strong>ã€<strong>Cortex</strong> ç­‰ï¼Œä»¥å‡è½» Prometheus çš„å­˜å‚¨å‹åŠ›ã€‚</p><ul><li><strong>Thanos / Cortex</strong>ï¼šå°† Prometheus æ•°æ®æµå¼å­˜å‚¨åˆ°å¤–éƒ¨å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ S3ã€GCSï¼‰ä¸­ï¼Œå¹¶ä¸”æä¾›æŸ¥è¯¢å’Œæ•°æ®æŒä¹…åŒ–åŠŸèƒ½ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒPrometheus ä»…éœ€è¦å¤„ç†å½“å‰çš„ç›‘æ§æ•°æ®ï¼Œå‡å°‘å­˜å‚¨è´Ÿæ‹…ã€‚</li><li><strong>Prometheus + InfluxDB</strong>ï¼šå°†é•¿æœŸå­˜å‚¨çš„æŒ‡æ ‡æ•°æ®è¿ç§»åˆ° InfluxDB æˆ–å…¶ä»–æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œä»¥ä¾¿ Prometheus ä¸“æ³¨äºçŸ­æœŸå†…çš„æŒ‡æ ‡æŸ¥è¯¢ã€‚</li></ul><hr><h3 id=6-ä¼˜åŒ–-alerting-å’Œ-rules><strong>6. ä¼˜åŒ– Alerting å’Œ Rules</strong>
<a class=anchor href=#6-%e4%bc%98%e5%8c%96-alerting-%e5%92%8c-rules>#</a></h3><p>Prometheus ä¸­çš„å‘Šè­¦è§„åˆ™å’Œè®°å½•è§„åˆ™å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½å‹åŠ›ã€‚é€šè¿‡ä¼˜åŒ–å‘Šè­¦è§„åˆ™å’Œå‡è½»å‘Šè­¦çš„è®¡ç®—è´Ÿæ‹…ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚</p><ul><li><p><strong>ä¼˜åŒ– Alerting è§„åˆ™</strong>ï¼šé¿å…è¿‡äºå¤æ‚çš„å‘Šè­¦æ¡ä»¶ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œé¿å…æ¯ä¸ªæ—¶åˆ»éƒ½è§¦å‘çš„å‘Šè­¦ï¼Œå¯ä»¥è®¾å®šæ›´é«˜çš„é˜ˆå€¼ã€‚</p></li><li><p><strong>å‡å°‘å‘Šè­¦é¢‘ç‡</strong>ï¼šä½¿ç”¨ <code>for</code> å‚æ•°ï¼Œé¿å…å› ä¸´æ—¶æ³¢åŠ¨è§¦å‘è¿‡å¤šå‘Šè­¦ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighErrorRate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>rate(http_requests_total{status=&#34;500&#34;}[5m]) &gt; 0.05</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>for</span>: <span style=color:#ae81ff>10m </span> <span style=color:#75715e># åœ¨ 10 åˆ†é’Ÿå†…æŒç»­è§¦å‘å‘Šè­¦æ‰æœ‰æ•ˆ</span>
</span></span></code></pre></div></li></ul><hr><h3 id=7-é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡><strong>7. é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡</strong>
<a class=anchor href=#7-%e9%ab%98%e5%8f%af%e7%94%a8%e5%92%8c%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1>#</a></h3><p>åœ¨å¤§è§„æ¨¡éƒ¨ç½²ä¸­ï¼Œç¡®ä¿ Prometheus çš„é«˜å¯ç”¨æ€§éå¸¸é‡è¦ã€‚å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š</p><ul><li><strong>ä½¿ç”¨å¤šä¸ª Prometheus å®ä¾‹</strong>ï¼šåˆ†å¸ƒå¼éƒ¨ç½²å¤šä¸ª Prometheus å®ä¾‹ï¼Œæé«˜æ•°æ®çš„é‡‡é›†èƒ½åŠ›ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šé€šè¿‡è´Ÿè½½å‡è¡¡å™¨æ¥åˆ†æ‹… Prometheus é‡‡é›†ç›®æ ‡ï¼ˆtargetsï¼‰çš„è´Ÿè½½ã€‚</li></ul><hr><h3 id=æ€»ç»“-4><strong>æ€»ç»“ï¼š</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-4>#</a></h3><p>ä¼˜åŒ– Prometheus æ€§èƒ½æ—¶ï¼Œè¦ä»å­˜å‚¨ã€æŸ¥è¯¢ã€é‡‡é›†é…ç½®ç­‰å¤šä¸ªæ–¹é¢å…¥æ‰‹ã€‚é’ˆå¯¹å¤§è§„æ¨¡ç¯å¢ƒï¼Œé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼ˆå¦‚ Federationã€Thanos æˆ– Cortexï¼‰ã€ä¼˜åŒ–å­˜å‚¨ï¼ˆSSDã€Retain è®¾ç½®ï¼‰ã€åˆç†é…ç½®æŸ¥è¯¢å’Œé‡‡é›†ç­–ç•¥ã€ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ç­‰éƒ½å¯ä»¥æœ‰æ•ˆæå‡æ€§èƒ½ã€‚åŒæ—¶ï¼Œç›‘æ§ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ä¹Ÿæ˜¯ç¡®ä¿ç¨³å®šè¿è¡Œçš„å…³é”®ã€‚</p><h2 id=å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”>å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”â˜†
<a class=anchor href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e5%91%8a%e8%ad%a6%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e5%93%8d%e5%ba%94>#</a></h2><p>å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”æ˜¯ DevOps å’Œ SREï¼ˆSite Reliability Engineeringï¼‰å®è·µä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œèƒ½å¤Ÿåœ¨é—®é¢˜å‘ç”Ÿæ—¶å¿«é€Ÿé‡‡å–è¡ŒåŠ¨ï¼Œå‡å°‘æ‰‹åŠ¨å¹²é¢„å’Œå“åº”æ—¶é—´ã€‚ä»¥ä¸‹æ˜¯å®ç°å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”çš„ä¸€äº›æ–¹æ³•å’Œæœ€ä½³å®è·µï¼š</p><h3 id=1-ä½¿ç”¨-prometheus--alertmanager-é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”><strong>1. ä½¿ç”¨ Prometheus + Alertmanager é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”</strong>
<a class=anchor href=#1-%e4%bd%bf%e7%94%a8-prometheus--alertmanager-%e9%85%8d%e7%bd%ae%e5%91%8a%e8%ad%a6%e8%87%aa%e5%8a%a8%e5%8c%96%e5%93%8d%e5%ba%94>#</a></h3><p>Prometheus ä¸ Alertmanager é…åˆä½¿ç”¨æ˜¯æœ€å¸¸è§çš„å‘Šè­¦ç³»ç»Ÿã€‚åœ¨å‘Šè­¦è§¦å‘åï¼ŒAlertmanager å¯ä»¥æ ¹æ®é…ç½®å°†å‘Šè­¦å‘é€åˆ°æŒ‡å®šçš„æ¥æ”¶å™¨ï¼ˆå¦‚ç”µå­é‚®ä»¶ã€Slackã€Webhook ç­‰ï¼‰ã€‚å¯ä»¥åœ¨å‘Šè­¦é€šçŸ¥ä¸­é›†æˆè‡ªåŠ¨åŒ–å“åº”æµç¨‹ã€‚</p><h4 id=æ­¥éª¤><strong>æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e6%ad%a5%e9%aa%a4>#</a></h4><ol><li><p><strong>è®¾ç½® Prometheus å‘Šè­¦è§„åˆ™</strong>ï¼šé¦–å…ˆï¼Œè®¾ç½®å‘Šè­¦è§„åˆ™ï¼Œç”¨äºæ£€æµ‹å¼‚å¸¸æƒ…å†µã€‚æ¯”å¦‚ï¼Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶è§¦å‘å‘Šè­¦ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighCpuUsage</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>avg(rate(cpu_usage_seconds_total[1m])) by (instance) &gt; 0.9</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>for</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;CPU usage is high on {{ $labels.instance }}&#34;</span>
</span></span></code></pre></div></li><li><p><strong>é…ç½® Alertmanager</strong>ï¼šé…ç½® Alertmanager æ¥å¤„ç†å‘Šè­¦å¹¶å°†å…¶å‘é€åˆ°ä¸åŒçš„é€šçŸ¥æ¸ é“ã€‚å‘Šè­¦å¯ä»¥è§¦å‘ Slackã€PagerDuty æˆ– Webhook ç­‰è‡ªåŠ¨åŒ–å“åº”æœºåˆ¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_by</span>: [<span style=color:#e6db74>&#39;alertname&#39;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#39;slack&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;slack&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>slack_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>api_url</span>: <span style=color:#e6db74>&#39;https://slack.com/api/alerts&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>channel</span>: <span style=color:#e6db74>&#39;#alerts&#39;</span>
</span></span></code></pre></div></li><li><p><strong>Webhook é›†æˆ</strong>ï¼šä¸ºäº†å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”ï¼Œå¯ä»¥é€šè¿‡é…ç½® Alertmanager çš„ Webhook æ¥æ”¶å™¨æ¥è§¦å‘è‡ªå®šä¹‰çš„è‡ªåŠ¨åŒ–å“åº”è„šæœ¬æˆ–å¤–éƒ¨å·¥å…·ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;webhook-receiver&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>webhook_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#39;http://your-service.example.com/alert&#39;</span>
</span></span></code></pre></div></li><li><p><strong>è‡ªåŠ¨åŒ–å“åº”</strong>ï¼šåœ¨å‘Šè­¦è§¦å‘æ—¶ï¼ŒWebhook ä¼šé€šçŸ¥æŒ‡å®šçš„ URLã€‚ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ª Web æœåŠ¡æ¥æ¥æ”¶è¿™äº› Webhook é€šçŸ¥ï¼Œå¹¶æ ¹æ®å‘Šè­¦ä¿¡æ¯è‡ªåŠ¨æ‰§è¡Œå“åº”æ“ä½œï¼Œä¾‹å¦‚ï¼š</p><ul><li>è‡ªåŠ¨é‡å¯æ•…éšœçš„ Pod æˆ–æœåŠ¡</li><li>è°ƒæ•´è´Ÿè½½å‡è¡¡é…ç½®</li><li>æ‰§è¡Œä¸€ç»„ä¿®å¤è„šæœ¬</li></ul></li></ol><h3 id=2-é›†æˆè‡ªåŠ¨åŒ–å·¥å…·å¦‚-ansibleterraformè¿›è¡Œå“åº”><strong>2. é›†æˆè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ Ansibleã€Terraformï¼‰è¿›è¡Œå“åº”</strong>
<a class=anchor href=#2-%e9%9b%86%e6%88%90%e8%87%aa%e5%8a%a8%e5%8c%96%e5%b7%a5%e5%85%b7%e5%a6%82-ansibleterraform%e8%bf%9b%e8%a1%8c%e5%93%8d%e5%ba%94>#</a></h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œå¦‚æ‰©å±•åŸºç¡€è®¾æ–½æˆ–æ‰§è¡Œä¿®å¤æ“ä½œã€‚å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚ <strong>Ansible</strong> æˆ– <strong>Terraform</strong> æ¥å®ç°è‡ªåŠ¨åŒ–å“åº”ã€‚</p><h4 id=æ­¥éª¤-1><strong>æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-1>#</a></h4><ol><li><p><strong>é…ç½®å‘Šè­¦è§¦å‘ Webhook</strong>ï¼šå°† Alertmanager é…ç½®ä¸ºè§¦å‘ Webhookã€‚</p></li><li><p><strong>ç¼–å†™è‡ªåŠ¨åŒ–å“åº”è„šæœ¬</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ¥æ”¶å‘Šè­¦ Webhook çš„ HTTP æœåŠ¡ï¼Œè§£æå‘Šè­¦ä¿¡æ¯ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å‘Šè­¦ç±»å‹æ‰§è¡Œç›¸åº”çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Ansible è¿è¡Œä¿®å¤è„šæœ¬æˆ–æ‰©å®¹å‘½ä»¤ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/alert&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>alert</span>():
</span></span><span style=display:flex><span>    alert_data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(request<span style=color:#f92672>.</span>data)
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ ¹æ®å‘Šè­¦ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> alert_data[<span style=color:#e6db74>&#39;alertname&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;HighCpuUsage&#39;</span>:
</span></span><span style=display:flex><span>        subprocess<span style=color:#f92672>.</span>call([<span style=color:#e6db74>&#34;ansible-playbook&#34;</span>, <span style=color:#e6db74>&#34;fix-cpu-issue.yml&#34;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> alert_data[<span style=color:#e6db74>&#39;alertname&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;HighMemoryUsage&#39;</span>:
</span></span><span style=display:flex><span>        subprocess<span style=color:#f92672>.</span>call([<span style=color:#e6db74>&#34;ansible-playbook&#34;</span>, <span style=color:#e6db74>&#34;fix-memory-issue.yml&#34;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;OK&#39;</span>, <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, port<span style=color:#f92672>=</span><span style=color:#ae81ff>5000</span>)
</span></span></code></pre></div></li><li><p><strong>é€šè¿‡ Ansible æ‰§è¡Œæ“ä½œ</strong>ï¼šåœ¨å‘Šè­¦è§¦å‘æ—¶ï¼Œè‡ªåŠ¨è¿è¡Œ Ansible Playbook æ¥ä¿®å¤é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡æˆ–æ‰©å±•å®¹å™¨å‰¯æœ¬ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Restart High CPU Service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Restart Pod</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kubernetes.core.k8s</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>state</span>: <span style=color:#ae81ff>restarted</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-service</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>kubeconfig</span>: <span style=color:#ae81ff>/path/to/kubeconfig</span>
</span></span></code></pre></div></li><li><p><strong>è‡ªåŠ¨åŒ–æ‰©å®¹</strong>ï¼šåœ¨å‘Šè­¦è§¦å‘æ—¶ï¼Œè‡ªåŠ¨æ‰©å®¹åº”ç”¨æœåŠ¡ï¼Œä»¥åº”å¯¹æ›´é«˜çš„è´Ÿè½½ã€‚å¯ä»¥ä½¿ç”¨ Terraform æ¥æ‰©å±•åŸºç¡€è®¾æ–½èµ„æºï¼Œå¦‚ EC2 å®ä¾‹æˆ– Kubernetes èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34; &#34;web&#34;</span> {
</span></span><span style=display:flex><span>  ami <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ami-0c55b159cbfafe1f0&#34;</span>
</span></span><span style=display:flex><span>  instance_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><h3 id=3-é›†æˆ-chatops-è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”><strong>3. é›†æˆ ChatOps è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”</strong>
<a class=anchor href=#3-%e9%9b%86%e6%88%90-chatops-%e8%bf%9b%e8%a1%8c%e8%87%aa%e5%8a%a8%e5%8c%96%e5%93%8d%e5%ba%94>#</a></h3><p>ChatOps é€šè¿‡å°†æ“ä½œè‡ªåŠ¨åŒ–ä¸èŠå¤©å·¥å…·ï¼ˆå¦‚ Slackã€Microsoft Teamsï¼‰é›†æˆï¼Œä½¿å¾—å‘Šè­¦å“åº”æ›´åŠ è¿…é€Ÿä¸”å¯è¿½è¸ªã€‚</p><h4 id=æ­¥éª¤-2><strong>æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-2>#</a></h4><ol><li><p><strong>é›†æˆ Slack å’Œ Prometheus Alertmanager</strong>ï¼šé€šè¿‡ Alertmanager é…ç½® Slack ä½œä¸ºå‘Šè­¦æ¥æ”¶å™¨ã€‚</p></li><li><p><strong>ç¼–å†™ ChatOps å‘½ä»¤</strong>ï¼šä½¿ç”¨ Slack çš„æœºå™¨äººï¼ˆä¾‹å¦‚ <strong>Hubot</strong> æˆ– <strong>Lita</strong>ï¼‰æ¥ç›‘å¬å‘Šè­¦ï¼Œå¹¶æ ¹æ®é¢„è®¾å‘½ä»¤è‡ªåŠ¨æ‰§è¡Œå“åº”æ“ä½œã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨èŠå¤©ä¸­è¾“å…¥å‘½ä»¤ï¼Œè§¦å‘è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œä¿®å¤æ“ä½œã€‚</p><p><strong>ç¤ºä¾‹å‘½ä»¤</strong>ï¼š</p><ul><li><code>/restart pod my-app</code>ï¼šé‡å¯å‡ºç°é—®é¢˜çš„ Pod</li><li><code>/scale up my-app</code>ï¼šæ‰©å±•åº”ç”¨å‰¯æœ¬æ•°</li></ul></li><li><p><strong>æ‰§è¡Œè‡ªåŠ¨åŒ–æ“ä½œ</strong>ï¼šé€šè¿‡ä¸ ChatOps æœºå™¨äººé›†æˆçš„è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡ŒåŸºç¡€è®¾æ–½æ“ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨æ‰©å±•èµ„æºã€é‡å¯æ•…éšœèŠ‚ç‚¹ç­‰ã€‚</p></li></ol><h3 id=4-ä½¿ç”¨-kubernetes-operator-è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤><strong>4. ä½¿ç”¨ Kubernetes Operator è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤</strong>
<a class=anchor href=#4-%e4%bd%bf%e7%94%a8-kubernetes-operator-%e8%bf%9b%e8%a1%8c%e8%87%aa%e5%8a%a8%e5%8c%96%e4%bf%ae%e5%a4%8d>#</a></h3><p>Kubernetes Operator æ˜¯ä¸€ç§ç®¡ç† Kubernetes èµ„æºçš„æ¨¡å¼ï¼Œå¯ä»¥è‡ªåŠ¨å“åº”åº”ç”¨ç¨‹åºçš„æ•…éšœã€‚</p><h4 id=æ­¥éª¤-3><strong>æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-3>#</a></h4><ol><li><p><strong>åˆ›å»ºè‡ªå®šä¹‰ Operator</strong>ï¼šå¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰çš„ Operatorï¼Œç”¨äºç›‘æ§ Prometheus å‘Šè­¦å¹¶è‡ªåŠ¨å“åº”ã€‚Operator ç›‘å¬ç‰¹å®šçš„æŒ‡æ ‡æˆ–å‘Šè­¦ï¼Œå½“æŸä¸ªé˜ˆå€¼è¢«è§¦å‘æ—¶ï¼Œè‡ªåŠ¨é‡‡å–è¡ŒåŠ¨ã€‚</p></li><li><p><strong>è‡ªåŠ¨ä¿®å¤åº”ç”¨</strong>ï¼šä¾‹å¦‚ï¼Œåœ¨æŸäº›æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼ŒOperator å¯ä»¥è‡ªåŠ¨é‡å¯ Podï¼Œæˆ–è€…å¢åŠ å‰¯æœ¬æ•°é‡ï¼Œè¿›è¡Œèµ„æºè°ƒåº¦ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-app:latest</span>
</span></span></code></pre></div></li></ol><h3 id=5-ä½¿ç”¨-pagerdutyopsgenie-ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”><strong>5. ä½¿ç”¨ PagerDutyã€OpsGenie ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”</strong>
<a class=anchor href=#5-%e4%bd%bf%e7%94%a8-pagerdutyopsgenie-%e7%ad%89%e5%b7%a5%e5%85%b7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e5%93%8d%e5%ba%94>#</a></h3><p>PagerDuty å’Œ OpsGenie æ˜¯å¸¸ç”¨çš„å‘Šè­¦å“åº”å·¥å…·ï¼Œå¯ä»¥é…ç½®è‡ªåŠ¨åŒ–å“åº”ç­–ç•¥ï¼Œå¦‚è‡ªåŠ¨é‡å¯æœåŠ¡ã€æ‰©å®¹ç­‰ã€‚</p><h4 id=æ­¥éª¤-4><strong>æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-4>#</a></h4><ol><li><strong>é›†æˆå‘Šè­¦é€šçŸ¥</strong>ï¼šé…ç½® Prometheus æˆ–å…¶ä»–ç›‘æ§å·¥å…·å°†å‘Šè­¦å‘é€åˆ° PagerDutyã€OpsGenie ç­‰å·¥å…·ã€‚</li><li><strong>è‡ªåŠ¨åŒ–å“åº”é…ç½®</strong>ï¼šè¿™äº›å·¥å…·æ”¯æŒé€šè¿‡ API æˆ–è‡ªåŠ¨åŒ–è§„åˆ™è§¦å‘å“åº”ã€‚å¯ä»¥é…ç½®è‡ªåŠ¨åˆ›å»ºäº‹ä»¶å¹¶æ ¹æ®å‘Šè­¦ç±»å‹è‡ªåŠ¨æ‰§è¡Œæ“ä½œï¼Œå¦‚å‘é€ç¡®è®¤ã€æ‰§è¡Œæ•…éšœä¿®å¤ç­‰ã€‚</li></ol><hr><h3 id=æ€»ç»“-5><strong>æ€»ç»“ï¼š</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-5>#</a></h3><p>å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”éœ€è¦æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œå·¥å…·é“¾æ¥è®¾è®¡ã€‚å¸¸è§çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨ <strong>Prometheus + Alertmanager</strong> é…ç½®å‘Šè­¦å¹¶é›†æˆ Webhookã€Ansibleã€Terraform ç­‰è‡ªåŠ¨åŒ–å·¥å…·ã€‚</li><li>é€šè¿‡ <strong>ChatOps</strong> å°†å‘Šè­¦å“åº”ä¸èŠå¤©å·¥å…·é›†æˆã€‚</li><li>ä½¿ç”¨ <strong>Kubernetes Operator</strong> è¿›è¡Œè‡ªå®šä¹‰çš„è‡ªåŠ¨åŒ–ä¿®å¤ã€‚</li><li>ä½¿ç”¨å‘Šè­¦ç®¡ç†å·¥å…·ï¼ˆå¦‚ <strong>PagerDuty</strong> æˆ– <strong>OpsGenie</strong>ï¼‰æ¥å“åº”å‘Šè­¦ã€‚</li></ul><p>è‡ªåŠ¨åŒ–å“åº”ä¸ä»…èƒ½å¤Ÿæé«˜è¿ç»´æ•ˆç‡ï¼Œè¿˜èƒ½ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæ—¶è¿…é€Ÿåšå‡ºååº”ï¼Œå‡å°‘ä¸šåŠ¡å½±å“ã€‚</p><h2 id=prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†>Prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†
<a class=anchor href=#prometheus%e6%95%b0%e6%8d%ae%e5%8e%8b%e7%bc%a9%e5%92%8c%e6%8c%81%e4%b9%85%e5%8c%96%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86>#</a></h2><p>Prometheus æ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§ç³»ç»Ÿï¼Œèƒ½å¤Ÿé€šè¿‡æ—¶åºæ•°æ®çš„æ–¹å¼è¿›è¡Œæ•°æ®é‡‡é›†ã€å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚åœ¨ Prometheus ä¸­ï¼Œæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–æ˜¯ä¸¤ä¸ªå…³é”®çš„è®¾è®¡é—®é¢˜ï¼Œä¿è¯äº†ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°å­˜å‚¨å¤§é‡çš„æ—¶åºæ•°æ®ã€‚</p><h3 id=1-prometheus-æ•°æ®å­˜å‚¨æ¶æ„><strong>1. Prometheus æ•°æ®å­˜å‚¨æ¶æ„</strong>
<a class=anchor href=#1-prometheus-%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e6%9e%b6%e6%9e%84>#</a></h3><p>Prometheus ä¸»è¦ä½¿ç”¨æœ¬åœ°ç£ç›˜å­˜å‚¨æ—¶åºæ•°æ®ï¼Œå¹¶ä¸”åœ¨å­˜å‚¨å’Œå‹ç¼©æ•°æ®æ—¶é‡‡ç”¨äº†ä¸€äº›æŠ€æœ¯æ¥ç¡®ä¿å…¶æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚å…¶æ•°æ®å­˜å‚¨åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>Time Series Databaseï¼ˆTSDBï¼‰</strong>ï¼šPrometheus ä½¿ç”¨æ—¶åºæ•°æ®åº“å­˜å‚¨æ—¶åºæ•°æ®ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—ç”±ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆå³æŒ‡æ ‡åç§°å’Œæ ‡ç­¾ç»„åˆï¼‰å’Œä¸€ç³»åˆ—æ—¶é—´æˆ³ä¸æ•°å€¼å¯¹ç»„æˆã€‚</li><li><strong>å—ï¼ˆBlocksï¼‰</strong>ï¼šPrometheus çš„å­˜å‚¨é‡‡ç”¨äº†å—ï¼ˆBlockï¼‰çš„æ–¹å¼ï¼Œå°†æ•°æ®æŒ‰æ—¶é—´åˆ†å—å­˜å‚¨ï¼Œæ¯ä¸ªå—é€šå¸¸ä¿å­˜ä¸€ä¸ªæ—¶é—´æ®µçš„æ•°æ®ï¼ˆä¾‹å¦‚ä¸¤å°æ—¶çš„æ•°æ®ï¼‰ã€‚å—å­˜å‚¨æ˜¯å‹ç¼©å­˜å‚¨å’ŒæŒä¹…åŒ–çš„åŸºç¡€ã€‚</li></ul><h3 id=2-æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†><strong>2. æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†</strong>
<a class=anchor href=#2-%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e4%b8%8e%e6%8c%81%e4%b9%85%e5%8c%96%e5%8e%9f%e7%90%86>#</a></h3><h4 id=21-æ•°æ®æ¨¡å‹><strong>2.1. æ•°æ®æ¨¡å‹</strong>
<a class=anchor href=#21-%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b>#</a></h4><p>åœ¨ Prometheus ä¸­ï¼Œæ•°æ®ä»¥æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰çš„å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>Metric Nameï¼ˆæŒ‡æ ‡åï¼‰</strong>ï¼šå”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åç§°ã€‚</li><li><strong>Labelsï¼ˆæ ‡ç­¾ï¼‰</strong>ï¼šç”¨äºæ ‡è¯†è¯¥æ—¶é—´åºåˆ—çš„é¢å¤–ç»´åº¦ï¼ˆå¦‚ <code>instance</code>ã€<code>job</code> ç­‰ï¼‰ï¼Œæ ‡ç­¾æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆKey-Valueï¼‰ï¼Œä¾‹å¦‚ <code>job="node_exporter"</code>ã€‚</li><li><strong>Timestampï¼ˆæ—¶é—´æˆ³ï¼‰</strong>ï¼šæ—¶é—´æˆ³æŒ‡ç¤ºè¯¥æ•°æ®ç‚¹çš„æ—¶é—´ï¼ŒPrometheus ä¸­çš„æ•°æ®ç²¾åº¦ä¸ºæ¯«ç§’çº§ã€‚</li><li><strong>Valueï¼ˆå€¼ï¼‰</strong>ï¼šæ¯ä¸ªæ—¶é—´æˆ³å¯¹åº”çš„åº¦é‡å€¼ã€‚</li></ul><h4 id=22-æ•°æ®å†™å…¥è¿‡ç¨‹><strong>2.2. æ•°æ®å†™å…¥è¿‡ç¨‹</strong>
<a class=anchor href=#22-%e6%95%b0%e6%8d%ae%e5%86%99%e5%85%a5%e8%bf%87%e7%a8%8b>#</a></h4><p>å½“ Prometheus ä»ç›®æ ‡ç«¯ç‚¹æŠ“å–æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šæŒ‰ç…§æ—¶é—´åºåˆ—çš„å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—çš„æ¯ä¸ªæ•°æ®ç‚¹éƒ½ä¼šåŒ…å«ä¸€ä¸ªæ—¶é—´æˆ³å’Œç›¸åº”çš„æ•°å€¼ã€‚è¿™äº›æ•°æ®ä¼šè¢«æŒ‰å—è¿›è¡Œå­˜å‚¨ã€‚</p><p>Prometheus é‡‡ç”¨ <strong>æ—¶é—´åˆ†åŒºï¼ˆTime Partitioningï¼‰</strong> å’Œ <strong>å—æ–‡ä»¶ï¼ˆBlock Filesï¼‰</strong> æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚æ•°æ®ä¼šè¢«åˆ†ä¸ºå¤šä¸ª <strong>å—ï¼ˆBlockï¼‰</strong>ï¼Œæ¯ä¸ªå—åŒ…å«ä¸€å®šæ—¶é—´èŒƒå›´ï¼ˆå¦‚ä¸¤ä¸ªå°æ—¶æˆ–æ›´é•¿æ—¶é—´ï¼‰çš„æ•°æ®ã€‚</p><h4 id=23-å—å­˜å‚¨ç»“æ„><strong>2.3. å—å­˜å‚¨ç»“æ„</strong>
<a class=anchor href=#23-%e5%9d%97%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84>#</a></h4><p>Prometheus å­˜å‚¨çš„æ¯ä¸ªå—ï¼ˆBlockï¼‰éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„æ—¶é—´è·¨åº¦ï¼Œé€šå¸¸ä¸º <strong>2å°æ—¶</strong>ã€‚æ¯ä¸ªå—éƒ½åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li><strong>ç´¢å¼•æ–‡ä»¶</strong>ï¼šè®°å½•äº†æ—¶é—´åºåˆ—çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚æ ‡ç­¾å’ŒæŒ‡æ ‡ä¿¡æ¯ã€‚</li><li><strong>æ•°æ®æ–‡ä»¶</strong>ï¼šå­˜å‚¨äº†æ¯ä¸ªæ—¶é—´åºåˆ—çš„å®é™…æ•°æ®ç‚¹ï¼Œæ•°æ®ç‚¹æŒ‰æ—¶é—´é¡ºåºæ’åˆ—ã€‚</li><li><strong>å‹ç¼©æ–‡ä»¶</strong>ï¼šPrometheus ä¼šå¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œä»¥å‡å°å­˜å‚¨ç©ºé—´ã€‚</li></ul><p>æ¯ä¸ªå—åœ¨ç£ç›˜ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«å¤šä¸ªå‹ç¼©åçš„æ•°æ®æ–‡ä»¶ï¼ˆå¦‚ <code>.tsdb</code> æ–‡ä»¶ï¼‰ã€‚è¿™äº›å—ä¼šæŒ‰æ—¶é—´é¡ºåºä¾æ¬¡å­˜å‚¨ï¼Œå¹¶ä¸”åœ¨ä¸€æ®µæ—¶é—´åè¿›è¡Œåˆå¹¶ã€‚</p><h4 id=24-æ•°æ®å‹ç¼©><strong>2.4. æ•°æ®å‹ç¼©</strong>
<a class=anchor href=#24-%e6%95%b0%e6%8d%ae%e5%8e%8b%e7%bc%a9>#</a></h4><p>Prometheus é€šè¿‡ <strong>WALï¼ˆWrite Ahead Logï¼‰</strong> å’Œ <strong>TSDBï¼ˆTime Series Databaseï¼‰</strong> æ•°æ®ç»“æ„æ¥å®ç°é«˜æ•ˆçš„å‹ç¼©å’ŒæŒä¹…åŒ–ã€‚</p><ul><li><strong>WALï¼ˆWrite-Ahead Logï¼‰</strong>ï¼šåœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒPrometheus ä¼šå…ˆå°†æ•°æ®å†™å…¥ WAL æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ã€‚WAL æ–‡ä»¶é€šå¸¸å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå½“è¾¾åˆ°ä¸€å®šçš„å¤§å°åï¼Œä¼šå°† WAL ä¸­çš„æ•°æ®åˆå¹¶åˆ° TSDB çš„å—ä¸­ã€‚</li><li><strong>TSDB æ•°æ®ç»“æ„</strong>ï¼šTSDB æ˜¯ Prometheus çš„æ ¸å¿ƒæ•°æ®å­˜å‚¨å¼•æ“ï¼Œå®ƒå°†æ—¶é—´åºåˆ—æ•°æ®æŒ‰å—ï¼ˆBlockï¼‰å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨ä¸€ç§åŸºäº <strong>LZ4 å‹ç¼©ç®—æ³•</strong> çš„æ–¹æ³•å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå‹ç¼©ã€‚æ¯ä¸ªæ•°æ®å—ä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”ï¼ˆå¦‚ 2 å°æ—¶ï¼‰æ¥åˆ›å»ºï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®å—ä¼šè¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å‹ç¼©åçš„æ•°æ®å ç”¨çš„ç£ç›˜ç©ºé—´è¿œå°äºåŸå§‹æ•°æ®ã€‚</li></ul><p>Prometheus ä½¿ç”¨ <strong>chunk encoding</strong>ï¼ˆå—ç¼–ç ï¼‰å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå­˜å‚¨å’Œå‹ç¼©ï¼Œå…·ä½“æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>Delta Encoding</strong>ï¼ˆå¢é‡ç¼–ç ï¼‰ï¼šé€šè¿‡è®°å½•ç›¸é‚»ä¸¤ä¸ªå€¼ä¹‹é—´çš„å·®å¼‚æ¥å‡å°‘å­˜å‚¨ç©ºé—´ã€‚</li><li><strong>Run-Length Encoding (RLE)</strong>ï¼šå¯¹è¿ç»­ç›¸åŒçš„å€¼è¿›è¡Œç¼–ç ï¼Œä»¥èŠ‚çœå­˜å‚¨ã€‚</li><li><strong>LZ4 Compression</strong>ï¼šåœ¨å—çº§åˆ«ä¸Šä½¿ç”¨ LZ4 å‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ã€‚</li></ul><h4 id=25-æ•°æ®å—åˆå¹¶><strong>2.5. æ•°æ®å—åˆå¹¶</strong>
<a class=anchor href=#25-%e6%95%b0%e6%8d%ae%e5%9d%97%e5%90%88%e5%b9%b6>#</a></h4><p>Prometheus ä¼šå®šæœŸè¿›è¡Œå—çš„åˆå¹¶ï¼ˆCompactionï¼‰æ“ä½œã€‚å—åˆå¹¶çš„ç›®çš„æ˜¯å‡å°‘å­˜å‚¨å ç”¨å’Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚åˆå¹¶è¿‡ç¨‹ä¼šæŠŠå°çš„æ—¶é—´æ®µåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ—¶é—´æ®µï¼Œå‹ç¼©ç‡è¿›ä¸€æ­¥æé«˜ï¼ŒåŒæ—¶å‡å°‘äº†å­˜å‚¨ç¢ç‰‡ã€‚</p><p>Prometheus ä¼šå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼Œå¯ä»¥é€šè¿‡ <code>--storage.tsdb.retention.time</code> å‚æ•°æ¥é…ç½®æ•°æ®çš„ä¿ç•™æ—¶é—´ã€‚</p><h3 id=3-æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“><strong>3. æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“</strong>
<a class=anchor href=#3-%e6%95%b0%e6%8d%ae%e5%8e%8b%e7%bc%a9%e4%b8%8e%e6%8c%81%e4%b9%85%e5%8c%96%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e6%80%bb%e7%bb%93>#</a></h3><ul><li><strong>æ—¶é—´åºåˆ—æ•°æ®ç»“æ„</strong>ï¼šPrometheus å­˜å‚¨æ—¶åºæ•°æ®æ—¶ï¼Œæ¯ä¸ªæ—¶é—´åºåˆ—æœ‰å”¯ä¸€çš„æ ‡ç­¾ç»„åˆå’Œæ•°å€¼ã€‚</li><li><strong>å—å­˜å‚¨æœºåˆ¶</strong>ï¼šæ•°æ®æŒ‰æ—¶é—´åˆ‡åˆ†æˆå¤šä¸ªå—ï¼Œæ¯ä¸ªå—å­˜å‚¨ä¸€å®šæ—¶é—´æ®µçš„æ•°æ®ï¼Œé€šå¸¸ä¸º 2 å°æ—¶ã€‚</li><li><strong>å‹ç¼©ç®—æ³•</strong>ï¼šä½¿ç”¨å¢é‡ç¼–ç ï¼ˆDelta Encodingï¼‰ã€æ¸¸ç¨‹é•¿åº¦ç¼–ç ï¼ˆRun-Length Encodingï¼‰ä»¥åŠ LZ4 å‹ç¼©ç®—æ³•å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘å­˜å‚¨ç©ºé—´ã€‚</li><li><strong>åˆå¹¶ä¸æ¸…ç†</strong>ï¼šå®šæœŸåˆå¹¶å°çš„å—å¹¶æ¸…ç†è¿‡æœŸæ•°æ®ï¼Œç¡®ä¿å­˜å‚¨ç©ºé—´çš„é«˜æ•ˆåˆ©ç”¨ã€‚</li><li><strong>WAL æ—¥å¿—</strong>ï¼šå†™æ“ä½œé¦–å…ˆè®°å½•åˆ° WALï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç„¶åå†å†™å…¥ TSDB å—ä¸­ã€‚</li></ul><h3 id=4-æŒä¹…åŒ–å­˜å‚¨><strong>4. æŒä¹…åŒ–å­˜å‚¨</strong>
<a class=anchor href=#4-%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8>#</a></h3><p>Prometheus çš„æ•°æ®æŒä¹…åŒ–æ˜¯åŸºäºæœ¬åœ°ç£ç›˜çš„ï¼Œæ•°æ®ä¼šä»¥å—çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¸”ä¼šè¿›è¡Œå®šæœŸçš„å‹ç¼©å’Œåˆå¹¶ã€‚æ•°æ®çš„æŒä¹…åŒ–æ—¶é—´å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ã€‚é€šå¸¸ï¼ŒPrometheus çš„å­˜å‚¨å¼•æ“æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€‚åˆä¸­å°å‹ç›‘æ§é›†ç¾¤ã€‚</p><p>å¯¹äºå¤§è§„æ¨¡ç¯å¢ƒï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼ˆå¦‚ <strong>Thanos</strong> æˆ– <strong>Cortex</strong>ï¼‰æ¥å®ç°åˆ†å¸ƒå¼å­˜å‚¨å’Œé•¿æœŸæŒä¹…åŒ–ã€‚</p><h2 id=kubectl-topè¾“å‡ºä¸linux-freeå‘½ä»¤ä¸ä¸€è‡´åŸå› >kubectl topè¾“å‡ºä¸Linux freeå‘½ä»¤ä¸ä¸€è‡´åŸå› â˜†
<a class=anchor href=#kubectl-top%e8%be%93%e5%87%ba%e4%b8%8elinux-free%e5%91%bd%e4%bb%a4%e4%b8%8d%e4%b8%80%e8%87%b4%e5%8e%9f%e5%9b%a0>#</a></h2><p><code>kubectl top</code> å’Œ Linux <code>free</code> å‘½ä»¤åœ¨è¾“å‡ºä¸Šå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä¸»è¦åŸå› åœ¨äºå®ƒä»¬è·å–å’Œæ˜¾ç¤ºçš„èµ„æºæ•°æ®æ¥æºã€è®¡ç®—æ–¹å¼å’Œè¦†ç›–èŒƒå›´ä¸åŒã€‚å…·ä½“æ¥è¯´ï¼š</p><h3 id=1-æ•°æ®æ¥æºçš„å·®å¼‚><strong>1. æ•°æ®æ¥æºçš„å·®å¼‚</strong>
<a class=anchor href=#1-%e6%95%b0%e6%8d%ae%e6%9d%a5%e6%ba%90%e7%9a%84%e5%b7%ae%e5%bc%82>#</a></h3><ul><li><strong><code>kubectl top</code></strong>:<ul><li><code>kubectl top</code> æ˜¯ Kubernetes çš„ç›‘æ§å‘½ä»¤ï¼Œä¸»è¦é€šè¿‡ <strong>metrics-server</strong> æˆ– <strong>Prometheus</strong> ç­‰ç›‘æ§å·¥å…·æä¾›é›†ç¾¤çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚å®ƒæ˜¾ç¤ºçš„æ˜¯æ¯ä¸ª Podã€èŠ‚ç‚¹ã€å®¹å™¨ç­‰åœ¨ Kubernetes é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆå¦‚ CPUã€å†…å­˜ç­‰ï¼‰ã€‚</li><li><strong>CPU ä½¿ç”¨æƒ…å†µ</strong> æ˜¯åŸºäº Kubernetes ä¸­çš„å®¹å™¨å®é™…è¯·æ±‚å’Œåˆ†é…çš„èµ„æºæ•°æ®ã€‚</li><li><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ</strong> æ˜¯åŸºäºå®¹å™¨åœ¨è¿è¡Œæ—¶çš„å®é™…å†…å­˜ä½¿ç”¨é‡ï¼ˆå®¹å™¨åˆ†é…çš„å†…å­˜å¯èƒ½ä¸å®Œå…¨ç­‰äºå…¶å®é™…ä½¿ç”¨çš„å†…å­˜ï¼‰ã€‚</li></ul></li><li><strong><code>free</code> å‘½ä»¤</strong>:<ul><li><code>free</code> æ˜¯ Linux ç³»ç»Ÿçš„æ ‡å‡†å‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºæ“ä½œç³»ç»Ÿå±‚é¢çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å®ƒæ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçº§åˆ«çš„å†…å­˜ä½¿ç”¨çŠ¶æ€ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå†…å­˜ï¼ˆRAMï¼‰ã€äº¤æ¢å†…å­˜ï¼ˆSwapï¼‰ç­‰ã€‚</li><li><code>free</code> å‘½ä»¤æŠ¥å‘Šçš„æ˜¯æ•´ä¸ªæœºå™¨ä¸Šçš„ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸è€ƒè™‘å®¹å™¨æˆ– Kubernetes ç¯å¢ƒä¸­çš„èµ„æºéš”ç¦»ã€‚</li></ul></li></ul><h3 id=2-èµ„æºçš„è®¡ç®—æ–¹å¼><strong>2. èµ„æºçš„è®¡ç®—æ–¹å¼</strong>
<a class=anchor href=#2-%e8%b5%84%e6%ba%90%e7%9a%84%e8%ae%a1%e7%ae%97%e6%96%b9%e5%bc%8f>#</a></h3><ul><li><p><strong><code>kubectl top</code></strong>:</p><ul><li><strong>CPU</strong>ï¼š<code>kubectl top</code> æ˜¾ç¤ºçš„æ˜¯å®¹å™¨å®é™…æ¶ˆè€—çš„ CPU èµ„æºï¼Œé€šå¸¸ä»¥ <strong>millicores</strong>ï¼ˆmCPUï¼‰ä¸ºå•ä½ï¼ˆä¾‹å¦‚ 500m è¡¨ç¤º 0.5 æ ¸ï¼‰ã€‚</li><li><strong>å†…å­˜</strong>ï¼šå®ƒæ˜¾ç¤ºçš„æ˜¯å®¹å™¨å®é™…ä½¿ç”¨çš„å†…å­˜é‡ï¼Œä¸åŒ…æ‹¬ç³»ç»Ÿå†…å­˜ä¸­çš„ç¼“å­˜å’Œç¼“å†²åŒºã€‚å®¹å™¨çš„å†…å­˜æ¶ˆè€—å¯èƒ½ä¸å®ƒæ‰€è¯·æ±‚çš„å†…å­˜æœ‰æ‰€ä¸åŒã€‚</li></ul></li><li><p><strong><code>free</code> å‘½ä»¤</strong>ï¼š</p><ul><li><p>ç‰©ç†å†…å­˜ï¼š</p><pre tabindex=0><code>free
</code></pre><p>æ˜¾ç¤ºçš„æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œé€šå¸¸ä¼šæŠ¥å‘Š</p><pre tabindex=0><code>used
</code></pre><p>ã€</p><pre tabindex=0><code>free
</code></pre><p>ã€</p><pre tabindex=0><code>buffers
</code></pre><p>ã€</p><pre tabindex=0><code>cached
</code></pre><p>ç­‰å­—æ®µã€‚</p><ul><li><code>used</code>ï¼šå·²ä½¿ç”¨çš„å†…å­˜ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç¼“å­˜å’Œç¼“å†²åŒºçš„å†…å­˜ã€‚</li><li><code>free</code>ï¼šç©ºé—²çš„å†…å­˜ã€‚</li><li><code>buffers/cache</code>ï¼šç”¨äºç¼“å­˜æ–‡ä»¶å’Œ I/O æ“ä½œçš„å†…å­˜ã€‚</li></ul></li><li><p><strong>äº¤æ¢ç©ºé—´ï¼ˆSwapï¼‰</strong>ï¼š<code>free</code> è¿˜æ˜¾ç¤ºäº†äº¤æ¢ç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸å®¹å™¨çš„å†…å­˜ä½¿ç”¨æ— å…³ã€‚</p></li></ul></li></ul><h3 id=3-èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–><strong>3. èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–</strong>
<a class=anchor href=#3-%e8%b5%84%e6%ba%90%e9%9a%94%e7%a6%bb%e5%92%8c%e5%ae%b9%e5%99%a8%e5%8c%96>#</a></h3><p>åœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œå®¹å™¨çš„èµ„æºé™åˆ¶æ˜¯ä¸ä¸»æœºç³»ç»Ÿèµ„æºè¿›è¡Œéš”ç¦»çš„ã€‚æ¯ä¸ªå®¹å™¨ï¼ˆæˆ– Podï¼‰å¯ä»¥æœ‰è‡ªå·±çš„ CPUã€å†…å­˜é™åˆ¶å’Œè¯·æ±‚ã€‚<code>kubectl top</code> æ˜¯åŸºäºè¿™äº›é™åˆ¶å’Œå®¹å™¨å®é™…æ¶ˆè€—çš„èµ„æºæ¥æŠ¥å‘Šçš„ã€‚</p><p>è€Œ <code>free</code> å‘½ä»¤æ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªç³»ç»Ÿçº§åˆ«çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä¸ä¼šåŒºåˆ†å®¹å™¨ä¹‹é—´çš„èµ„æºæ¶ˆè€—ã€‚æ‰€ä»¥ï¼Œ<code>kubectl top</code> ä¸­æ˜¾ç¤ºçš„å†…å­˜å’Œ CPU ä½¿ç”¨é‡æ˜¯åŸºäºå®¹å™¨å†…çš„ä½¿ç”¨æƒ…å†µï¼Œè€Œ <code>free</code> å‘½ä»¤æ˜¾ç¤ºçš„æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„èµ„æºä½¿ç”¨ï¼Œä¸åŒºåˆ†å®¹å™¨ä¹‹é—´çš„ä½¿ç”¨ã€‚</p><h3 id=4-æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ><strong>4. æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ</strong>
<a class=anchor href=#4-%e6%b1%87%e6%80%bb%e4%b8%8e%e6%98%be%e7%a4%ba%e7%9a%84%e4%b8%8d%e5%90%8c>#</a></h3><ul><li><strong><code>kubectl top</code></strong>ï¼šæ˜¯ä»¥ Podã€Node æˆ– Container ä¸ºå•ä½æ˜¾ç¤ºèµ„æºä½¿ç”¨æƒ…å†µã€‚å¦‚æœä½ æŸ¥è¯¢çš„æ˜¯ Pod çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå®ƒå°†æŠ¥å‘Šè¯¥ Pod å†…æ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨åˆè®¡å€¼ï¼Œè€Œè¿™äº›å®¹å™¨çš„å®é™…èµ„æºæ¶ˆè€—å’Œå†…å­˜ä½¿ç”¨é‡æ˜¯é€šè¿‡ Kubernetes çš„ç›‘æ§ç»„ä»¶ï¼ˆå¦‚ metrics-serverï¼‰æ¥æ±‡æŠ¥çš„ã€‚</li><li><strong><code>free</code> å‘½ä»¤</strong>ï¼šæ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬ä¸»æœºã€æ‰€æœ‰å®¹å™¨å’Œæ‰€æœ‰è¿›ç¨‹ï¼‰çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå®ƒçš„è¾“å‡ºåŒ…æ‹¬æ“ä½œç³»ç»Ÿçº§åˆ«çš„å†…å­˜æ€»é‡å’Œå·²ä½¿ç”¨ã€ç©ºé—²ã€ç¼“å­˜ç­‰çš„è¯¦ç»†æƒ…å†µã€‚</li></ul><h3 id=æ€»ç»“-6><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-6>#</a></h3><p><code>kubectl top</code> å’Œ <code>free</code> å‘½ä»¤æ˜¾ç¤ºçš„æ•°æ®æ¥æºå’Œè®¡ç®—æ–¹å¼ä¸åŒï¼š</p><ul><li><code>kubectl top</code> ä¸»è¦æ˜¾ç¤º Kubernetes ç¯å¢ƒä¸‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œä¾æ®å®¹å™¨çš„èµ„æºæ¶ˆè€—ã€‚</li><li><code>free</code> æ˜¾ç¤ºçš„æ˜¯ Linux ç³»ç»Ÿå±‚çº§çš„å†…å­˜æƒ…å†µï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰å†…å­˜ä½¿ç”¨æƒ…å†µã€ç¼“å­˜ã€ç¼“å†²åŒºç­‰ã€‚</li></ul><p>å› æ­¤ï¼Œ<code>kubectl top</code> å’Œ <code>free</code> è¾“å‡ºä¸ä¸€è‡´æ˜¯å› ä¸ºå®ƒä»¬çš„æ•°æ®æ¥æºä¸åŒã€è®¡ç®—æ–¹å¼ä¸åŒä»¥åŠæ‰€æ˜¾ç¤ºçš„èµ„æºèŒƒå›´ä¸åŒã€‚</p><h2 id=ç”¨åˆ°äº†å“ªäº›exporteråŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨-prometheus-ç›‘æ§ä¸­exporter-æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶å®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡å¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥-prometheus-èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„-prometheus-exporter-åŠå…¶åŠŸèƒ½>ç”¨åˆ°äº†å“ªäº›exporterï¼ŒåŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨ Prometheus ç›‘æ§ä¸­ï¼Œ<strong>Exporter</strong> æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶ï¼Œå®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡ï¼Œå¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥ Prometheus èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Prometheus Exporter åŠå…¶åŠŸèƒ½ï¼š
<a class=anchor href=#%e7%94%a8%e5%88%b0%e4%ba%86%e5%93%aa%e4%ba%9bexporter%e5%8a%9f%e8%83%bd%e6%98%af%e4%bb%80%e4%b9%88%e5%9c%a8-prometheus-%e7%9b%91%e6%8e%a7%e4%b8%adexporter-%e6%98%af%e4%b8%80%e4%b8%aa%e9%87%8d%e8%a6%81%e7%9a%84%e7%bb%84%e4%bb%b6%e5%ae%83%e7%94%a8%e4%ba%8e%e4%bb%8e%e4%b8%8d%e5%90%8c%e7%9a%84%e5%ba%94%e7%94%a8%e6%88%96%e7%b3%bb%e7%bb%9f%e4%b8%ad%e6%94%b6%e9%9b%86%e6%8c%87%e6%a0%87%e5%b9%b6%e5%b0%86%e8%bf%99%e4%ba%9b%e6%8c%87%e6%a0%87%e4%bb%a5-prometheus-%e8%83%bd%e5%a4%9f%e7%90%86%e8%a7%a3%e7%9a%84%e6%a0%bc%e5%bc%8f%e6%9a%b4%e9%9c%b2%e5%87%ba%e6%9d%a5%e4%bb%a5%e4%b8%8b%e6%98%af%e4%b8%80%e4%ba%9b%e5%b8%b8%e7%94%a8%e7%9a%84-prometheus-exporter-%e5%8f%8a%e5%85%b6%e5%8a%9f%e8%83%bd>#</a></h2><h3 id=1-node-exporter>1. <strong>Node Exporter</strong>
<a class=anchor href=#1-node-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºæ”¶é›†æ“ä½œç³»ç»Ÿçº§åˆ«çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»ŸæŒ‡æ ‡ï¼Œæ¶µç›– CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰åŸºæœ¬èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>CPU ä½¿ç”¨ç‡</li><li>å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆåŒ…æ‹¬ I/O é€Ÿç‡ã€ç£ç›˜ç©ºé—´ç­‰ï¼‰</li><li>ç½‘ç»œæµé‡</li><li>ç³»ç»Ÿè´Ÿè½½</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Linux/Unix ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</p></li></ul><h3 id=2-kube-state-metrics>2. <strong>kube-state-metrics</strong>
<a class=anchor href=#2-kube-state-metrics>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä» Kubernetes é›†ç¾¤ä¸­æ”¶é›†å…³äº Kubernetes èµ„æºçš„çŠ¶æ€æŒ‡æ ‡ã€‚ä¸åŒäº <code>Node Exporter</code> é‡‡é›†æ“ä½œç³»ç»Ÿçš„æŒ‡æ ‡ï¼Œ<code>kube-state-metrics</code> é‡‡é›†çš„æ˜¯ Kubernetes èµ„æºï¼ˆå¦‚ Podã€Deploymentã€ReplicaSetã€StatefulSetã€Node ç­‰ï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>Pod çŠ¶æ€ï¼ˆè¿è¡Œã€å¾…å¯åŠ¨ã€å¤±è´¥ç­‰ï¼‰</li><li>Deployment å’Œ ReplicaSet çš„å‰¯æœ¬æ•°</li><li>èŠ‚ç‚¹çŠ¶æ€ï¼ˆReadyã€NotReadyï¼‰</li><li>èµ„æºè¯·æ±‚ä¸é™åˆ¶</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Kubernetes é›†ç¾¤çš„èµ„æºçŠ¶æ€å’Œå¥åº·çŠ¶å†µã€‚</p></li></ul><h3 id=3-cadvisor>3. <strong>cAdvisor</strong>
<a class=anchor href=#3-cadvisor>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºæ”¶é›† Docker å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæä¾› CPUã€å†…å­˜ã€ç£ç›˜ I/Oã€ç½‘ç»œä½¿ç”¨ç­‰å®¹å™¨çº§åˆ«çš„æŒ‡æ ‡ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>æ¯ä¸ª Docker å®¹å™¨çš„ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>å®¹å™¨çš„ç½‘ç»œæµé‡</li><li>å®¹å™¨çš„ç£ç›˜ I/O</li><li>å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¯åŠ¨ã€åœæ­¢ç­‰ï¼‰</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Docker å®¹å™¨çš„èµ„æºæ¶ˆè€—å’Œæ€§èƒ½ã€‚</p></li></ul><h3 id=4-blackbox-exporter>4. <strong>Blackbox Exporter</strong>
<a class=anchor href=#4-blackbox-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºé€šè¿‡é»‘ç›’æ–¹å¼ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼‰æ£€æŸ¥æœåŠ¡çš„å¯ç”¨æ€§å’Œå“åº”æ—¶é—´ã€‚å®ƒæ”¯æŒ HTTPã€HTTPSã€DNSã€TCP ç­‰åè®®çš„å¥åº·æ£€æŸ¥ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>HTTP/HTTPS çŠ¶æ€ç ç›‘æ§</li><li>DNS æŸ¥è¯¢å“åº”æ—¶é—´</li><li>TCP ç«¯å£çš„å¯è¾¾æ€§</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ£€æµ‹å¤–éƒ¨æœåŠ¡çš„å¯ç”¨æ€§ï¼Œæ£€æŸ¥ç½‘ç«™æˆ–å…¶ä»–ç½‘ç»œæœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚</p></li></ul><h3 id=5-mysql-exporter>5. <strong>MySQL Exporter</strong>
<a class=anchor href=#5-mysql-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šä¸“é—¨ç”¨äºæ”¶é›† MySQL æ•°æ®åº“çš„æŒ‡æ ‡ï¼Œç›‘æ§ MySQL æ•°æ®åº“çš„æ€§èƒ½å’Œå¥åº·çŠ¶å†µã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½</li><li>æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>æ•°æ®åº“çš„è¿æ¥æ•°</li><li>æ•°æ®åº“çš„ç¼“å­˜ä½¿ç”¨</li><li>ç£ç›˜ I/O ç­‰</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ MySQL æ•°æ®åº“çš„æ€§èƒ½ï¼Œå¸®åŠ©è¯Šæ–­æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆã€‚</p></li></ul><h3 id=6-postgresql-exporter>6. <strong>PostgreSQL Exporter</strong>
<a class=anchor href=#6-postgresql-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä» PostgreSQL æ•°æ®åº“ä¸­æ”¶é›†æŒ‡æ ‡ï¼Œç±»ä¼¼äº MySQL Exporterï¼Œä½†ä¸“ä¸º PostgreSQL å®šåˆ¶ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>æ•°æ®åº“çš„è¿æ¥æ•°</li><li>ç¼“å­˜å’Œç¼“å­˜å‘½ä¸­ç‡</li><li>æ´»è·ƒæŸ¥è¯¢æ•°é‡</li><li>æ•°æ®åº“å¤§å°</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ PostgreSQL æ•°æ®åº“çš„æ€§èƒ½å’Œå¥åº·ã€‚</p></li></ul><h3 id=7-jmx-exporter>7. <strong>JMX Exporter</strong>
<a class=anchor href=#7-jmx-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä» Java åº”ç”¨ä¸­æ”¶é›† JMXï¼ˆJava Management Extensionsï¼‰æš´éœ²çš„æŒ‡æ ‡ï¼Œé€‚ç”¨äºåŸºäº Java çš„åº”ç”¨ï¼Œå¦‚ Kafkaã€Tomcatã€JVM ç­‰ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>JVM å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>åƒåœ¾å›æ”¶ç»Ÿè®¡</li><li>çº¿ç¨‹æ± ä½¿ç”¨æƒ…å†µ</li><li>Kafkaã€Tomcat ç­‰ Java æœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Java åº”ç”¨å’Œ JVM çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p></li></ul><h3 id=8-redis-exporter>8. <strong>Redis Exporter</strong>
<a class=anchor href=#8-redis-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºç›‘æ§ Redis æ•°æ®åº“çš„æ€§èƒ½å’Œå¥åº·ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>Redis å†…å­˜ä½¿ç”¨</li><li>å‘½ä¸­ç‡</li><li>é”å’Œè¿æ¥</li><li>é”®ç©ºé—´ä½¿ç”¨æƒ…å†µ</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Redis æ•°æ®åº“çš„æ€§èƒ½ï¼Œç¡®ä¿ Redis è¿è¡Œå¥åº·ã€‚</p></li></ul><h3 id=9-mongodb-exporter>9. <strong>MongoDB Exporter</strong>
<a class=anchor href=#9-mongodb-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºç›‘æ§ MongoDB æ•°æ®åº“çš„æ€§èƒ½å’ŒçŠ¶æ€ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>æ•°æ®åº“çš„è¿æ¥æ•°</li><li>æŸ¥è¯¢æ€§èƒ½</li><li>å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>å¤åˆ¶é›†çŠ¶æ€</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ MongoDB æ•°æ®åº“ï¼Œè¯Šæ–­æ•°æ®åº“æ€§èƒ½é—®é¢˜ã€‚</p></li></ul><h3 id=10-elasticsearch-exporter>10. <strong>Elasticsearch Exporter</strong>
<a class=anchor href=#10-elasticsearch-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä» Elasticsearch é›†ç¾¤ä¸­æ”¶é›†æŒ‡æ ‡ï¼Œç›‘æ§ Elasticsearch çš„å¥åº·å’Œæ€§èƒ½ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>é›†ç¾¤çš„å¥åº·çŠ¶æ€</li><li>èŠ‚ç‚¹å’Œç´¢å¼•çš„æ€§èƒ½</li><li>æ–‡æ¡£æ•°ã€æŸ¥è¯¢æ€§èƒ½ç­‰</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Elasticsearch é›†ç¾¤ï¼Œç¡®ä¿å…¶é«˜æ•ˆè¿è¡Œã€‚</p></li></ul><h3 id=11-nginx-exporter>11. <strong>Nginx Exporter</strong>
<a class=anchor href=#11-nginx-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä» Nginx æœåŠ¡å™¨æ”¶é›†æŒ‡æ ‡ï¼Œå¸®åŠ©ç›‘æ§ Nginx çš„æ€§èƒ½ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>Nginx è¯·æ±‚å’Œå“åº”æ•°</li><li>Nginx é”™è¯¯æ—¥å¿—</li><li>Nginx çš„è¿æ¥æ•°</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Nginx çš„è´Ÿè½½å’Œæ€§èƒ½ï¼Œè¯Šæ–­é—®é¢˜ã€‚</p></li></ul><h3 id=12-kafka-exporter>12. <strong>Kafka Exporter</strong>
<a class=anchor href=#12-kafka-exporter>#</a></h3><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šç”¨äºç›‘æ§ Kafka é›†ç¾¤çš„å¥åº·å’Œæ€§èƒ½ã€‚</p></li><li><p>ç›‘æ§å†…å®¹</p><p>ï¼š</p><ul><li>æ¶ˆè´¹è€…ç»„å’Œä¸»é¢˜çš„åç§»é‡</li><li>è¯·æ±‚å’Œå“åº”å»¶è¿Ÿ</li><li>ç£ç›˜å’Œå†…å­˜ä½¿ç”¨</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç›‘æ§ Kafka é›†ç¾¤çš„å¥åº·çŠ¶å†µï¼Œç¡®ä¿æ¶ˆæ¯ä¼ é€’çš„é«˜æ•ˆæ€§ã€‚</p></li></ul><h3 id=æ€»ç»“-7><strong>æ€»ç»“</strong>ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-7>#</a></h3><p>è¿™äº› Exporter çš„å…±åŒç›®æ ‡æ˜¯å°†å„ä¸ªç³»ç»Ÿã€æœåŠ¡æˆ–åº”ç”¨çš„æ€§èƒ½æŒ‡æ ‡æš´éœ²ç»™ Prometheusï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œç›‘æ§å’Œå‘Šè­¦ã€‚é€šè¿‡åˆé€‚çš„ Exporterï¼Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†äº†è§£æ¯ä¸ªæœåŠ¡æˆ–ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€èµ„æºä½¿ç”¨æƒ…å†µå’Œæ½œåœ¨é—®é¢˜ï¼Œå¸®åŠ©è¿ç»´äººå‘˜åšå‡ºåŠæ—¶å“åº”å’Œä¼˜åŒ–å†³ç­–ã€‚</p><h2 id=æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporter>æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporterâ˜†
<a class=anchor href=#%e6%98%af%e5%90%a6%e8%87%aa%e5%b7%b1%e5%bc%80%e5%8f%91%e8%bf%87exporter>#</a></h2><p>æ˜¯çš„ï¼Œæˆ‘æœ‰å¼€å‘è¿‡è‡ªå®šä¹‰ <strong>Exporter</strong> çš„ç»éªŒã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œç°æœ‰çš„ Prometheus Exporter å¯èƒ½æ— æ³•æ»¡è¶³ç‰¹å®šçš„ç›‘æ§éœ€æ±‚ï¼Œè¿™æ—¶å°±éœ€è¦å¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰ Exporter æ¥æš´éœ²ç‰¹å®šæœåŠ¡æˆ–åº”ç”¨çš„æŒ‡æ ‡ã€‚</p><h3 id=è‡ªå®šä¹‰-exporter-å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤>è‡ªå®šä¹‰ Exporter å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤ï¼š
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89-exporter-%e5%bc%80%e5%8f%91%e7%9a%84%e4%b8%80%e8%88%ac%e6%ad%a5%e9%aa%a4>#</a></h3><ol><li><strong>é€‰æ‹©è¯­è¨€å’Œæ¡†æ¶</strong>ï¼šå¸¸è§çš„å¼€å‘è¯­è¨€æœ‰ Goã€Pythonã€Java ç­‰ã€‚Go æ˜¯å®˜æ–¹æ¨èçš„è¯­è¨€ï¼Œå› ä¸º Prometheus æœ¬èº«å°±æ˜¯ç”¨ Go ç¼–å†™çš„ï¼Œå¹¶ä¸”æä¾›äº†å®˜æ–¹çš„å®¢æˆ·ç«¯åº“ï¼ˆ<code>prometheus/client_golang</code>ï¼‰ã€‚</li><li><strong>åˆ›å»ºæŒ‡æ ‡</strong>ï¼š<ul><li>ä½¿ç”¨ Prometheus çš„å®¢æˆ·ç«¯åº“æ¥å®šä¹‰æ‰€éœ€çš„æŒ‡æ ‡ï¼ˆä¾‹å¦‚ï¼Œè®¡æ•°å™¨ã€ç›´æ–¹å›¾ã€æ‘˜è¦ç­‰ï¼‰ã€‚</li><li>é€šè¿‡ Prometheus æä¾›çš„ <code>http.Handler</code> å‘ Prometheus æš´éœ²è¿™äº›æŒ‡æ ‡ã€‚</li></ul></li><li><strong>æ”¶é›†æ•°æ®</strong>ï¼š<ul><li>é€šè¿‡ä»£ç æ”¶é›†ç³»ç»Ÿæˆ–åº”ç”¨çš„ç‰¹å®šæ•°æ®ï¼ˆå¦‚åº”ç”¨çš„å¥åº·çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ç­‰ï¼‰ã€‚è¿™é€šå¸¸æ¶‰åŠè®¿é—® APIã€æ—¥å¿—æ–‡ä»¶æˆ–æ•°æ®åº“ç­‰ã€‚</li></ul></li><li><strong>å¯åŠ¨ HTTP æœåŠ¡å™¨</strong>ï¼š<ul><li>å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬ Prometheus è¿›è¡ŒæŒ‡æ ‡æŠ“å–çš„ç«¯å£ã€‚</li></ul></li><li><strong>å®šæœŸæ›´æ–°æŒ‡æ ‡</strong>ï¼š<ul><li>å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚ <code>time.Ticker</code>ï¼‰å®šæœŸæ›´æ–°æˆ–é‡æ–°æŠ“å–éœ€è¦ç›‘æ§çš„æ•°æ®ã€‚</li></ul></li></ol><h3 id=ç¤ºä¾‹ç”¨-go-å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰-exporter>ç¤ºä¾‹ï¼šç”¨ Go å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ Exporter
<a class=anchor href=#%e7%a4%ba%e4%be%8b%e7%94%a8-go-%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e8%87%aa%e5%ae%9a%e4%b9%89-exporter>#</a></h3><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ Go è¯­è¨€ç¤ºä¾‹ï¼Œåˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <strong>Exporter</strong> æ¥ç›‘æ§ä¸€ä¸ªå‡è®¾çš„æœåŠ¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/prometheus/client_golang/prometheus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/prometheus/client_golang/prometheus/promhttp&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡æ ‡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>upGauge</span> = <span style=color:#a6e22e>prometheus</span>.<span style=color:#a6e22e>NewGaugeVec</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>prometheus</span>.<span style=color:#a6e22e>GaugeOpts</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;my_service_up&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Help</span>: <span style=color:#e6db74>&#34;Indicates whether my service is up (1) or down (0).&#34;</span>,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		[]<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;service_name&#34;</span>},
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>prometheus</span>.<span style=color:#a6e22e>MustRegister</span>(<span style=color:#a6e22e>upGauge</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>recordMetrics</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æ¨¡æ‹ŸæœåŠ¡çŠ¶æ€æ›´æ–°</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>upGauge</span>.<span style=color:#a6e22e>WithLabelValues</span>(<span style=color:#e6db74>&#34;my_service&#34;</span>).<span style=color:#a6e22e>Set</span>(<span style=color:#ae81ff>1</span>) <span style=color:#75715e>// æœåŠ¡çŠ¶æ€ä¸º up</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>upGauge</span>.<span style=color:#a6e22e>WithLabelValues</span>(<span style=color:#e6db74>&#34;my_service&#34;</span>).<span style=color:#a6e22e>Set</span>(<span style=color:#ae81ff>0</span>) <span style=color:#75715e>// æœåŠ¡çŠ¶æ€ä¸º down</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ï¼Œæš´éœ² Prometheus çš„æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/metrics&#34;</span>, <span style=color:#a6e22e>promhttp</span>.<span style=color:#a6e22e>Handler</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// å¼€å¯æœåŠ¡çŠ¶æ€çš„æ¨¡æ‹Ÿ</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>recordMetrics</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// å¯åŠ¨ HTTP æœåŠ¡å™¨</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Starting custom exporter on :8080&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=å…³é”®ç‚¹>å…³é”®ç‚¹ï¼š
<a class=anchor href=#%e5%85%b3%e9%94%ae%e7%82%b9>#</a></h3><ul><li><strong>upGauge</strong> æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>GaugeVec</code> ç±»å‹æŒ‡æ ‡ï¼Œç”¨æ¥è¡¨ç¤ºæœåŠ¡æ˜¯å¦å¯ç”¨ã€‚</li><li><code>recordMetrics</code> å‡½æ•°æ¨¡æ‹Ÿæ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡æœåŠ¡çŠ¶æ€ï¼šæœåŠ¡å¤„äº &ldquo;up&rdquo; æˆ– &ldquo;down&rdquo; çŠ¶æ€ã€‚</li><li><code>/metrics</code> è·¯å¾„ç”¨äºæš´éœ² Prometheus æ‰€éœ€çš„æŒ‡æ ‡ã€‚</li></ul><h3 id=å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜>å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜ï¼š
<a class=anchor href=#%e5%bc%80%e5%8f%91%e8%bf%87%e7%a8%8b%e4%b8%ad%e5%8f%af%e8%83%bd%e9%81%87%e5%88%b0%e7%9a%84%e6%8c%91%e6%88%98>#</a></h3><ol><li><strong>æ•°æ®æºçš„è®¿é—®é—®é¢˜</strong>ï¼šåœ¨è‡ªå®šä¹‰ Exporter ä¸­ï¼Œæ•°æ®çš„æ”¶é›†æºå¯èƒ½æ˜¯æ•°æ®åº“ã€API æˆ–å…¶ä»–å¤–éƒ¨ç³»ç»Ÿï¼Œè®¿é—®è¿™äº›æ•°æ®æºå¯èƒ½éœ€è¦é¢å¤–çš„æƒé™æˆ–å®‰å…¨é…ç½®ã€‚</li><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šå½“éœ€è¦é¢‘ç¹æ”¶é›†å¤§é‡æ•°æ®æ—¶ï¼Œç¡®ä¿ Exporter æ€§èƒ½é«˜æ•ˆæ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™å¯èƒ½å¯¹è¢«ç›‘æ§æœåŠ¡é€ æˆå½±å“ã€‚</li><li><strong>ç›‘æ§æŒ‡æ ‡è®¾è®¡</strong>ï¼šè®¾è®¡å¥½çš„æŒ‡æ ‡å¯¹äºåç»­çš„ç›‘æ§å’Œå‘Šè­¦éå¸¸å…³é”®ï¼Œè¦ç¡®ä¿æŒ‡æ ‡å…·æœ‰å¯ç†è§£æ€§ã€è¶³å¤Ÿçš„ç»†ç²’åº¦ï¼Œä¸”ç¬¦åˆ Prometheus çš„æœ€ä½³å®è·µã€‚</li></ol><p>å¼€å‘è‡ªå®šä¹‰ Exporter çš„å…³é”®æ˜¯æ ¹æ®å…·ä½“éœ€æ±‚æš´éœ²åˆé€‚çš„æŒ‡æ ‡ï¼Œå¹¶ç¡®ä¿èƒ½å¤Ÿé«˜æ•ˆã€ç¨³å®šåœ°è¿è¡Œã€‚</p><h2 id=target-downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤>target downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤ï¼Ÿ
<a class=anchor href=#target-down%e7%9a%84%e6%83%85%e5%86%b5%e5%a6%82%e4%bd%95%e8%bf%9b%e8%a1%8c%e6%95%85%e9%9a%9c%e6%8e%92%e9%99%a4>#</a></h2><p>å½“ Prometheus æŠ¥å‘ŠæŸä¸ª <strong>target down</strong>ï¼ˆç›®æ ‡ä¸å¯è¾¾ï¼‰æ—¶ï¼Œæ„å‘³ç€ Prometheus æ— æ³•ä»è¯¥ç›®æ ‡æŠ“å–åˆ°æ•°æ®ã€‚è¿™ç§æƒ…å†µçš„æ•…éšœæ’é™¤å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤è¿›è¡Œï¼š</p><h3 id=1-æ£€æŸ¥-prometheus-æ—¥å¿—>1. <strong>æ£€æŸ¥ Prometheus æ—¥å¿—</strong>
<a class=anchor href=#1-%e6%a3%80%e6%9f%a5-prometheus-%e6%97%a5%e5%bf%97>#</a></h3><ul><li>æŸ¥çœ‹ Prometheus çš„æ—¥å¿—æ–‡ä»¶ï¼Œä»¥ä¾¿è¯†åˆ«æ˜¯å¦æœ‰ä»»ä½•ç½‘ç»œé”™è¯¯ã€èº«ä»½éªŒè¯å¤±è´¥æˆ–è¶…æ—¶ç­‰ä¿¡æ¯ã€‚</li><li>æ—¥å¿—ä¸­é€šå¸¸ä¼šç»™å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š<ul><li>&ldquo;connection refused&rdquo;ï¼ˆæ‹’ç»è¿æ¥ï¼‰</li><li>&ldquo;timeout&rdquo;ï¼ˆè¶…æ—¶ï¼‰</li><li>&ldquo;authentication failure&rdquo;ï¼ˆè®¤è¯å¤±è´¥ï¼‰</li></ul></li></ul><h3 id=2-æ£€æŸ¥ç½‘ç»œè¿æ¥>2. <strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong>
<a class=anchor href=#2-%e6%a3%80%e6%9f%a5%e7%bd%91%e7%bb%9c%e8%bf%9e%e6%8e%a5>#</a></h3><ul><li><p>Ping ç›®æ ‡æœåŠ¡</p><p>ï¼šé¦–å…ˆç¡®è®¤ Prometheus æ˜¯å¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè¿æ¥åˆ°ç›®æ ‡æœºå™¨æˆ–æœåŠ¡ã€‚ä½¿ç”¨</p><pre tabindex=0><code>ping
</code></pre><p>æˆ–</p><pre tabindex=0><code>telnet
</code></pre><p>æµ‹è¯•ä¸ç›®æ ‡ç«¯å£çš„è¿æ¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ping &lt;target_host&gt;
</span></span><span style=display:flex><span>telnet &lt;target_host&gt; &lt;target_port&gt;
</span></span></code></pre></div></li><li><p><strong>é˜²ç«å¢™å’Œç½‘ç»œç­–ç•¥</strong>ï¼šç¡®ä¿ Prometheus æœåŠ¡å™¨ä¸ç›®æ ‡æœåŠ¡ä¹‹é—´æ²¡æœ‰é˜²ç«å¢™è§„åˆ™æˆ–ç½‘ç»œç­–ç•¥é˜»æ­¢é€šä¿¡ã€‚æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ç›¸åº”ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 80/443 æˆ– Prometheus çš„æŠ“å–ç«¯å£ï¼‰æ˜¯å¼€æ”¾çš„ã€‚</p></li></ul><h3 id=3-æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€>3. <strong>æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€</strong>
<a class=anchor href=#3-%e6%a3%80%e6%9f%a5%e7%9b%ae%e6%a0%87%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81>#</a></h3><ul><li><p>å¦‚æœç›®æ ‡æœåŠ¡æ˜¯ä¸€ä¸ª Web æœåŠ¡æˆ–åº”ç”¨ç¨‹åºï¼Œç¡®ä¿å®ƒæ­£åœ¨è¿è¡Œå¹¶ä¸”èƒ½å¤Ÿæ­£å¸¸å“åº”è¯·æ±‚ã€‚</p><ul><li><p>Web æœåŠ¡</p><p>ï¼šå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æˆ–ä½¿ç”¨</p><pre tabindex=0><code>curl
</code></pre><p>è¯·æ±‚ç›®æ ‡æœåŠ¡çš„</p><pre tabindex=0><code>/metrics
</code></pre><p>ç«¯ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://&lt;target_host&gt;:&lt;port&gt;/metrics
</span></span></code></pre></div></li><li><p><strong>æœåŠ¡å¥åº·æ£€æŸ¥</strong>ï¼šå¦‚æœç›®æ ‡æœåŠ¡æä¾›å¥åº·æ£€æŸ¥ APIï¼Œå…ˆæ£€æŸ¥å¥åº·çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€‚</p></li></ul></li></ul><h3 id=4-æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®>4. <strong>æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®</strong>
<a class=anchor href=#4-%e6%a3%80%e6%9f%a5%e7%9b%ae%e6%a0%87%e7%ab%af%e7%82%b9%e7%9a%84%e9%85%8d%e7%bd%ae>#</a></h3><ul><li>ç¡®ä¿ Prometheus é…ç½®æ–‡ä»¶ä¸­çš„æŠ“å–ç«¯ç‚¹æ˜¯æ­£ç¡®çš„ï¼Œç‰¹åˆ«æ˜¯ URL å’Œç«¯å£ã€‚å¦‚æœ URL æˆ–ç«¯å£é…ç½®é”™è¯¯ï¼ŒPrometheus å°†æ— æ³•æŠ“å–æ•°æ®ã€‚</li><li>æ£€æŸ¥ <code>scrape_configs</code> éƒ¨åˆ†ï¼Œç¡®ä¿ç›®æ ‡æœåŠ¡çš„åœ°å€å’Œç«¯å£æ­£ç¡®ï¼Œå¹¶ä¸”æ²¡æœ‰æ‹¼å†™é”™è¯¯æˆ–æ ¼å¼é—®é¢˜ã€‚</li></ul><h3 id=5-ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜>5. <strong>ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜</strong>
<a class=anchor href=#5-%e7%9b%ae%e6%a0%87%e6%9c%8d%e5%8a%a1%e7%9a%84%e8%b4%9f%e8%bd%bd%e9%97%ae%e9%a2%98>#</a></h3><ul><li>å¦‚æœç›®æ ‡æœåŠ¡åœ¨é«˜è´Ÿè½½ä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“åº”æ—¶é—´è¿‡é•¿ï¼Œä»è€Œå¯¼è‡´ Prometheus æ— æ³•åŠæ—¶æŠ“å–æ•°æ®ã€‚æ£€æŸ¥ç›®æ ‡æœåŠ¡çš„è´Ÿè½½å’Œæ€§èƒ½æŒ‡æ ‡ï¼ˆå¦‚ CPUã€å†…å­˜ä½¿ç”¨ç‡ç­‰ï¼‰ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ã€‚</li><li><strong>èµ„æºä¸è¶³</strong>ï¼šæ£€æŸ¥ç›®æ ‡æœºå™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆä¾‹å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ I/Oï¼‰ï¼Œå¦‚æœè´Ÿè½½è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“åº”è¶…æ—¶æˆ–æœåŠ¡ä¸­æ–­ã€‚</li></ul><h3 id=6-èº«ä»½éªŒè¯é—®é¢˜>6. <strong>èº«ä»½éªŒè¯é—®é¢˜</strong>
<a class=anchor href=#6-%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e9%97%ae%e9%a2%98>#</a></h3><ul><li>å¦‚æœç›®æ ‡æœåŠ¡éœ€è¦èº«ä»½éªŒè¯ï¼ˆå¦‚ HTTP åŸºæœ¬è®¤è¯ã€OAuth ç­‰ï¼‰ï¼Œç¡®ä¿ Prometheus é…ç½®æ–‡ä»¶ä¸­æ­£ç¡®è®¾ç½®äº†èº«ä»½éªŒè¯ä¿¡æ¯ã€‚</li><li>åœ¨ Prometheus é…ç½®æ–‡ä»¶çš„ <code>scrape_configs</code> éƒ¨åˆ†ä¸­ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ èº«ä»½éªŒè¯çš„ <code>basic_auth</code> æˆ– <code>bearer_token</code> ç­‰å‚æ•°ã€‚</li></ul><h3 id=7-æ£€æŸ¥-prometheus-é…ç½®æ–‡ä»¶>7. <strong>æ£€æŸ¥ Prometheus é…ç½®æ–‡ä»¶</strong>
<a class=anchor href=#7-%e6%a3%80%e6%9f%a5-prometheus-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h3><ul><li>ç¡®ä¿ <code>scrape_interval</code> é…ç½®åˆç†ã€‚å¦‚æœæŠ“å–é—´éš”å¤ªçŸ­ï¼Œç›®æ ‡å¯èƒ½æ— æ³•åŠæ—¶å“åº”ï¼Œå¯¼è‡´æŠ“å–å¤±è´¥ã€‚é€‚å½“å¢å¤§æŠ“å–é—´éš”ï¼Œä»¥é¿å…è¿‡åº¦çš„å‹åŠ›ã€‚</li><li>è¿˜è¦æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† <strong>scrape_timeout</strong>ï¼Œå¦‚æœç›®æ ‡å“åº”è¶…æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ <code>target down</code>ã€‚</li></ul><h3 id=8-æŸ¥çœ‹-prometheus-ç›®æ ‡çŠ¶æ€>8. <strong>æŸ¥çœ‹ Prometheus ç›®æ ‡çŠ¶æ€</strong>
<a class=anchor href=#8-%e6%9f%a5%e7%9c%8b-prometheus-%e7%9b%ae%e6%a0%87%e7%8a%b6%e6%80%81>#</a></h3><ul><li>åœ¨ Prometheus çš„ Web UI ä¸­ï¼Œè®¿é—® <code>Status -> Targets</code> é¡µé¢ï¼ŒæŸ¥çœ‹ç›®æ ‡çš„çŠ¶æ€ã€æœ€åä¸€æ¬¡æŠ“å–çš„æ—¶é—´å’Œä»»ä½•é”™è¯¯ä¿¡æ¯ã€‚</li><li>ç›®æ ‡é¡µé¢é€šå¸¸ä¼šæ˜¾ç¤ºä¸€äº›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©ä½ è¿›ä¸€æ­¥è¯Šæ–­é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ˜¯å¦å­˜åœ¨ &ldquo;http_errors&rdquo; æˆ– &ldquo;timeouts&rdquo;ã€‚</li></ul><h3 id=9-é‡å¯-prometheus>9. <strong>é‡å¯ Prometheus</strong>
<a class=anchor href=#9-%e9%87%8d%e5%90%af-prometheus>#</a></h3><ul><li>å¦‚æœæ‰€æœ‰è®¾ç½®çœ‹èµ·æ¥éƒ½æ­£ç¡®ï¼Œä½† Prometheus ä»ç„¶æ— æ³•è¿æ¥åˆ°ç›®æ ‡æœåŠ¡ï¼Œå¯ä»¥å°è¯•é‡å¯ Prometheusã€‚è¿™æœ‰æ—¶å¯ä»¥è§£å†³ä¸ç½‘ç»œè¿æ¥æˆ–æœåŠ¡çŠ¶æ€ç›¸å…³çš„ä¸´æ—¶é—®é¢˜ã€‚</li></ul><h3 id=10-ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—>10. <strong>ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—</strong>
<a class=anchor href=#10-%e7%9b%ae%e6%a0%87%e7%ab%af%e6%9c%8d%e5%8a%a1%e6%97%a5%e5%bf%97>#</a></h3><ul><li>æŸ¥çœ‹ç›®æ ‡æœåŠ¡çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ä¸ Prometheus æŠ“å–ç›¸å…³çš„é”™è¯¯æˆ–è­¦å‘Šä¿¡æ¯ã€‚</li><li>å¦‚æœç›®æ ‡æœåŠ¡æš´éœ²åœ¨å®¹å™¨æˆ–è™šæ‹Ÿæœºä¸­ï¼Œç¡®ä¿è¯¥å®¹å™¨æˆ–è™šæ‹Ÿæœºè¿è¡Œæ­£å¸¸ä¸”æ²¡æœ‰èµ„æºç“¶é¢ˆã€‚</li></ul><h3 id=æ•…éšœæ’é™¤ç¤ºä¾‹>æ•…éšœæ’é™¤ç¤ºä¾‹ï¼š
<a class=anchor href=#%e6%95%85%e9%9a%9c%e6%8e%92%e9%99%a4%e7%a4%ba%e4%be%8b>#</a></h3><p>å‡è®¾ Prometheus æ˜¾ç¤ºä¸€ä¸ªç›®æ ‡ä¸º <strong>down</strong>ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ’æŸ¥ï¼š</p><ol><li>åœ¨ Prometheus UI ä¸­æŸ¥çœ‹ç›®æ ‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œå‘ç°é”™è¯¯ä¿¡æ¯ä¸º <code>connection refused</code>ã€‚</li><li>ä½¿ç”¨ <code>telnet</code> æµ‹è¯•ä¸ç›®æ ‡ç«¯å£çš„è¿æ¥ï¼Œå‘ç°è¿æ¥ä¸ä¸Šã€‚</li><li>æ£€æŸ¥ç›®æ ‡æœåŠ¡çš„çŠ¶æ€ï¼Œå‘ç°ç›®æ ‡æœåŠ¡æœªå¯åŠ¨ï¼Œå°è¯•é‡å¯ç›®æ ‡æœåŠ¡ã€‚</li><li>å†æ¬¡æŸ¥çœ‹ Prometheus UIï¼Œå‘ç°ç›®æ ‡çŠ¶æ€å˜ä¸º <strong>up</strong>ï¼Œé—®é¢˜è§£å†³ã€‚</li></ol><h3 id=æ€»ç»“-8>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93-8>#</a></h3><p>è§£å†³ <code>target down</code> é—®é¢˜é€šå¸¸æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„æ£€æŸ¥ï¼š</p><ol><li>ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™ã€‚</li><li>ç›®æ ‡æœåŠ¡çš„å¯ç”¨æ€§ã€‚</li><li>Prometheus é…ç½®å’ŒæŠ“å–ç«¯ç‚¹ã€‚</li><li>ç›®æ ‡æœåŠ¡çš„è´Ÿè½½å’Œèº«ä»½éªŒè¯ã€‚</li></ol><p>é€šè¿‡æœ‰åºçš„æ’æŸ¥ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ‰¾å‡ºå¹¶è§£å†³ç›®æ ‡æœåŠ¡æ— æ³•æŠ“å–çš„æ ¹æœ¬åŸå› ã€‚</p><h2 id=exporter-åœæ­¢å·¥ä½œå¦‚ä½•ç›‘æ§>Exporter åœæ­¢å·¥ä½œï¼Œå¦‚ä½•ç›‘æ§ï¼Ÿ
<a class=anchor href=#exporter-%e5%81%9c%e6%ad%a2%e5%b7%a5%e4%bd%9c%e5%a6%82%e4%bd%95%e7%9b%91%e6%8e%a7>#</a></h2><p>ç›‘æ§ <strong>Exporter</strong> åœæ­¢å·¥ä½œæ˜¯ç¡®ä¿ç³»ç»Ÿå¯é æ€§å’Œå¥åº·çš„å…³é”®æ­¥éª¤ã€‚Exporter åœæ­¢å·¥ä½œæ—¶ï¼ŒPrometheus æ— æ³•æŠ“å–æŒ‡æ ‡ï¼Œè¿™ä¼šå½±å“ä½ çš„ç›‘æ§å’ŒæŠ¥è­¦ç³»ç»Ÿã€‚å› æ­¤ï¼Œç›‘æ§ Exporter æœ¬èº«çš„å¥åº·çŠ¶æ€ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç›‘æ§ Exporter åœæ­¢å·¥ä½œçš„æ–¹æ³•ï¼š</p><h3 id=1-prometheus-è‡ªèº«çš„ç›‘æ§>1. <strong>Prometheus è‡ªèº«çš„ç›‘æ§</strong>
<a class=anchor href=#1-prometheus-%e8%87%aa%e8%ba%ab%e7%9a%84%e7%9b%91%e6%8e%a7>#</a></h3><ul><li><p>Target çŠ¶æ€</p><p>ï¼šPrometheus ä¼šåœ¨ Web UI ä¸Šæ˜¾ç¤ºæŠ“å–ç›®æ ‡çš„å¥åº·çŠ¶æ€ã€‚ä½ å¯ä»¥ç›‘æ§</p><p>Prometheus Targets</p><p>é¡µé¢çš„</p><pre tabindex=0><code>last scrape
</code></pre><p>æ—¶é—´ï¼Œçœ‹çœ‹ç›®æ ‡æ˜¯å¦ä»ç„¶å¤„äºæ­£å¸¸æŠ“å–çŠ¶æ€ã€‚</p><ul><li>é€šè¿‡ <code>Status -> Targets</code> é¡µé¢ï¼Œä½ å¯ä»¥æŸ¥çœ‹æ¯ä¸ªç›®æ ‡çš„æœ€åæŠ“å–æ—¶é—´ã€æŠ“å–çŠ¶æ€ä»¥åŠç›¸å…³çš„é”™è¯¯ä¿¡æ¯ã€‚é€šè¿‡ç›‘æ§è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥ç¡®ä¿ Exporter æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li></ul></li><li><p>Prometheus ä»»åŠ¡å¤±è´¥æŠ¥è­¦</p><p>ï¼šPrometheus å¯ä»¥è®¾ç½®æŠ¥è­¦è§„åˆ™ï¼Œå½“æŸä¸ª Exporter é•¿æ—¶é—´æ²¡æœ‰æŠ“å–åˆ°æ•°æ®æ—¶å‘å‡ºæŠ¥è­¦ã€‚ä¾‹å¦‚ï¼Œ</p><pre tabindex=0><code>up
</code></pre><p>æŒ‡æ ‡ä¸º 0 è¡¨ç¤ºç›®æ ‡ä¸å¯è¾¾ï¼Œå¯ä»¥è®¾ç½®å‘Šè­¦è§„åˆ™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>exporters</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>ExporterDown</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>up{job=&#34;your_exporter_job&#34;} == 0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>for</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;Exporter is down for more than 5 minutes&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;The exporter for {{ $labels.instance }} is not reachable for the last 5 minutes.&#34;</span>
</span></span></code></pre></div><p>è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿åœ¨ Exporter åœæ­¢å·¥ä½œæ—¶åŠæ—¶é€šçŸ¥ä½ ã€‚</p></li></ul><h3 id=2-exporter-çš„å¥åº·æ£€æŸ¥>2. <strong>Exporter çš„å¥åº·æ£€æŸ¥</strong>
<a class=anchor href=#2-exporter-%e7%9a%84%e5%81%a5%e5%ba%b7%e6%a3%80%e6%9f%a5>#</a></h3><ul><li><p><strong>HTTP å¥åº·æ£€æŸ¥ç«¯ç‚¹</strong>ï¼šå¦‚æœä½ çš„ Exporter æ”¯æŒå¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¦‚ <code>/health</code> æˆ– <code>/metrics</code>ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ Prometheus æˆ–å…¶ä»–ç›‘æ§å·¥å…·å®šæœŸæ£€æŸ¥è¯¥ç«¯ç‚¹çš„å“åº”çŠ¶æ€ã€‚</p></li><li><p>è‡ªå®šä¹‰ Exporter å¥åº·æŒ‡æ ‡</p><p>ï¼šè®¸å¤š Exporter æä¾›äº†å¥åº·çŠ¶æ€æˆ–å†…éƒ¨æŒ‡æ ‡ï¼Œå¦‚</p><pre tabindex=0><code>up
</code></pre><p>ã€</p><pre tabindex=0><code>health
</code></pre><p>ã€</p><pre tabindex=0><code>status
</code></pre><p>ç­‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥è€ƒè™‘è‡ªå®šä¹‰å®ç°ï¼Œæš´éœ²ä¸€ä¸ªæŒ‡æ ‡æ¥æ˜¾ç¤º Exporter æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åœ¨ä½ çš„ Exporter ä¸­åŠ å…¥ /metrics ç«¯ç‚¹ç›‘æ§æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¾‹å¦‚ï¼šup{job=&#34;my_exporter&#34;} 1</span>
</span></span></code></pre></div><p>Prometheus å¯ä»¥æŠ“å–å¹¶åœ¨ä¸æ­£å¸¸æ—¶æŠ¥è­¦ã€‚</p></li></ul><h3 id=3-exporter-è¿›ç¨‹ç›‘æ§>3. <strong>Exporter è¿›ç¨‹ç›‘æ§</strong>
<a class=anchor href=#3-exporter-%e8%bf%9b%e7%a8%8b%e7%9b%91%e6%8e%a7>#</a></h3><ul><li><p><strong>è¿›ç¨‹ç›‘æ§</strong>ï¼šä½¿ç”¨ <strong>node_exporter</strong> æˆ– <strong>prometheus-node-exporter</strong> æ¥ç›‘æ§ Exporter çš„è¿›ç¨‹çŠ¶æ€ã€‚ä½ å¯ä»¥æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œï¼Œå¹¶ç›‘æ§ Exporter çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰ã€‚</p></li><li><p>Linux è¿›ç¨‹ç›‘æ§</p><p>ï¼šä½ å¯ä»¥ä½¿ç”¨</p><pre tabindex=0><code>ps
</code></pre><p>ã€</p><pre tabindex=0><code>top
</code></pre><p>æˆ–</p><pre tabindex=0><code>systemd
</code></pre><p>ç­‰å·¥å…·æŸ¥çœ‹ Exporter è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚æ¯”å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps aux | grep &lt;exporter_name&gt;
</span></span></code></pre></div><p>å¦‚æœè¿›ç¨‹åœæ­¢ï¼Œä½ å¯ä»¥è®¾ç½®è‡ªåŠ¨é‡å¯è¿›ç¨‹çš„æœºåˆ¶ï¼ˆå¦‚ systemd è‡ªåŠ¨é‡å¯ï¼‰ã€‚</p></li></ul><h3 id=4-å¤–éƒ¨æœåŠ¡ç›‘æ§>4. <strong>å¤–éƒ¨æœåŠ¡ç›‘æ§</strong>
<a class=anchor href=#4-%e5%a4%96%e9%83%a8%e6%9c%8d%e5%8a%a1%e7%9b%91%e6%8e%a7>#</a></h3><ul><li><p>å®¹å™¨åŒ– Exporter</p><p>ï¼šå¦‚æœ Exporter è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨ç›‘æ§å·¥å…·ï¼ˆå¦‚ Kubernetes æˆ– Dockerï¼‰æ¥ç›‘æ§å®¹å™¨çš„å¥åº·çŠ¶æ€ã€‚</p><ul><li>åœ¨ Kubernetes ä¸­ï¼Œä½ å¯ä»¥é…ç½®å¥åº·æ£€æŸ¥ï¼ˆliveness å’Œ readiness probeï¼‰æ¥æ£€æŸ¥ Exporter æ˜¯å¦å¯ç”¨ã€‚è¿™æ ·ï¼Œå½“ Exporter åœæ­¢æ—¶ï¼ŒKubernetes ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ã€‚</li><li>åœ¨ Docker ä¸­ï¼Œä½ å¯ä»¥è®¾ç½®å®¹å™¨çš„å¥åº·æ£€æŸ¥ï¼Œç›‘æ§å®¹å™¨å†…çš„æœåŠ¡çŠ¶æ€ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker inspect --format <span style=color:#e6db74>&#39;{{json .State.Health}}&#39;</span> &lt;container_id&gt;
</span></span></code></pre></div></li></ul><h3 id=5-æ—¥å¿—ç›‘æ§>5. <strong>æ—¥å¿—ç›‘æ§</strong>
<a class=anchor href=#5-%e6%97%a5%e5%bf%97%e7%9b%91%e6%8e%a7>#</a></h3><ul><li><strong>Exporter æ—¥å¿—</strong>ï¼šå¾ˆå¤š Exporter éƒ½æœ‰æ—¥å¿—è¾“å‡ºï¼Œç›‘æ§æ—¥å¿—æ˜¯æ’æŸ¥é—®é¢˜çš„å¥½æ–¹æ³•ã€‚é€šè¿‡ <strong>log shipper</strong>ï¼ˆå¦‚ <strong>Fluentd</strong>ã€<strong>Logstash</strong>ã€<strong>Filebeat</strong> ç­‰ï¼‰å°†æ—¥å¿—æ”¶é›†åˆ° ELK æˆ–å…¶ä»–æ—¥å¿—ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨é”™è¯¯æˆ–å´©æºƒçš„æ—¥å¿—ã€‚</li><li><strong>é”™è¯¯æ—¥å¿—åˆ†æ</strong>ï¼šå½“ Exporter åœæ­¢å·¥ä½œæ—¶ï¼Œé€šå¸¸ä¼šæœ‰ç›¸å…³é”™è¯¯æ—¥å¿—ã€‚å¯ä»¥é€šè¿‡åˆ†ææ—¥å¿—å†…å®¹æ¥å‘ç°æ•…éšœçš„æ ¹æœ¬åŸå› ã€‚</li></ul><h3 id=6-è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½>6. <strong>è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½</strong>
<a class=anchor href=#6-%e8%87%aa%e5%8a%a8%e5%8c%96%e4%bf%ae%e5%a4%8d%e6%8e%aa%e6%96%bd>#</a></h3><ul><li><p>è‡ªåŠ¨é‡å¯ Exporter</p><p>ï¼šå¦‚æœ Exporter åœæ­¢å·¥ä½œï¼Œå¯ä»¥é…ç½®è‡ªåŠ¨é‡å¯æœºåˆ¶ã€‚é€šè¿‡</p><p>systemd</p><p>æˆ–</p><p>Supervisor</p><p>ç­‰å·¥å…·ï¼Œç¡®ä¿ Exporter åœ¨åœæ­¢åèƒ½å¤Ÿè‡ªåŠ¨é‡å¯ã€‚</p><ul><li><p>åœ¨ systemd ä¸­ï¼Œä½ å¯ä»¥é…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[Unit]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Description</span><span style=color:#f92672>=</span><span style=color:#e6db74>Exporter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ExecStart</span><span style=color:#f92672>=</span><span style=color:#e6db74>/path/to/exporter</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Restart</span><span style=color:#f92672>=</span><span style=color:#e6db74>always</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>RestartSec</span><span style=color:#f92672>=</span><span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Install]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>WantedBy</span><span style=color:#f92672>=</span><span style=color:#e6db74>multi-user.target</span>
</span></span></code></pre></div></li><li><p>é€šè¿‡è®¾ç½® <code>Restart=always</code>ï¼Œå¯ä»¥ç¡®ä¿ Exporter åœ¨ä»»ä½•æ„å¤–åœæ­¢åè¢«è‡ªåŠ¨é‡å¯ã€‚</p></li></ul></li></ul><h3 id=7-å¤–éƒ¨ç›‘æ§å·¥å…·>7. <strong>å¤–éƒ¨ç›‘æ§å·¥å…·</strong>
<a class=anchor href=#7-%e5%a4%96%e9%83%a8%e7%9b%91%e6%8e%a7%e5%b7%a5%e5%85%b7>#</a></h3><ul><li><strong>é»‘ç›’ç›‘æ§</strong>ï¼šä½ è¿˜å¯ä»¥ä½¿ç”¨å¤–éƒ¨ç›‘æ§å·¥å…·ï¼ˆå¦‚ <strong>Pingdom</strong> æˆ– <strong>UptimeRobot</strong>ï¼‰å¯¹ Exporter çš„ <code>/metrics</code> ç«¯ç‚¹è¿›è¡Œé»‘ç›’ç›‘æ§ï¼Œç¡®ä¿æœåŠ¡æ˜¯å¯è¾¾çš„ã€‚</li><li><strong>Alertmanager é›†æˆ</strong>ï¼šé€šè¿‡ Prometheus çš„ <strong>Alertmanager</strong> é›†æˆï¼Œå¯ä»¥è®¾ç½®å¤æ‚çš„æŠ¥è­¦è§„åˆ™ï¼Œè¿›è¡Œå¤šæ¸ é“é€šçŸ¥ï¼ˆå¦‚ Slackã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰ï¼‰ï¼Œç¡®ä¿åœ¨ Exporter åœæ­¢å·¥ä½œæ—¶èƒ½å¤ŸåŠæ—¶é€šçŸ¥è¿ç»´äººå‘˜ã€‚</li></ul><h3 id=8-åˆ†ææŒ‡æ ‡ä¸¢å¤±>8. <strong>åˆ†ææŒ‡æ ‡ä¸¢å¤±</strong>
<a class=anchor href=#8-%e5%88%86%e6%9e%90%e6%8c%87%e6%a0%87%e4%b8%a2%e5%a4%b1>#</a></h3><ul><li>å¦‚æœ Exporter åœæ­¢å·¥ä½œï¼ŒPrometheus ä¼šåœ¨æŠ“å–è¯¥ç›®æ ‡æ—¶ä¸¢å¤±æŒ‡æ ‡ã€‚é€šè¿‡ç›‘æ§ Prometheus çš„ <strong>scrape_latency</strong> å’Œ <strong>scrape_errors</strong> æŒ‡æ ‡ï¼Œå¯ä»¥åˆ†ææŠ“å–æ—¶çš„å»¶è¿Ÿå’Œé”™è¯¯ï¼Œå‘ç° Exporter æ˜¯å¦æœ‰é—®é¢˜ã€‚</li></ul><h3 id=æ€»ç»“-9>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93-9>#</a></h3><p>ç›‘æ§ Exporter åœæ­¢å·¥ä½œä¸»è¦æ˜¯ç¡®ä¿å…¶ <strong>å¯è¾¾æ€§</strong>ã€<strong>å¥åº·çŠ¶æ€</strong>ã€<strong>è¿›ç¨‹è¿è¡ŒçŠ¶æ€</strong>ï¼Œå¹¶é€šè¿‡ Prometheusã€å¤–éƒ¨å·¥å…·ä»¥åŠæ—¥å¿—ç›‘æ§ç­‰æ‰‹æ®µç¡®ä¿åŠæ—¶å‘ç°é—®é¢˜å¹¶è¿›è¡Œè‡ªåŠ¨æ¢å¤ã€‚é€šè¿‡é…ç½®åˆç†çš„å‘Šè­¦æœºåˆ¶ï¼Œå½“ Exporter åœæ­¢å·¥ä½œæ—¶ï¼Œèƒ½å¤ŸåŠæ—¶é‡‡å–åº”å¯¹æªæ–½ï¼Œç¡®ä¿ç›‘æ§ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚</p><h2 id=prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹>Prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ
<a class=anchor href=#prometheus%e7%9a%84%e6%8b%89%e5%8f%96%e6%a8%a1%e5%bc%8f%e4%b8%8ezabbix%e6%8e%a8%e9%80%81%e6%a8%a1%e5%bc%8f%e6%9c%89%e4%bd%95%e5%8c%ba%e5%88%ab%e5%90%84%e6%9c%89%e4%bb%80%e4%b9%88%e4%bc%98%e7%bc%ba%e7%82%b9>#</a></h2><p>Prometheus çš„æ‹‰å–æ¨¡å¼ï¼ˆPull Modelï¼‰å’Œ Zabbix çš„æ¨é€æ¨¡å¼ï¼ˆPush Modelï¼‰åœ¨æ•°æ®æ”¶é›†å’Œç›‘æ§æ¶æ„ä¸Šæœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸¤ç§æ¨¡å¼çš„æ¯”è¾ƒï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ä¼˜ç¼ºç‚¹ï¼š</p><h3 id=1-prometheus-æ‹‰å–æ¨¡å¼pull-model>1. <strong>Prometheus æ‹‰å–æ¨¡å¼ï¼ˆPull Modelï¼‰</strong>
<a class=anchor href=#1-prometheus-%e6%8b%89%e5%8f%96%e6%a8%a1%e5%bc%8fpull-model>#</a></h3><p><strong>åŸç†</strong>ï¼šPrometheus ä½œä¸ºç›‘æ§ç³»ç»Ÿï¼Œå®šæœŸä¸»åŠ¨ä»è¢«ç›‘æ§çš„ç›®æ ‡ï¼ˆå¦‚åº”ç”¨ç¨‹åºã€æ•°æ®åº“ã€æœåŠ¡å™¨ç­‰ï¼‰ä¸­æ‹‰å–ï¼ˆscrapeï¼‰æŒ‡æ ‡æ•°æ®ã€‚</p><p><strong>å·¥ä½œæ–¹å¼</strong>ï¼š</p><ul><li>Prometheus é…ç½®äº†å¤šä¸ª <code>targets</code>ï¼ˆç›®æ ‡ï¼‰ï¼Œæ¯ä¸ªç›®æ ‡éƒ½æœ‰ä¸€ä¸ªæš´éœ² <code>/metrics</code> ç«¯ç‚¹ï¼ˆé€šå¸¸æ˜¯ HTTPï¼‰ã€‚</li><li>Prometheus å®šæœŸè®¿é—®è¿™äº›ç«¯ç‚¹æ‹‰å–æ•°æ®ã€‚</li><li>æ‹‰å–æ•°æ®çš„é—´éš”ã€è¶…æ—¶ç­‰éƒ½å¯ä»¥åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>å»ä¸­å¿ƒåŒ–ç®¡ç†</strong>ï¼šPrometheus ä¸»åŠ¨ä»å¤šä¸ªç›®æ ‡æ‹‰å–æ•°æ®ï¼Œä¸éœ€è¦åœ¨è¢«ç›‘æ§çš„ç³»ç»Ÿä¸Šå®‰è£…ä»»ä½•æ¨é€çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡ã€‚</li><li><strong>æ— å®¢æˆ·ç«¯é…ç½®</strong>ï¼šç”±äºæ‹‰å–æ•°æ®æ˜¯ç”± Prometheus è‡ªå·±å‘èµ·çš„ï¼Œè¢«ç›‘æ§çš„ç›®æ ‡ä¸éœ€è¦çŸ¥é“ Prometheus çš„å­˜åœ¨ï¼Œé…ç½®è¾ƒä¸ºç®€å•ã€‚</li><li><strong>çµæ´»æ€§é«˜</strong>ï¼šå¯ä»¥æ–¹ä¾¿åœ°é…ç½®æŠ“å–é—´éš”ã€æ‹‰å–è¶…æ—¶ç­‰å‚æ•°ï¼Œçµæ´»åº”å¯¹ä¸åŒç›®æ ‡çš„ç›‘æ§éœ€æ±‚ã€‚</li><li><strong>æ”¯æŒæœåŠ¡å‘ç°</strong>ï¼šPrometheus æ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆå¦‚ Kubernetesã€Consulã€DNSï¼‰ï¼Œèƒ½å¤ŸåŠ¨æ€å‘ç°å¹¶ç›‘æ§æ–°çš„ç›®æ ‡ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>ä¾èµ–ç›®æ ‡å¯è¾¾æ€§</strong>ï¼šæ‹‰å–æ¨¡å¼è¦æ±‚ Prometheus èƒ½å¤Ÿè®¿é—®æ‰€æœ‰ç›®æ ‡ï¼Œå¦‚æœç›®æ ‡ä¸å¯è¾¾ï¼ŒPrometheus å°±æ— æ³•è·å–æ•°æ®ã€‚</li><li><strong>ç½‘ç»œå¸¦å®½æ¶ˆè€—è¾ƒå¤§</strong>ï¼šç”±äº Prometheus å®šæœŸæ‹‰å–æ•°æ®ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„ç½‘ç»œè¯·æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡éƒ¨ç½²æ—¶ï¼Œå¯¹ç½‘ç»œå¸¦å®½æœ‰è¾ƒå¤§çš„æ¶ˆè€—ã€‚</li><li><strong>å»¶è¿Ÿè¾ƒé«˜</strong>ï¼šæ‹‰å–æ¨¡å¼ä¸‹ï¼ŒPrometheus çš„æ•°æ®é‡‡é›†é—´éš”è¾ƒä¸ºå›ºå®šï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®æœ‰ä¸€å®šå»¶è¿Ÿï¼ˆä¾‹å¦‚æ¯ 15 ç§’æˆ– 1 åˆ†é’Ÿæ‰æŠ“å–ä¸€æ¬¡ï¼‰ã€‚</li></ul><hr><h3 id=2-zabbix-æ¨é€æ¨¡å¼push-model>2. <strong>Zabbix æ¨é€æ¨¡å¼ï¼ˆPush Modelï¼‰</strong>
<a class=anchor href=#2-zabbix-%e6%8e%a8%e9%80%81%e6%a8%a1%e5%bc%8fpush-model>#</a></h3><p><strong>åŸç†</strong>ï¼šZabbix é€šè¿‡ç›‘æ§ä»£ç†æˆ–å®¢æˆ·ç«¯ï¼Œå°†ç›‘æ§æ•°æ®ä¸»åŠ¨æ¨é€åˆ° Zabbix æœåŠ¡å™¨ã€‚</p><p><strong>å·¥ä½œæ–¹å¼</strong>ï¼š</p><ul><li>Zabbix åœ¨è¢«ç›‘æ§ç›®æ ‡ä¸Šå®‰è£…äº†ç›‘æ§ä»£ç†ï¼ˆZabbix Agentï¼‰ï¼Œè¯¥ä»£ç†è´Ÿè´£æ”¶é›†æœ¬æœºçš„å„ç§æŒ‡æ ‡ã€‚</li><li>ä»£ç†å°†æ•°æ®æ¨é€åˆ° Zabbix Server æˆ– Zabbix Proxyï¼ŒZabbix æœåŠ¡å™¨å®šæœŸå¤„ç†è¿™äº›æ•°æ®å¹¶ç”ŸæˆæŠ¥è­¦ã€æŠ¥å‘Šç­‰ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>å³åˆ»æ”¶é›†æ•°æ®</strong>ï¼šæ•°æ®æ¨é€åˆ°æœåŠ¡å™¨åï¼Œå‡ ä¹å®æ—¶å¯ä»¥çœ‹åˆ°ç›‘æ§æ•°æ®ï¼Œå»¶è¿Ÿè¾ƒä½ã€‚</li><li><strong>é€‚åº”åŠ¨æ€ç¯å¢ƒ</strong>ï¼šåœ¨ä¸€äº›ç›®æ ‡è¾ƒä¸ºåŠ¨æ€ï¼ˆå¦‚å®¹å™¨åŒ–ç¯å¢ƒï¼‰æ—¶ï¼Œæ¨é€æ¨¡å¼å¯ä»¥æ›´åŠ çµæ´»åœ°å¤„ç†æ–°ç›®æ ‡çš„åŠ å…¥ã€‚</li><li><strong>ç›®æ ‡æ— é¡»æš´éœ²ç«¯å£</strong>ï¼šç”±äºæ•°æ®æ˜¯ä»ä»£ç†ç«¯æ¨é€åˆ°æœåŠ¡å™¨ï¼Œç›®æ ‡ç³»ç»Ÿä¸éœ€è¦æš´éœ² HTTP ç«¯å£æˆ–å…¶ä»–æœåŠ¡ç«¯ç‚¹ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ã€‚</li><li><strong>æ”¯æŒä¸»åŠ¨æŠ¥è­¦</strong>ï¼šZabbix ä»£ç†å¯åœ¨ç›‘æ§æŒ‡æ ‡è¾¾åˆ°é¢„è­¦æ¡ä»¶æ—¶ä¸»åŠ¨å‘æœåŠ¡å™¨æŠ¥å‘Šï¼Œå‡å°‘äº†æœåŠ¡å™¨ç«¯çš„è´Ÿæ‹…ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>ä»£ç†éƒ¨ç½²</strong>ï¼šéœ€è¦åœ¨æ¯ä¸ªè¢«ç›‘æ§çš„ç›®æ ‡ä¸Šéƒ¨ç½² Zabbix ä»£ç†ï¼Œè¿™å¯èƒ½å¢åŠ é…ç½®å’Œç»´æŠ¤çš„å¤æ‚åº¦ï¼Œå°¤å…¶åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­ã€‚</li><li><strong>ä»£ç†æ•…éšœé£é™©</strong>ï¼šå¦‚æœ Zabbix ä»£ç†åœæ­¢å·¥ä½œæˆ–é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œæ•°æ®å°±æ— æ³•æ¨é€åˆ° Zabbix æœåŠ¡å™¨ï¼Œå¯èƒ½å¯¼è‡´ç›‘æ§æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>å¤æ‚çš„ç½‘ç»œé…ç½®</strong>ï¼šéœ€è¦å¤„ç†ç½‘ç»œè®¿é—®æ§åˆ¶ã€é˜²ç«å¢™ç­‰é—®é¢˜ï¼Œå› ä¸ºè¢«ç›‘æ§çš„ç›®æ ‡éœ€è¦æ¨é€æ•°æ®åˆ° Zabbix æœåŠ¡å™¨æˆ–ä»£ç†ã€‚</li><li><strong>ä¸é€‚åˆå¤§é‡ç›®æ ‡çš„å®æ—¶ç›‘æ§</strong>ï¼šå¦‚æœç›®æ ‡éå¸¸å¤šï¼Œæ¨é€æ¨¡å¼å¯èƒ½ä¼šé€ æˆä»£ç†å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œå‹åŠ›ã€‚</li></ul><hr><h3 id=3-å¯¹æ¯”æ€»ç»“>3. <strong>å¯¹æ¯”æ€»ç»“</strong>
<a class=anchor href=#3-%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93>#</a></h3><table><thead><tr><th>ç‰¹æ€§</th><th><strong>Prometheus æ‹‰å–æ¨¡å¼</strong></th><th><strong>Zabbix æ¨é€æ¨¡å¼</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®é‡‡é›†æ–¹å¼</strong></td><td>Prometheus å®šæœŸæ‹‰å–æ•°æ®</td><td>ç›®æ ‡ä¸»åŠ¨æ¨é€æ•°æ®</td></tr><tr><td><strong>é…ç½®å¤æ‚åº¦</strong></td><td>æ— éœ€åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šé…ç½®ä»£ç†</td><td>éœ€è¦åœ¨æ¯ä¸ªç›®æ ‡å®‰è£…ä»£ç†</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>å®¹æ˜“æ‰©å±•ï¼ˆä½¿ç”¨æœåŠ¡å‘ç°ï¼‰</td><td>æ‰©å±•æ—¶éœ€è¦ç®¡ç†æ›´å¤šçš„ä»£ç†</td></tr><tr><td><strong>å»¶è¿Ÿ</strong></td><td>å¯èƒ½æœ‰è¾ƒé«˜å»¶è¿Ÿï¼ˆå–å†³äºæŠ“å–é—´éš”ï¼‰</td><td>æ•°æ®æ¨é€è¾ƒä¸ºå®æ—¶</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>éœ€è¦æš´éœ²ç«¯å£æ¥æ‹‰å–æ•°æ®</td><td>æ¨é€æ•°æ®ä¸éœ€è¦æš´éœ²ç«¯å£</td></tr><tr><td><strong>å¯é æ€§</strong></td><td>å¦‚æœç›®æ ‡ä¸å¯è¾¾ï¼Œä¼šä¸¢å¤±æ•°æ®</td><td>å¦‚æœä»£ç†æˆ–ç½‘ç»œä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±</td></tr><tr><td><strong>ç½‘ç»œè´Ÿè½½</strong></td><td>å®šæœŸæ‹‰å–ï¼Œå¯èƒ½äº§ç”Ÿå¤§é‡è¯·æ±‚</td><td>æ¨é€æ•°æ®ï¼Œå¦‚æœç›®æ ‡ä¸ç¨³å®šåˆ™å¯èƒ½é€ æˆå‹åŠ›</td></tr><tr><td><strong>é€‚åº”åŠ¨æ€ç¯å¢ƒï¼ˆå¦‚å®¹å™¨åŒ–ï¼‰</strong></td><td>é€‚åº”æ€§è¾ƒå¼ºï¼Œé€šè¿‡æœåŠ¡å‘ç°åŠ¨æ€æ·»åŠ ç›®æ ‡</td><td>éœ€è¦åŠ¨æ€æ›´æ–°ä»£ç†é…ç½®</td></tr><tr><td><strong>æŠ¥è­¦æœºåˆ¶</strong></td><td>æŠ¥è­¦é€šè¿‡ Prometheus çš„æŸ¥è¯¢å’Œè§„åˆ™å¼•æ“è§¦å‘</td><td>ä»£ç†å¯ä»¥ä¸»åŠ¨æ¨é€æŠ¥è­¦ä¿¡æ¯</td></tr></tbody></table><hr><h3 id=4-é€‚ç”¨åœºæ™¯-3>4. <strong>é€‚ç”¨åœºæ™¯</strong>
<a class=anchor href=#4-%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af-3>#</a></h3><ul><li><strong>Prometheus æ‹‰å–æ¨¡å¼</strong>ï¼šé€‚ç”¨äºå¤§è§„æ¨¡ã€å®¹å™¨åŒ–ç¯å¢ƒï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†åŠ¨æ€å˜åŒ–çš„ç›®æ ‡ï¼Œå¹¶ä¸”é€šè¿‡çµæ´»çš„é…ç½®å’ŒæœåŠ¡å‘ç°æœºåˆ¶æ¥æ”¯æŒè‡ªåŠ¨åŒ–ç›‘æ§ã€‚</li><li><strong>Zabbix æ¨é€æ¨¡å¼</strong>ï¼šé€‚ç”¨äºéœ€è¦å®æ—¶æ•°æ®ä¸”ç›®æ ‡å¯ä»¥ä¸»åŠ¨æ¨é€æ•°æ®çš„ç¯å¢ƒï¼Œå°¤å…¶é€‚åˆä¼ ç»Ÿçš„ IT åŸºç¡€è®¾æ–½ï¼Œå¹¶ä¸”ç›®æ ‡ç³»ç»Ÿçš„ä»£ç†èƒ½å¤Ÿç¨³å®šè¿è¡Œã€‚</li></ul><h3 id=æ€»ç»“-10>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93-10>#</a></h3><ul><li><strong>Prometheus çš„æ‹‰å–æ¨¡å¼</strong> æ›´é€‚åˆå¤§è§„æ¨¡ã€å®¹å™¨åŒ–ã€äº‘åŸç”Ÿç¯å¢ƒï¼Œæ”¯æŒè‡ªåŠ¨åŒ–ã€çµæ´»æ€§é«˜ï¼Œä½†å¯¹ç½‘ç»œä¾èµ–è¾ƒå¤§ã€‚</li><li><strong>Zabbix çš„æ¨é€æ¨¡å¼</strong> æ›´é€‚åˆä¼ ç»Ÿç¯å¢ƒï¼Œæ”¯æŒå®æ—¶ç›‘æ§ï¼Œä½†éœ€è¦åœ¨æ¯ä¸ªç›®æ ‡ä¸Šéƒ¨ç½²ä»£ç†ï¼Œä¸”æœ‰ä¸€å®šçš„ç»´æŠ¤æˆæœ¬ã€‚</li></ul><p>ä¸¤è€…å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’ŒåŸºç¡€è®¾æ–½éœ€æ±‚æ¥é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆã€‚</p><h2 id=prometheus-operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™>Prometheus operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™
<a class=anchor href=#prometheus-operator%e6%80%8e%e4%b9%88%e6%b7%bb%e5%8a%a0targets%e5%92%8c%e5%91%8a%e8%ad%a6%e8%a7%84%e5%88%99>#</a></h2><p><strong>Prometheus Operator</strong> æ˜¯ä¸€ä¸ªç”¨æ¥åœ¨ Kubernetes ä¸Šç®¡ç† Prometheus éƒ¨ç½²çš„å·¥å…·ï¼Œå®ƒç®€åŒ–äº† Prometheus çš„åˆ›å»ºã€é…ç½®ã€ç®¡ç†å’Œæ‰©å±•ã€‚é€šè¿‡ <strong>Prometheus Operator</strong>ï¼Œä½ å¯ä»¥é€šè¿‡ Kubernetes èµ„æºå¯¹è±¡æ¥ç®¡ç† Prometheus é›†ç¾¤çš„é…ç½®ã€å‘Šè­¦è§„åˆ™å’ŒæœåŠ¡å‘ç°ï¼ˆtargetsï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•é€šè¿‡ <strong>Prometheus Operator</strong> æ¥æ·»åŠ  <strong>targets</strong> å’Œ <strong>å‘Šè­¦è§„åˆ™</strong> çš„æ­¥éª¤ã€‚</p><h3 id=1-æ·»åŠ -targets-æœåŠ¡å‘ç°>1. æ·»åŠ  Targets (æœåŠ¡å‘ç°)
<a class=anchor href=#1-%e6%b7%bb%e5%8a%a0-targets-%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0>#</a></h3><p>åœ¨ <strong>Prometheus Operator</strong> ä¸­ï¼Œç›®æ ‡ (targets) æ˜¯é€šè¿‡ <strong>ServiceMonitor</strong> æˆ– <strong>PodMonitor</strong> èµ„æºæ¥é…ç½®çš„ã€‚ServiceMonitor ç”¨äºç›‘æ§æœåŠ¡ï¼ŒPodMonitor ç”¨äºç›‘æ§å•ä¸ª Podã€‚</p><h4 id=æ­¥éª¤-5>æ­¥éª¤ï¼š
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-5>#</a></h4><ol><li><p>åˆ›å»ºä¸€ä¸ª <strong>ServiceMonitor</strong> èµ„æºå¯¹è±¡æ¥é…ç½® Prometheus ç›‘æ§çš„æœåŠ¡ã€‚</p><p><strong>ç¤ºä¾‹ï¼šåˆ›å»º ServiceMonitor é…ç½®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>monitoring.coreos.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceMonitor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example-servicemonitor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>example-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>endpoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>30s</span>
</span></span></code></pre></div><ul><li><code>metadata.name</code>: å®šä¹‰ ServiceMonitor çš„åç§°ã€‚</li><li><code>spec.selector</code>: ç”¨äºé€‰æ‹©åŒ¹é…çš„ Kubernetes æœåŠ¡ã€‚</li><li><code>spec.endpoints</code>: å®šä¹‰ Prometheus é€šè¿‡è¯¥ç«¯ç‚¹è¿›è¡Œç›‘æ§çš„æ–¹å¼ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç«¯å£å’Œæ‹‰å–æ•°æ®çš„é—´éš”ã€‚</li></ul></li><li><p>åœ¨ Kubernetes ä¸­åº”ç”¨ ServiceMonitor é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f servicemonitor.yaml
</span></span></code></pre></div></li><li><p>ç¡®ä¿ Prometheus Operator é…ç½®äº†é€‚å½“çš„ <strong>Prometheus</strong> å®ä¾‹å’Œ <strong>ServiceMonitorSelector</strong>ã€‚åœ¨ Prometheus é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ <strong>Prometheus CRD</strong>ï¼ˆCustom Resource Definitionsï¼‰æ¥æŒ‡å®šå“ªäº› ServiceMonitor å¯¹è±¡éœ€è¦è¢« Prometheus ç›‘æ§ã€‚</p><p><strong>ç¤ºä¾‹ï¼šPrometheus CRD é…ç½®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>monitoring.coreos.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Prometheus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>prometheus</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceMonitorSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>monitoring</span>: <span style=color:#ae81ff>enabled</span>
</span></span></code></pre></div><p>è¿™ä¸ªé…ç½®ä½¿å¾— Prometheus åªé€‰æ‹©å¸¦æœ‰ <code>monitoring: enabled</code> æ ‡ç­¾çš„ ServiceMonitor å¯¹è±¡è¿›è¡Œç›‘æ§ã€‚</p></li></ol><h3 id=2-æ·»åŠ å‘Šè­¦è§„åˆ™>2. æ·»åŠ å‘Šè­¦è§„åˆ™
<a class=anchor href=#2-%e6%b7%bb%e5%8a%a0%e5%91%8a%e8%ad%a6%e8%a7%84%e5%88%99>#</a></h3><p>Prometheus çš„å‘Šè­¦è§„åˆ™é€šå¸¸é€šè¿‡ <strong>PrometheusRule</strong> èµ„æºæ¥å®šä¹‰ã€‚å‘Šè­¦è§„åˆ™å®šä¹‰äº†è§¦å‘æ¡ä»¶ä»¥åŠå¦‚ä½•é€šçŸ¥ã€‚</p><h4 id=æ­¥éª¤-6>æ­¥éª¤ï¼š
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-6>#</a></h4><ol><li><p>åˆ›å»ºä¸€ä¸ª <strong>PrometheusRule</strong> èµ„æºå¯¹è±¡æ¥å®šä¹‰å‘Šè­¦è§„åˆ™ã€‚</p><p><strong>ç¤ºä¾‹ï¼šåˆ›å»º PrometheusRule é…ç½®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>monitoring.coreos.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PrometheusRule</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example-alert-rules</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example-alerts</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighMemoryUsage</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>container_memory_usage_bytes{container=&#34;example-container&#34;} &gt; 500000000</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>for</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;Memory usage is over 500MB for 5 minutes&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Container {{ $labels.container }} is using more than 500MB of memory.&#34;</span>
</span></span></code></pre></div><ul><li><code>alert</code>: å‘Šè­¦çš„åç§°ã€‚</li><li><code>expr</code>: ç”¨ Prometheus æŸ¥è¯¢è¯­è¨€ï¼ˆPromQLï¼‰å®šä¹‰çš„å‘Šè­¦è¡¨è¾¾å¼ã€‚æ­¤è¡¨è¾¾å¼ç›‘æµ‹å®¹å™¨å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè¶…è¿‡ 500MB è§¦å‘å‘Šè­¦ã€‚</li><li><code>for</code>: è®¾ç½®å‘Šè­¦è§¦å‘çš„æŒç»­æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œ5 åˆ†é’Ÿå†…å†…å­˜ä½¿ç”¨è¶…è¿‡ 500MB æ‰è§¦å‘å‘Šè­¦ã€‚</li><li><code>labels</code>: æ·»åŠ ä¸€äº›è‡ªå®šä¹‰æ ‡ç­¾ï¼Œå¯ä»¥åœ¨é€šçŸ¥æ—¶ä½¿ç”¨ã€‚</li><li><code>annotations</code>: æä¾›å‘Šè­¦çš„è¯¦ç»†ä¿¡æ¯ï¼Œé€šå¸¸åŒ…æ‹¬æ‘˜è¦å’Œæè¿°ã€‚</li></ul></li><li><p>åœ¨ Kubernetes ä¸­åº”ç”¨ PrometheusRule é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f prometheusrule.yaml
</span></span></code></pre></div></li><li><p>ç¡®ä¿ Prometheus é…ç½®äº†å‘Šè­¦è§„åˆ™ã€‚</p><p><strong>ç¤ºä¾‹ï¼šPrometheus CRD é…ç½®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>monitoring.coreos.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Prometheus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>prometheus</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ruleSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>enabled</span>
</span></span></code></pre></div><p>è¿™ä¸ªé…ç½®ä½¿å¾— Prometheus åªé€‰æ‹©å¸¦æœ‰ <code>alert: enabled</code> æ ‡ç­¾çš„ PrometheusRule å¯¹è±¡ä½œä¸ºå‘Šè­¦è§„åˆ™ã€‚</p></li></ol><h3 id=3-å‘Šè­¦é€šçŸ¥>3. å‘Šè­¦é€šçŸ¥
<a class=anchor href=#3-%e5%91%8a%e8%ad%a6%e9%80%9a%e7%9f%a5>#</a></h3><p>ä¸€æ—¦å‘Šè­¦è§„åˆ™é…ç½®å®Œæˆï¼ŒPrometheus ä¼šæ ¹æ®å®šä¹‰çš„è§„åˆ™è¯„ä¼°å’Œè§¦å‘å‘Šè­¦ã€‚å¦‚æœä½ è¿˜éœ€è¦å‘Šè­¦é€šçŸ¥ï¼ˆå¦‚å‘é€é‚®ä»¶ã€Slackã€PagerDuty ç­‰ï¼‰ï¼Œå¯ä»¥é…ç½® <strong>Alertmanager</strong> æ¥å¤„ç†å‘Šè­¦é€šçŸ¥ã€‚</p><p><strong>ç¤ºä¾‹ï¼šAlertmanager é…ç½®ï¼ˆé€šè¿‡ Kubernetes ConfigMapï¼‰</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>alertmanager-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>alertmanager.yml</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    global:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resolve_timeout: 5m
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    route:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      receiver: &#39;slack-notifications&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    receivers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: &#39;slack-notifications&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        slack_configs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          - channel: &#39;#alerts&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            send_resolved: true</span>
</span></span></code></pre></div><p><strong>åº”ç”¨ Alertmanager é…ç½®</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f alertmanager-config.yaml
</span></span></code></pre></div><h3 id=æ€»ç»“-11>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93-11>#</a></h3><ul><li><strong>æ·»åŠ  Targets</strong>ï¼šé€šè¿‡ <strong>ServiceMonitor</strong> æˆ– <strong>PodMonitor</strong> æ¥æŒ‡å®š Prometheus éœ€è¦ç›‘æ§çš„ç›®æ ‡ï¼ˆæœåŠ¡æˆ– Podï¼‰ã€‚</li><li><strong>æ·»åŠ å‘Šè­¦è§„åˆ™</strong>ï¼šé€šè¿‡ <strong>PrometheusRule</strong> æ¥å®šä¹‰ Prometheus çš„å‘Šè­¦è§„åˆ™ã€‚</li><li><strong>å‘Šè­¦é€šçŸ¥</strong>ï¼šå‘Šè­¦ä¼šè§¦å‘åï¼Œé€šè¿‡ <strong>Alertmanager</strong> å‘é€é€šçŸ¥ï¼Œæ‚¨å¯ä»¥é…ç½®é€šçŸ¥æ¸ é“ï¼Œå¦‚ Slackã€é‚®ä»¶ç­‰ã€‚</li></ul><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ <strong>Prometheus Operator</strong> æ¥è‡ªåŠ¨åŒ–å’Œç®€åŒ–è¿™äº›é…ç½®çš„ç®¡ç†ã€‚</p><h2 id=k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨prometheusç›‘æ§>k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨Prometheusç›‘æ§
<a class=anchor href=#k8s%e9%9b%86%e7%be%a4%e5%a4%96exporter%e6%80%8e%e4%b9%88%e4%bd%bf%e7%94%a8prometheus%e7%9b%91%e6%8e%a7>#</a></h2><p>åœ¨ Kubernetes é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ <strong>Prometheus</strong> ç›‘æ§ <strong>Exporter</strong>ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® <strong>Prometheus</strong> æ¥ç›´æ¥ä»å¤–éƒ¨ç³»ç»Ÿæˆ–æœåŠ¡æ‹‰å–æŒ‡æ ‡æ•°æ®ã€‚è¿™é‡Œçš„å…³é”®æ˜¯é…ç½® <strong>Prometheus</strong> ä»¥ä½¿å…¶èƒ½å¤Ÿè¿æ¥åˆ°å¤–éƒ¨çš„ <strong>Exporter</strong> å¹¶è·å–æ•°æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯å®ç°çš„æ­¥éª¤ï¼š</p><h3 id=1-ç¡®ä¿å¤–éƒ¨-exporter-å¯è®¿é—®>1. ç¡®ä¿å¤–éƒ¨ Exporter å¯è®¿é—®
<a class=anchor href=#1-%e7%a1%ae%e4%bf%9d%e5%a4%96%e9%83%a8-exporter-%e5%8f%af%e8%ae%bf%e9%97%ae>#</a></h3><p>é¦–å…ˆï¼Œç¡®ä¿å¤–éƒ¨ <strong>Exporter</strong> å¯ä»¥è¢« Prometheus è®¿é—®ã€‚<strong>Exporter</strong> å¯ä»¥æ˜¯è¿è¡Œåœ¨ç‰©ç†æœºã€è™šæ‹Ÿæœºæˆ–äº‘å®ä¾‹ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€…æ˜¯å…¶ä»–å®¹å™¨åŒ–ç¯å¢ƒä¸­çš„æœåŠ¡ã€‚</p><ul><li>å¤–éƒ¨ <strong>Exporter</strong> éœ€è¦æš´éœ²ä¸€ä¸ª HTTP æœåŠ¡æ¥å£ï¼ŒPrometheus å¯ä»¥é€šè¿‡ HTTP æ‹‰å–æŒ‡æ ‡ã€‚é€šå¸¸ï¼Œ<strong>Exporter</strong> ä¼šæš´éœ²åœ¨ä¸€ä¸ªç‰¹å®šç«¯å£ï¼ˆä¾‹å¦‚ 9100ã€9182ã€8080 ç­‰ï¼‰ã€‚</li></ul><h3 id=2-é…ç½®-prometheus-æ¥æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>2. é…ç½® Prometheus æ¥æŠ“å–å¤–éƒ¨ Exporter æ•°æ®
<a class=anchor href=#2-%e9%85%8d%e7%bd%ae-prometheus-%e6%9d%a5%e6%8a%93%e5%8f%96%e5%a4%96%e9%83%a8-exporter-%e6%95%b0%e6%8d%ae>#</a></h3><p>åœ¨ Prometheus é…ç½®ä¸­ï¼Œä½ éœ€è¦æ·»åŠ å¤–éƒ¨ <strong>Exporter</strong> çš„ç›®æ ‡ï¼Œé€šå¸¸é€šè¿‡ <strong><code>scrape_config</code></strong> é…ç½® Prometheus ä»å¤–éƒ¨ç›®æ ‡ï¼ˆIP åœ°å€æˆ–åŸŸåï¼‰æ‹‰å–æ•°æ®ã€‚</p><h4 id=æ­¥éª¤-7>æ­¥éª¤ï¼š
<a class=anchor href=#%e6%ad%a5%e9%aa%a4-7>#</a></h4><ol><li><p><strong>ç¼–è¾‘ Prometheus é…ç½®æ–‡ä»¶</strong>ï¼šåœ¨ Prometheus é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ <code>prometheus.yml</code>ï¼‰ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ <code>scrape_config</code> é…ç½®ï¼Œä»¥ä¾¿ Prometheus å¯ä»¥ä»å¤–éƒ¨çš„ <strong>Exporter</strong> ä¸­æŠ“å–æ•°æ®ã€‚</p><p><strong>ç¤ºä¾‹ï¼šPrometheus é…ç½®</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;external-exporter&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;&lt;external_exporter_ip&gt;:&lt;port&gt;&#39;</span>, <span style=color:#e6db74>&#39;&lt;external_exporter_ip2&gt;:&lt;port&gt;&#39;</span>]
</span></span></code></pre></div><ul><li><code>job_name</code>ï¼šå®šä¹‰ä¸€ä¸ªä»»åŠ¡çš„åç§°ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è¿™ä¸ªåç§°ã€‚</li><li><code>targets</code>ï¼šæ˜¯ <strong>Exporter</strong> çš„åœ°å€åˆ—è¡¨ï¼Œé€šå¸¸åŒ…æ‹¬ IP å’Œç«¯å£ï¼Œç¡®ä¿ Prometheus å¯ä»¥è®¿é—®è¿™äº›åœ°å€ã€‚ä½ å¯ä»¥åˆ—å‡ºå¤šä¸ªç›®æ ‡ï¼ŒPrometheus å°†ä¼šå¹¶è¡Œæ‹‰å–æ•°æ®ã€‚</li></ul></li><li><p><strong>é‡å¯ Prometheus</strong>ï¼šé…ç½®ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ Prometheus æœåŠ¡ä»¥ä½¿æ–°çš„é…ç½®ç”Ÿæ•ˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart prometheus
</span></span></code></pre></div><p>æˆ–è€…ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Dockerï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker restart &lt;prometheus_container_name&gt;
</span></span></code></pre></div></li></ol><h3 id=3-éªŒè¯-prometheus-æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>3. éªŒè¯ Prometheus æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨ Exporter æ•°æ®
<a class=anchor href=#3-%e9%aa%8c%e8%af%81-prometheus-%e6%98%af%e5%90%a6%e5%8f%af%e4%bb%a5%e6%ad%a3%e7%a1%ae%e6%8a%93%e5%8f%96%e5%a4%96%e9%83%a8-exporter-%e6%95%b0%e6%8d%ae>#</a></h3><p>å®Œæˆé…ç½®åï¼Œä½ å¯ä»¥é€šè¿‡ Prometheus çš„ <strong>Web UI</strong> æ¥æŸ¥çœ‹æ˜¯å¦å·²ç»æˆåŠŸæŠ“å–åˆ°å¤–éƒ¨ <strong>Exporter</strong> çš„æ•°æ®ã€‚</p><ol><li><p>è¿›å…¥ Prometheus Web UIï¼ˆé€šå¸¸æ˜¯ <code>http://&lt;prometheus_ip>:9090</code>ï¼‰ã€‚</p></li><li><p>è¿›å…¥</p><p>Targets</p><p>é¡µé¢ (</p><pre tabindex=0><code>http://&lt;prometheus_ip&gt;:9090/targets
</code></pre><p>)ï¼Œæ£€æŸ¥</p><pre tabindex=0><code>scrape_configs
</code></pre><p>ä¸­æ·»åŠ çš„ç›®æ ‡æ˜¯å¦å‡ºç°ï¼ŒçŠ¶æ€æ˜¯å¦ä¸º</p><pre tabindex=0><code>up
</code></pre><p>ã€‚</p><ul><li>å¦‚æœç›®æ ‡å¤„äº <code>up</code> çŠ¶æ€ï¼Œè¡¨ç¤º Prometheus æˆåŠŸæŠ“å–äº†æŒ‡æ ‡ã€‚</li><li>å¦‚æœçŠ¶æ€ä¸º <code>down</code>ï¼Œæ£€æŸ¥æ˜¯å¦èƒ½ä» Prometheus æœºå™¨è®¿é—®å¤–éƒ¨ <strong>Exporter</strong> åœ°å€ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ã€ç«¯å£æ²¡æœ‰å¼€æ”¾æˆ–è€…é˜²ç«å¢™é™åˆ¶ç­‰åŸå› ã€‚</li></ul></li></ol><h3 id=4-é…ç½®å‘Šè­¦å¯é€‰>4. é…ç½®å‘Šè­¦ï¼ˆå¯é€‰ï¼‰
<a class=anchor href=#4-%e9%85%8d%e7%bd%ae%e5%91%8a%e8%ad%a6%e5%8f%af%e9%80%89>#</a></h3><p>ä½ å¯ä»¥æ ¹æ®æŠ“å–åˆ°çš„å¤–éƒ¨æŒ‡æ ‡é…ç½® Prometheus çš„å‘Šè­¦è§„åˆ™ã€‚å‘Šè­¦è§„åˆ™å¯ä»¥é€šè¿‡ <strong>PrometheusRule</strong> æˆ–ç›´æ¥åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨æŠ“å–ä¸€ä¸ª Node Exporter çš„å¤–éƒ¨æŒ‡æ ‡å¹¶æƒ³è®¾ç½®ä¸€ä¸ªå‘Šè­¦æ¥ç›‘æ§ CPU ä½¿ç”¨ç‡ï¼š</p><h4 id=é…ç½®å‘Šè­¦è§„åˆ™>é…ç½®å‘Šè­¦è§„åˆ™ï¼š
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e5%91%8a%e8%ad%a6%e8%a7%84%e5%88%99>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-alerts</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighCPUUsage</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>node_cpu_seconds_total{mode=&#34;user&#34;} &gt; 80</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>for</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;CPU usage is over 80% for 5 minutes.&#34;</span>
</span></span></code></pre></div><h3 id=5-é…ç½®å‘Šè­¦é€šçŸ¥å¯é€‰>5. é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
<a class=anchor href=#5-%e9%85%8d%e7%bd%ae%e5%91%8a%e8%ad%a6%e9%80%9a%e7%9f%a5%e5%8f%af%e9%80%89>#</a></h3><p>å¦‚æœéœ€è¦é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆä¾‹å¦‚ï¼Œå‘é€åˆ° Slackã€Email æˆ–å…¶ä»–é€šçŸ¥æ¸ é“ï¼‰ï¼Œä½ éœ€è¦åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <strong>Alertmanager</strong> é…ç½®ã€‚</p><p><strong>ç¤ºä¾‹ï¼šAlertmanager é…ç½®</strong>ï¼ˆå‘é€ Slack é€šçŸ¥ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resolve_timeout</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#39;slack-notifications&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;slack-notifications&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>slack_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>channel</span>: <span style=color:#e6db74>&#39;#alerts&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>send_resolved</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>ç„¶åï¼ŒPrometheus ä¼šå°†å‘Šè­¦å‘é€åˆ° <strong>Alertmanager</strong>ï¼Œç”± <strong>Alertmanager</strong> è´Ÿè´£å¤„ç†å’Œè½¬å‘é€šçŸ¥ã€‚</p><h3 id=æ€»ç»“-12>æ€»ç»“ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-12>#</a></h3><ol><li>ç¡®ä¿å¤–éƒ¨ <strong>Exporter</strong> å¯é€šè¿‡ HTTP æš´éœ²æŒ‡æ ‡ï¼ŒPrometheus å¯ä»¥è®¿é—®ã€‚</li><li>åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>scrape_configs</code> æ·»åŠ å¤–éƒ¨ <strong>Exporter</strong> çš„åœ°å€ã€‚</li><li>é€šè¿‡ Prometheus Web UI æ£€æŸ¥ç›®æ ‡æ˜¯å¦è¢«æ­£ç¡®æŠ“å–ã€‚</li><li>é…ç½®å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥æ¸ é“ï¼ˆå¯é€‰ï¼‰ã€‚</li></ol><p>é€šè¿‡è¿™äº›æ­¥éª¤ï¼ŒPrometheus å°±å¯ä»¥ç›‘æ§å¤–éƒ¨ <strong>Exporter</strong>ï¼Œå¹¶ä¸”ä½ å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®å‘Šè­¦å’Œé€šçŸ¥ã€‚</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#prometheus>Prometheus</a></li><li><a href=#prometheusçš„å·¥ä½œæµç¨‹>Prometheusçš„å·¥ä½œæµç¨‹</a></li><li><a href=#metricçš„å‡ ç§ç±»å‹åˆ†åˆ«æ˜¯ä»€ä¹ˆ>Metricçš„å‡ ç§ç±»å‹ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ˜†</a><ul><li><a href=#æ€»ç»“>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°>Prometheusæœ‰å“ªå‡ ç§æœåŠ¡å‘ç°â˜†</a><ul><li><a href=#1-kubernetes-æœåŠ¡å‘ç°>1. <strong>Kubernetes æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#2-consul-æœåŠ¡å‘ç°>2. <strong>Consul æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#3-ec2-æœåŠ¡å‘ç°>3. <strong>EC2 æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#4-gcegoogle-compute-engineæœåŠ¡å‘ç°>4. <strong>GCEï¼ˆGoogle Compute Engineï¼‰æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#5-azure-æœåŠ¡å‘ç°>5. <strong>Azure æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#6-dns-æœåŠ¡å‘ç°>6. <strong>DNS æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#7-file-æœåŠ¡å‘ç°>7. <strong>File æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#8-static-æœåŠ¡å‘ç°>8. <strong>Static æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#9-openstack-æœåŠ¡å‘ç°>9. <strong>OpenStack æœåŠ¡å‘ç°</strong>ï¼š</a></li><li><a href=#æ€»ç»“-1>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#prometheuså¸¸ç”¨å‡½æ•°>Prometheuså¸¸ç”¨å‡½æ•°</a><ul><li><a href=#1-èšåˆå‡½æ•°aggregation-functions>1. <strong>èšåˆå‡½æ•°ï¼ˆAggregation Functionsï¼‰</strong></a></li><li><a href=#2-ç»Ÿè®¡å‡½æ•°statistical-functions>2. <strong>ç»Ÿè®¡å‡½æ•°ï¼ˆStatistical Functionsï¼‰</strong></a></li><li><a href=#3-æ—¶é—´å‡½æ•°time-functions>3. <strong>æ—¶é—´å‡½æ•°ï¼ˆTime Functionsï¼‰</strong></a></li><li><a href=#4-æ•°å€¼å¤„ç†å‡½æ•°mathematical-functions>4. <strong>æ•°å€¼å¤„ç†å‡½æ•°ï¼ˆMathematical Functionsï¼‰</strong></a></li><li><a href=#5-å­—ç¬¦ä¸²å¤„ç†å‡½æ•°string-functions>5. <strong>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼ˆString Functionsï¼‰</strong></a></li><li><a href=#6-æŸ¥è¯¢æ—¶é—´å‡½æ•°time-interval-functions>6. <strong>æŸ¥è¯¢æ—¶é—´å‡½æ•°ï¼ˆTime Interval Functionsï¼‰</strong></a></li><li><a href=#7-ç‡å‡½æ•°rate-functions>7. <strong>ç‡å‡½æ•°ï¼ˆRate Functionsï¼‰</strong></a></li><li><a href=#8-é€»è¾‘å‡½æ•°logical-functions>8. <strong>é€»è¾‘å‡½æ•°ï¼ˆLogical Functionsï¼‰</strong></a></li><li><a href=#9-è¿‡æ»¤ä¸æ¡ä»¶filters--conditionals>9. <strong>è¿‡æ»¤ä¸æ¡ä»¶ï¼ˆFilters & Conditionalsï¼‰</strong></a></li><li><a href=#10-ç™¾åˆ†æ¯”è®¡ç®—percentile-calculation>10. <strong>ç™¾åˆ†æ¯”è®¡ç®—ï¼ˆPercentile Calculationï¼‰</strong></a></li><li><a href=#æ€»ç»“-2>æ€»ç»“ï¼š</a></li></ul></li><li><a href=#thanosæ¶æ„>thanosæ¶æ„â˜†</a><ul><li><a href=#thanos-æ¶æ„æ¦‚è¿°>Thanos æ¶æ„æ¦‚è¿°</a></li><li><a href=#thanos-æ¶æ„å›¾>Thanos æ¶æ„å›¾</a></li><li><a href=#thanos-æ ¸å¿ƒåŠŸèƒ½>Thanos æ ¸å¿ƒåŠŸèƒ½</a></li><li><a href=#thanos-çš„ä½¿ç”¨åœºæ™¯>Thanos çš„ä½¿ç”¨åœºæ™¯</a></li><li><a href=#æ€»ç»“-3>æ€»ç»“</a></li></ul></li><li><a href=#thanosä¸victoriametricså¯¹æ¯”>thanosä¸VictoriaMetricså¯¹æ¯”</a></li><li><a href=#1-æ¦‚è¿°><strong>1. æ¦‚è¿°</strong></a></li><li><a href=#2-æ¶æ„å¯¹æ¯”><strong>2. æ¶æ„å¯¹æ¯”</strong></a><ul><li><a href=#thanos><strong>Thanos</strong></a></li><li><a href=#victoriametrics><strong>VictoriaMetrics</strong></a></li></ul></li><li><a href=#3-å…³é”®ç‰¹æ€§å¯¹æ¯”><strong>3. å…³é”®ç‰¹æ€§å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-æ€»ç»“><strong>5. æ€»ç»“</strong></a></li><li><a href=#thanos-sidecarå’ŒreceiveåŒºåˆ«>thanos sidecarå’ŒreceiveåŒºåˆ«â˜†</a><ul><li><a href=#thanos-sidecar-vs-thanos-receive-å¯¹æ¯”><strong>Thanos Sidecar vs Thanos Receive å¯¹æ¯”</strong></a></li></ul></li><li><a href=#1-ä¸»è¦ç”¨é€”><strong>1. ä¸»è¦ç”¨é€”</strong></a></li><li><a href=#2-æ¶æ„å¯¹æ¯”-1><strong>2. æ¶æ„å¯¹æ¯”</strong></a><ul><li><a href=#thanos-sidecar><strong>Thanos Sidecar</strong></a></li><li><a href=#thanos-receive><strong>Thanos Receive</strong></a></li></ul></li><li><a href=#3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-1><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-é€‰å‹å»ºè®®><strong>5. é€‰å‹å»ºè®®</strong></a></li><li><a href=#thanos-ruleç»„ä»¶å’ŒprometheusåŒºåˆ«>thanos ruleç»„ä»¶å’ŒprometheusåŒºåˆ«</a><ul><li><a href=#thanos-rule-vs-prometheusåŒºåˆ«ä¸å¯¹æ¯”><strong>Thanos Rule vs Prometheusï¼šåŒºåˆ«ä¸å¯¹æ¯”</strong></a></li></ul></li><li><a href=#1-ä¸»è¦ç”¨é€”-1><strong>1. ä¸»è¦ç”¨é€”</strong></a></li><li><a href=#2-ç»„ä»¶ä»‹ç»><strong>2. ç»„ä»¶ä»‹ç»</strong></a><ul><li><a href=#-prometheus><strong>ğŸ“Œ Prometheus</strong></a></li><li><a href=#-thanos-rule><strong>ğŸ“Œ Thanos Rule</strong></a></li></ul></li><li><a href=#3-è¯¦ç»†åŠŸèƒ½å¯¹æ¯”-1><strong>3. è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-2><strong>4. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#5-æ€»ç»“-1><strong>5. æ€»ç»“</strong></a></li><li><a href=#prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª>Prometheuså‘Šè­¦ä»è§¦å‘åˆ°æ”¶åˆ°é€šçŸ¥å»¶è¿Ÿåœ¨å“ª</a></li><li><a href=#-prometheus-å‘Šè­¦æµç¨‹><strong>ğŸ“Œ Prometheus å‘Šè­¦æµç¨‹</strong></a></li><li><a href=#-å¯èƒ½çš„å»¶è¿Ÿç‚¹><strong>ğŸ“Œ å¯èƒ½çš„å»¶è¿Ÿç‚¹</strong></a></li><li><a href=#-å¦‚ä½•ä¼˜åŒ–-prometheus-å‘Šè­¦å»¶è¿Ÿ><strong>ğŸ“Œ å¦‚ä½•ä¼˜åŒ– Prometheus å‘Šè­¦å»¶è¿Ÿï¼Ÿ</strong></a><ul><li><a href=#1-è°ƒæ•´><strong>1. è°ƒæ•´ <code>scrape_interval</code></strong></a></li><li><a href=#2-è°ƒæ•´><strong>2. è°ƒæ•´ <code>evaluation_interval</code></strong></a></li><li><a href=#3-è°ƒæ•´><strong>3. è°ƒæ•´ <code>for</code> å‚æ•°</strong></a></li><li><a href=#4-è°ƒæ•´-alertmanager-é…ç½®><strong>4. è°ƒæ•´ Alertmanager é…ç½®</strong></a></li><li><a href=#5-ä¼˜åŒ–é€šçŸ¥æ–¹å¼><strong>5. ä¼˜åŒ–é€šçŸ¥æ–¹å¼</strong></a></li></ul></li><li><a href=#-ç»“è®º><strong>ğŸ“Œ ç»“è®º</strong></a><ul><li><a href=#-ä¼˜åŒ–å»ºè®®>ğŸš€ <strong>ä¼˜åŒ–å»ºè®®</strong></a></li><li><a href=#-æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®><strong>ğŸ”¥ æ¨èä¼˜åŒ–åçš„ç¤ºä¾‹é…ç½®</strong></a></li></ul></li><li><a href=#å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåš>å‘Šè­¦æŠ‘åˆ¶æ€ä¹ˆåšâ˜†</a></li><li><a href=#-å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶çš„å·¥ä½œåŸç†</strong></a></li><li><a href=#-å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®><strong>ğŸ“Œ å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®</strong></a><ul><li><a href=#ç¤ºä¾‹-1å±è”½><strong>ç¤ºä¾‹ 1ï¼šå±è”½ <code>InstanceDown</code> å‘Šè­¦ï¼Œè‹¥ <code>ClusterDown</code> å‘Šè­¦å·²è§¦å‘</strong></a></li><li><a href=#ç¤ºä¾‹-2æŸä¸ªæœåŠ¡><strong>ç¤ºä¾‹ 2ï¼šæŸä¸ªæœåŠ¡ <code>APIHighLatency</code> æ—¶ï¼Œå±è”½ <code>APIErrorRate</code></strong></a></li></ul></li><li><a href=#-é…ç½®><strong>ğŸ“Œ é…ç½® <code>Alertmanager.yml</code> è§„åˆ™</strong></a><ul><li><a href=#å®Œæ•´ç¤ºä¾‹><strong>å®Œæ•´ç¤ºä¾‹</strong></a></li></ul></li><li><a href=#-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶</strong></a></li><li><a href=#-æ€»ç»“><strong>ğŸ“Œ æ€»ç»“</strong></a><ul><li><a href=#prometheus-å‘Šè­¦æŠ‘åˆ¶inhibition><strong>Prometheus å‘Šè­¦æŠ‘åˆ¶ï¼ˆInhibitionï¼‰</strong></a></li></ul></li><li><a href=#-é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤><strong>ğŸ“Œ é…ç½®å‘Šè­¦æŠ‘åˆ¶çš„æ­¥éª¤</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½-instancedown-å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ InstanceDown å‘Šè­¦</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ç£ç›˜ä½¿ç”¨ç‡é«˜å‘Šè­¦</strong></a></li><li><a href=#-ç¤ºä¾‹å±è”½><strong>ğŸ“Œ ç¤ºä¾‹ï¼šå±è”½ <code>NodeDown</code>ï¼ˆèŠ‚ç‚¹å®•æœºï¼‰å‘Šè­¦</strong></a></li><li><a href=#heading><strong>ğŸ“Œ <code>inhibit_rules</code> é…ç½®å®Œæ•´ç¤ºä¾‹</strong></a></li><li><a href=#-å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶-1><strong>ğŸ“Œ å¦‚ä½•æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶ï¼Ÿ</strong></a><ul><li><a href=#æ–¹å¼-1ä½¿ç”¨><strong>æ–¹å¼ 1ï¼šä½¿ç”¨ <code>amtool</code></strong></a></li><li><a href=#æ–¹å¼-2æŸ¥çœ‹-alertmanager-ui><strong>æ–¹å¼ 2ï¼šæŸ¥çœ‹ Alertmanager UI</strong></a></li></ul></li><li><a href=#-ç»“è®º-1><strong>ğŸ“Œ ç»“è®º</strong></a></li><li><a href=#å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåš>å‘Šè­¦æ¶æ„é«˜å¯ç”¨æ€ä¹ˆåšâ˜†</a></li><li><a href=#prometheus-å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ><strong>Prometheus å‘Šè­¦ç³»ç»Ÿé«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ</strong></a></li><li><a href=#-1-prometheus-é«˜å¯ç”¨><strong>ğŸ“Œ 1. Prometheus é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆ-1prometheus-åŒå®ä¾‹ä¸»å¤‡><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šPrometheus åŒå®ä¾‹ï¼ˆä¸»å¤‡ï¼‰</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2prometheus--thanos-victoriametrics><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šPrometheus + Thanos/ VictoriaMetrics</strong></a></li></ul></li><li><a href=#-2-alertmanager-é«˜å¯ç”¨><strong>ğŸ“Œ 2. Alertmanager é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆalertmanager-é›†ç¾¤><strong>ğŸ”¹ æ–¹æ¡ˆï¼šAlertmanager é›†ç¾¤</strong></a></li></ul></li><li><a href=#-3-é€šçŸ¥æ¸ é“é«˜å¯ç”¨><strong>ğŸ“Œ 3. é€šçŸ¥æ¸ é“é«˜å¯ç”¨</strong></a><ul><li><a href=#-æ–¹æ¡ˆ-1å¤šä¸ªé€šçŸ¥é€šé“><strong>ğŸ”¹ æ–¹æ¡ˆ 1ï¼šå¤šä¸ªé€šçŸ¥é€šé“</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2webhook-é«˜å¯ç”¨><strong>ğŸ”¹ æ–¹æ¡ˆ 2ï¼šWebhook é«˜å¯ç”¨</strong></a></li></ul></li><li><a href=#-4-å…¨å±€é«˜å¯ç”¨æ¶æ„><strong>ğŸ“Œ 4. å…¨å±€é«˜å¯ç”¨æ¶æ„</strong></a></li><li><a href=#-ç»“è®º-2><strong>ğŸ“Œ ç»“è®º</strong></a></li><li><a href=#podæŒ‡æ ‡wsså’ŒrssåŒºåˆ«>PodæŒ‡æ ‡WSSå’ŒRSSåŒºåˆ«â˜†</a></li><li><a href=#-rssresident-set-size><strong>ğŸ“Œ RSSï¼ˆResident Set Sizeï¼‰</strong></a></li><li><a href=#-wssworking-set-size><strong>ğŸ“Œ WSSï¼ˆWorking Set Sizeï¼‰</strong></a></li><li><a href=#-wss-vs-rss-æ€»ç»“><strong>ğŸ“Œ WSS vs. RSS æ€»ç»“</strong></a></li><li><a href=#-kubernetes-ç›¸å…³><strong>ğŸ“Œ Kubernetes ç›¸å…³</strong></a></li><li><a href=#ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡>ç›‘æ§å››ä¸ªé»„é‡‘æŒ‡æ ‡</a></li><li><a href=#-1-latencyå»¶è¿Ÿ><strong>ğŸ“Œ 1. Latencyï¼ˆå»¶è¿Ÿï¼‰</strong></a></li><li><a href=#-2-trafficæµé‡><strong>ğŸ“Œ 2. Trafficï¼ˆæµé‡ï¼‰</strong></a></li><li><a href=#-3-errorsé”™è¯¯ç‡><strong>ğŸ“Œ 3. Errorsï¼ˆé”™è¯¯ç‡ï¼‰</strong></a></li><li><a href=#-4-saturationé¥±å’Œåº¦><strong>ğŸ“Œ 4. Saturationï¼ˆé¥±å’Œåº¦ï¼‰</strong></a></li><li><a href=#-æ€»ç»“-1><strong>ğŸ“Œ æ€»ç»“</strong></a></li><li><a href=#åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹å¦‚ä½•ä¼˜åŒ–prometheusæ€§èƒ½>åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¼˜åŒ–Prometheusæ€§èƒ½</a><ul><li><a href=#1-åˆ†å¸ƒå¼æ¶æ„è®¾è®¡><strong>1. åˆ†å¸ƒå¼æ¶æ„è®¾è®¡</strong></a></li><li><a href=#2-æ•°æ®å­˜å‚¨ä¼˜åŒ–><strong>2. æ•°æ®å­˜å‚¨ä¼˜åŒ–</strong></a></li><li><a href=#3-æŸ¥è¯¢ä¼˜åŒ–><strong>3. æŸ¥è¯¢ä¼˜åŒ–</strong></a></li><li><a href=#4-è°ƒæ•´-scrape-é…ç½®><strong>4. è°ƒæ•´ Scrape é…ç½®</strong></a></li><li><a href=#5-ä½¿ç”¨-external-storage><strong>5. ä½¿ç”¨ External Storage</strong></a></li><li><a href=#6-ä¼˜åŒ–-alerting-å’Œ-rules><strong>6. ä¼˜åŒ– Alerting å’Œ Rules</strong></a></li><li><a href=#7-é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡><strong>7. é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡</strong></a></li><li><a href=#æ€»ç»“-4><strong>æ€»ç»“ï¼š</strong></a></li></ul></li><li><a href=#å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”>å¦‚ä½•å®ç°å‘Šè­¦çš„è‡ªåŠ¨åŒ–å“åº”â˜†</a><ul><li><a href=#1-ä½¿ç”¨-prometheus--alertmanager-é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”><strong>1. ä½¿ç”¨ Prometheus + Alertmanager é…ç½®å‘Šè­¦è‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#2-é›†æˆè‡ªåŠ¨åŒ–å·¥å…·å¦‚-ansibleterraformè¿›è¡Œå“åº”><strong>2. é›†æˆè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ Ansibleã€Terraformï¼‰è¿›è¡Œå“åº”</strong></a></li><li><a href=#3-é›†æˆ-chatops-è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”><strong>3. é›†æˆ ChatOps è¿›è¡Œè‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#4-ä½¿ç”¨-kubernetes-operator-è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤><strong>4. ä½¿ç”¨ Kubernetes Operator è¿›è¡Œè‡ªåŠ¨åŒ–ä¿®å¤</strong></a></li><li><a href=#5-ä½¿ç”¨-pagerdutyopsgenie-ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”><strong>5. ä½¿ç”¨ PagerDutyã€OpsGenie ç­‰å·¥å…·çš„è‡ªåŠ¨åŒ–å“åº”</strong></a></li><li><a href=#æ€»ç»“-5><strong>æ€»ç»“ï¼š</strong></a></li></ul></li><li><a href=#prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†>Prometheusæ•°æ®å‹ç¼©å’ŒæŒä¹…åŒ–å®ç°åŸç†</a><ul><li><a href=#1-prometheus-æ•°æ®å­˜å‚¨æ¶æ„><strong>1. Prometheus æ•°æ®å­˜å‚¨æ¶æ„</strong></a></li><li><a href=#2-æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†><strong>2. æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†</strong></a></li><li><a href=#3-æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“><strong>3. æ•°æ®å‹ç¼©ä¸æŒä¹…åŒ–çš„å®ç°åŸç†æ€»ç»“</strong></a></li><li><a href=#4-æŒä¹…åŒ–å­˜å‚¨><strong>4. æŒä¹…åŒ–å­˜å‚¨</strong></a></li></ul></li><li><a href=#kubectl-topè¾“å‡ºä¸linux-freeå‘½ä»¤ä¸ä¸€è‡´åŸå› >kubectl topè¾“å‡ºä¸Linux freeå‘½ä»¤ä¸ä¸€è‡´åŸå› â˜†</a><ul><li><a href=#1-æ•°æ®æ¥æºçš„å·®å¼‚><strong>1. æ•°æ®æ¥æºçš„å·®å¼‚</strong></a></li><li><a href=#2-èµ„æºçš„è®¡ç®—æ–¹å¼><strong>2. èµ„æºçš„è®¡ç®—æ–¹å¼</strong></a></li><li><a href=#3-èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–><strong>3. èµ„æºéš”ç¦»å’Œå®¹å™¨åŒ–</strong></a></li><li><a href=#4-æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ><strong>4. æ±‡æ€»ä¸æ˜¾ç¤ºçš„ä¸åŒ</strong></a></li><li><a href=#æ€»ç»“-6><strong>æ€»ç»“</strong></a></li></ul></li><li><a href=#ç”¨åˆ°äº†å“ªäº›exporteråŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨-prometheus-ç›‘æ§ä¸­exporter-æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶å®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡å¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥-prometheus-èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„-prometheus-exporter-åŠå…¶åŠŸèƒ½>ç”¨åˆ°äº†å“ªäº›exporterï¼ŒåŠŸèƒ½æ˜¯ä»€ä¹ˆåœ¨ Prometheus ç›‘æ§ä¸­ï¼Œ<strong>Exporter</strong> æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„ä»¶ï¼Œå®ƒç”¨äºä»ä¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿä¸­æ”¶é›†æŒ‡æ ‡ï¼Œå¹¶å°†è¿™äº›æŒ‡æ ‡ä»¥ Prometheus èƒ½å¤Ÿç†è§£çš„æ ¼å¼æš´éœ²å‡ºæ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Prometheus Exporter åŠå…¶åŠŸèƒ½ï¼š</a><ul><li><a href=#1-node-exporter>1. <strong>Node Exporter</strong></a></li><li><a href=#2-kube-state-metrics>2. <strong>kube-state-metrics</strong></a></li><li><a href=#3-cadvisor>3. <strong>cAdvisor</strong></a></li><li><a href=#4-blackbox-exporter>4. <strong>Blackbox Exporter</strong></a></li><li><a href=#5-mysql-exporter>5. <strong>MySQL Exporter</strong></a></li><li><a href=#6-postgresql-exporter>6. <strong>PostgreSQL Exporter</strong></a></li><li><a href=#7-jmx-exporter>7. <strong>JMX Exporter</strong></a></li><li><a href=#8-redis-exporter>8. <strong>Redis Exporter</strong></a></li><li><a href=#9-mongodb-exporter>9. <strong>MongoDB Exporter</strong></a></li><li><a href=#10-elasticsearch-exporter>10. <strong>Elasticsearch Exporter</strong></a></li><li><a href=#11-nginx-exporter>11. <strong>Nginx Exporter</strong></a></li><li><a href=#12-kafka-exporter>12. <strong>Kafka Exporter</strong></a></li><li><a href=#æ€»ç»“-7><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li><li><a href=#æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporter>æ˜¯å¦è‡ªå·±å¼€å‘è¿‡exporterâ˜†</a><ul><li><a href=#è‡ªå®šä¹‰-exporter-å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤>è‡ªå®šä¹‰ Exporter å¼€å‘çš„ä¸€èˆ¬æ­¥éª¤ï¼š</a></li><li><a href=#ç¤ºä¾‹ç”¨-go-å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰-exporter>ç¤ºä¾‹ï¼šç”¨ Go å¼€å‘ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ Exporter</a></li><li><a href=#å…³é”®ç‚¹>å…³é”®ç‚¹ï¼š</a></li><li><a href=#å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜>å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æŒ‘æˆ˜ï¼š</a></li></ul></li><li><a href=#target-downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤>target downçš„æƒ…å†µå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤ï¼Ÿ</a><ul><li><a href=#1-æ£€æŸ¥-prometheus-æ—¥å¿—>1. <strong>æ£€æŸ¥ Prometheus æ—¥å¿—</strong></a></li><li><a href=#2-æ£€æŸ¥ç½‘ç»œè¿æ¥>2. <strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong></a></li><li><a href=#3-æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€>3. <strong>æ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€</strong></a></li><li><a href=#4-æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®>4. <strong>æ£€æŸ¥ç›®æ ‡ç«¯ç‚¹çš„é…ç½®</strong></a></li><li><a href=#5-ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜>5. <strong>ç›®æ ‡æœåŠ¡çš„è´Ÿè½½é—®é¢˜</strong></a></li><li><a href=#6-èº«ä»½éªŒè¯é—®é¢˜>6. <strong>èº«ä»½éªŒè¯é—®é¢˜</strong></a></li><li><a href=#7-æ£€æŸ¥-prometheus-é…ç½®æ–‡ä»¶>7. <strong>æ£€æŸ¥ Prometheus é…ç½®æ–‡ä»¶</strong></a></li><li><a href=#8-æŸ¥çœ‹-prometheus-ç›®æ ‡çŠ¶æ€>8. <strong>æŸ¥çœ‹ Prometheus ç›®æ ‡çŠ¶æ€</strong></a></li><li><a href=#9-é‡å¯-prometheus>9. <strong>é‡å¯ Prometheus</strong></a></li><li><a href=#10-ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—>10. <strong>ç›®æ ‡ç«¯æœåŠ¡æ—¥å¿—</strong></a></li><li><a href=#æ•…éšœæ’é™¤ç¤ºä¾‹>æ•…éšœæ’é™¤ç¤ºä¾‹ï¼š</a></li><li><a href=#æ€»ç»“-8>æ€»ç»“</a></li></ul></li><li><a href=#exporter-åœæ­¢å·¥ä½œå¦‚ä½•ç›‘æ§>Exporter åœæ­¢å·¥ä½œï¼Œå¦‚ä½•ç›‘æ§ï¼Ÿ</a><ul><li><a href=#1-prometheus-è‡ªèº«çš„ç›‘æ§>1. <strong>Prometheus è‡ªèº«çš„ç›‘æ§</strong></a></li><li><a href=#2-exporter-çš„å¥åº·æ£€æŸ¥>2. <strong>Exporter çš„å¥åº·æ£€æŸ¥</strong></a></li><li><a href=#3-exporter-è¿›ç¨‹ç›‘æ§>3. <strong>Exporter è¿›ç¨‹ç›‘æ§</strong></a></li><li><a href=#4-å¤–éƒ¨æœåŠ¡ç›‘æ§>4. <strong>å¤–éƒ¨æœåŠ¡ç›‘æ§</strong></a></li><li><a href=#5-æ—¥å¿—ç›‘æ§>5. <strong>æ—¥å¿—ç›‘æ§</strong></a></li><li><a href=#6-è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½>6. <strong>è‡ªåŠ¨åŒ–ä¿®å¤æªæ–½</strong></a></li><li><a href=#7-å¤–éƒ¨ç›‘æ§å·¥å…·>7. <strong>å¤–éƒ¨ç›‘æ§å·¥å…·</strong></a></li><li><a href=#8-åˆ†ææŒ‡æ ‡ä¸¢å¤±>8. <strong>åˆ†ææŒ‡æ ‡ä¸¢å¤±</strong></a></li><li><a href=#æ€»ç»“-9>æ€»ç»“</a></li></ul></li><li><a href=#prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹>Prometheusçš„æ‹‰å–æ¨¡å¼ä¸zabbixæ¨é€æ¨¡å¼æœ‰ä½•åŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a><ul><li><a href=#1-prometheus-æ‹‰å–æ¨¡å¼pull-model>1. <strong>Prometheus æ‹‰å–æ¨¡å¼ï¼ˆPull Modelï¼‰</strong></a></li><li><a href=#2-zabbix-æ¨é€æ¨¡å¼push-model>2. <strong>Zabbix æ¨é€æ¨¡å¼ï¼ˆPush Modelï¼‰</strong></a></li><li><a href=#3-å¯¹æ¯”æ€»ç»“>3. <strong>å¯¹æ¯”æ€»ç»“</strong></a></li><li><a href=#4-é€‚ç”¨åœºæ™¯-3>4. <strong>é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#æ€»ç»“-10>æ€»ç»“</a></li></ul></li><li><a href=#prometheus-operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™>Prometheus operatoræ€ä¹ˆæ·»åŠ targetså’Œå‘Šè­¦è§„åˆ™</a><ul><li><a href=#1-æ·»åŠ -targets-æœåŠ¡å‘ç°>1. æ·»åŠ  Targets (æœåŠ¡å‘ç°)</a></li><li><a href=#2-æ·»åŠ å‘Šè­¦è§„åˆ™>2. æ·»åŠ å‘Šè­¦è§„åˆ™</a></li><li><a href=#3-å‘Šè­¦é€šçŸ¥>3. å‘Šè­¦é€šçŸ¥</a></li><li><a href=#æ€»ç»“-11>æ€»ç»“</a></li></ul></li><li><a href=#k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨prometheusç›‘æ§>k8sé›†ç¾¤å¤–exporteræ€ä¹ˆä½¿ç”¨Prometheusç›‘æ§</a><ul><li><a href=#1-ç¡®ä¿å¤–éƒ¨-exporter-å¯è®¿é—®>1. ç¡®ä¿å¤–éƒ¨ Exporter å¯è®¿é—®</a></li><li><a href=#2-é…ç½®-prometheus-æ¥æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>2. é…ç½® Prometheus æ¥æŠ“å–å¤–éƒ¨ Exporter æ•°æ®</a></li><li><a href=#3-éªŒè¯-prometheus-æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨-exporter-æ•°æ®>3. éªŒè¯ Prometheus æ˜¯å¦å¯ä»¥æ­£ç¡®æŠ“å–å¤–éƒ¨ Exporter æ•°æ®</a></li><li><a href=#4-é…ç½®å‘Šè­¦å¯é€‰>4. é…ç½®å‘Šè­¦ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#5-é…ç½®å‘Šè­¦é€šçŸ¥å¯é€‰>5. é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆå¯é€‰ï¼‰</a></li><li><a href=#æ€»ç»“-12>æ€»ç»“ï¼š</a></li></ul></li></ul></nav></div></aside></main></body></html>
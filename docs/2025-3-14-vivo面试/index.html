<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  ä½ ä»¬çš„k8sé›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ
  #

5ä¸ªmasterèŠ‚ç‚¹ å‰©ä¸‹æ˜¯nodeèŠ‚ç‚¹ï¼Œè”é‚¦ï¼Œ2ä¸ªæ§åˆ¶é¢é›†ç¾¤å’Œ38è¿è¡Œé¢é›†ç¾¤ ç»„æˆk8sè”é‚¦ï¼Œæ§åˆ¶é¢k8sé›†ç¾¤åªè·‘paaså¹³å°çš„åº”ç”¨ï¼Œè¿è¡Œé¢é›†ç¾¤è·‘ä¸šåŠ¡åº”ç”¨ï¼ŒAD BC åˆ†åŒºï¼Œå¤šAZå¤¸æœºæˆ¿å®¹ç¾
Kubernetes é›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡å¯¹äºç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§å’Œå®¹ç¾èƒ½åŠ›éå¸¸é‡è¦ã€‚æ ¹æ®ä½ æè¿°çš„è®¾è®¡æ¶æ„ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„åˆ†æå’Œå±•å¼€ï¼š

  1. 5ä¸ª Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰
  #


å¤šèŠ‚ç‚¹è®¾è®¡ï¼šé«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤éœ€è¦è‡³å°‘ä¸‰ä¸ª master èŠ‚ç‚¹æ¥æä¾›å†—ä½™ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœã€‚ä½ é€‰æ‹©äº† 5 ä¸ª master èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥å¢å¼ºé›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œé¿å…ä»»ä½• 2 ä¸ªèŠ‚ç‚¹å®•æœºæ—¶é›†ç¾¤æœåŠ¡çš„ä¸å¯ç”¨ã€‚
æ§åˆ¶é¢èŒè´£ï¼šKubernetes master èŠ‚ç‚¹è´Ÿè´£è°ƒåº¦ã€é›†ç¾¤çŠ¶æ€ç®¡ç†ã€API æœåŠ¡å™¨ã€æ§åˆ¶å™¨ç®¡ç†å™¨ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚å°† master èŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æˆ–è™šæ‹Ÿæœºä¸Šï¼Œå¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨è¿›è¡Œæµé‡åˆ†é…ï¼Œå¯ä»¥æœ‰æ•ˆé¿å… master èŠ‚ç‚¹å•ç‚¹æ•…éšœã€‚
è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ Nginxã€HAProxy æˆ–äº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡ï¼‰å¯¹å¤–æš´éœ² Kubernetes API Serverï¼Œä½¿å¾—æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ kubectlã€åº”ç”¨ï¼‰èƒ½å¤Ÿåœ¨å¤šä¸ª master èŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ï¼Œé¿å…å•ä¸€ master èŠ‚ç‚¹çš„å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚


  2. Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰
  #


è¿è¡Œä¸šåŠ¡åº”ç”¨ï¼šKubernetes çš„ node èŠ‚ç‚¹è´Ÿè´£è¿è¡Œå®¹å™¨åŒ–çš„ä¸šåŠ¡åº”ç”¨ã€‚åœ¨è¯¥æ¶æ„ä¸‹ï¼ŒèŠ‚ç‚¹æ•°ç›®é€šå¸¸æ ¹æ®å·¥ä½œè´Ÿè½½çš„éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚æ¯ä¸ª node èŠ‚ç‚¹è¿è¡Œ kubelet å’Œ kube-proxyï¼Œè¿™äº›ç»„ä»¶ç®¡ç†èŠ‚ç‚¹çš„å¥åº·å’ŒæœåŠ¡å‘ç°ã€‚
è‡ªåŠ¨æ‰©å®¹ï¼šå¯ä»¥é€šè¿‡ Kubernetes é›†ç¾¤çš„ HPAï¼ˆHorizontal Pod Autoscalerï¼‰æ¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘ node èŠ‚ç‚¹çš„æ•°é‡ï¼Œä»è€Œåº”å¯¹è´Ÿè½½çš„æ³¢åŠ¨ã€‚


  3. è”é‚¦æ¶æ„ï¼ˆFederationï¼‰
  #


æ§åˆ¶é¢é›†ç¾¤å’Œè¿è¡Œé¢é›†ç¾¤çš„åˆ†ç¦»ï¼šåœ¨è”é‚¦æ¶æ„ä¸­ï¼Œæ§åˆ¶é¢é›†ç¾¤è´Ÿè´£ç®¡ç†å’Œæ§åˆ¶é›†ç¾¤çš„æ•´ä½“çŠ¶æ€ï¼Œä½†ä¸è¿è¡Œå…·ä½“çš„ä¸šåŠ¡åº”ç”¨ã€‚è€Œè¿è¡Œé¢é›†ç¾¤ä¸“æ³¨äºè¿è¡Œä¸šåŠ¡åº”ç”¨ï¼Œè´Ÿè½½ç”±æ§åˆ¶é¢é›†ç¾¤ç»Ÿä¸€è°ƒåº¦ã€‚æ§åˆ¶é¢é›†ç¾¤é€šå¸¸åªè¿è¡Œ PaaS å¹³å°ç›¸å…³çš„åº”ç”¨ï¼Œè€Œä¸šåŠ¡åº”ç”¨åˆ™è¿è¡Œåœ¨è¿è¡Œé¢é›†ç¾¤ä¸­ã€‚
è”é‚¦è°ƒåº¦ï¼šKubernetes è”é‚¦å¯ä»¥è·¨å¤šä¸ªé›†ç¾¤è¿›è¡Œè°ƒåº¦ï¼Œæ”¯æŒå¤šä¸ªé›†ç¾¤ä¸­çš„æœåŠ¡å‘ç°ã€è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ä½¿ç”¨ Kubernetes è”é‚¦å¯ä»¥å®ç°è·¨åœ°åŸŸã€è·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡æ‰©å±•ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨æ€§ã€‚
è·¨åŒºåŸŸå®¹ç¾ï¼šè”é‚¦æ¶æ„ä¸­çš„å¤šä¸ªè¿è¡Œé¢é›†ç¾¤å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„å¯ç”¨åŒºåŸŸï¼ˆAvailability Zoneï¼ŒAZï¼‰å’Œä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚é€šè¿‡åˆç†çš„è®¾è®¡ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåŒºåŸŸå‘ç”Ÿæ•…éšœæ—¶ï¼Œè‡ªåŠ¨å°†æµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåŒºåŸŸï¼Œä»è€Œå®ç°è·¨åŒºåŸŸå®¹ç¾ã€‚


  4. AD BC åˆ†åŒº
  #


AD å’Œ BC æ˜¯ä¸åŒçš„åŒºåŸŸåˆ†åŒºï¼šè¿™é‡Œçš„ AD å’Œ BC å¾ˆå¯èƒ½æŒ‡çš„æ˜¯ä¸åŒçš„åº”ç”¨åŒºåŸŸåˆ†åŒºæˆ–è€…ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åˆ†åŒºã€‚AD å’Œ BC ä»£è¡¨äº†ä¸¤ç±»ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯ä¸ªåˆ†åŒºå¯èƒ½æœ‰ç‹¬ç«‹çš„ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨éš”ç¦»è¦æ±‚ã€‚
åˆ†åŒºç®¡ç†ï¼šé€šè¿‡ä¸ºä¸åŒçš„ä¸šåŠ¡æ¨¡å—ä½¿ç”¨ä¸åŒçš„ Kubernetes Namespaceï¼Œå¯ä»¥åœ¨åŒä¸€é›†ç¾¤ä¸­å®ç°ä¸€å®šç¨‹åº¦çš„èµ„æºéš”ç¦»ã€æƒé™ç®¡ç†å’Œç½‘ç»œéš”ç¦»ã€‚


  5. å¤š AZ è·¨æœºæˆ¿å®¹ç¾è®¾è®¡
  #


è·¨æœºæˆ¿éƒ¨ç½²ï¼šé€šè¿‡å°† Kubernetes é›†ç¾¤éƒ¨ç½²åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–å¤šä¸ªå¯ç”¨åŒºï¼ˆAZï¼‰ä¹‹é—´ï¼Œå®ç°é«˜å¯ç”¨å’Œç¾éš¾æ¢å¤ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ª master èŠ‚ç‚¹è·¨æœºæˆ¿éƒ¨ç½²ï¼Œå¹¶åˆ©ç”¨äº‘æœåŠ¡æä¾›çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ç½‘ç»œè®¾è®¡ï¼Œä¿è¯ master èŠ‚ç‚¹èƒ½å¤Ÿè·¨æœºæˆ¿è®¿é—®ä¸”é«˜å¯ç”¨ã€‚
Pod è·¨ AZ éƒ¨ç½²ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒPod å¯ä»¥è·¨å¤šä¸ª AZ éƒ¨ç½²ï¼Œé€šè¿‡é…ç½® topologySpreadConstraints æˆ–ä½¿ç”¨é€‚å½“çš„äº²å’Œæ€§å’Œåäº²å’Œæ€§ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨åœ¨å¤šä¸ª AZ ä¸­æœ‰å†—ä½™å¤‡ä»½ï¼Œé¿å…æŸä¸ª AZ æ•…éšœå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚
Persistent Volume è·¨ AZ å­˜å‚¨ï¼šä½¿ç”¨è·¨ AZ çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚äº‘æä¾›å•†çš„è·¨åŒºåŸŸå­˜å‚¨å·ï¼‰ç¡®ä¿åœ¨ä¸€ä¸ª AZ æ•…éšœæ—¶ï¼Œåº”ç”¨çš„æŒä¹…åŒ–æ•°æ®èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚æŸäº›äº‘å¹³å°å¦‚ AWS EBS æ”¯æŒè·¨å¯ç”¨åŒºçš„æ•°æ®å¤åˆ¶ã€‚


  6. å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡
  #


å¥åº·æ£€æŸ¥ï¼šé€šè¿‡å­˜æ´»æ£€æµ‹å’Œå°±ç»ªæ£€æµ‹ç¡®ä¿æ¯ä¸ªç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€etcdã€kubelet ç­‰ï¼‰éƒ½å¤„äºæ­£å¸¸çŠ¶æ€ã€‚å¦‚æœæŸä¸ªç»„ä»¶å¤±è´¥ï¼Œè‡ªåŠ¨è¿›è¡Œè‡ªæ„ˆæˆ–é‡æ–°è°ƒåº¦ã€‚
Pod è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡ï¼šKubernetes è°ƒåº¦å™¨ä¼šæ ¹æ®é›†ç¾¤çš„è´Ÿè½½å’Œå®¹å™¨çš„èµ„æºéœ€æ±‚ï¼Œå°† Pod åˆ†é…åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶åˆ©ç”¨ Service å’Œ Ingress å¯¹å¤–æš´éœ²åº”ç”¨ï¼Œç¡®ä¿æµé‡èƒ½å¤Ÿåœ¨ä¸åŒçš„ Pod å’ŒèŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ã€‚


  7. ç¾éš¾æ¢å¤ä¸å®¹é”™
  #


Etcd é«˜å¯ç”¨ï¼šEtcd æ˜¯ Kubernetes é›†ç¾¤çš„å…³é”®ç»„ä»¶ï¼Œå­˜å‚¨äº†é›†ç¾¤çš„æ‰€æœ‰é…ç½®ä¿¡æ¯å’ŒçŠ¶æ€ã€‚é€šè¿‡å°† Etcd éƒ¨ç½²ä¸ºé«˜å¯ç”¨é›†ç¾¤ï¼ˆé€šå¸¸æ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ 3 ä¸ªæˆ– 5 ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œç¡®ä¿åœ¨ä»»æ„èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé›†ç¾¤ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚
å¤šåŒºåŸŸå†—ä½™ï¼šé€šè¿‡è·¨åŒºåŸŸéƒ¨ç½² Etcd èŠ‚ç‚¹å’Œ Master èŠ‚ç‚¹ï¼Œç¡®ä¿åœ¨å•ä¸ªåŒºåŸŸæˆ–æ•°æ®ä¸­å¿ƒå‘ç”Ÿæ•…éšœæ—¶ï¼Œå…¶ä»–åŒºåŸŸå¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚å³ä½¿åœ¨å¤§è§„æ¨¡ç¾éš¾ä¸­ï¼Œä¹Ÿèƒ½æœ€å¤§ç¨‹åº¦åœ°ä¿æŒç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚


  8. å¤‡ä»½ä¸æ¢å¤
  #


å®šæœŸå¤‡ä»½ï¼šå®šæœŸå¤‡ä»½ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ etcdã€kube-apiserver çš„é…ç½®ç­‰ï¼‰ï¼Œä»¥åº”å¯¹æ•°æ®ä¸¢å¤±æˆ–ç¾éš¾æ¢å¤éœ€æ±‚ã€‚
æ¢å¤æ–¹æ¡ˆï¼šæµ‹è¯•å¹¶åˆ¶å®šæ¢å¤æ–¹æ¡ˆï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å¤Ÿè¿…é€Ÿå°†é›†ç¾¤æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Velero æˆ–å…¶ä»–å¤‡ä»½å·¥å…·è¿›è¡Œé›†ç¾¤å¤‡ä»½å’Œæ¢å¤ã€‚


  æ€»ç»“
  #

é€šè¿‡è¿™æ ·çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡ï¼ŒKubernetes é›†ç¾¤èƒ½å¤Ÿåœ¨é¢å¯¹èŠ‚ç‚¹æ•…éšœã€åŒºåŸŸæ•…éšœç­‰æƒ…å†µä¸‹ä¿æŒé«˜åº¦çš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚è”é‚¦æ¶æ„ã€è·¨æœºæˆ¿å®¹ç¾ã€å¤š AZ éƒ¨ç½²ã€Etcd é«˜å¯ç”¨ç­‰è®¾è®¡ç¡®ä¿äº†åº”ç”¨åœ¨ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ä¸‹èƒ½å¤Ÿå¾—åˆ°è‰¯å¥½çš„æ”¯æŒï¼ŒåŒæ—¶å…·å¤‡äº†å¼ºå¤§çš„å®¹é”™èƒ½åŠ›å’Œæ‰©å±•èƒ½åŠ›ã€‚"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-3-14 vivoé¢è¯•"><meta property="og:description" content="ä½ ä»¬çš„k8sé›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ # 5ä¸ªmasterèŠ‚ç‚¹ å‰©ä¸‹æ˜¯nodeèŠ‚ç‚¹ï¼Œè”é‚¦ï¼Œ2ä¸ªæ§åˆ¶é¢é›†ç¾¤å’Œ38è¿è¡Œé¢é›†ç¾¤ ç»„æˆk8sè”é‚¦ï¼Œæ§åˆ¶é¢k8sé›†ç¾¤åªè·‘paaså¹³å°çš„åº”ç”¨ï¼Œè¿è¡Œé¢é›†ç¾¤è·‘ä¸šåŠ¡åº”ç”¨ï¼ŒAD BC åˆ†åŒºï¼Œå¤šAZå¤¸æœºæˆ¿å®¹ç¾
Kubernetes é›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡å¯¹äºç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§å’Œå®¹ç¾èƒ½åŠ›éå¸¸é‡è¦ã€‚æ ¹æ®ä½ æè¿°çš„è®¾è®¡æ¶æ„ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„åˆ†æå’Œå±•å¼€ï¼š
1. 5ä¸ª Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰ # å¤šèŠ‚ç‚¹è®¾è®¡ï¼šé«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤éœ€è¦è‡³å°‘ä¸‰ä¸ª master èŠ‚ç‚¹æ¥æä¾›å†—ä½™ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœã€‚ä½ é€‰æ‹©äº† 5 ä¸ª master èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥å¢å¼ºé›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œé¿å…ä»»ä½• 2 ä¸ªèŠ‚ç‚¹å®•æœºæ—¶é›†ç¾¤æœåŠ¡çš„ä¸å¯ç”¨ã€‚ æ§åˆ¶é¢èŒè´£ï¼šKubernetes master èŠ‚ç‚¹è´Ÿè´£è°ƒåº¦ã€é›†ç¾¤çŠ¶æ€ç®¡ç†ã€API æœåŠ¡å™¨ã€æ§åˆ¶å™¨ç®¡ç†å™¨ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚å°† master èŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æˆ–è™šæ‹Ÿæœºä¸Šï¼Œå¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨è¿›è¡Œæµé‡åˆ†é…ï¼Œå¯ä»¥æœ‰æ•ˆé¿å… master èŠ‚ç‚¹å•ç‚¹æ•…éšœã€‚ è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ Nginxã€HAProxy æˆ–äº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡ï¼‰å¯¹å¤–æš´éœ² Kubernetes API Serverï¼Œä½¿å¾—æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ kubectlã€åº”ç”¨ï¼‰èƒ½å¤Ÿåœ¨å¤šä¸ª master èŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ï¼Œé¿å…å•ä¸€ master èŠ‚ç‚¹çš„å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚ 2. Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰ # è¿è¡Œä¸šåŠ¡åº”ç”¨ï¼šKubernetes çš„ node èŠ‚ç‚¹è´Ÿè´£è¿è¡Œå®¹å™¨åŒ–çš„ä¸šåŠ¡åº”ç”¨ã€‚åœ¨è¯¥æ¶æ„ä¸‹ï¼ŒèŠ‚ç‚¹æ•°ç›®é€šå¸¸æ ¹æ®å·¥ä½œè´Ÿè½½çš„éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚æ¯ä¸ª node èŠ‚ç‚¹è¿è¡Œ kubelet å’Œ kube-proxyï¼Œè¿™äº›ç»„ä»¶ç®¡ç†èŠ‚ç‚¹çš„å¥åº·å’ŒæœåŠ¡å‘ç°ã€‚ è‡ªåŠ¨æ‰©å®¹ï¼šå¯ä»¥é€šè¿‡ Kubernetes é›†ç¾¤çš„ HPAï¼ˆHorizontal Pod Autoscalerï¼‰æ¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘ node èŠ‚ç‚¹çš„æ•°é‡ï¼Œä»è€Œåº”å¯¹è´Ÿè½½çš„æ³¢åŠ¨ã€‚ 3. è”é‚¦æ¶æ„ï¼ˆFederationï¼‰ # æ§åˆ¶é¢é›†ç¾¤å’Œè¿è¡Œé¢é›†ç¾¤çš„åˆ†ç¦»ï¼šåœ¨è”é‚¦æ¶æ„ä¸­ï¼Œæ§åˆ¶é¢é›†ç¾¤è´Ÿè´£ç®¡ç†å’Œæ§åˆ¶é›†ç¾¤çš„æ•´ä½“çŠ¶æ€ï¼Œä½†ä¸è¿è¡Œå…·ä½“çš„ä¸šåŠ¡åº”ç”¨ã€‚è€Œè¿è¡Œé¢é›†ç¾¤ä¸“æ³¨äºè¿è¡Œä¸šåŠ¡åº”ç”¨ï¼Œè´Ÿè½½ç”±æ§åˆ¶é¢é›†ç¾¤ç»Ÿä¸€è°ƒåº¦ã€‚æ§åˆ¶é¢é›†ç¾¤é€šå¸¸åªè¿è¡Œ PaaS å¹³å°ç›¸å…³çš„åº”ç”¨ï¼Œè€Œä¸šåŠ¡åº”ç”¨åˆ™è¿è¡Œåœ¨è¿è¡Œé¢é›†ç¾¤ä¸­ã€‚ è”é‚¦è°ƒåº¦ï¼šKubernetes è”é‚¦å¯ä»¥è·¨å¤šä¸ªé›†ç¾¤è¿›è¡Œè°ƒåº¦ï¼Œæ”¯æŒå¤šä¸ªé›†ç¾¤ä¸­çš„æœåŠ¡å‘ç°ã€è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ä½¿ç”¨ Kubernetes è”é‚¦å¯ä»¥å®ç°è·¨åœ°åŸŸã€è·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡æ‰©å±•ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨æ€§ã€‚ è·¨åŒºåŸŸå®¹ç¾ï¼šè”é‚¦æ¶æ„ä¸­çš„å¤šä¸ªè¿è¡Œé¢é›†ç¾¤å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„å¯ç”¨åŒºåŸŸï¼ˆAvailability Zoneï¼ŒAZï¼‰å’Œä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚é€šè¿‡åˆç†çš„è®¾è®¡ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåŒºåŸŸå‘ç”Ÿæ•…éšœæ—¶ï¼Œè‡ªåŠ¨å°†æµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåŒºåŸŸï¼Œä»è€Œå®ç°è·¨åŒºåŸŸå®¹ç¾ã€‚ 4. AD BC åˆ†åŒº # AD å’Œ BC æ˜¯ä¸åŒçš„åŒºåŸŸåˆ†åŒºï¼šè¿™é‡Œçš„ AD å’Œ BC å¾ˆå¯èƒ½æŒ‡çš„æ˜¯ä¸åŒçš„åº”ç”¨åŒºåŸŸåˆ†åŒºæˆ–è€…ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åˆ†åŒºã€‚AD å’Œ BC ä»£è¡¨äº†ä¸¤ç±»ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯ä¸ªåˆ†åŒºå¯èƒ½æœ‰ç‹¬ç«‹çš„ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨éš”ç¦»è¦æ±‚ã€‚ åˆ†åŒºç®¡ç†ï¼šé€šè¿‡ä¸ºä¸åŒçš„ä¸šåŠ¡æ¨¡å—ä½¿ç”¨ä¸åŒçš„ Kubernetes Namespaceï¼Œå¯ä»¥åœ¨åŒä¸€é›†ç¾¤ä¸­å®ç°ä¸€å®šç¨‹åº¦çš„èµ„æºéš”ç¦»ã€æƒé™ç®¡ç†å’Œç½‘ç»œéš”ç¦»ã€‚ 5. å¤š AZ è·¨æœºæˆ¿å®¹ç¾è®¾è®¡ # è·¨æœºæˆ¿éƒ¨ç½²ï¼šé€šè¿‡å°† Kubernetes é›†ç¾¤éƒ¨ç½²åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–å¤šä¸ªå¯ç”¨åŒºï¼ˆAZï¼‰ä¹‹é—´ï¼Œå®ç°é«˜å¯ç”¨å’Œç¾éš¾æ¢å¤ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ª master èŠ‚ç‚¹è·¨æœºæˆ¿éƒ¨ç½²ï¼Œå¹¶åˆ©ç”¨äº‘æœåŠ¡æä¾›çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ç½‘ç»œè®¾è®¡ï¼Œä¿è¯ master èŠ‚ç‚¹èƒ½å¤Ÿè·¨æœºæˆ¿è®¿é—®ä¸”é«˜å¯ç”¨ã€‚ Pod è·¨ AZ éƒ¨ç½²ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒPod å¯ä»¥è·¨å¤šä¸ª AZ éƒ¨ç½²ï¼Œé€šè¿‡é…ç½® topologySpreadConstraints æˆ–ä½¿ç”¨é€‚å½“çš„äº²å’Œæ€§å’Œåäº²å’Œæ€§ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨åœ¨å¤šä¸ª AZ ä¸­æœ‰å†—ä½™å¤‡ä»½ï¼Œé¿å…æŸä¸ª AZ æ•…éšœå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚ Persistent Volume è·¨ AZ å­˜å‚¨ï¼šä½¿ç”¨è·¨ AZ çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚äº‘æä¾›å•†çš„è·¨åŒºåŸŸå­˜å‚¨å·ï¼‰ç¡®ä¿åœ¨ä¸€ä¸ª AZ æ•…éšœæ—¶ï¼Œåº”ç”¨çš„æŒä¹…åŒ–æ•°æ®èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚æŸäº›äº‘å¹³å°å¦‚ AWS EBS æ”¯æŒè·¨å¯ç”¨åŒºçš„æ•°æ®å¤åˆ¶ã€‚ 6. å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡ # å¥åº·æ£€æŸ¥ï¼šé€šè¿‡å­˜æ´»æ£€æµ‹å’Œå°±ç»ªæ£€æµ‹ç¡®ä¿æ¯ä¸ªç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€etcdã€kubelet ç­‰ï¼‰éƒ½å¤„äºæ­£å¸¸çŠ¶æ€ã€‚å¦‚æœæŸä¸ªç»„ä»¶å¤±è´¥ï¼Œè‡ªåŠ¨è¿›è¡Œè‡ªæ„ˆæˆ–é‡æ–°è°ƒåº¦ã€‚ Pod è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡ï¼šKubernetes è°ƒåº¦å™¨ä¼šæ ¹æ®é›†ç¾¤çš„è´Ÿè½½å’Œå®¹å™¨çš„èµ„æºéœ€æ±‚ï¼Œå°† Pod åˆ†é…åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶åˆ©ç”¨ Service å’Œ Ingress å¯¹å¤–æš´éœ²åº”ç”¨ï¼Œç¡®ä¿æµé‡èƒ½å¤Ÿåœ¨ä¸åŒçš„ Pod å’ŒèŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ã€‚ 7. ç¾éš¾æ¢å¤ä¸å®¹é”™ # Etcd é«˜å¯ç”¨ï¼šEtcd æ˜¯ Kubernetes é›†ç¾¤çš„å…³é”®ç»„ä»¶ï¼Œå­˜å‚¨äº†é›†ç¾¤çš„æ‰€æœ‰é…ç½®ä¿¡æ¯å’ŒçŠ¶æ€ã€‚é€šè¿‡å°† Etcd éƒ¨ç½²ä¸ºé«˜å¯ç”¨é›†ç¾¤ï¼ˆé€šå¸¸æ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ 3 ä¸ªæˆ– 5 ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œç¡®ä¿åœ¨ä»»æ„èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé›†ç¾¤ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ å¤šåŒºåŸŸå†—ä½™ï¼šé€šè¿‡è·¨åŒºåŸŸéƒ¨ç½² Etcd èŠ‚ç‚¹å’Œ Master èŠ‚ç‚¹ï¼Œç¡®ä¿åœ¨å•ä¸ªåŒºåŸŸæˆ–æ•°æ®ä¸­å¿ƒå‘ç”Ÿæ•…éšœæ—¶ï¼Œå…¶ä»–åŒºåŸŸå¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚å³ä½¿åœ¨å¤§è§„æ¨¡ç¾éš¾ä¸­ï¼Œä¹Ÿèƒ½æœ€å¤§ç¨‹åº¦åœ°ä¿æŒç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ 8. å¤‡ä»½ä¸æ¢å¤ # å®šæœŸå¤‡ä»½ï¼šå®šæœŸå¤‡ä»½ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ etcdã€kube-apiserver çš„é…ç½®ç­‰ï¼‰ï¼Œä»¥åº”å¯¹æ•°æ®ä¸¢å¤±æˆ–ç¾éš¾æ¢å¤éœ€æ±‚ã€‚ æ¢å¤æ–¹æ¡ˆï¼šæµ‹è¯•å¹¶åˆ¶å®šæ¢å¤æ–¹æ¡ˆï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å¤Ÿè¿…é€Ÿå°†é›†ç¾¤æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Velero æˆ–å…¶ä»–å¤‡ä»½å·¥å…·è¿›è¡Œé›†ç¾¤å¤‡ä»½å’Œæ¢å¤ã€‚ æ€»ç»“ # é€šè¿‡è¿™æ ·çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡ï¼ŒKubernetes é›†ç¾¤èƒ½å¤Ÿåœ¨é¢å¯¹èŠ‚ç‚¹æ•…éšœã€åŒºåŸŸæ•…éšœç­‰æƒ…å†µä¸‹ä¿æŒé«˜åº¦çš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚è”é‚¦æ¶æ„ã€è·¨æœºæˆ¿å®¹ç¾ã€å¤š AZ éƒ¨ç½²ã€Etcd é«˜å¯ç”¨ç­‰è®¾è®¡ç¡®ä¿äº†åº”ç”¨åœ¨ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ä¸‹èƒ½å¤Ÿå¾—åˆ°è‰¯å¥½çš„æ”¯æŒï¼ŒåŒæ—¶å…·å¤‡äº†å¼ºå¤§çš„å®¹é”™èƒ½åŠ›å’Œæ‰©å±•èƒ½åŠ›ã€‚"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-3-14 vivoé¢è¯• | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.f95c6b9a60666b7048cee04630cfc1e8d9370fb96c18c5c4d047db5e7a5d2e18.js integrity="sha256-+VxrmmBma3BIzuBGMM/B6Nk3D7lsGMXE0EfbXnpdLhg=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-4-16 è‡ªç ”k8så¹³å°</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-4-16 sleepç¡çœ åº”ç”¨</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-4-16 paaså¼€å‘è®°å½•</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-4-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-4-16 BOSSç›´è˜è‡ªåŠ¨æŠ•é€’</a></li><li><a href=/docs/2025-3-30-metallb/>2025-3-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-3-24 è‡ªæˆ‘ä»‹ç»</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametricsé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics å’Œ Thanos å¯¹æ¯”</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanosé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanosæ¶æ„</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w podå‹æµ‹å¤ç›˜</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 ç«å±±äº‘è¿ç§»å·¥ç¨‹å¸ˆé¢è¯•è®°å½•</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/ class=active>2025-3-14 vivoé¢è¯•</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istioæµé‡åˆ†æ</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calicoä¸‰ç§æ¨¡å¼ä¸‹æµé‡ä¼ è¾“</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 å¡”èµé¢è¯•</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 è¿½è§…é¢è¯•</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8såˆ é™¤podæˆ–deploymentçš„æµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8såˆ›å»ºpodæµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-2-28 prometheusé¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 é¢è¯•0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 é«˜çº§è¿ç»´é¢è¯•é¢˜-linuxéƒ¨åˆ†</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 ä¸­çº§è¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224é¢è¯•</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 é¢è¯•0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 é¢è¯•0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 é¢è¯•2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8sé¢˜ç›®</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 é¢è¯•0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 é¢è¯•2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 ç¾å›½ç å†œè®¡åˆ’</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 ç¾å›½ç å†œè–ªé…¬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8sç»„ä»¶</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8så¸¸è§æ•…éšœæŒ‡å—</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 è¦ä¸è¦åˆ›ä¸š</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 æ—©æœŸæ¨¡å¼</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 å¤§å °æ²³-æˆ‘çš„ä¿å§†</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 åˆåˆ›å…¬å¸</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 åˆ›ä¸šè€…äº¤æµ</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 åˆ›ä¸šç‚¹å­</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealosè·æŠ•</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack sshè¿æ¥</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpasséƒ¨ç½²openstack devstackå½¢å¼</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart éƒ¨ç½²flaskåº”ç”¨</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 å—å­˜å‚¨å’Œå¯¹è±¡å‚¨å­˜åŒºåˆ«</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstackéœ€è¦å‡ å°è™šæ‹Ÿæœº</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstackå’ŒkubernetesåŒºåˆ«</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nanoæ“ä½œ</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpassæ“ä½œ</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeaszéƒ¨ç½²k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 é¡¶çº§devopså·¥å…·å¤§ç›˜ç‚¹</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 æ¸…ç†dockeré•œåƒ</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 æ„å»ºå®¹å™¨é•œåƒåˆ©å™¨buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 æ˜¯æŠ€æœ¯å¤§ç¥è¿˜æ˜¯åŸºç¡€æ¶æ„éƒ¨çš„ç¥¸å®³</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 æ­ä¸ªæ—¥å¿—æ‰‹æœºç³»ç»Ÿä¸é¦™å—</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 æˆ‘åªæƒ³åšæŠ€æœ¯ èµ°æŠ€æœ¯è·¯çº¿</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 å¸¸è§linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 å¤§å‚æ€»ç»“nginxé«˜å¹¶å‘ä¼˜åŒ–ç¬”è®°</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 å²ä¸Šæœ€ç‰›jenkins pipelineæµæ°´çº¿è¯¦è§£</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEGä¸istioé›†æˆ</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginxå¦‚ä½•è§£å†³æƒŠç¾¤æ•ˆåº”</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctlæ£€æµ‹é›†ç¾¤podé—´è¿é€šæ€§</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linuxè¿ç»´å·¥ç¨‹å¸ˆ50ä¸ªå¸¸è§é¢è¯•é¢˜</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linuxç³»ç»Ÿæ€§èƒ½ä¼˜åŒ– ä¸ƒä¸ªå®æˆ˜ç»éªŒ</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awkæ–‡æœ¬å¤„ç†å™¨ 8ä¸ªæ¡ˆä¾‹</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruiseåŸåœ°å‡çº§è§£æ</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8Sé¢è¯•é¢˜</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8sèƒŒåserviceæ˜¯å¦‚ä½•å·¥ä½œçš„</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8Sçš„æœ€åä¸€å—æ‹¼å›¾</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istioéƒ¨ç½²</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfileå®šåˆ¶ä¸“å±é•œåƒ</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33æ¬¾gitopsä¸devopsä¸»æµç³»ç»Ÿ</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linuxé¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8sé¢è¯•é¢˜</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruiseè¯¦ç»†è§£é‡Šä»¥åŠåŸåœ°å‡çº§åŠå…¨é“¾è·¯ç°åº¦å‘å¸ƒæ–¹æ¡ˆ</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8Sä¹‹ingress-nginxåŸç†åŠé…ç½®</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 ä½¿ç”¨cloudflare(CF)æ­å»ºdockerhubä»£ç†</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 å•masterå•etcdæ”¹é€ ä¸º3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 é¢è¯•æ€»ç»“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 å¦‚ä½•ä¸ºK8Sä¿é©¾æŠ¤èˆª</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8Så¦‚ä½•è·å¾— IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_status_update.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_pod_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8Sè°ƒåº¦å™¨ extender.go æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹sync.go åŒæ­¥ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹rollback.go å›æ»š æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹recreate.go é‡å»º æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ scheduler.go è°ƒåº¦å™¨ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ rolling.go æ»šåŠ¨æ›´æ–° æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ progress.go è¿›åº¦ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ deployment_controller.goæºç è§£è¯»</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S è°ƒåº¦å™¨ scheduler_one.go æºç è§£è¯»</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 å½»æ‚Ÿå®¹å™¨ç½‘ç»œ</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 é¢è¯•ç”¨ Golang æ‰‹æ’¸ LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 è‡ªåŠ¨å±è”½IPæ”»å‡»</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 ç¦»çº¿å®‰è£…kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 ç£ç›˜æ•°æ®æ¢å¤</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 æ¸…ç†æ®‹ç•™çš„calicoç½‘ç»œæ’ä»¶</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 æµé‡ä½•å¤„æ¥ä½•å¤„å»</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 æå¤§æé«˜å·¥ä½œæ•ˆç‡çš„ Linux å‘½ä»¤</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 æ–‡å­¦çš„æ•…ä¹¡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 ææ‡‚K8Sé‰´æƒ</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 å®¹å™¨ç½‘ç»œåŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ OverlayFS åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 å®¹å™¨åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 å®¹å™¨å†…çš„ 1 å·è¿›ç¨‹</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 å®¹å™¨ä¸­åŸŸåè§£æä»¥åŠä¸åŒdnspolicyå¯¹åŸŸåè§£æçš„å½±å“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 å¦‚ä½•è°ƒè¯• crash å®¹å™¨çš„ç½‘ç»œ</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 å¦‚ä½•ä½¿ç”¨tektonå¿«é€Ÿæ­å»ºCI/CDå¹³å°</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 å¤§è§„æ¨¡å¹¶å‘ä¸‹å¦‚ä½•åŠ å¿« Pod å¯åŠ¨é€Ÿåº¦</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 ä½¿ç”¨kubernees leases è½»æ¾å®ç°leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 äºŒè¿›åˆ¶éƒ¨ç½²K8SåŠ èŠ‚ç‚¹æ“ä½œ</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 ä¸¤å¼ å›¾å…¨é¢ç†è§£K8SåŸç†</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 sslè¯ä¹¦è‡ªç­¾å‘</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheusä¼ä¸šçº§ç›‘æ§ä½¿ç”¨æ€»ç»“</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 åŸç†</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux æ€§èƒ½ä¼˜åŒ–å¤§å…¨</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(é‰´æƒ)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(è®¤è¯)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes æºç ç»“æ„</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekeyæ·»åŠ æ–°èŠ‚ç‚¹</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8Sé¢è¯•å®å…¸</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8Sé¢è¯•å¤§å…¨</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8sè¿ç»´ä¹‹æ¸…ç†ç£ç›˜</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8Sè°ƒè¯•POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8Sçš„PODç±»å‹</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8såº”ç”¨çš„æœ€ä½³å®è·µ</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8Så‘½ä»¤æŒ‡å—</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8SåŸåœ°å‡çº§</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S æ¢é’ˆåŸç†</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S å¼€å‘å¯ä¸æ­¢ CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebsåŸç†</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chartå’Œrepo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanelç½‘ç»œ</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCDç¨³å®šæ€§åŠæ€§èƒ½ä¼˜åŒ–å®è·µ</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCDå¤‡ä»½</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Dockeré‡è¦çš„ç½‘ç»œçŸ¥è¯†ç‚¹</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfileçš„copyå’Œaddçš„åŒºåˆ«</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNSä¹‹å…‰</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd åŸºæœ¬æ“ä½œ</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNIæ’ä»¶é€‰å‹</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go æ¶æ„</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go å››ç§å®¢æˆ·ç«¯</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICDæ€è€ƒ</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calicoç½‘ç»œè‡ªå®šä¹‰</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acmeè‡ªåŠ¨æ›´æ–°è¯ä¹¦</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16ä¸ªæ¦‚å¿µå¸¦ä½ å…¥é—¨ Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 é¢è¯•0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600æ¡æœ€å¼ºlinuxå‘½ä»¤æ€»ç»“</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16å¼ ç¡¬æ ¸å›¾è§£k8sç½‘ç»œ</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8sä¹‹kubeletæºç è§£è¯»</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 ä¸¤å¼ å›¾å…¨é¢ç†è§£k8såŸç†</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 é¢è¯•</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8sæµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S æµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 é¢è¯•</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8sé¢è¯•å®å…¸</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8sæ¶æ„å¸ˆé¢è¯•å¤§å…¨</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 ä½¿ç”¨ OpenFunction åœ¨ä»»ä½•åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œæ— æœåŠ¡å™¨å·¥ä½œè´Ÿè½½</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 ç¦»çº¿å®‰è£…é›†ç¾¤</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 æ“ä½œç³»ç»Ÿè¯´æ˜</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 å¿«é€ŸæŒ‡å—</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 å¼€å§‹ä½¿ç”¨ cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 å¤šæ¶æ„æ”¯æŒ</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 å…¬æœ‰äº‘ä¸Šéƒ¨ç½²</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 ä¸ªæ€§åŒ–é›†ç¾¤å‚æ•°é…ç½®</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl å‘½ä»¤è¡Œä»‹ç»</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB è´Ÿè½½å‡è¡¡éƒ¨ç½²</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico é…ç½® BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-å®‰è£…é›†ç¾¤ä¸»è¦æ’ä»¶</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S é›†ç¾¤å­˜å‚¨</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…kube-ovnç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…flannelç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ciliumç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…calicoç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-å®‰è£…etcdé›†ç¾¤</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-é›†ç¾¤è§„åˆ’å’ŒåŸºç¡€å‚æ•°è®¾å®š</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-å®‰è£…kube_nodeèŠ‚ç‚¹</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-å®‰è£…kube_masterèŠ‚ç‚¹</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-åˆ›å»ºè¯ä¹¦å’Œç¯å¢ƒå‡†å¤‡</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 æ€è€ƒ</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-3-14 vivoé¢è¯•</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#1-5ä¸ª-master-èŠ‚ç‚¹æ§åˆ¶é¢>1. <strong>5ä¸ª Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰</strong></a></li><li><a href=#2-node-èŠ‚ç‚¹å·¥ä½œèŠ‚ç‚¹>2. <strong>Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰</strong></a></li><li><a href=#3-è”é‚¦æ¶æ„federation>3. <strong>è”é‚¦æ¶æ„ï¼ˆFederationï¼‰</strong></a></li><li><a href=#4-ad-bc-åˆ†åŒº>4. <strong>AD BC åˆ†åŒº</strong></a></li><li><a href=#5-å¤š-az-è·¨æœºæˆ¿å®¹ç¾è®¾è®¡>5. <strong>å¤š AZ è·¨æœºæˆ¿å®¹ç¾è®¾è®¡</strong></a></li><li><a href=#6-å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡>6. <strong>å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡</strong></a></li><li><a href=#7-ç¾éš¾æ¢å¤ä¸å®¹é”™>7. <strong>ç¾éš¾æ¢å¤ä¸å®¹é”™</strong></a></li><li><a href=#8-å¤‡ä»½ä¸æ¢å¤>8. <strong>å¤‡ä»½ä¸æ¢å¤</strong></a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></li></ul><ul><li><a href=#1-etcd-å®¹ç¾æ–¹æ¡ˆ><strong>1. etcd å®¹ç¾æ–¹æ¡ˆ</strong></a><ul><li><a href=#1-etcd-é«˜å¯ç”¨éƒ¨ç½²><strong>(1) etcd é«˜å¯ç”¨éƒ¨ç½²</strong></a></li><li><a href=#2-etcd-å¤‡ä»½ä¸æ¢å¤><strong>(2) etcd å¤‡ä»½ä¸æ¢å¤</strong></a></li><li><a href=#3-etcd-è‡ªåŠ¨æ•…éšœè½¬ç§»><strong>(3) etcd è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></a></li></ul></li><li><a href=#2-kubernetes-æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ><strong>2. Kubernetes æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ</strong></a><ul><li><a href=#1-é«˜å¯ç”¨æ¶æ„><strong>(1) é«˜å¯ç”¨æ¶æ„</strong></a></li><li><a href=#2-ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤><strong>(2) ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤</strong></a></li><li><a href=#3-å¤‡ä»½ä¸æ¢å¤><strong>(3) å¤‡ä»½ä¸æ¢å¤</strong></a></li></ul></li><li><a href=#3-æ•…éšœæ¢å¤ç­–ç•¥><strong>3. æ•…éšœæ¢å¤ç­–ç•¥</strong></a></li><li><a href=#4-ç»“è®º><strong>4. ç»“è®º</strong></a></li></ul><ul><li><a href=#kubernetes-å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡><strong>Kubernetes å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡</strong></a></li></ul><ul><li><a href=#-åœºæ™¯-1etcd-æ•…éšœ><strong>ğŸŸ¢ åœºæ™¯ 1ï¼šetcd æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-2master-èŠ‚ç‚¹æ•…éšœ><strong>ğŸŸ¡ åœºæ™¯ 2ï¼šMaster èŠ‚ç‚¹æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-3node-è®¡ç®—èŠ‚ç‚¹æ•…éšœ><strong>ğŸ”´ åœºæ™¯ 3ï¼šNode è®¡ç®—èŠ‚ç‚¹æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-4ingressservice-è´Ÿè½½å‡è¡¡å¼‚å¸¸><strong>ğŸŸ  åœºæ™¯ 4ï¼šIngress/Service è´Ÿè½½å‡è¡¡å¼‚å¸¸</strong></a></li><li><a href=#-åœºæ™¯-5å­˜å‚¨æ•…éšœ><strong>ğŸ”µ åœºæ™¯ 5ï¼šå­˜å‚¨æ•…éšœ</strong></a></li></ul><ul><li><a href=#æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ><strong>æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ</strong></a></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-1etcd-é€‰ä¸»æ—¶é—´è¿‡é•¿å½±å“-api-server-å“åº”><strong>ğŸ›‘ é—®é¢˜ 1ï¼šetcd é€‰ä¸»æ—¶é—´è¿‡é•¿ï¼Œå½±å“ API Server å“åº”</strong></a></li><li><a href=#-é—®é¢˜-2etcd-å¤‡ä»½æœªç”Ÿæ•ˆæ¢å¤å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 2ï¼šetcd å¤‡ä»½æœªç”Ÿæ•ˆï¼Œæ¢å¤å¤±è´¥</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-3kube-apiserver-å®•æœºè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ><strong>ğŸ›‘ é—®é¢˜ 3ï¼škube-apiserver å®•æœºï¼Œè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-4èŠ‚ç‚¹é©±é€å-pod-è¿ç§»å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šèŠ‚ç‚¹é©±é€å Pod è¿ç§»å¤±è´¥</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-5ingress-nginx-å®•æœºåä¸šåŠ¡ä¸å¯è®¿é—®><strong>ğŸ›‘ é—®é¢˜ 5ï¼šIngress Nginx å®•æœºåï¼Œä¸šåŠ¡ä¸å¯è®¿é—®</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-6pvc-ç»‘å®šå¤±è´¥pod-è¿›å…¥><strong>ğŸ›‘ é—®é¢˜ 6ï¼šPVC ç»‘å®šå¤±è´¥ï¼ŒPod è¿›å…¥ <code>Pending</code> çŠ¶æ€</strong></a></li></ul></li><li><a href=#æ€»ç»“-1><strong>æ€»ç»“</strong></a></li></ul><ul><li><a href=#å¤§è§„æ¨¡å¯åŠ¨-pod-å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ><strong>å¤§è§„æ¨¡å¯åŠ¨ Pod å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ</strong></a></li><li><a href=#-1-é€šè¿‡><strong>ğŸ›  1. é€šè¿‡ <code>kubectl</code> å’Œ <code>describe</code> å‘½ä»¤æ’æŸ¥</strong></a><ul><li><a href=#-æŸ¥çœ‹-pod-çŠ¶æ€><strong>ğŸ“Œ æŸ¥çœ‹ Pod çŠ¶æ€</strong></a></li><li><a href=#-è·å–è¯¦ç»†ä¿¡æ¯><strong>ğŸ“Œ è·å–è¯¦ç»†ä¿¡æ¯</strong></a></li></ul></li><li><a href=#-2-è°ƒåº¦é—®é¢˜pod-æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹><strong>ğŸ” 2. è°ƒåº¦é—®é¢˜ï¼ˆPod æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-1é›†ç¾¤èµ„æºä¸è¶³><strong>ğŸ›‘ é—®é¢˜ 1ï¼šé›†ç¾¤èµ„æºä¸è¶³</strong></a></li><li><a href=#-é—®é¢˜-2èŠ‚ç‚¹è°ƒåº¦é™åˆ¶><strong>ğŸ›‘ é—®é¢˜ 2ï¼šèŠ‚ç‚¹è°ƒåº¦é™åˆ¶</strong></a></li></ul></li><li><a href=#-3-å®¹å™¨åˆ›å»ºé—®é¢˜containercreating-å¡ä½><strong>ğŸ” 3. å®¹å™¨åˆ›å»ºé—®é¢˜ï¼ˆContainerCreating å¡ä½ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-3cni-ç½‘ç»œç»„ä»¶å¼‚å¸¸><strong>ğŸ›‘ é—®é¢˜ 3ï¼šCNI ç½‘ç»œç»„ä»¶å¼‚å¸¸</strong></a></li><li><a href=#-é—®é¢˜-4å®¹å™¨é•œåƒæ‹‰å–å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šå®¹å™¨é•œåƒæ‹‰å–å¤±è´¥</strong></a></li></ul></li><li><a href=#-4-å­˜å‚¨é—®é¢˜pvc-ç»‘å®šå¤±è´¥><strong>ğŸ” 4. å­˜å‚¨é—®é¢˜ï¼ˆPVC ç»‘å®šå¤±è´¥ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-5å­˜å‚¨å·æŒ‚è½½å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 5ï¼šå­˜å‚¨å·æŒ‚è½½å¤±è´¥</strong></a></li></ul></li><li><a href=#-5-master-ç»„ä»¶è´Ÿè½½è¿‡é«˜><strong>ğŸ” 5. Master ç»„ä»¶è´Ÿè½½è¿‡é«˜</strong></a><ul><li><a href=#-é—®é¢˜-6api-server-è´Ÿè½½è¿‡é«˜><strong>ğŸ›‘ é—®é¢˜ 6ï¼šAPI Server è´Ÿè½½è¿‡é«˜</strong></a></li></ul></li><li><a href=#-æ€»ç»“><strong>ğŸ¯ æ€»ç»“</strong></a></li></ul><ul><li><a href=#kubernetes-ä¸­-redis-å’Œ-kafka-å®¹å™¨åŒ–æ–¹æ¡ˆ><strong>Kubernetes ä¸­ Redis å’Œ Kafka å®¹å™¨åŒ–æ–¹æ¡ˆ</strong></a></li></ul><ul><li><ul><li><a href=#-redis-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Redis æ–¹æ¡ˆè®¾è®¡</strong></a></li><li><a href=#-æ–¹æ¡ˆ-1redis-sentinel-é«˜å¯ç”¨><strong>ğŸ“Œ æ–¹æ¡ˆ 1ï¼šRedis Sentinel é«˜å¯ç”¨</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2redis-clusteråˆ†ç‰‡><strong>ğŸ“Œ æ–¹æ¡ˆ 2ï¼šRedis Clusterï¼ˆåˆ†ç‰‡ï¼‰</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-kafka-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Kafka æ–¹æ¡ˆè®¾è®¡</strong></a></li><li><a href=#-kafka-å®¹å™¨åŒ–éƒ¨ç½²><strong>ğŸ“Œ Kafka å®¹å™¨åŒ–éƒ¨ç½²</strong></a></li></ul></li></ul><ul><li><a href=#-1-æ•°æ®æŒä¹…åŒ–><strong>ğŸ“Œ 1. æ•°æ®æŒä¹…åŒ–</strong></a></li><li><a href=#-2-é«˜å¯ç”¨><strong>ğŸ“Œ 2. é«˜å¯ç”¨</strong></a></li><li><a href=#-3-å»¶è¿Ÿä¼˜åŒ–><strong>ğŸ“Œ 3. å»¶è¿Ÿä¼˜åŒ–</strong></a></li></ul><ul><li><a href=#dragonfly-åŸç†è§£æ><strong>Dragonfly åŸç†è§£æ</strong></a><ul><li><a href=#-dragonfly-æ˜¯ä»€ä¹ˆ><strong>ğŸ“Œ Dragonfly æ˜¯ä»€ä¹ˆï¼Ÿ</strong></a></li></ul></li><li><a href=#1-dragonfly-ä¸»è¦ç»„æˆ><strong>1ï¸âƒ£ Dragonfly ä¸»è¦ç»„æˆ</strong></a></li><li><a href=#2-dragonfly-çš„å·¥ä½œåŸç†><strong>2ï¸âƒ£ Dragonfly çš„å·¥ä½œåŸç†</strong></a><ul><li><a href=#-1-é•œåƒæ–‡ä»¶ä¸‹è½½è¯·æ±‚><strong>ğŸ›  1. é•œåƒ/æ–‡ä»¶ä¸‹è½½è¯·æ±‚</strong></a></li><li><a href=#-2-è°ƒåº¦èŠ‚ç‚¹scheduler><strong>ğŸ›  2. è°ƒåº¦èŠ‚ç‚¹ï¼ˆschedulerï¼‰</strong></a></li><li><a href=#-3-p2p-ä¸‹è½½><strong>ğŸ›  3. P2P ä¸‹è½½</strong></a></li><li><a href=#-4-æœ¬åœ°ç¼“å­˜><strong>ğŸ›  4. æœ¬åœ°ç¼“å­˜</strong></a></li></ul></li><li><a href=#3-dragonfly-çš„-p2p-ä¸‹è½½æœºåˆ¶><strong>3ï¸âƒ£ Dragonfly çš„ P2P ä¸‹è½½æœºåˆ¶</strong></a><ul><li><a href=#-p2p-åˆ†å—ä¸‹è½½><strong>ğŸ”¥ P2P åˆ†å—ä¸‹è½½</strong></a></li></ul></li><li><a href=#4-dragonfly-é«˜å¯ç”¨æ¶æ„><strong>4ï¸âƒ£ Dragonfly é«˜å¯ç”¨æ¶æ„</strong></a><ul><li><a href=#-å¤šçº§ç¼“å­˜æ¶æ„><strong>ğŸŒ å¤šçº§ç¼“å­˜æ¶æ„</strong></a></li><li><a href=#-å…³é”®ç‰¹æ€§><strong>âš¡ å…³é”®ç‰¹æ€§</strong></a></li></ul></li><li><a href=#5-dragonfly-åœ¨-kubernetes-é›†ç¾¤ä¸­çš„åº”ç”¨><strong>5ï¸âƒ£ Dragonfly åœ¨ Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨</strong></a><ul><li><a href=#-åœ¨-kubernetes-ä½¿ç”¨-dragonfly><strong>ğŸ”¥ åœ¨ Kubernetes ä½¿ç”¨ Dragonfly</strong></a></li></ul></li><li><a href=#6-dragonfly-å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ><strong>6ï¸âƒ£ Dragonfly å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ</strong></a></li><li><a href=#-æ€»ç»“-2><strong>âœ… æ€»ç»“</strong></a></li></ul><ul><li><a href=#ç›‘æ§æ—¥æ´»åƒä¸‡çº§-app-çš„ç›‘æ§ä½“ç³»è®¾è®¡><strong>ç›‘æ§æ—¥æ´»åƒä¸‡çº§ App çš„ç›‘æ§ä½“ç³»è®¾è®¡</strong></a></li><li><a href=#1-ç›‘æ§ä½“ç³»è®¾è®¡><strong>1. ç›‘æ§ä½“ç³»è®¾è®¡</strong></a><ul><li><a href=#1ç›‘æ§æ¶æ„><strong>ï¼ˆ1ï¼‰ç›‘æ§æ¶æ„</strong></a></li></ul></li><li><a href=#2-å…³é”®ç›‘æ§æŒ‡æ ‡><strong>2. å…³é”®ç›‘æ§æŒ‡æ ‡</strong></a><ul><li><a href=#1ä¸šåŠ¡å±‚ç›‘æ§><strong>ï¼ˆ1ï¼‰ä¸šåŠ¡å±‚ç›‘æ§</strong></a></li><li><a href=#2ç³»ç»Ÿå±‚ç›‘æ§><strong>ï¼ˆ2ï¼‰ç³»ç»Ÿå±‚ç›‘æ§</strong></a></li><li><a href=#3åº”ç”¨å±‚ç›‘æ§apm><strong>ï¼ˆ3ï¼‰åº”ç”¨å±‚ç›‘æ§ï¼ˆAPMï¼‰</strong></a></li><li><a href=#4æ—¥å¿—--å¼‚å¸¸ç›‘æ§><strong>ï¼ˆ4ï¼‰æ—¥å¿— & å¼‚å¸¸ç›‘æ§</strong></a></li></ul></li><li><a href=#3-ç›‘æ§å·¥å…·é€‰å‹><strong>3. ç›‘æ§å·¥å…·é€‰å‹</strong></a></li><li><a href=#4-å‘Šè­¦ç­–ç•¥><strong>4. å‘Šè­¦ç­–ç•¥</strong></a><ul><li><a href=#1å‘Šè­¦åˆ†çº§><strong>ï¼ˆ1ï¼‰å‘Šè­¦åˆ†çº§</strong></a></li><li><a href=#2è‡ªåŠ¨åŒ–è¿ç»´><strong>ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–è¿ç»´</strong></a></li></ul></li><li><a href=#5-å…¸å‹æ•…éšœåœºæ™¯--å¤„ç†><strong>5. å…¸å‹æ•…éšœåœºæ™¯ & å¤„ç†</strong></a></li><li><a href=#æ€»ç»“-2><strong>æ€»ç»“</strong></a></li></ul><ul><li><ul><li><a href=#1-å¢åŠ -prometheus-çš„å†…å­˜é™åˆ¶>1. <strong>å¢åŠ  Prometheus çš„å†…å­˜é™åˆ¶</strong></a></li><li><a href=#2-è°ƒæ•´>2. <strong>è°ƒæ•´ <code>max-memory</code> é™åˆ¶</strong></a></li><li><a href=#3-å‡å°‘-prometheus-å­˜å‚¨æ•°æ®çš„é‡>3. <strong>å‡å°‘ Prometheus å­˜å‚¨æ•°æ®çš„é‡</strong></a></li><li><a href=#4-ä½¿ç”¨è¾ƒå°çš„>4. <strong>ä½¿ç”¨è¾ƒå°çš„ <code>scrape_interval</code></strong></a></li><li><a href=#5-ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢>5. <strong>ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢</strong></a></li><li><a href=#6-å¯ç”¨>6. <strong>å¯ç”¨ <code>remote_write</code> å’Œå¤–éƒ¨å­˜å‚¨</strong></a></li><li><a href=#7-æé«˜-prometheus-æ€§èƒ½>7. <strong>æé«˜ Prometheus æ€§èƒ½</strong></a></li><li><a href=#8-æ‰©å±•-prometheus-é›†ç¾¤>8. <strong>æ‰©å±• Prometheus é›†ç¾¤</strong></a></li><li><a href=#æ€»ç»“-3>æ€»ç»“ï¼š</a></li><li><a href=#prometheus-è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ><strong>Prometheus è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ</strong></a></li><li><a href=#è”é‚¦çš„å·¥ä½œåŸç†><strong>è”é‚¦çš„å·¥ä½œåŸç†</strong></a></li><li><a href=#è”é‚¦çš„å…¸å‹ç”¨é€”><strong>è”é‚¦çš„å…¸å‹ç”¨é€”</strong></a></li><li><a href=#prometheus-è”é‚¦çš„é…ç½®><strong>Prometheus è”é‚¦çš„é…ç½®</strong></a></li><li><a href=#å…³é”®å‚æ•°è§£é‡Š><strong>å…³é”®å‚æ•°è§£é‡Š</strong></a></li><li><a href=#ä¼˜åŠ¿><strong>ä¼˜åŠ¿</strong></a></li><li><a href=#é™åˆ¶å’ŒæŒ‘æˆ˜><strong>é™åˆ¶å’ŒæŒ‘æˆ˜</strong></a></li><li><a href=#æ€»ç»“-4><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤><strong>éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤ï¼š</strong></a></li><li><a href=#ä¿è¯-playbook-çš„å¹‚ç­‰æ€§><strong>ä¿è¯ Playbook çš„å¹‚ç­‰æ€§ï¼š</strong></a></li><li><a href=#ä¿è¯-playbook-çš„å®‰å…¨æ€§><strong>ä¿è¯ Playbook çš„å®‰å…¨æ€§ï¼š</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯><strong>ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯</strong></a></li><li><a href=#è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤><strong>è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤ï¼š</strong></a></li><li><a href=#ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·><strong>ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·ï¼š</strong></a></li><li><a href=#æ€»ç»“-5><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li></ul><ul><li><a href=#æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡-><strong>æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡</strong> ğŸš€</a></li><li><a href=#1-æµé‡æ´ªå³°çš„ç‰¹å¾><strong>1. æµé‡æ´ªå³°çš„ç‰¹å¾</strong></a></li><li><a href=#2-è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„><strong>2. è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„</strong></a></li><li><a href=#3-å…³é”®æ‰©ç¼©å®¹ç­–ç•¥><strong>3. å…³é”®æ‰©ç¼©å®¹ç­–ç•¥</strong></a><ul><li><a href=#1pod-æ°´å¹³æ‰©å±•hpa><strong>ï¼ˆ1ï¼‰Pod æ°´å¹³æ‰©å±•ï¼ˆHPAï¼‰</strong></a></li><li><a href=#2pod-å‚ç›´æ‰©å±•vpa><strong>ï¼ˆ2ï¼‰Pod å‚ç›´æ‰©å±•ï¼ˆVPAï¼‰</strong></a></li><li><a href=#3é›†ç¾¤èŠ‚ç‚¹æ‰©å±•cluster-autoscaler><strong>ï¼ˆ3ï¼‰é›†ç¾¤èŠ‚ç‚¹æ‰©å±•ï¼ˆCluster Autoscalerï¼‰</strong></a></li><li><a href=#4äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹keda><strong>ï¼ˆ4ï¼‰äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹ï¼ˆKEDAï¼‰</strong></a></li></ul></li><li><a href=#4-é¢„æ¡ˆ--é«˜å¯ç”¨ç­–ç•¥><strong>4. é¢„æ¡ˆ & é«˜å¯ç”¨ç­–ç•¥</strong></a><ul><li><a href=#1æµé‡é¢„æ¡ˆ><strong>ï¼ˆ1ï¼‰æµé‡é¢„æ¡ˆ</strong></a></li><li><a href=#2æ•…éšœæ¢å¤><strong>ï¼ˆ2ï¼‰æ•…éšœæ¢å¤</strong></a></li></ul></li><li><a href=#5-æ–¹æ¡ˆæ€»ç»“><strong>5. æ–¹æ¡ˆæ€»ç»“</strong></a><ul><li><a href=#æœ€ç»ˆæ¶æ„><strong>æœ€ç»ˆæ¶æ„</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#1-ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°><strong>1. ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°</strong></a></li><li><a href=#2-åˆ†æç½‘ç»œé“¾è·¯><strong>2. åˆ†æç½‘ç»œé“¾è·¯</strong></a></li><li><a href=#3-å­˜å‚¨å±‚æ’æŸ¥><strong>3. å­˜å‚¨å±‚æ’æŸ¥</strong></a></li><li><a href=#4-è§†é¢‘æ–‡ä»¶åˆ†æ><strong>4. è§†é¢‘æ–‡ä»¶åˆ†æ</strong></a></li><li><a href=#5-å®¢æˆ·ç«¯æ’æŸ¥><strong>5. å®¢æˆ·ç«¯æ’æŸ¥</strong></a></li><li><a href=#6-æµç¨‹ç›‘æ§ä¸æ—¥å¿—><strong>6. æµç¨‹ç›‘æ§ä¸æ—¥å¿—</strong></a></li><li><a href=#7-è¿›è¡Œå‹åŠ›æµ‹è¯•><strong>7. è¿›è¡Œå‹åŠ›æµ‹è¯•</strong></a></li><li><a href=#æ€»ç»“-6><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li></ul><ul><li><ul><li><a href=#1-æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»><strong>1. æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»</strong></a></li><li><a href=#2-æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»><strong>2. æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»</strong></a></li><li><a href=#3-æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»><strong>3. æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»</strong></a></li><li><a href=#4-æ•…éšœåˆ†ç±»><strong>4. æ•…éšœåˆ†ç±»</strong></a></li><li><a href=#5-ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ><strong>5. ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ</strong></a></li><li><a href=#6-åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°><strong>6. åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°</strong></a></li><li><a href=#7-ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ><strong>7. ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ</strong></a></li><li><a href=#æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹><strong>æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹</strong>ï¼š</a></li><li><a href=#æ€»ç»“-7><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£><strong>äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£</strong>ï¼š</a></li><li><a href=#ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åå¦‚ä½•è§£å†³é—®é¢˜><strong>ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åï¼Œå¦‚ä½•è§£å†³é—®é¢˜ï¼Ÿ</strong></a></li><li><a href=#æ€»ç»“-8><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#1-å®šä¹‰å’Œé‡ç‚¹><strong>1. å®šä¹‰å’Œé‡ç‚¹</strong></a></li><li><a href=#2-ä¸»è¦èŒè´£><strong>2. ä¸»è¦èŒè´£</strong></a></li><li><a href=#3-å…³æ³¨ç‚¹å’Œç›®æ ‡><strong>3. å…³æ³¨ç‚¹å’Œç›®æ ‡</strong></a></li><li><a href=#4-è·¨éƒ¨é—¨åä½œ><strong>4. è·¨éƒ¨é—¨åä½œ</strong></a></li><li><a href=#5-è¿ç»´å·¥å…·ä¸æŠ€æœ¯><strong>5. è¿ç»´å·¥å…·ä¸æŠ€æœ¯</strong></a></li><li><a href=#æ€»ç»“-9><strong>æ€»ç»“</strong></a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ä½ ä»¬çš„k8sé›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„æ€ä¹ˆè®¾è®¡çš„>ä½ ä»¬çš„k8sé›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ
<a class=anchor href=#%e4%bd%a0%e4%bb%ac%e7%9a%84k8s%e9%9b%86%e7%be%a4%e7%9a%84%e9%ab%98%e5%8f%af%e7%94%a8%e6%9e%b6%e6%9e%84%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e7%9a%84>#</a></h1><p>5ä¸ªmasterèŠ‚ç‚¹ å‰©ä¸‹æ˜¯nodeèŠ‚ç‚¹ï¼Œè”é‚¦ï¼Œ2ä¸ªæ§åˆ¶é¢é›†ç¾¤å’Œ38è¿è¡Œé¢é›†ç¾¤ ç»„æˆk8sè”é‚¦ï¼Œæ§åˆ¶é¢k8sé›†ç¾¤åªè·‘paaså¹³å°çš„åº”ç”¨ï¼Œè¿è¡Œé¢é›†ç¾¤è·‘ä¸šåŠ¡åº”ç”¨ï¼ŒAD BC åˆ†åŒºï¼Œå¤šAZå¤¸æœºæˆ¿å®¹ç¾</p><p>Kubernetes é›†ç¾¤çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡å¯¹äºç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§å’Œå®¹ç¾èƒ½åŠ›éå¸¸é‡è¦ã€‚æ ¹æ®ä½ æè¿°çš„è®¾è®¡æ¶æ„ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„åˆ†æå’Œå±•å¼€ï¼š</p><h3 id=1-5ä¸ª-master-èŠ‚ç‚¹æ§åˆ¶é¢>1. <strong>5ä¸ª Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰</strong>
<a class=anchor href=#1-5%e4%b8%aa-master-%e8%8a%82%e7%82%b9%e6%8e%a7%e5%88%b6%e9%9d%a2>#</a></h3><ul><li><strong>å¤šèŠ‚ç‚¹è®¾è®¡</strong>ï¼šé«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤éœ€è¦è‡³å°‘ä¸‰ä¸ª master èŠ‚ç‚¹æ¥æä¾›å†—ä½™ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœã€‚ä½ é€‰æ‹©äº† 5 ä¸ª master èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥å¢å¼ºé›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œé¿å…ä»»ä½• 2 ä¸ªèŠ‚ç‚¹å®•æœºæ—¶é›†ç¾¤æœåŠ¡çš„ä¸å¯ç”¨ã€‚</li><li><strong>æ§åˆ¶é¢èŒè´£</strong>ï¼šKubernetes master èŠ‚ç‚¹è´Ÿè´£è°ƒåº¦ã€é›†ç¾¤çŠ¶æ€ç®¡ç†ã€API æœåŠ¡å™¨ã€æ§åˆ¶å™¨ç®¡ç†å™¨ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚å°† master èŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æˆ–è™šæ‹Ÿæœºä¸Šï¼Œå¹¶ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨è¿›è¡Œæµé‡åˆ†é…ï¼Œå¯ä»¥æœ‰æ•ˆé¿å… master èŠ‚ç‚¹å•ç‚¹æ•…éšœã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ Nginxã€HAProxy æˆ–äº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡ï¼‰å¯¹å¤–æš´éœ² Kubernetes API Serverï¼Œä½¿å¾—æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ <code>kubectl</code>ã€åº”ç”¨ï¼‰èƒ½å¤Ÿåœ¨å¤šä¸ª master èŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ï¼Œé¿å…å•ä¸€ master èŠ‚ç‚¹çš„å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚</li></ul><h3 id=2-node-èŠ‚ç‚¹å·¥ä½œèŠ‚ç‚¹>2. <strong>Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰</strong>
<a class=anchor href=#2-node-%e8%8a%82%e7%82%b9%e5%b7%a5%e4%bd%9c%e8%8a%82%e7%82%b9>#</a></h3><ul><li><strong>è¿è¡Œä¸šåŠ¡åº”ç”¨</strong>ï¼šKubernetes çš„ node èŠ‚ç‚¹è´Ÿè´£è¿è¡Œå®¹å™¨åŒ–çš„ä¸šåŠ¡åº”ç”¨ã€‚åœ¨è¯¥æ¶æ„ä¸‹ï¼ŒèŠ‚ç‚¹æ•°ç›®é€šå¸¸æ ¹æ®å·¥ä½œè´Ÿè½½çš„éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚æ¯ä¸ª node èŠ‚ç‚¹è¿è¡Œ <code>kubelet</code> å’Œ <code>kube-proxy</code>ï¼Œè¿™äº›ç»„ä»¶ç®¡ç†èŠ‚ç‚¹çš„å¥åº·å’ŒæœåŠ¡å‘ç°ã€‚</li><li><strong>è‡ªåŠ¨æ‰©å®¹</strong>ï¼šå¯ä»¥é€šè¿‡ Kubernetes é›†ç¾¤çš„ HPAï¼ˆHorizontal Pod Autoscalerï¼‰æ¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘ node èŠ‚ç‚¹çš„æ•°é‡ï¼Œä»è€Œåº”å¯¹è´Ÿè½½çš„æ³¢åŠ¨ã€‚</li></ul><h3 id=3-è”é‚¦æ¶æ„federation>3. <strong>è”é‚¦æ¶æ„ï¼ˆFederationï¼‰</strong>
<a class=anchor href=#3-%e8%81%94%e9%82%a6%e6%9e%b6%e6%9e%84federation>#</a></h3><ul><li><strong>æ§åˆ¶é¢é›†ç¾¤å’Œè¿è¡Œé¢é›†ç¾¤çš„åˆ†ç¦»</strong>ï¼šåœ¨è”é‚¦æ¶æ„ä¸­ï¼Œæ§åˆ¶é¢é›†ç¾¤è´Ÿè´£ç®¡ç†å’Œæ§åˆ¶é›†ç¾¤çš„æ•´ä½“çŠ¶æ€ï¼Œä½†ä¸è¿è¡Œå…·ä½“çš„ä¸šåŠ¡åº”ç”¨ã€‚è€Œè¿è¡Œé¢é›†ç¾¤ä¸“æ³¨äºè¿è¡Œä¸šåŠ¡åº”ç”¨ï¼Œè´Ÿè½½ç”±æ§åˆ¶é¢é›†ç¾¤ç»Ÿä¸€è°ƒåº¦ã€‚æ§åˆ¶é¢é›†ç¾¤é€šå¸¸åªè¿è¡Œ PaaS å¹³å°ç›¸å…³çš„åº”ç”¨ï¼Œè€Œä¸šåŠ¡åº”ç”¨åˆ™è¿è¡Œåœ¨è¿è¡Œé¢é›†ç¾¤ä¸­ã€‚</li><li><strong>è”é‚¦è°ƒåº¦</strong>ï¼šKubernetes è”é‚¦å¯ä»¥è·¨å¤šä¸ªé›†ç¾¤è¿›è¡Œè°ƒåº¦ï¼Œæ”¯æŒå¤šä¸ªé›†ç¾¤ä¸­çš„æœåŠ¡å‘ç°ã€è·¨é›†ç¾¤è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ä½¿ç”¨ Kubernetes è”é‚¦å¯ä»¥å®ç°è·¨åœ°åŸŸã€è·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡æ‰©å±•ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨æ€§ã€‚</li><li><strong>è·¨åŒºåŸŸå®¹ç¾</strong>ï¼šè”é‚¦æ¶æ„ä¸­çš„å¤šä¸ªè¿è¡Œé¢é›†ç¾¤å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„å¯ç”¨åŒºåŸŸï¼ˆAvailability Zoneï¼ŒAZï¼‰å’Œä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚é€šè¿‡åˆç†çš„è®¾è®¡ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåŒºåŸŸå‘ç”Ÿæ•…éšœæ—¶ï¼Œè‡ªåŠ¨å°†æµé‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåŒºåŸŸï¼Œä»è€Œå®ç°è·¨åŒºåŸŸå®¹ç¾ã€‚</li></ul><h3 id=4-ad-bc-åˆ†åŒº>4. <strong>AD BC åˆ†åŒº</strong>
<a class=anchor href=#4-ad-bc-%e5%88%86%e5%8c%ba>#</a></h3><ul><li><strong>AD å’Œ BC æ˜¯ä¸åŒçš„åŒºåŸŸåˆ†åŒº</strong>ï¼šè¿™é‡Œçš„ AD å’Œ BC å¾ˆå¯èƒ½æŒ‡çš„æ˜¯ä¸åŒçš„åº”ç”¨åŒºåŸŸåˆ†åŒºæˆ–è€…ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åˆ†åŒºã€‚AD å’Œ BC ä»£è¡¨äº†ä¸¤ç±»ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯ä¸ªåˆ†åŒºå¯èƒ½æœ‰ç‹¬ç«‹çš„ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨éš”ç¦»è¦æ±‚ã€‚</li><li><strong>åˆ†åŒºç®¡ç†</strong>ï¼šé€šè¿‡ä¸ºä¸åŒçš„ä¸šåŠ¡æ¨¡å—ä½¿ç”¨ä¸åŒçš„ Kubernetes Namespaceï¼Œå¯ä»¥åœ¨åŒä¸€é›†ç¾¤ä¸­å®ç°ä¸€å®šç¨‹åº¦çš„èµ„æºéš”ç¦»ã€æƒé™ç®¡ç†å’Œç½‘ç»œéš”ç¦»ã€‚</li></ul><h3 id=5-å¤š-az-è·¨æœºæˆ¿å®¹ç¾è®¾è®¡>5. <strong>å¤š AZ è·¨æœºæˆ¿å®¹ç¾è®¾è®¡</strong>
<a class=anchor href=#5-%e5%a4%9a-az-%e8%b7%a8%e6%9c%ba%e6%88%bf%e5%ae%b9%e7%81%be%e8%ae%be%e8%ae%a1>#</a></h3><ul><li><strong>è·¨æœºæˆ¿éƒ¨ç½²</strong>ï¼šé€šè¿‡å°† Kubernetes é›†ç¾¤éƒ¨ç½²åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–å¤šä¸ªå¯ç”¨åŒºï¼ˆAZï¼‰ä¹‹é—´ï¼Œå®ç°é«˜å¯ç”¨å’Œç¾éš¾æ¢å¤ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ª master èŠ‚ç‚¹è·¨æœºæˆ¿éƒ¨ç½²ï¼Œå¹¶åˆ©ç”¨äº‘æœåŠ¡æä¾›çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ç½‘ç»œè®¾è®¡ï¼Œä¿è¯ master èŠ‚ç‚¹èƒ½å¤Ÿè·¨æœºæˆ¿è®¿é—®ä¸”é«˜å¯ç”¨ã€‚</li><li><strong>Pod è·¨ AZ éƒ¨ç½²</strong>ï¼šåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒPod å¯ä»¥è·¨å¤šä¸ª AZ éƒ¨ç½²ï¼Œé€šè¿‡é…ç½® <code>topologySpreadConstraints</code> æˆ–ä½¿ç”¨é€‚å½“çš„äº²å’Œæ€§å’Œåäº²å’Œæ€§ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨åœ¨å¤šä¸ª AZ ä¸­æœ‰å†—ä½™å¤‡ä»½ï¼Œé¿å…æŸä¸ª AZ æ•…éšœå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚</li><li><strong>Persistent Volume è·¨ AZ å­˜å‚¨</strong>ï¼šä½¿ç”¨è·¨ AZ çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚äº‘æä¾›å•†çš„è·¨åŒºåŸŸå­˜å‚¨å·ï¼‰ç¡®ä¿åœ¨ä¸€ä¸ª AZ æ•…éšœæ—¶ï¼Œåº”ç”¨çš„æŒä¹…åŒ–æ•°æ®èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚æŸäº›äº‘å¹³å°å¦‚ AWS EBS æ”¯æŒè·¨å¯ç”¨åŒºçš„æ•°æ®å¤åˆ¶ã€‚</li></ul><h3 id=6-å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡>6. <strong>å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡</strong>
<a class=anchor href=#6-%e5%81%a5%e5%ba%b7%e6%a3%80%e6%9f%a5%e5%92%8c%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1>#</a></h3><ul><li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šé€šè¿‡å­˜æ´»æ£€æµ‹å’Œå°±ç»ªæ£€æµ‹ç¡®ä¿æ¯ä¸ªç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€etcdã€kubelet ç­‰ï¼‰éƒ½å¤„äºæ­£å¸¸çŠ¶æ€ã€‚å¦‚æœæŸä¸ªç»„ä»¶å¤±è´¥ï¼Œè‡ªåŠ¨è¿›è¡Œè‡ªæ„ˆæˆ–é‡æ–°è°ƒåº¦ã€‚</li><li><strong>Pod è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šKubernetes è°ƒåº¦å™¨ä¼šæ ¹æ®é›†ç¾¤çš„è´Ÿè½½å’Œå®¹å™¨çš„èµ„æºéœ€æ±‚ï¼Œå°† Pod åˆ†é…åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶åˆ©ç”¨ <code>Service</code> å’Œ <code>Ingress</code> å¯¹å¤–æš´éœ²åº”ç”¨ï¼Œç¡®ä¿æµé‡èƒ½å¤Ÿåœ¨ä¸åŒçš„ Pod å’ŒèŠ‚ç‚¹ä¹‹é—´è´Ÿè½½å‡è¡¡ã€‚</li></ul><h3 id=7-ç¾éš¾æ¢å¤ä¸å®¹é”™>7. <strong>ç¾éš¾æ¢å¤ä¸å®¹é”™</strong>
<a class=anchor href=#7-%e7%81%be%e9%9a%be%e6%81%a2%e5%a4%8d%e4%b8%8e%e5%ae%b9%e9%94%99>#</a></h3><ul><li><strong>Etcd é«˜å¯ç”¨</strong>ï¼šEtcd æ˜¯ Kubernetes é›†ç¾¤çš„å…³é”®ç»„ä»¶ï¼Œå­˜å‚¨äº†é›†ç¾¤çš„æ‰€æœ‰é…ç½®ä¿¡æ¯å’ŒçŠ¶æ€ã€‚é€šè¿‡å°† Etcd éƒ¨ç½²ä¸ºé«˜å¯ç”¨é›†ç¾¤ï¼ˆé€šå¸¸æ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ 3 ä¸ªæˆ– 5 ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œç¡®ä¿åœ¨ä»»æ„èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé›†ç¾¤ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</li><li><strong>å¤šåŒºåŸŸå†—ä½™</strong>ï¼šé€šè¿‡è·¨åŒºåŸŸéƒ¨ç½² Etcd èŠ‚ç‚¹å’Œ Master èŠ‚ç‚¹ï¼Œç¡®ä¿åœ¨å•ä¸ªåŒºåŸŸæˆ–æ•°æ®ä¸­å¿ƒå‘ç”Ÿæ•…éšœæ—¶ï¼Œå…¶ä»–åŒºåŸŸå¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚å³ä½¿åœ¨å¤§è§„æ¨¡ç¾éš¾ä¸­ï¼Œä¹Ÿèƒ½æœ€å¤§ç¨‹åº¦åœ°ä¿æŒç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li></ul><h3 id=8-å¤‡ä»½ä¸æ¢å¤>8. <strong>å¤‡ä»½ä¸æ¢å¤</strong>
<a class=anchor href=#8-%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d>#</a></h3><ul><li><strong>å®šæœŸå¤‡ä»½</strong>ï¼šå®šæœŸå¤‡ä»½ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ etcdã€kube-apiserver çš„é…ç½®ç­‰ï¼‰ï¼Œä»¥åº”å¯¹æ•°æ®ä¸¢å¤±æˆ–ç¾éš¾æ¢å¤éœ€æ±‚ã€‚</li><li><strong>æ¢å¤æ–¹æ¡ˆ</strong>ï¼šæµ‹è¯•å¹¶åˆ¶å®šæ¢å¤æ–¹æ¡ˆï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å¤Ÿè¿…é€Ÿå°†é›†ç¾¤æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Velero æˆ–å…¶ä»–å¤‡ä»½å·¥å…·è¿›è¡Œé›†ç¾¤å¤‡ä»½å’Œæ¢å¤ã€‚</li></ul><h3 id=æ€»ç»“>æ€»ç»“
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h3><p>é€šè¿‡è¿™æ ·çš„é«˜å¯ç”¨æ¶æ„è®¾è®¡ï¼ŒKubernetes é›†ç¾¤èƒ½å¤Ÿåœ¨é¢å¯¹èŠ‚ç‚¹æ•…éšœã€åŒºåŸŸæ•…éšœç­‰æƒ…å†µä¸‹ä¿æŒé«˜åº¦çš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚è”é‚¦æ¶æ„ã€è·¨æœºæˆ¿å®¹ç¾ã€å¤š AZ éƒ¨ç½²ã€Etcd é«˜å¯ç”¨ç­‰è®¾è®¡ç¡®ä¿äº†åº”ç”¨åœ¨ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ä¸‹èƒ½å¤Ÿå¾—åˆ°è‰¯å¥½çš„æ”¯æŒï¼ŒåŒæ—¶å…·å¤‡äº†å¼ºå¤§çš„å®¹é”™èƒ½åŠ›å’Œæ‰©å±•èƒ½åŠ›ã€‚</p><h1 id=etcdæˆ–è€…æ§åˆ¶é¢ç»„ä»¶çš„å®¹ç¾æ–¹æ¡ˆ>etcdæˆ–è€…æ§åˆ¶é¢ç»„ä»¶çš„å®¹ç¾æ–¹æ¡ˆï¼Ÿ
<a class=anchor href=#etcd%e6%88%96%e8%80%85%e6%8e%a7%e5%88%b6%e9%9d%a2%e7%bb%84%e4%bb%b6%e7%9a%84%e5%ae%b9%e7%81%be%e6%96%b9%e6%a1%88>#</a></h1><p>Kubernetes <strong>etcd</strong> å’Œ <strong>æ§åˆ¶é¢ï¼ˆControl Planeï¼‰</strong> ç»„ä»¶çš„å®¹ç¾æ–¹æ¡ˆè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å†³å®šäº†æ•´ä¸ªé›†ç¾¤çš„å¯ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯ <strong>etcd</strong> å’Œ <strong>æ§åˆ¶é¢ç»„ä»¶</strong> çš„å®¹ç¾æ–¹æ¡ˆï¼ŒåŒ…æ‹¬é«˜å¯ç”¨éƒ¨ç½²ã€å¤‡ä»½æ¢å¤ã€è‡ªåŠ¨æ•…éšœè½¬ç§»ç­‰ç­–ç•¥ã€‚</p><hr><h2 id=1-etcd-å®¹ç¾æ–¹æ¡ˆ><strong>1. etcd å®¹ç¾æ–¹æ¡ˆ</strong>
<a class=anchor href=#1-etcd-%e5%ae%b9%e7%81%be%e6%96%b9%e6%a1%88>#</a></h2><p><strong>etcd æ˜¯ Kubernetes çš„æ ¸å¿ƒæ•°æ®å­˜å‚¨ï¼Œå­˜å‚¨äº†æ‰€æœ‰ API èµ„æºå¯¹è±¡çš„çŠ¶æ€ã€‚å¦‚æœ etcd å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ª Kubernetes æ§åˆ¶é¢å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚</strong></p><h3 id=1-etcd-é«˜å¯ç”¨éƒ¨ç½²><strong>(1) etcd é«˜å¯ç”¨éƒ¨ç½²</strong>
<a class=anchor href=#1-etcd-%e9%ab%98%e5%8f%af%e7%94%a8%e9%83%a8%e7%bd%b2>#</a></h3><ul><li><strong>å¤šèŠ‚ç‚¹é›†ç¾¤ï¼ˆ3ã€5ã€7 ç­‰å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼‰</strong><ul><li>etcd éœ€è¦ä½¿ç”¨<strong>å¥‡æ•°ä¸ªèŠ‚ç‚¹</strong>ï¼Œä»¥ä¿è¯ <strong>Raft å…±è¯†ç®—æ³•</strong>å¯ä»¥æ­£ç¡®é€‰ä¸¾ leaderã€‚</li><li>é€šå¸¸æ¨è<strong>è‡³å°‘ 3 ä¸ªèŠ‚ç‚¹</strong>ï¼Œè¿™æ ·å³ä½¿å®•æ‰ 1 ä¸ªï¼Œé›†ç¾¤ä»èƒ½ç»§ç»­è¿è¡Œã€‚</li><li>ç”Ÿäº§ç¯å¢ƒæ¨è<strong>5 ä¸ªèŠ‚ç‚¹</strong>ï¼Œä»¥æå‡å®¹ç¾èƒ½åŠ›ã€‚</li></ul></li><li><strong>è·¨ AZ æˆ–æœºæˆ¿éƒ¨ç½²</strong><ul><li>é‡‡ç”¨ <strong>å¤š AZ/å¤šæœºæˆ¿éƒ¨ç½²</strong>ï¼Œåˆ†å¸ƒå¼æ”¾ç½® etcd èŠ‚ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœï¼ˆå¦‚å•ä¸ªæœºæˆ¿æ–­ç½‘ã€æ–­ç”µï¼‰ã€‚</li><li>å¦‚æœä½¿ç”¨äº‘ç¯å¢ƒï¼ˆå¦‚ AWSã€é˜¿é‡Œäº‘ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨äº‘å¹³å°çš„ <strong>å¯ç”¨åŒºï¼ˆAZï¼‰</strong> åˆ†å¸ƒ etcd å®ä¾‹ã€‚</li></ul></li><li><strong>è´Ÿè½½å‡è¡¡</strong><ul><li>etcd é›†ç¾¤ä¹‹é—´çš„é€šä¿¡é€šå¸¸é€šè¿‡å†…éƒ¨ DNS è§£æï¼Œæ¯ä¸ª etcd æˆå‘˜éœ€è¦ä½¿ç”¨<strong>å›ºå®š IP</strong> æˆ– <strong>DNS è§£æ</strong>æ¥è¿›è¡Œäº’è”ã€‚</li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>Keepalived + HAProxy</strong> è¿›è¡Œé«˜å¯ç”¨æ€§è´Ÿè½½å‡è¡¡ï¼Œä»¥é˜²æ­¢æŸä¸ª etcd å®ä¾‹å´©æºƒæ—¶å½±å“é›†ç¾¤è¿æ¥ã€‚</li></ul></li></ul><hr><h3 id=2-etcd-å¤‡ä»½ä¸æ¢å¤><strong>(2) etcd å¤‡ä»½ä¸æ¢å¤</strong>
<a class=anchor href=#2-etcd-%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d>#</a></h3><ul><li><p><strong>å®šæœŸå¿«ç…§å¤‡ä»½</strong></p><ul><li><p>é€šè¿‡</p><pre tabindex=0><code>etcdctl snapshot save
</code></pre><p>å‘½ä»¤å®šæœŸå¤‡ä»½ etcd æ•°æ®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl snapshot save /backup/etcd-snapshot.db
</span></span></code></pre></div></li><li><p>å®šæœŸå°†å¿«ç…§æ–‡ä»¶å­˜å‚¨åˆ°è¿œç¨‹å­˜å‚¨ï¼ˆå¦‚ <strong>é˜¿é‡Œäº‘ OSSã€AWS S3ã€Ceph</strong>ï¼‰ã€‚</p></li></ul></li><li><p><strong>æ¢å¤ etcd é›†ç¾¤</strong></p><ul><li><p>å½“ etcd å‘ç”Ÿæ•°æ®æŸåæˆ–é›†ç¾¤å´©æºƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¿«ç…§æ¢å¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl snapshot restore /backup/etcd-snapshot.db
</span></span></code></pre></div></li><li><p>é‡æ–°é…ç½® <code>etcd</code>ï¼Œå¹¶å¯åŠ¨æ–°çš„ etcd å®ä¾‹åŠ å…¥é›†ç¾¤ã€‚</p></li></ul></li><li><p><strong>ç›‘æ§ etcd çŠ¶æ€</strong></p><ul><li><p>ä½¿ç”¨</p><pre tabindex=0><code>etcdctl endpoint status
</code></pre><p>æŸ¥çœ‹ etcd å¥åº·çŠ¶æ€ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl endpoint status --write-out<span style=color:#f92672>=</span>table
</span></span></code></pre></div></li><li><p>ç»“åˆ <strong>Prometheus + Grafana</strong> ç›‘æ§ etcd å…³é”®æŒ‡æ ‡ï¼Œå¦‚ <code>etcd_server_leader_changes_seen_total</code>ï¼ˆleader å˜æ›´é¢‘ç‡ï¼‰ã€<code>etcd_disk_wal_fsync_duration_seconds</code>ï¼ˆå†™å…¥å»¶è¿Ÿï¼‰ã€‚</p></li></ul></li></ul><hr><h3 id=3-etcd-è‡ªåŠ¨æ•…éšœè½¬ç§»><strong>(3) etcd è‡ªåŠ¨æ•…éšœè½¬ç§»</strong>
<a class=anchor href=#3-etcd-%e8%87%aa%e5%8a%a8%e6%95%85%e9%9a%9c%e8%bd%ac%e7%a7%bb>#</a></h3><ul><li>è‡ªåŠ¨é€‰ä¸»<ul><li>etcd ä½¿ç”¨ Raft åè®®è¿›è¡Œ leader é€‰ä¸¾ï¼Œ<strong>å½“ leader èŠ‚ç‚¹å´©æºƒåï¼Œå‰©ä½™ etcd æˆå‘˜ä¼šè‡ªåŠ¨é€‰ä¸¾æ–°çš„ leader</strong>ã€‚</li><li>å¦‚æœé›†ç¾¤ä¸­ etcd æˆå‘˜ä½äºåŠæ•°ï¼ˆ<code>N/2+1</code>ï¼‰ï¼Œåˆ™é›†ç¾¤è¿›å…¥ <strong>Read-Only</strong> æ¨¡å¼ï¼ŒAPI Server å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚</li><li>è§£å†³æ–¹æ¡ˆï¼š<ul><li>åŠæ—©å‘ç° etcd æ•…éšœï¼ŒåŠæ—¶æ‰©å®¹æ–°çš„ etcd æˆå‘˜ã€‚</li><li>é€šè¿‡ <code>etcdctl member list</code> ç›‘æ§ etcd æˆå‘˜çŠ¶æ€ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ‰‹åŠ¨é‡æ–°åŠ å…¥æ–°çš„ etcd èŠ‚ç‚¹ã€‚</li></ul></li></ul></li></ul><hr><h2 id=2-kubernetes-æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ><strong>2. Kubernetes æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ</strong>
<a class=anchor href=#2-kubernetes-%e6%8e%a7%e5%88%b6%e9%9d%a2%e7%bb%84%e4%bb%b6%e5%ae%b9%e7%81%be%e6%96%b9%e6%a1%88>#</a></h2><p>Kubernetes æ§åˆ¶é¢åŒ…æ‹¬ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p><ol><li><strong>kube-apiserver</strong>ï¼ˆAPI æœåŠ¡å™¨ï¼‰</li><li><strong>kube-scheduler</strong>ï¼ˆè°ƒåº¦å™¨ï¼‰</li><li><strong>kube-controller-manager</strong>ï¼ˆæ§åˆ¶å™¨ç®¡ç†å™¨ï¼‰</li><li><strong>kubelet</strong>ï¼ˆèŠ‚ç‚¹ç®¡ç†ï¼‰</li><li><strong>kube-proxy</strong>ï¼ˆç½‘ç»œä»£ç†ï¼‰</li><li><strong>etcd</strong>ï¼ˆæ•°æ®å­˜å‚¨ï¼Œå‰é¢å·²è¯¦ç»†è¯´æ˜ï¼‰</li></ol><hr><h3 id=1-é«˜å¯ç”¨æ¶æ„><strong>(1) é«˜å¯ç”¨æ¶æ„</strong>
<a class=anchor href=#1-%e9%ab%98%e5%8f%af%e7%94%a8%e6%9e%b6%e6%9e%84>#</a></h3><h4 id=å¤š-master-é«˜å¯ç”¨><strong>å¤š Master é«˜å¯ç”¨</strong>
<a class=anchor href=#%e5%a4%9a-master-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h4><ul><li><p>é‡‡ç”¨ <strong>å¤š Master</strong> æ¶æ„ï¼ˆè‡³å°‘ 3 ä¸ªï¼‰ï¼Œé¿å…å•ç‚¹æ•…éšœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>+----------------------+        +----------------------+
</span></span><span style=display:flex><span>|   Master-1 (Active)  |        |   Master-2 (Backup)  |
</span></span><span style=display:flex><span>|   kube-apiserver     |  &lt;---&gt; |   kube-apiserver     |
</span></span><span style=display:flex><span>|   kube-controller    |        |   kube-controller    |
</span></span><span style=display:flex><span>|   kube-scheduler     |        |   kube-scheduler     |
</span></span><span style=display:flex><span>+----------------------+        +----------------------+
</span></span><span style=display:flex><span>         |                                |
</span></span><span style=display:flex><span>         |                                |
</span></span><span style=display:flex><span>      +----------------------------------------+
</span></span><span style=display:flex><span>      |       HAProxy / Keepalived / VIP      |
</span></span><span style=display:flex><span>      +----------------------------------------+
</span></span><span style=display:flex><span>         |
</span></span><span style=display:flex><span>      +----------------+
</span></span><span style=display:flex><span>      |  Worker Nodes  |
</span></span><span style=display:flex><span>      +----------------+
</span></span></code></pre></div></li><li><p><strong>kube-apiserver</strong></p><ul><li>éƒ¨ç½²å¤šä¸ª <code>kube-apiserver</code> å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ <strong>è´Ÿè½½å‡è¡¡å™¨ï¼ˆHAProxyã€Nginxã€Keepalivedï¼‰</strong> è¿›è¡Œæµé‡åˆ†å‘ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li></ul></li><li><p><strong>kube-controller-manager å’Œ kube-scheduler</strong></p><ul><li>åªèƒ½è¿è¡Œåœ¨å•ä¸ª <code>leader</code> èŠ‚ç‚¹ä¸Šï¼ˆé‡‡ç”¨ <code>leader election</code> æœºåˆ¶ï¼‰ã€‚</li><li>å…¶ä»– master èŠ‚ç‚¹ä¼šç­‰å¾… leader å¤±æ•ˆåè‡ªåŠ¨æ¥ç®¡æ§åˆ¶æƒã€‚</li></ul></li><li><p><strong>è´Ÿè½½å‡è¡¡</strong></p><ul><li><p>Keepalived + HAProxy</p><p>ï¼š</p><ul><li>Keepalived æä¾› VIP åœ°å€ï¼Œå®ç°æ•…éšœæ—¶çš„ API Server åˆ‡æ¢ã€‚</li><li>HAProxy è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œåˆ†å‘ API è¯·æ±‚ã€‚</li></ul></li></ul></li></ul><hr><h3 id=2-ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤><strong>(2) ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤</strong>
<a class=anchor href=#2-%e7%9b%91%e6%8e%a7%e4%b8%8e%e8%87%aa%e5%8a%a8%e6%81%a2%e5%a4%8d>#</a></h3><ul><li><strong>Prometheus ç›‘æ§</strong><ul><li>ç›‘æ§ <code>kube-apiserver</code> å“åº”æ—¶é—´ã€<code>etcd</code> è¯»å†™å»¶è¿Ÿç­‰å…³é”®æŒ‡æ ‡ã€‚</li><li>å‘ç°å¼‚å¸¸æ—¶ï¼Œè§¦å‘è‡ªåŠ¨æ‰©å®¹æˆ–æ•…éšœè½¬ç§»ã€‚</li></ul></li><li><strong>è‡ªåŠ¨é‡å¯</strong><ul><li>ç»“åˆ <strong>systemd</strong> æˆ– <strong>Kubernetes è‡ªæ„ˆèƒ½åŠ›ï¼ˆlivenessProbe + readinessProbeï¼‰</strong>ï¼Œç¡®ä¿æ§åˆ¶é¢ç»„ä»¶å´©æºƒæ—¶è‡ªåŠ¨é‡å¯ã€‚</li></ul></li></ul><hr><h3 id=3-å¤‡ä»½ä¸æ¢å¤><strong>(3) å¤‡ä»½ä¸æ¢å¤</strong>
<a class=anchor href=#3-%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d>#</a></h3><ul><li><p><strong>API Server å¤‡ä»½</strong></p><ul><li><p>å¤‡ä»½</p><pre tabindex=0><code>kube-apiserver
</code></pre><p>é…ç½®æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp -r /etc/kubernetes /backup/kubernetes
</span></span></code></pre></div></li><li><p>å¤‡ä»½</p><pre tabindex=0><code>kubeconfig
</code></pre><p>æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp ~/.kube/config /backup/kube-config
</span></span></code></pre></div></li></ul></li><li><p><strong>æ¢å¤ API Server</strong></p><ul><li><p>å¦‚æœ</p><pre tabindex=0><code>kube-apiserver
</code></pre><p>å´©æºƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart kube-apiserver
</span></span></code></pre></div></li><li><p>å¦‚æœ API Server æ•…éšœï¼Œå¯ä»¥åˆ‡æ¢è‡³å¤‡ç”¨ master èŠ‚ç‚¹ã€‚</p></li></ul></li></ul><hr><h2 id=3-æ•…éšœæ¢å¤ç­–ç•¥><strong>3. æ•…éšœæ¢å¤ç­–ç•¥</strong>
<a class=anchor href=#3-%e6%95%85%e9%9a%9c%e6%81%a2%e5%a4%8d%e7%ad%96%e7%95%a5>#</a></h2><table><thead><tr><th>ç»„ä»¶</th><th>å¯èƒ½çš„æ•…éšœ</th><th>å®¹ç¾æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>etcd</td><td>å•èŠ‚ç‚¹æ•…éšœ</td><td>Raft è‡ªåŠ¨é€‰ä¸¾æ–° leader</td></tr><tr><td>etcd</td><td>å¤šèŠ‚ç‚¹æ•…éšœ</td><td>é€šè¿‡å¿«ç…§æ¢å¤æ•°æ®</td></tr><tr><td>kube-apiserver</td><td>API æ— æ³•è®¿é—®</td><td>è´Ÿè½½å‡è¡¡ + å¤‡ç”¨ master åˆ‡æ¢</td></tr><tr><td>kube-controller-manager</td><td>leader æ•…éšœ</td><td>å…¶ä»– master è‡ªåŠ¨æ¥ç®¡</td></tr><tr><td>kube-scheduler</td><td>leader æ•…éšœ</td><td>å…¶ä»– master è‡ªåŠ¨é€‰ä¸¾æ–° leader</td></tr></tbody></table><hr><h2 id=4-ç»“è®º><strong>4. ç»“è®º</strong>
<a class=anchor href=#4-%e7%bb%93%e8%ae%ba>#</a></h2><ul><li><strong>etcd é«˜å¯ç”¨</strong>ï¼šè‡³å°‘ 3 ä¸ªèŠ‚ç‚¹ï¼Œè·¨ AZ éƒ¨ç½²ï¼Œå®šæœŸå¤‡ä»½ï¼Œè‡ªåŠ¨ leader é€‰ä¸¾ã€‚</li><li><strong>æ§åˆ¶é¢é«˜å¯ç”¨</strong>ï¼šå¤š Master éƒ¨ç½²ï¼ŒKeepalived/HAProxy è´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨é€‰ä¸»ã€‚</li><li><strong>ç›‘æ§ä¸å‘Šè­¦</strong>ï¼šPrometheus ç›‘æ§ï¼Œå‘ç°å¼‚å¸¸æ—¶è‡ªåŠ¨æ‰©å®¹æˆ–åˆ‡æ¢ã€‚</li><li><strong>å¤‡ä»½ä¸æ¢å¤</strong>ï¼šå®šæœŸå¤‡ä»½ etcd æ•°æ®å’Œæ§åˆ¶é¢é…ç½®ï¼Œå¿«é€Ÿæ¢å¤æœåŠ¡ã€‚</li></ul><p>è¿™å¥—æ–¹æ¡ˆå¯ä»¥ä¿è¯ Kubernetes åœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ï¼Œæå‡é›†ç¾¤çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p><h1 id=æ¼”ç»ƒæ€ä¹ˆè®¾è®¡æ¼”ç»ƒåœºæ™¯è¦†ç›–æ ¸å¿ƒé£é™©å’Œæ¨åŠ¨æ”¹è¿›çš„æªæ–½>æ¼”ç»ƒï¼Œæ€ä¹ˆè®¾è®¡æ¼”ç»ƒåœºæ™¯ï¼Œè¦†ç›–æ ¸å¿ƒé£é™©å’Œæ¨åŠ¨æ”¹è¿›çš„æªæ–½ï¼Ÿ
<a class=anchor href=#%e6%bc%94%e7%bb%83%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e6%bc%94%e7%bb%83%e5%9c%ba%e6%99%af%e8%a6%86%e7%9b%96%e6%a0%b8%e5%bf%83%e9%a3%8e%e9%99%a9%e5%92%8c%e6%8e%a8%e5%8a%a8%e6%94%b9%e8%bf%9b%e7%9a%84%e6%8e%aa%e6%96%bd>#</a></h1><h2 id=kubernetes-å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡><strong>Kubernetes å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡</strong>
<a class=anchor href=#kubernetes-%e5%ae%b9%e7%81%be%e6%bc%94%e7%bb%83%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1>#</a></h2><p>å®¹ç¾æ¼”ç»ƒçš„ç›®çš„æ˜¯<strong>éªŒè¯ Kubernetes é›†ç¾¤åœ¨å…³é”®ç»„ä»¶æ•…éšœã€èŠ‚ç‚¹ä¸¢å¤±ã€ç½‘ç»œå¼‚å¸¸ç­‰æƒ…å†µä¸‹çš„æ¢å¤èƒ½åŠ›</strong>ï¼Œå¹¶æ‰¾åˆ°æ”¹è¿›ç‚¹ï¼Œæå‡ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚
å®¹ç¾æ¼”ç»ƒéœ€è¦†ç›– <strong>etcdã€æ§åˆ¶é¢ã€è®¡ç®—èŠ‚ç‚¹ã€å­˜å‚¨ã€ç½‘ç»œç­‰æ ¸å¿ƒç»„ä»¶</strong>ï¼Œå¹¶æ¨æ¼”å„ç§å¯èƒ½çš„æ•…éšœåœºæ™¯ã€‚</p><hr><h1 id=1-æ¼”ç»ƒç›®æ ‡><strong>1. æ¼”ç»ƒç›®æ ‡</strong>
<a class=anchor href=#1-%e6%bc%94%e7%bb%83%e7%9b%ae%e6%a0%87>#</a></h1><p>âœ… éªŒè¯ Kubernetes <strong>é«˜å¯ç”¨æ¶æ„</strong>æ˜¯å¦å¯é 
âœ… å‘ç°å¯èƒ½çš„<strong>å•ç‚¹æ•…éšœï¼ˆSPOFï¼‰</strong>
âœ… ç¡®ä¿ <strong>etcd å¤‡ä»½ä¸æ¢å¤æœºåˆ¶</strong>æœ‰æ•ˆ
âœ… æµ‹è¯• <strong>è´Ÿè½½å‡è¡¡ä¸æ•…éšœè½¬ç§»èƒ½åŠ›</strong>
âœ… æå‡åº”æ€¥å“åº”æ•ˆç‡ï¼Œä¼˜åŒ–å‘Šè­¦ã€æ—¥å¿—ã€ç›‘æ§æœºåˆ¶</p><hr><h1 id=2-æ¼”ç»ƒæ ¸å¿ƒåœºæ™¯><strong>2. æ¼”ç»ƒæ ¸å¿ƒåœºæ™¯</strong>
<a class=anchor href=#2-%e6%bc%94%e7%bb%83%e6%a0%b8%e5%bf%83%e5%9c%ba%e6%99%af>#</a></h1><p>å®¹ç¾æ¼”ç»ƒåˆ†ä¸º <strong>æ ¸å¿ƒç»„ä»¶æ•…éšœ</strong>ã€<strong>ç½‘ç»œå¼‚å¸¸</strong>ã€<strong>å­˜å‚¨æ•…éšœ</strong>ã€<strong>é«˜å¹¶å‘å‹åŠ›æµ‹è¯•</strong>ç­‰ã€‚</p><h2 id=-åœºæ™¯-1etcd-æ•…éšœ><strong>ğŸŸ¢ åœºæ™¯ 1ï¼šetcd æ•…éšœ</strong>
<a class=anchor href=#-%e5%9c%ba%e6%99%af-1etcd-%e6%95%85%e9%9a%9c>#</a></h2><p>ğŸ¯ <strong>ç›®æ ‡</strong>ï¼šç¡®ä¿ etcd å´©æºƒå Kubernetes ä»èƒ½æ­£å¸¸è¿ä½œï¼Œå¹¶éªŒè¯ etcd å¿«ç…§æ¢å¤æœºåˆ¶ã€‚</p><p>ğŸ”¹ <strong>æ¼”ç»ƒæ­¥éª¤</strong>ï¼š</p><ol><li><p>åˆ é™¤ etcd Leader èŠ‚ç‚¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop etcd
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ <code>etcdctl endpoint status</code>ï¼Œç¡®è®¤æ–° Leader é€‰ä¸¾æƒ…å†µã€‚</p></li><li><p>æ¨¡æ‹Ÿå¤šèŠ‚ç‚¹ etcd æ•…éšœ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop etcd
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ Kubernetes API æ˜¯å¦å¯ç”¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div></li><li><p>æ¢å¤ etcd</p><ul><li><p>è‹¥å•èŠ‚ç‚¹æ•…éšœï¼Œç­‰å¾… etcd è‡ªåŠ¨é€‰ä¸»ã€‚</p></li><li><p>è‹¥é›†ç¾¤å´©æºƒï¼Œä½¿ç”¨ etcd å¤‡ä»½æ¢å¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl snapshot restore /backup/etcd-snapshot.db
</span></span></code></pre></div></li></ul></li></ol><p>ğŸ›  <strong>æ”¹è¿›æªæ–½</strong>ï¼š</p><ul><li>ç¡®ä¿ <strong>etcd å¤‡ä»½ç­–ç•¥æœ‰æ•ˆ</strong>ï¼ˆå®šæœŸå¿«ç…§ + è¿œç¨‹å­˜å‚¨ï¼‰ã€‚</li><li>ç›‘æ§ <code>etcd_server_leader_changes_seen_total</code> é¢‘ç‡ï¼Œæå‰å‘ç°å¼‚å¸¸ã€‚</li></ul><hr><h2 id=-åœºæ™¯-2master-èŠ‚ç‚¹æ•…éšœ><strong>ğŸŸ¡ åœºæ™¯ 2ï¼šMaster èŠ‚ç‚¹æ•…éšœ</strong>
<a class=anchor href=#-%e5%9c%ba%e6%99%af-2master-%e8%8a%82%e7%82%b9%e6%95%85%e9%9a%9c>#</a></h2><p>ğŸ¯ <strong>ç›®æ ‡</strong>ï¼šç¡®ä¿ Kubernetes <strong>æ§åˆ¶é¢</strong>å…·å¤‡é«˜å¯ç”¨æ€§ï¼ŒéªŒè¯ <strong>API Server æ•…éšœè½¬ç§»èƒ½åŠ›</strong>ã€‚</p><p>ğŸ”¹ <strong>æ¼”ç»ƒæ­¥éª¤</strong>ï¼š</p><ol><li><p>å…³é—­ä¸» Master èŠ‚ç‚¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop kube-apiserver
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ <code>kubectl get nodes</code> å’Œ <code>kubectl get pods -n kube-system</code>ï¼Œç¡®è®¤å…¶ä»– Master æ˜¯å¦æ¥ç®¡æµé‡ã€‚</p></li><li><p>æ¨¡æ‹Ÿæ‰€æœ‰ Master èŠ‚ç‚¹å®•æœº</p><ul><li><p>å…³é—­æ‰€æœ‰ API Server è¿›ç¨‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop kube-apiserver kube-controller-manager kube-scheduler
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ <strong>é›†ç¾¤çŠ¶æ€ã€è´Ÿè½½å‡è¡¡</strong>ï¼ŒéªŒè¯ Keepalived æ˜¯å¦åˆ‡æ¢ VIPã€‚</p></li><li><p>é‡æ–°å¯åŠ¨ Masterï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl start kube-apiserver kube-controller-manager kube-scheduler
</span></span></code></pre></div></li></ul></li><li><p>ç¡®è®¤æ§åˆ¶é¢æ˜¯å¦æ¢å¤ã€‚</p></li></ol><p>ğŸ›  <strong>æ”¹è¿›æªæ–½</strong>ï¼š</p><ul><li>ç¡®ä¿ <strong>HAProxy / Keepalived VIP</strong> å¯ç”¨ï¼Œè‡ªåŠ¨åˆ‡æ¢ã€‚</li><li>ç›‘æ§ <strong>API Server å“åº”æ—¶é—´</strong>ï¼Œé˜²æ­¢è¶…æ—¶å¯¼è‡´ä¸šåŠ¡å¼‚å¸¸ã€‚</li></ul><hr><h2 id=-åœºæ™¯-3node-è®¡ç®—èŠ‚ç‚¹æ•…éšœ><strong>ğŸ”´ åœºæ™¯ 3ï¼šNode è®¡ç®—èŠ‚ç‚¹æ•…éšœ</strong>
<a class=anchor href=#-%e5%9c%ba%e6%99%af-3node-%e8%ae%a1%e7%ae%97%e8%8a%82%e7%82%b9%e6%95%85%e9%9a%9c>#</a></h2><p>ğŸ¯ <strong>ç›®æ ‡</strong>ï¼šéªŒè¯ <strong>Pod è¿ç§»èƒ½åŠ›</strong>ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¼šå›  Worker èŠ‚ç‚¹æ•…éšœè€Œä¸­æ–­ã€‚</p><p>ğŸ”¹ <strong>æ¼”ç»ƒæ­¥éª¤</strong>ï¼š</p><ol><li><p>é€‰å–ä¸€ä¸ª Nodeï¼Œ</p><p>é©±é€è¯¥èŠ‚ç‚¹æ‰€æœ‰ Pod</p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl drain &lt;node-name&gt; --ignore-daemonsets --delete-local-data
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ Pod è¿ç§»</p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -o wide
</span></span></code></pre></div></li><li><p>å½»åº•ä¸‹çº¿è¯¥èŠ‚ç‚¹</p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete node &lt;node-name&gt;
</span></span></code></pre></div></li><li><p>é‡æ–°åŠ å…¥è¯¥èŠ‚ç‚¹</p><p>ï¼š</p><ul><li><p>é‡æ–°å®‰è£… kubeletï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm reset <span style=color:#f92672>&amp;&amp;</span> kubeadm join ...
</span></span></code></pre></div></li><li><p>ç¡®è®¤èŠ‚ç‚¹æ¢å¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div></li></ul></li></ol><p>ğŸ›  <strong>æ”¹è¿›æªæ–½</strong>ï¼š</p><ul><li>ä¸šåŠ¡åº”ç”¨åº”é…ç½® <strong>Pod åäº²å’Œæ€§ã€HPAï¼ˆè‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰</strong>ï¼Œé˜²æ­¢èŠ‚ç‚¹æ•…éšœæ—¶ä¸šåŠ¡ä¸å¯ç”¨ã€‚</li><li>ç›‘æ§ <code>kubelet</code> çŠ¶æ€ï¼Œç¡®ä¿èŠ‚ç‚¹æ•…éšœèƒ½<strong>è‡ªåŠ¨è§¦å‘å‘Šè­¦</strong>ã€‚</li></ul><hr><h2 id=-åœºæ™¯-4ingressservice-è´Ÿè½½å‡è¡¡å¼‚å¸¸><strong>ğŸŸ  åœºæ™¯ 4ï¼šIngress/Service è´Ÿè½½å‡è¡¡å¼‚å¸¸</strong>
<a class=anchor href=#-%e5%9c%ba%e6%99%af-4ingressservice-%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e5%bc%82%e5%b8%b8>#</a></h2><p>ğŸ¯ <strong>ç›®æ ‡</strong>ï¼šæ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡å¼‚å¸¸ï¼ŒéªŒè¯æµé‡åˆ‡æ¢æ˜¯å¦æ­£å¸¸ã€‚</p><p>ğŸ”¹ <strong>æ¼”ç»ƒæ­¥éª¤</strong>ï¼š</p><ol><li><p>å…³é—­ Ingress Controller</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod -n ingress-nginx --all
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿå¤–éƒ¨è¯·æ±‚æ˜¯å¦å—å½±å“ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://&lt;ingress-url&gt;
</span></span></code></pre></div></li><li><p>åˆ é™¤ Service è´Ÿè½½å‡è¡¡å™¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete service my-lb-service
</span></span></code></pre></div></li><li><p>ç¡®è®¤ Service æ˜¯å¦é‡æ–°åˆ›å»ºï¼Œå¹¶ç»‘å®šæ–°çš„ IPã€‚</p></li></ol><p>ğŸ›  <strong>æ”¹è¿›æªæ–½</strong>ï¼š</p><ul><li>å¢åŠ  <strong>å¤šå‰¯æœ¬ Ingress Controller</strong>ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li><li>ä½¿ç”¨ <strong>MetalLB / Keepalived</strong> ä¿éšœ Service é«˜å¯ç”¨ã€‚</li></ul><hr><h2 id=-åœºæ™¯-5å­˜å‚¨æ•…éšœ><strong>ğŸ”µ åœºæ™¯ 5ï¼šå­˜å‚¨æ•…éšœ</strong>
<a class=anchor href=#-%e5%9c%ba%e6%99%af-5%e5%ad%98%e5%82%a8%e6%95%85%e9%9a%9c>#</a></h2><p>ğŸ¯ <strong>ç›®æ ‡</strong>ï¼šç¡®ä¿ PVC æŒ‚è½½å¤±è´¥æ—¶ï¼Œåº”ç”¨èƒ½æ­£ç¡®æ¢å¤ã€‚</p><p>ğŸ”¹ <strong>æ¼”ç»ƒæ­¥éª¤</strong>ï¼š</p><ol><li><p>åˆ é™¤å­˜å‚¨èŠ‚ç‚¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete node storage-node-1
</span></span></code></pre></div></li><li><p>è§‚å¯Ÿ PVC çŠ¶æ€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pvc -A
</span></span></code></pre></div></li><li><p>é‡æ–°åˆ›å»ºå­˜å‚¨èŠ‚ç‚¹</p><p>ï¼š</p><ul><li>ç¡®ä¿æ–°çš„å­˜å‚¨èŠ‚ç‚¹èƒ½æ­£ç¡®ç»‘å®š PVCã€‚</li><li>ç¡®è®¤ Pod èƒ½æ­£ç¡®è®¿é—®æ•°æ®ã€‚</li></ul></li></ol><p>ğŸ›  <strong>æ”¹è¿›æªæ–½</strong>ï¼š</p><ul><li>é‡‡ç”¨ <strong>Cephã€NFSã€GlusterFS</strong> ç­‰åˆ†å¸ƒå¼å­˜å‚¨ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li><li>å¢åŠ  <strong>PVC ç»‘å®šç­–ç•¥</strong>ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li></ul><hr><h1 id=3-ä¿éšœæªæ–½><strong>3. ä¿éšœæªæ–½</strong>
<a class=anchor href=#3-%e4%bf%9d%e9%9a%9c%e6%8e%aa%e6%96%bd>#</a></h1><p>âœ… <strong>æå‰é€šçŸ¥</strong>ï¼šåˆ¶å®šæ¼”ç»ƒæ—¶é—´ï¼Œé€šçŸ¥ç›¸å…³å›¢é˜Ÿ
âœ… <strong>é¢„æ¡ˆå‡†å¤‡</strong>ï¼šæå‰é…ç½®æ¢å¤æ–¹æ¡ˆï¼Œç¡®ä¿å¿«é€Ÿå›æ»š
âœ… <strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç»“åˆ Prometheus + Grafana ç›‘æ§å…³é”®æŒ‡æ ‡
âœ… <strong>æ—¥å¿—åˆ†æ</strong>ï¼šç»“åˆ ELK / Loki è¿›è¡Œæ•…éšœåˆ†æ
âœ… <strong>æ¼”ç»ƒæ€»ç»“</strong>ï¼šè®°å½•æ¼”ç»ƒè¿‡ç¨‹ï¼ŒæŒç»­æ”¹è¿›</p><hr><h1 id=4-ç»“è®º-1><strong>4. ç»“è®º</strong>
<a class=anchor href=#4-%e7%bb%93%e8%ae%ba-1>#</a></h1><ul><li>é€šè¿‡<strong>æ•…éšœæ³¨å…¥</strong>ï¼ˆå¦‚ <code>etcdctl snapshot restore</code>ã€<code>kubectl drain</code>ï¼‰ï¼Œæ¨¡æ‹Ÿæ ¸å¿ƒç»„ä»¶æ•…éšœï¼ŒéªŒè¯é›†ç¾¤çš„æ¢å¤èƒ½åŠ›ã€‚</li><li>ç›‘æ§ <strong>etcd leader é€‰ä¸¾ã€API Server å“åº”ã€Pod è¿ç§»ã€è´Ÿè½½å‡è¡¡</strong> ç­‰å…³é”®è·¯å¾„ï¼Œæ‰¾å‡ºæ½œåœ¨é£é™©ç‚¹ã€‚</li><li>ç»“åˆ Prometheus + ELK ç›‘æ§æ•…éšœï¼Œæå‡å‘Šè­¦å’Œè‡ªåŠ¨æ¢å¤èƒ½åŠ›ã€‚</li></ul><p>è¿™å¥—æ–¹æ¡ˆå¯ä»¥å¸®åŠ© Kubernetes é›†ç¾¤åœ¨æç«¯æƒ…å†µä¸‹<strong>ç¨³å®šè¿è¡Œã€å¿«é€Ÿæ¢å¤ã€é™ä½ä¸šåŠ¡å½±å“</strong>ã€‚ ğŸš€</p><h1 id=æ¼”ç»ƒå‘ç°çš„é—®é¢˜å’Œæ”¹è¿›çš„åœ°æ–¹>æ¼”ç»ƒå‘ç°çš„é—®é¢˜å’Œæ”¹è¿›çš„åœ°æ–¹ï¼Ÿ
<a class=anchor href=#%e6%bc%94%e7%bb%83%e5%8f%91%e7%8e%b0%e7%9a%84%e9%97%ae%e9%a2%98%e5%92%8c%e6%94%b9%e8%bf%9b%e7%9a%84%e5%9c%b0%e6%96%b9>#</a></h1><h2 id=æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ><strong>æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ</strong>
<a class=anchor href=#%e6%bc%94%e7%bb%83%e5%8f%91%e7%8e%b0%e7%9a%84%e9%97%ae%e9%a2%98%e4%b8%8e%e6%94%b9%e8%bf%9b%e6%96%b9%e6%a1%88>#</a></h2><p>åœ¨ Kubernetes å®¹ç¾æ¼”ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç°ä¸€äº›ç³»ç»Ÿè®¾è®¡ã€è¿ç»´ç®¡ç†ã€ç»„ä»¶å¯é æ€§æ–¹é¢çš„<strong>æ½œåœ¨é£é™©</strong>ã€‚ä¸‹é¢æ€»ç»“äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶æä¾›å¯¹åº”çš„æ”¹è¿›æ–¹æ¡ˆã€‚</p><hr><h1 id=1-etcd-ç›¸å…³é—®é¢˜><strong>1. etcd ç›¸å…³é—®é¢˜</strong>
<a class=anchor href=#1-etcd-%e7%9b%b8%e5%85%b3%e9%97%ae%e9%a2%98>#</a></h1><h3 id=-é—®é¢˜-1etcd-é€‰ä¸»æ—¶é—´è¿‡é•¿å½±å“-api-server-å“åº”><strong>ğŸ›‘ é—®é¢˜ 1ï¼šetcd é€‰ä¸»æ—¶é—´è¿‡é•¿ï¼Œå½±å“ API Server å“åº”</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-1etcd-%e9%80%89%e4%b8%bb%e6%97%b6%e9%97%b4%e8%bf%87%e9%95%bf%e5%bd%b1%e5%93%8d-api-server-%e5%93%8d%e5%ba%94>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li><code>kubectl get nodes</code> ç­‰å‘½ä»¤è¶…æ—¶</li><li><code>etcdctl endpoint status</code> æ˜¾ç¤º <code>leader</code> å˜åŒ–</li><li><code>kube-apiserver</code> æ— æ³•æ­£å¸¸è®¿é—® etcd</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li>etcd é€‰ä¸¾æ—¶é—´è¿‡é•¿</li><li>ç½‘ç»œæŠ–åŠ¨å¯¼è‡´ etcd è¿æ¥æ–­å¼€</li><li>etcd è´Ÿè½½é«˜ï¼Œå†™å…¥æ…¢ï¼Œå½±å“ leader é€‰ä¸¾</li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>è°ƒæ•´ etcd é€‰ä¸¾è¶…æ—¶æ—¶é—´</p><p>ï¼ˆé»˜è®¤ 1000msï¼Œå»ºè®® 200ms~500msï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>election-timeout</span>: <span style=color:#ae81ff>250ms</span>
</span></span></code></pre></div></li><li><p>ä¼˜åŒ– etcd æ€§èƒ½ï¼š</p><ul><li>ä½¿ç”¨ SSD ä½œä¸ºå­˜å‚¨ç›˜ï¼Œé¿å…ç£ç›˜ IO ç“¶é¢ˆ</li><li><code>etcdctl defrag</code> é‡Šæ”¾ç¢ç‰‡åŒ–ç©ºé—´</li><li>é™åˆ¶ <code>kube-apiserver</code> è®¿é—® etcd é¢‘ç‡ï¼ˆå‡å°‘é«˜å¹¶å‘è¯·æ±‚ï¼‰</li></ul></li><li><p>å¢åŠ  etcd ç›‘æ§ï¼š</p><ul><li><code>etcd_server_leader_changes_seen_total</code> é¢‘ç¹å˜åŒ– â†’ å¯èƒ½æœ‰ç½‘ç»œé—®é¢˜</li><li><code>etcd_disk_wal_fsync_duration_seconds_bucket</code> é«˜ â†’ è¯´æ˜ç£ç›˜ IO å­˜åœ¨ç“¶é¢ˆ</li></ul></li></ul><hr><h3 id=-é—®é¢˜-2etcd-å¤‡ä»½æœªç”Ÿæ•ˆæ¢å¤å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 2ï¼šetcd å¤‡ä»½æœªç”Ÿæ•ˆï¼Œæ¢å¤å¤±è´¥</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-2etcd-%e5%a4%87%e4%bb%bd%e6%9c%aa%e7%94%9f%e6%95%88%e6%81%a2%e5%a4%8d%e5%a4%b1%e8%b4%a5>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li>ä½¿ç”¨ <code>etcdctl snapshot restore</code> æ¢å¤æ—¶ï¼Œå‘ç° <code>data-dir</code> è·¯å¾„å†²çª</li><li><code>etcdctl member list</code> æ˜¾ç¤ºæ•°æ®ä¸å®Œæ•´</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li>etcd å¤‡ä»½ä¸å®Œæ•´ï¼Œæ¢å¤æ—¶æŠ¥é”™</li><li>å¤‡ä»½æœªåŒ…å« <code>member</code> ç›®å½•ï¼Œå¯¼è‡´ <code>etcd</code> æ— æ³•æ­£ç¡®åŠ è½½å¿«ç…§</li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>ä½¿ç”¨æ­£ç¡®æ–¹å¼å¤‡ä»½ etcdï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl snapshot save /backup/etcd-snapshot.db
</span></span></code></pre></div></li><li><p>æ¢å¤æ—¶æŒ‡å®šæ–°çš„ <code>data-dir</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETCDCTL_API<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> etcdctl snapshot restore /backup/etcd-snapshot.db --data-dir<span style=color:#f92672>=</span>/var/lib/etcd-new
</span></span></code></pre></div></li><li><p>å®šæœŸæ£€æŸ¥ etcd å¤‡ä»½å®Œæ•´æ€§ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>etcdctl snapshot status /backup/etcd-snapshot.db
</span></span></code></pre></div></li></ul><hr><h1 id=2-master-ç»„ä»¶é—®é¢˜><strong>2. Master ç»„ä»¶é—®é¢˜</strong>
<a class=anchor href=#2-master-%e7%bb%84%e4%bb%b6%e9%97%ae%e9%a2%98>#</a></h1><h3 id=-é—®é¢˜-3kube-apiserver-å®•æœºè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ><strong>ğŸ›‘ é—®é¢˜ 3ï¼škube-apiserver å®•æœºï¼Œè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-3kube-apiserver-%e5%ae%95%e6%9c%ba%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e6%9c%aa%e7%94%9f%e6%95%88>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li><code>kubectl</code> å‘½ä»¤å¡ä½ï¼ŒAPI æ— æ³•è®¿é—®</li><li><code>haproxy</code> ä»ç„¶è½¬å‘æµé‡åˆ°æ•…éšœ Master</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li><strong>è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥å¤±æ•ˆ</strong>ï¼Œå¯¼è‡´æµé‡ä»ç„¶è½¬å‘åˆ°å®•æœº Master</li><li><code>kube-apiserver</code> <strong>æœªé…ç½®å¤šä¸ª <code>--etcd-servers</code></strong></li><li><strong>VIP åˆ‡æ¢å¤±è´¥</strong>ï¼ˆKeepalived æœªæ­£å¸¸è§¦å‘ï¼‰</li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>ä¼˜åŒ–è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥ï¼š</p><pre tabindex=0><code class=language-haproxy data-lang=haproxy>backend kube-apiservers
  option httpchk GET /livez
  default-server check fall 3 rise 2
</code></pre></li><li><p>é…ç½® API Server è¿æ¥å¤šä¸ª etcd èŠ‚ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>--<span style=color:#ae81ff>etcd-servers=https://etcd-1:2379,https://etcd-2:2379,https://etcd-3:2379</span>
</span></span></code></pre></div></li><li><p>ä¼˜åŒ– Keepalived VIP åˆ‡æ¢ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vrrp_script chk_apiserver <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  script <span style=color:#e6db74>&#34;curl -s http://127.0.0.1:6443/livez || exit 1&#34;</span>
</span></span><span style=display:flex><span>  interval <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  weight -2
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></li></ul><hr><h1 id=3-node-è®¡ç®—èŠ‚ç‚¹é—®é¢˜><strong>3. Node è®¡ç®—èŠ‚ç‚¹é—®é¢˜</strong>
<a class=anchor href=#3-node-%e8%ae%a1%e7%ae%97%e8%8a%82%e7%82%b9%e9%97%ae%e9%a2%98>#</a></h1><h3 id=-é—®é¢˜-4èŠ‚ç‚¹é©±é€å-pod-è¿ç§»å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šèŠ‚ç‚¹é©±é€å Pod è¿ç§»å¤±è´¥</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-4%e8%8a%82%e7%82%b9%e9%a9%b1%e9%80%90%e5%90%8e-pod-%e8%bf%81%e7%a7%bb%e5%a4%b1%e8%b4%a5>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li><code>kubectl drain</code> åï¼ŒPod æ²¡æœ‰è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹</li><li><code>kubectl get pods -o wide</code> å‘ç° Pod å¡åœ¨ <code>Terminating</code> çŠ¶æ€</li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li><strong>Pod æ²¡æœ‰å®šä¹‰èµ„æºé™åˆ¶</strong>ï¼Œå¯¼è‡´æ–°èŠ‚ç‚¹èµ„æºä¸è¶³</li><li><strong>Pod ç»‘å®šåˆ°æŒ‡å®š Node</strong>ï¼ˆ<code>nodeSelector</code>ã€<code>affinity</code> é™åˆ¶ï¼‰</li><li><strong>DaemonSet ä¸èƒ½è‡ªåŠ¨è¿ç§»</strong>ï¼Œå½±å“ Node çº§ç»„ä»¶ï¼ˆå¦‚ <code>fluentd</code>ï¼‰</li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>ç»™ Pod è®¾å®š <code>requests</code> å’Œ <code>limits</code>ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿèµ„æºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;200Mi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span></code></pre></div></li><li><p>æ£€æŸ¥ <code>nodeSelector</code> / <code>affinity</code> è§„åˆ™ï¼Œé¿å…è¿‡äºä¸¥æ ¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>kubernetes.io/hostname</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>NotIn</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>failed-node</span>
</span></span></code></pre></div></li><li><p><strong>ä½¿ç”¨ <code>kubectl delete pod --force</code> é‡Šæ”¾å¡ä½çš„ Pod</strong>ã€‚</p></li></ul><hr><h1 id=4-ingress--service-é—®é¢˜><strong>4. Ingress / Service é—®é¢˜</strong>
<a class=anchor href=#4-ingress--service-%e9%97%ae%e9%a2%98>#</a></h1><h3 id=-é—®é¢˜-5ingress-nginx-å®•æœºåä¸šåŠ¡ä¸å¯è®¿é—®><strong>ğŸ›‘ é—®é¢˜ 5ï¼šIngress Nginx å®•æœºåï¼Œä¸šåŠ¡ä¸å¯è®¿é—®</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-5ingress-nginx-%e5%ae%95%e6%9c%ba%e5%90%8e%e4%b8%9a%e5%8a%a1%e4%b8%8d%e5%8f%af%e8%ae%bf%e9%97%ae>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li>ä¸šåŠ¡è®¿é—® <code>502 Bad Gateway</code></li><li><code>kubectl get pods -n ingress-nginx</code> å‘ç° Pod å¤„äº <code>CrashLoopBackOff</code></li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li><strong>Ingress Controller åªæœ‰ 1 ä¸ªå‰¯æœ¬</strong>ï¼Œæ²¡æœ‰é«˜å¯ç”¨</li><li><strong>Pod ç»‘å®šäº†æŒ‡å®š Node</strong>ï¼Œå¯¼è‡´è¯¥ Node æ•…éšœæ—¶å½±å“æ‰€æœ‰æµé‡</li><li><strong>Backend Service æ— å¯ç”¨ Pod</strong></li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>å¢åŠ  Ingress å‰¯æœ¬æ•°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span></code></pre></div></li><li><p>ç§»é™¤å›ºå®šèŠ‚ç‚¹ç»‘å®šï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nodeSelector</span>: {}
</span></span></code></pre></div></li><li><p>åœ¨ Prometheus ç›‘æ§ Ingress ç»„ä»¶çŠ¶æ€ï¼Œæå‰å‘Šè­¦ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>rate(nginx_ingress_controller_requests[5m])</span>
</span></span></code></pre></div></li></ul><hr><h1 id=5-å­˜å‚¨é—®é¢˜><strong>5. å­˜å‚¨é—®é¢˜</strong>
<a class=anchor href=#5-%e5%ad%98%e5%82%a8%e9%97%ae%e9%a2%98>#</a></h1><h3 id=-é—®é¢˜-6pvc-ç»‘å®šå¤±è´¥pod-è¿›å…¥><strong>ğŸ›‘ é—®é¢˜ 6ï¼šPVC ç»‘å®šå¤±è´¥ï¼ŒPod è¿›å…¥ <code>Pending</code> çŠ¶æ€</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-6pvc-%e7%bb%91%e5%ae%9a%e5%a4%b1%e8%b4%a5pod-%e8%bf%9b%e5%85%a5>#</a></h3><ul><li><strong>ç°è±¡</strong>ï¼š<ul><li><code>kubectl describe pvc</code> æ˜¾ç¤º <code>Waiting for first consumer</code></li><li><code>kubectl get pods</code> å‘ç° <code>MountVolume.SetUp failed</code></li></ul></li><li><strong>åŸå› </strong>ï¼š<ul><li><strong>Pod æ²¡æœ‰è°ƒåº¦åˆ°å­˜å‚¨æ”¯æŒçš„èŠ‚ç‚¹</strong></li><li><strong>å­˜å‚¨ç±» <code>StorageClass</code> æ²¡æœ‰æ­£ç¡®ç»‘å®š PVC</strong></li><li><strong>åº•å±‚ NFS / Ceph æ•…éšœï¼Œå¯¼è‡´å­˜å‚¨ä¸å¯ç”¨</strong></li></ul></li></ul><p>âœ… <strong>æ”¹è¿›æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>å¼ºåˆ¶ Pod ç»‘å®šæ”¯æŒå­˜å‚¨çš„èŠ‚ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>storage-node</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div></li><li><p>æå‰ Provision é¢„åˆ†é… PVCï¼Œé¿å…åŠ¨æ€ç»‘å®šå¤±è´¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create pvc --storage-class<span style=color:#f92672>=</span>fast-storage
</span></span></code></pre></div></li><li><p>ç›‘æ§å­˜å‚¨åç«¯å¥åº·çŠ¶æ€ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ceph -s
</span></span></code></pre></div></li></ul><hr><h2 id=æ€»ç»“-1><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-1>#</a></h2><p>âœ… <strong>etcd é€‰ä¸»ä¼˜åŒ–</strong>ï¼Œå‡å°‘ API Server æ— å“åº”æ—¶é—´
âœ… <strong>è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥</strong>ï¼Œé¿å… Master å®•æœºå½±å“é›†ç¾¤
âœ… <strong>Pod èµ„æºä¼˜åŒ–</strong>ï¼Œç¡®ä¿èŠ‚ç‚¹æ•…éšœæ—¶ Pod è¿ç§»é¡ºç•…
âœ… <strong>Ingress é«˜å¯ç”¨</strong>ï¼Œé¿å…æµé‡å…¥å£å•ç‚¹æ•…éšœ
âœ… <strong>å­˜å‚¨ç­–ç•¥ä¼˜åŒ–</strong>ï¼Œç¡®ä¿ PVC ç»‘å®šç¨³å®š</p><p>è¿™äº›æ”¹è¿›æªæ–½èƒ½æé«˜ Kubernetes é›†ç¾¤çš„<strong>å¯é æ€§ã€æ¢å¤èƒ½åŠ›</strong>ï¼Œè®©ç³»ç»Ÿåœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å¿«é€Ÿæ¢å¤ï¼ ğŸš€</p><h1 id=é›†ç¾¤å¤§è§„æ¨¡å¯åŠ¨podå¤±è´¥æ€ä¹ˆå®šä½é—®é¢˜å¹¶è°ƒä¼˜>é›†ç¾¤å¤§è§„æ¨¡å¯åŠ¨podå¤±è´¥ï¼Œæ€ä¹ˆå®šä½é—®é¢˜å¹¶è°ƒä¼˜ï¼Ÿ
<a class=anchor href=#%e9%9b%86%e7%be%a4%e5%a4%a7%e8%a7%84%e6%a8%a1%e5%90%af%e5%8a%a8pod%e5%a4%b1%e8%b4%a5%e6%80%8e%e4%b9%88%e5%ae%9a%e4%bd%8d%e9%97%ae%e9%a2%98%e5%b9%b6%e8%b0%83%e4%bc%98>#</a></h1><h2 id=å¤§è§„æ¨¡å¯åŠ¨-pod-å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ><strong>å¤§è§„æ¨¡å¯åŠ¨ Pod å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ</strong>
<a class=anchor href=#%e5%a4%a7%e8%a7%84%e6%a8%a1%e5%90%af%e5%8a%a8-pod-%e5%a4%b1%e8%b4%a5%e7%9a%84%e6%8e%92%e6%9f%a5%e4%b8%8e%e4%bc%98%e5%8c%96%e6%96%b9%e6%a1%88>#</a></h2><p>åœ¨ Kubernetes é›†ç¾¤ä¸­å¤§è§„æ¨¡å¯åŠ¨ Pod æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ° Pod å¤„äº <strong><code>Pending</code></strong> æˆ– <strong><code>ContainerCreating</code></strong> çŠ¶æ€ï¼Œç”šè‡³éƒ¨åˆ†èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜ï¼Œå¯¼è‡´é›†ç¾¤æ•´ä½“ä¸å¯ç”¨ã€‚è¿™é‡Œæä¾›<strong>å®Œæ•´çš„æ’æŸ¥æµç¨‹å’Œä¼˜åŒ–æ–¹æ¡ˆ</strong>ã€‚</p><hr><h2 id=-1-é€šè¿‡><strong>ğŸ›  1. é€šè¿‡ <code>kubectl</code> å’Œ <code>describe</code> å‘½ä»¤æ’æŸ¥</strong>
<a class=anchor href=#-1-%e9%80%9a%e8%bf%87>#</a></h2><h3 id=-æŸ¥çœ‹-pod-çŠ¶æ€><strong>ğŸ“Œ æŸ¥çœ‹ Pod çŠ¶æ€</strong>
<a class=anchor href=#-%e6%9f%a5%e7%9c%8b-pod-%e7%8a%b6%e6%80%81>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -A -o wide
</span></span></code></pre></div><ul><li><strong>Pending</strong>ï¼šè¡¨ç¤º Pod è¿˜æœªè¢«è°ƒåº¦åˆ°èŠ‚ç‚¹</li><li><strong>ContainerCreating</strong>ï¼šPod å·²è°ƒåº¦åˆ°èŠ‚ç‚¹ï¼Œä½†å®¹å™¨æœªèƒ½æˆåŠŸåˆ›å»º</li><li><strong>CrashLoopBackOff</strong>ï¼šPod ä¸æ–­é‡å¯ï¼Œå¯èƒ½æ˜¯åº”ç”¨é—®é¢˜</li></ul><h3 id=-è·å–è¯¦ç»†ä¿¡æ¯><strong>ğŸ“Œ è·å–è¯¦ç»†ä¿¡æ¯</strong>
<a class=anchor href=#-%e8%8e%b7%e5%8f%96%e8%af%a6%e7%bb%86%e4%bf%a1%e6%81%af>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><ul><li><pre tabindex=0><code>Events
</code></pre><p>å­—æ®µå¯æŸ¥çœ‹é”™è¯¯åŸå› ï¼š</p><ul><li><strong>FailedScheduling</strong>ï¼šè°ƒåº¦å¤±è´¥ï¼Œå¯èƒ½èµ„æºä¸è¶³</li><li><strong>Network not ready</strong>ï¼šCNI ç»„ä»¶æ•…éšœ</li><li><strong>Failed to attach volume</strong>ï¼šå­˜å‚¨æŒ‚è½½å¤±è´¥</li></ul></li></ul><hr><h2 id=-2-è°ƒåº¦é—®é¢˜pod-æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹><strong>ğŸ” 2. è°ƒåº¦é—®é¢˜ï¼ˆPod æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹ï¼‰</strong>
<a class=anchor href=#-2-%e8%b0%83%e5%ba%a6%e9%97%ae%e9%a2%98pod-%e6%97%a0%e6%b3%95%e8%a2%ab%e5%88%86%e9%85%8d%e5%88%b0%e8%8a%82%e7%82%b9>#</a></h2><h3 id=-é—®é¢˜-1é›†ç¾¤èµ„æºä¸è¶³><strong>ğŸ›‘ é—®é¢˜ 1ï¼šé›†ç¾¤èµ„æºä¸è¶³</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-1%e9%9b%86%e7%be%a4%e8%b5%84%e6%ba%90%e4%b8%8d%e8%b6%b3>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><pre tabindex=0><code>kubectl describe pod
</code></pre><p>æ˜¾ç¤ºï¼š</p><pre tabindex=0><code>0/50 nodes are available: insufficient CPU, insufficient memory
</code></pre></li><li><p><code>kubectl get nodes</code> æ˜¾ç¤ºéƒ¨åˆ†èŠ‚ç‚¹ <code>NotReady</code></p></li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥èŠ‚ç‚¹å¯ç”¨èµ„æº</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl top nodes
</span></span></code></pre></div><p>å¦‚æœ CPU æˆ–å†…å­˜å·²æ»¡ï¼Œå¯ä»¥ï¼š</p><ul><li><strong>é‡Šæ”¾æ— ç”¨ Pod</strong></li><li><strong>æ‰©å®¹ Worker èŠ‚ç‚¹</strong></li></ul></li><li><p><strong>è°ƒæ•´è°ƒåº¦ç­–ç•¥</strong>ï¼ˆä½¿ç”¨ <code>priorityClass</code> æå‡å…³é”® Pod ä¼˜å…ˆçº§ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>scheduling.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PriorityClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>high-priority</span>
</span></span><span style=display:flex><span><span style=color:#f92672>value</span>: <span style=color:#ae81ff>1000000</span>
</span></span><span style=display:flex><span><span style=color:#f92672>globalDefault</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;High priority for critical pods&#34;</span>
</span></span></code></pre></div></li><li><p><strong>ä¼˜åŒ– Pod èµ„æºè¯·æ±‚</strong></p><ul><li>é¿å… Pod ç”³è¯·è¿‡å¤šèµ„æºå¯¼è‡´è°ƒåº¦å¤±è´¥ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;250m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span></code></pre></div></li></ol><hr><h3 id=-é—®é¢˜-2èŠ‚ç‚¹è°ƒåº¦é™åˆ¶><strong>ğŸ›‘ é—®é¢˜ 2ï¼šèŠ‚ç‚¹è°ƒåº¦é™åˆ¶</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-2%e8%8a%82%e7%82%b9%e8%b0%83%e5%ba%a6%e9%99%90%e5%88%b6>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><pre tabindex=0><code>kubectl describe pod
</code></pre><p>æ˜¾ç¤ºï¼š</p><pre tabindex=0><code>0/50 nodes match node selector
</code></pre></li><li><p>Pod ç»‘å®šäº† <code>nodeSelector</code> æˆ– <code>affinity</code>ï¼Œå¯¼è‡´æ²¡æœ‰å¯ç”¨èŠ‚ç‚¹</p></li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥ Pod çš„ <code>nodeSelector</code></strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>node-type</span>: <span style=color:#e6db74>&#34;high-performance&#34;</span>
</span></span></code></pre></div><ul><li><p>ç¡®ä¿æœ‰è‡³å°‘ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes --show-labels
</span></span></code></pre></div></li></ul></li><li><p><strong>æ£€æŸ¥ <code>affinity</code> è§„åˆ™</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeAffinity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodeSelectorTerms</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>disktype</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>ssd</span>
</span></span></code></pre></div><ul><li>å¯é€‚å½“é™ä½ <code>requiredDuringSchedulingIgnoredDuringExecution</code> çš„çº¦æŸçº§åˆ«ã€‚</li></ul></li></ol><hr><h2 id=-3-å®¹å™¨åˆ›å»ºé—®é¢˜containercreating-å¡ä½><strong>ğŸ” 3. å®¹å™¨åˆ›å»ºé—®é¢˜ï¼ˆContainerCreating å¡ä½ï¼‰</strong>
<a class=anchor href=#-3-%e5%ae%b9%e5%99%a8%e5%88%9b%e5%bb%ba%e9%97%ae%e9%a2%98containercreating-%e5%8d%a1%e4%bd%8f>#</a></h2><h3 id=-é—®é¢˜-3cni-ç½‘ç»œç»„ä»¶å¼‚å¸¸><strong>ğŸ›‘ é—®é¢˜ 3ï¼šCNI ç½‘ç»œç»„ä»¶å¼‚å¸¸</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-3cni-%e7%bd%91%e7%bb%9c%e7%bb%84%e4%bb%b6%e5%bc%82%e5%b8%b8>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><pre tabindex=0><code>kubectl describe pod
</code></pre><p>æ˜¾ç¤ºï¼š</p><pre tabindex=0><code>Failed create pod sandbox: rpc error: code = Unknown desc = failed to setup network
</code></pre></li><li><p><code>kubectl get pods -n kube-system</code> å‘ç° <code>coredns</code>ã€<code>calico-node</code> ç­‰ç½‘ç»œç»„ä»¶å¼‚å¸¸</p></li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥ CNI æ’ä»¶çŠ¶æ€</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n kube-system | grep calico
</span></span><span style=display:flex><span>kubectl logs -f &lt;cni-pod-name&gt; -n kube-system
</span></span></code></pre></div><ul><li><p>å¦‚æœ CNI ç»„ä»¶å´©æºƒï¼Œé‡å¯å®ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod &lt;cni-pod-name&gt; -n kube-system
</span></span></code></pre></div></li></ul></li><li><p><strong>æ£€æŸ¥ IP èµ„æºæ˜¯å¦è€—å°½</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ippools -A
</span></span></code></pre></div><ul><li><p>å¦‚æœ IP åœ°å€ä¸è¶³ï¼Œéœ€è¦æ‰©å±• IP æ± ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>IPPool</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>default-pool</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cidr</span>: <span style=color:#ae81ff>192.168.1.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>blockSize</span>: <span style=color:#ae81ff>26</span>
</span></span></code></pre></div></li></ul></li></ol><hr><h3 id=-é—®é¢˜-4å®¹å™¨é•œåƒæ‹‰å–å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šå®¹å™¨é•œåƒæ‹‰å–å¤±è´¥</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-4%e5%ae%b9%e5%99%a8%e9%95%9c%e5%83%8f%e6%8b%89%e5%8f%96%e5%a4%b1%e8%b4%a5>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><pre tabindex=0><code>kubectl describe pod
</code></pre><p>æ˜¾ç¤ºï¼š</p><pre tabindex=0><code>Failed to pull image: ImagePullBackOff
</code></pre></li><li><pre tabindex=0><code>kubectl get events
</code></pre><p>å‘ç°ï¼š</p><pre tabindex=0><code>Failed to pull image &#34;myrepo/myimage:v1.0&#34;: not found
</code></pre></li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥ç§æœ‰é•œåƒä»“åº“çš„ Secret</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get secret -n &lt;namespace&gt;
</span></span></code></pre></div><ul><li><p>å¦‚æœæ²¡æœ‰</p><pre tabindex=0><code>imagePullSecret
</code></pre><p>ï¼Œåˆ›å»ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret docker-registry my-registry-secret <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --docker-server<span style=color:#f92672>=</span>&lt;your-registry&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --docker-username<span style=color:#f92672>=</span>&lt;your-username&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --docker-password<span style=color:#f92672>=</span>&lt;your-password&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --namespace<span style=color:#f92672>=</span>&lt;namespace&gt;
</span></span></code></pre></div></li><li><p>ä¿®æ”¹ Pod é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imagePullSecrets</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-registry-secret</span>
</span></span></code></pre></div></li></ul></li><li><p><strong>æ£€æŸ¥é•œåƒä»“åº“å¯ç”¨æ€§</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker login &lt;your-registry&gt;
</span></span><span style=display:flex><span>docker pull myrepo/myimage:v1.0
</span></span></code></pre></div></li></ol><hr><h2 id=-4-å­˜å‚¨é—®é¢˜pvc-ç»‘å®šå¤±è´¥><strong>ğŸ” 4. å­˜å‚¨é—®é¢˜ï¼ˆPVC ç»‘å®šå¤±è´¥ï¼‰</strong>
<a class=anchor href=#-4-%e5%ad%98%e5%82%a8%e9%97%ae%e9%a2%98pvc-%e7%bb%91%e5%ae%9a%e5%a4%b1%e8%b4%a5>#</a></h2><h3 id=-é—®é¢˜-5å­˜å‚¨å·æŒ‚è½½å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 5ï¼šå­˜å‚¨å·æŒ‚è½½å¤±è´¥</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-5%e5%ad%98%e5%82%a8%e5%8d%b7%e6%8c%82%e8%bd%bd%e5%a4%b1%e8%b4%a5>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><pre tabindex=0><code>kubectl describe pod
</code></pre><p>æ˜¾ç¤ºï¼š</p><pre tabindex=0><code>MountVolume.SetUp failed for volume &#34;pvc-xxxx&#34; : rpc error: code = DeadlineExceeded
</code></pre></li><li><p>Pod å¤„äº <code>ContainerCreating</code> çŠ¶æ€</p></li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥ PVC çŠ¶æ€</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pvc -n &lt;namespace&gt;
</span></span></code></pre></div><ul><li><p>å¦‚æœ</p><pre tabindex=0><code>STATUS
</code></pre><p>ä¸º</p><pre tabindex=0><code>Pending
</code></pre><p>ï¼Œåˆ™éœ€è¦ç¡®è®¤å­˜å‚¨ç±»ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get sc
</span></span></code></pre></div></li></ul></li><li><p><strong>å¦‚æœ PVC ç»‘å®šå¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶é‡æ–°ç»‘å®š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div></li></ol><hr><h2 id=-5-master-ç»„ä»¶è´Ÿè½½è¿‡é«˜><strong>ğŸ” 5. Master ç»„ä»¶è´Ÿè½½è¿‡é«˜</strong>
<a class=anchor href=#-5-master-%e7%bb%84%e4%bb%b6%e8%b4%9f%e8%bd%bd%e8%bf%87%e9%ab%98>#</a></h2><h3 id=-é—®é¢˜-6api-server-è´Ÿè½½è¿‡é«˜><strong>ğŸ›‘ é—®é¢˜ 6ï¼šAPI Server è´Ÿè½½è¿‡é«˜</strong>
<a class=anchor href=#-%e9%97%ae%e9%a2%98-6api-server-%e8%b4%9f%e8%bd%bd%e8%bf%87%e9%ab%98>#</a></h3><ul><li><p>ç°è±¡</p><p>ï¼š</p><ul><li><code>kubectl get pods</code> å“åº”ç¼“æ…¢</li><li><code>kube-apiserver</code> CPU é£™é«˜</li></ul></li></ul><p>âœ… <strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ol><li><p><strong>æ£€æŸ¥ API Server å‹åŠ›</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get --raw <span style=color:#e6db74>&#34;/metrics&#34;</span> | grep apiserver_request
</span></span></code></pre></div></li><li><p><strong>å¯ç”¨ <code>kube-proxy</code> IPVS æ¨¡å¼ï¼Œå‡å°‘ API Server è´Ÿè½½</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;ipvs&#34;</span>
</span></span></code></pre></div></li><li><p><strong>å¢åŠ  API Server å‰¯æœ¬æ•°</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl scale deploy kube-apiserver --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span></code></pre></div></li></ol><hr><h2 id=-æ€»ç»“><strong>ğŸ¯ æ€»ç»“</strong>
<a class=anchor href=#-%e6%80%bb%e7%bb%93>#</a></h2><table><thead><tr><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>èµ„æºä¸è¶³</td><td>è°ƒæ•´ <code>requests/limits</code>ï¼Œæ‰©å®¹èŠ‚ç‚¹</td></tr><tr><td>è°ƒåº¦å¤±è´¥</td><td>æ”¾å®½ <code>nodeSelector</code>ï¼Œä½¿ç”¨ <code>priorityClass</code></td></tr><tr><td>CNI æ•…éšœ</td><td>æ£€æŸ¥ <code>coredns</code> å’Œ <code>calico-node</code></td></tr><tr><td>é•œåƒæ‹‰å–å¤±è´¥</td><td>æ·»åŠ  <code>imagePullSecrets</code>ï¼Œæ£€æŸ¥é•œåƒä»“åº“</td></tr><tr><td>PVC ç»‘å®šå¤±è´¥</td><td>æ£€æŸ¥ <code>StorageClass</code> å’Œ <code>PersistentVolume</code></td></tr><tr><td>API Server è´Ÿè½½é«˜</td><td>å¯ç”¨ IPVSï¼Œå¢åŠ å‰¯æœ¬æ•°</td></tr></tbody></table><p>å¦‚æœé›†ç¾¤å¤§è§„æ¨¡å¯åŠ¨ Pod å¤±è´¥ï¼ŒæŒ‰ç…§ä»¥ä¸Šæ–¹æ³•é€æ­¥æ’æŸ¥ï¼Œä¼˜åŒ–è°ƒåº¦å’Œèµ„æºåˆ†é…ï¼Œå³å¯æé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼ ğŸš€</p><h1 id=éƒ¨ç½²redisæˆ–è€…kafkaä¸­é—´ä»¶å—æ€ä¹ˆè®¾è®¡å®¹å™¨åŒ–æ–¹æ¡ˆé«˜å¯ç”¨æ•°æ®æŒä¹…åŒ–æˆ–è€…å»¶è¿Ÿçš„æƒ…å†µ>éƒ¨ç½²redisæˆ–è€…kafkaä¸­é—´ä»¶å—ï¼Ÿæ€ä¹ˆè®¾è®¡å®¹å™¨åŒ–æ–¹æ¡ˆï¼Ÿé«˜å¯ç”¨ï¼Ÿæ•°æ®æŒä¹…åŒ–æˆ–è€…å»¶è¿Ÿçš„æƒ…å†µï¼Ÿ
<a class=anchor href=#%e9%83%a8%e7%bd%b2redis%e6%88%96%e8%80%85kafka%e4%b8%ad%e9%97%b4%e4%bb%b6%e5%90%97%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e5%ae%b9%e5%99%a8%e5%8c%96%e6%96%b9%e6%a1%88%e9%ab%98%e5%8f%af%e7%94%a8%e6%95%b0%e6%8d%ae%e6%8c%81%e4%b9%85%e5%8c%96%e6%88%96%e8%80%85%e5%bb%b6%e8%bf%9f%e7%9a%84%e6%83%85%e5%86%b5>#</a></h1><h2 id=kubernetes-ä¸­-redis-å’Œ-kafka-å®¹å™¨åŒ–æ–¹æ¡ˆ><strong>Kubernetes ä¸­ Redis å’Œ Kafka å®¹å™¨åŒ–æ–¹æ¡ˆ</strong>
<a class=anchor href=#kubernetes-%e4%b8%ad-redis-%e5%92%8c-kafka-%e5%ae%b9%e5%99%a8%e5%8c%96%e6%96%b9%e6%a1%88>#</a></h2><p>åœ¨ Kubernetes ä¸­éƒ¨ç½² Redis æˆ– Kafka éœ€è¦è€ƒè™‘<strong>é«˜å¯ç”¨ã€æ•°æ®æŒä¹…åŒ–å’Œå»¶è¿Ÿä¼˜åŒ–</strong>ç­‰å…³é”®ç‚¹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è®¾è®¡æ–¹æ¡ˆã€‚</p><hr><h1 id=1-redis-å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ><strong>1ï¸âƒ£ Redis å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ</strong>
<a class=anchor href=#1-redis-%e5%ae%b9%e5%99%a8%e5%8c%96%e9%83%a8%e7%bd%b2%e6%96%b9%e6%a1%88>#</a></h1><h3 id=-redis-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Redis æ–¹æ¡ˆè®¾è®¡</strong>
<a class=anchor href=#-redis-%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1>#</a></h3><ul><li><p>æ¶æ„</p><p>ï¼š</p><ul><li><strong>Redis Sentinel + Redis ä¸»ä»</strong>ï¼ˆé«˜å¯ç”¨ï¼‰</li><li><strong>Redis Cluster</strong>ï¼ˆåˆ†ç‰‡æ‰©å±•ï¼‰</li></ul></li><li><p>å­˜å‚¨æŒä¹…åŒ–</p><p>ï¼š</p><ul><li><strong>AOF</strong>ï¼ˆAppend Only Fileï¼Œé€‚ç”¨äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼‰</li><li><strong>RDB</strong>ï¼ˆå‘¨æœŸæ€§å¿«ç…§ï¼Œé€‚ç”¨äºæ€§èƒ½ä¼˜å…ˆåœºæ™¯ï¼‰</li></ul></li><li><p>éƒ¨ç½²æ–¹å¼</p><p>ï¼š</p><ul><li><code>StatefulSet</code> ç®¡ç† <code>Redis Master/Slave</code></li><li><code>Sentinel</code> ç›‘æ§å¹¶è‡ªåŠ¨æ•…éšœè½¬ç§»</li><li>æŒä¹…åŒ– PVC å­˜å‚¨ Redis æ•°æ®</li></ul></li></ul><hr><h3 id=-æ–¹æ¡ˆ-1redis-sentinel-é«˜å¯ç”¨><strong>ğŸ“Œ æ–¹æ¡ˆ 1ï¼šRedis Sentinel é«˜å¯ç”¨</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-1redis-sentinel-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h3><h4 id=-11-åˆ›å»º-redis-statefulset><strong>ğŸ›  1.1 åˆ›å»º Redis StatefulSet</strong>
<a class=anchor href=#-11-%e5%88%9b%e5%bb%ba-redis-statefulset>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis:6.2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;redis-server&#34;</span>, <span style=color:#e6db74>&#34;/redis.conf&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>6379</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis-config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumeClaimTemplates</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>accessModes</span>: [<span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</span></span></code></pre></div><h4 id=-12-åˆ›å»º-sentinel-éƒ¨ç½²><strong>ğŸ›  1.2 åˆ›å»º Sentinel éƒ¨ç½²</strong>
<a class=anchor href=#-12-%e5%88%9b%e5%bb%ba-sentinel-%e9%83%a8%e7%bd%b2>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis-sentinel</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>redis-sentinel</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>redis-sentinel</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sentinel</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis:6.2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;redis-sentinel&#34;</span>, <span style=color:#e6db74>&#34;/sentinel.conf&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>26379</span>
</span></span></code></pre></div><h4 id=-é«˜å¯ç”¨åŸç†><strong>ğŸ“Œ é«˜å¯ç”¨åŸç†</strong>
<a class=anchor href=#-%e9%ab%98%e5%8f%af%e7%94%a8%e5%8e%9f%e7%90%86>#</a></h4><ol><li>Sentinel ç›‘å¬ Redis ä¸»ä»çŠ¶æ€ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼Œä¼šè‡ªåŠ¨é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li><code>StatefulSet</code> ä¿è¯ Redis èŠ‚ç‚¹çš„ç¨³å®šæ€§ï¼ŒPod é‡å¯å IP ä¸å˜ã€‚</li><li>PVC æŒä¹…åŒ– Redis æ•°æ®ï¼Œé˜²æ­¢ Pod åˆ é™¤å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li></ol><hr><h3 id=-æ–¹æ¡ˆ-2redis-clusteråˆ†ç‰‡><strong>ğŸ“Œ æ–¹æ¡ˆ 2ï¼šRedis Clusterï¼ˆåˆ†ç‰‡ï¼‰</strong>
<a class=anchor href=#-%e6%96%b9%e6%a1%88-2redis-cluster%e5%88%86%e7%89%87>#</a></h3><ul><li><p>é€‚ç”¨äºé«˜åååœºæ™¯ï¼Œåˆ†ç‰‡å­˜å‚¨ï¼Œæé«˜å¯æ‰©å±•æ€§ã€‚</p></li><li><p>éœ€è¦ <code>6</code> ä¸ª Redis Podï¼ˆ3 Master + 3 Slaveï¼‰ã€‚</p></li><li><p>ä½¿ç”¨</p><pre tabindex=0><code>StatefulSet
</code></pre><p>éƒ¨ç½² Redisï¼Œæ¯ä¸ª Pod è¿è¡Œ</p><pre tabindex=0><code>redis-server
</code></pre><p>å¹¶å¼€å¯é›†ç¾¤æ¨¡å¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>redis-cli --cluster create &lt;master1-ip&gt;:6379 &lt;master2-ip&gt;:6379 &lt;master3-ip&gt;:6379 --cluster-replicas <span style=color:#ae81ff>1</span>
</span></span></code></pre></div></li><li><p>ç¼ºç‚¹</p><p>ï¼š</p><ul><li>éœ€è¦åº”ç”¨ç«¯æ”¯æŒ Redis Cluster è®¿é—®æ–¹å¼ï¼ˆ<code>JedisCluster</code> æˆ– <code>lettuce</code>ï¼‰ã€‚</li><li>éœ€è¦ <code>configmap</code> æå‰é…ç½® <code>redis.conf</code> ä»¥æ”¯æŒ <code>cluster-enabled yes</code>ã€‚</li></ul></li></ul><hr><h1 id=2-kafka-å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ><strong>2ï¸âƒ£ Kafka å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ</strong>
<a class=anchor href=#2-kafka-%e5%ae%b9%e5%99%a8%e5%8c%96%e9%83%a8%e7%bd%b2%e6%96%b9%e6%a1%88>#</a></h1><p>Kafka éœ€è¦è€ƒè™‘<strong>é«˜å¯ç”¨ã€æ•°æ®æŒä¹…åŒ–å’Œå»¶è¿Ÿä¼˜åŒ–</strong>ï¼Œæ¨èä½¿ç”¨ <strong>Kafka + Zookeeper</strong> è¿›è¡Œç®¡ç†ã€‚</p><h3 id=-kafka-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Kafka æ–¹æ¡ˆè®¾è®¡</strong>
<a class=anchor href=#-kafka-%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1>#</a></h3><ul><li><p><strong>å­˜å‚¨</strong>ï¼šKafka ä¾èµ–ç£ç›˜ IOï¼Œéœ€è¦ <code>PersistentVolume</code></p></li><li><p><strong>é«˜å¯ç”¨</strong>ï¼šå¤šå‰¯æœ¬ <code>replication-factor > 1</code></p></li><li><p>ä¼˜åŒ–</p><p>ï¼š</p><ul><li><code>log.segment.bytes</code> è°ƒæ•´ segment å¤§å°ï¼Œä¼˜åŒ–æ—¥å¿—å­˜å‚¨</li><li><code>message.max.bytes</code> é™åˆ¶å•æ¡æ¶ˆæ¯å¤§å°ï¼Œé˜²æ­¢ OOM</li><li><code>num.partitions</code> é€‚å½“å¢åŠ åˆ†åŒºï¼Œæé«˜å¹¶å‘èƒ½åŠ›</li></ul></li></ul><hr><h3 id=-kafka-å®¹å™¨åŒ–éƒ¨ç½²><strong>ğŸ“Œ Kafka å®¹å™¨åŒ–éƒ¨ç½²</strong>
<a class=anchor href=#-kafka-%e5%ae%b9%e5%99%a8%e5%8c%96%e9%83%a8%e7%bd%b2>#</a></h3><h4 id=-21-éƒ¨ç½²-zookeeperç”¨äºç®¡ç†-kafka-broker><strong>ğŸ›  2.1 éƒ¨ç½² Zookeeperï¼ˆç”¨äºç®¡ç† Kafka Brokerï¼‰</strong>
<a class=anchor href=#-21-%e9%83%a8%e7%bd%b2-zookeeper%e7%94%a8%e4%ba%8e%e7%ae%a1%e7%90%86-kafka-broker>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>bitnami/zookeeper:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ALLOW_ANONYMOUS_LOGIN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;yes&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
</span></span></code></pre></div><hr><h4 id=-22-éƒ¨ç½²-kafka-statefulset><strong>ğŸ›  2.2 éƒ¨ç½² Kafka StatefulSet</strong>
<a class=anchor href=#-22-%e9%83%a8%e7%bd%b2-kafka-statefulset>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>bitnami/kafka:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KAFKA_CFG_ZOOKEEPER_CONNECT</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;zookeeper:2181&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KAFKA_CFG_ADVERTISED_LISTENERS</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;PLAINTEXT://kafka:9092&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KAFKA_CFG_DEFAULT_REPLICATION_FACTOR</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KAFKA_CFG_NUM_PARTITIONS</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>9092</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/bitnami/kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumeClaimTemplates</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>accessModes</span>: [<span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Gi</span>
</span></span></code></pre></div><hr><h1 id=3-å…³é”®ä¼˜åŒ–ç‚¹><strong>3ï¸âƒ£ å…³é”®ä¼˜åŒ–ç‚¹</strong>
<a class=anchor href=#3-%e5%85%b3%e9%94%ae%e4%bc%98%e5%8c%96%e7%82%b9>#</a></h1><h2 id=-1-æ•°æ®æŒä¹…åŒ–><strong>ğŸ“Œ 1. æ•°æ®æŒä¹…åŒ–</strong>
<a class=anchor href=#-1-%e6%95%b0%e6%8d%ae%e6%8c%81%e4%b9%85%e5%8c%96>#</a></h2><ul><li><strong>Redis</strong>ï¼šä½¿ç”¨ PVC å­˜å‚¨ <code>/data</code> ç›®å½•ï¼Œé˜²æ­¢é‡å¯ä¸¢å¤±æ•°æ®ã€‚</li><li><strong>Kafka</strong>ï¼šä½¿ç”¨ PVC æŒä¹…åŒ– <code>/bitnami/kafka</code> ç›®å½•ï¼Œé˜²æ­¢ Broker å¤±æ•ˆå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li></ul><hr><h2 id=-2-é«˜å¯ç”¨><strong>ğŸ“Œ 2. é«˜å¯ç”¨</strong>
<a class=anchor href=#-2-%e9%ab%98%e5%8f%af%e7%94%a8>#</a></h2><table><thead><tr><th>ç»„ä»¶</th><th>æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Redis</td><td>Sentinel æˆ– Cluster</td></tr><tr><td>Kafka</td><td><code>replication-factor=2</code>ï¼Œé¿å…å•ç‚¹æ•…éšœ</td></tr><tr><td>Zookeeper</td><td>3 ä¸ªå‰¯æœ¬ï¼Œé¿å… Leader é€‰ä¸¾å¤±è´¥</td></tr></tbody></table><hr><h2 id=-3-å»¶è¿Ÿä¼˜åŒ–><strong>ğŸ“Œ 3. å»¶è¿Ÿä¼˜åŒ–</strong>
<a class=anchor href=#-3-%e5%bb%b6%e8%bf%9f%e4%bc%98%e5%8c%96>#</a></h2><ul><li><strong>Redis</strong>ï¼š<ul><li>å…³é—­ <code>fsync</code> ä»¥æé«˜å†™å…¥ååï¼ˆä½†å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰</li><li><code>maxclients</code> é™åˆ¶å¹¶å‘è¿æ¥ï¼Œé˜²æ­¢ OOM</li><li><code>timeout</code> è®¾ç½®è¶…æ—¶å›æ”¶ç©ºé—²è¿æ¥</li></ul></li><li><strong>Kafka</strong>ï¼š<ul><li><code>acks=1</code> æé«˜ç”Ÿäº§è€…ååé‡ï¼ˆ<code>acks=all</code> å¯ä¿è¯ä¸€è‡´æ€§ï¼Œä½†ä¼šå¢åŠ å»¶è¿Ÿï¼‰</li><li><code>linger.ms=5</code> æ‰¹é‡å¤„ç†æ¶ˆæ¯ï¼Œå‡å°‘ IO è¯·æ±‚</li><li><code>replication-factor=2</code> ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±</li></ul></li></ul><hr><h1 id=-æ€»ç»“-1><strong>âœ… æ€»ç»“</strong>
<a class=anchor href=#-%e6%80%bb%e7%bb%93-1>#</a></h1><table><thead><tr><th>ç»„ä»¶</th><th>é«˜å¯ç”¨</th><th>æŒä¹…åŒ–</th><th>ä¼˜åŒ–ç­–ç•¥</th></tr></thead><tbody><tr><td>Redis</td><td>Sentinel / Cluster</td><td>PVC / AOF</td><td>fsync å…³é—­ï¼Œmaxclients é™æµ</td></tr><tr><td>Kafka</td><td>å¤š Broker + Zookeeper</td><td>PVC</td><td>acks=1, linger.ms=5</td></tr><tr><td>Zookeeper</td><td>3 å‰¯æœ¬</td><td>PVC</td><td>Leader é€‰ä¸¾ä¼˜åŒ–</td></tr></tbody></table><p>é€šè¿‡ Kubernetes <code>StatefulSet</code> è¿›è¡Œ Redis å’Œ Kafka éƒ¨ç½²ï¼Œå¯ä»¥ä¿è¯<strong>é«˜å¯ç”¨ã€æŒä¹…åŒ–å’Œä½å»¶è¿Ÿ</strong>ï¼ŒåŒæ—¶èƒ½å¤ŸåŠ¨æ€æ‰©å±•ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼ ğŸš€</p><h1 id=drgonflyçš„åŸç†>drgonflyçš„åŸç†ï¼Ÿ
<a class=anchor href=#drgonfly%e7%9a%84%e5%8e%9f%e7%90%86>#</a></h1><h2 id=dragonfly-åŸç†è§£æ><strong>Dragonfly åŸç†è§£æ</strong>
<a class=anchor href=#dragonfly-%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90>#</a></h2><h3 id=-dragonfly-æ˜¯ä»€ä¹ˆ><strong>ğŸ“Œ Dragonfly æ˜¯ä»€ä¹ˆï¼Ÿ</strong>
<a class=anchor href=#-dragonfly-%e6%98%af%e4%bb%80%e4%b9%88>#</a></h3><p>Dragonfly æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„<strong>P2P åˆ†å‘ç³»ç»Ÿ</strong>ï¼Œä¸»è¦ç”¨äº<strong>äº‘åŸç”Ÿç¯å¢ƒ</strong>ï¼Œä¼˜åŒ–å¤§è§„æ¨¡<strong>é•œåƒã€æ–‡ä»¶åˆ†å‘</strong>ï¼Œè§£å†³ Kubernetes é›†ç¾¤ä¸­<strong>å®¹å™¨é•œåƒæ‹‰å–æ…¢</strong>çš„é—®é¢˜ã€‚</p><hr><h2 id=1-dragonfly-ä¸»è¦ç»„æˆ><strong>1ï¸âƒ£ Dragonfly ä¸»è¦ç»„æˆ</strong>
<a class=anchor href=#1-dragonfly-%e4%b8%bb%e8%a6%81%e7%bb%84%e6%88%90>#</a></h2><p>Dragonfly ä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p><table><thead><tr><th>ç»„ä»¶</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>dfdaemon</strong></td><td>è¿è¡Œåœ¨æ¯ä¸ª Node ä¸Šçš„ P2P ä¸‹è½½å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‹¦æˆª <code>docker pull</code> è¯·æ±‚</td></tr><tr><td><strong>scheduler</strong></td><td>è°ƒåº¦èŠ‚ç‚¹ï¼Œè´Ÿè´£ Peer èŠ‚ç‚¹ç®¡ç†ã€ä»»åŠ¡åˆ†å‘ã€P2P ä¸‹è½½è°ƒåº¦</td></tr><tr><td><strong>cdn</strong></td><td>ç¼“å­˜ä¸­å¿ƒï¼ŒåŠ é€Ÿç§å­æ–‡ä»¶åˆ†å‘</td></tr><tr><td><strong>dfget</strong></td><td>å…·ä½“æ‰§è¡Œä¸‹è½½ä»»åŠ¡çš„å·¥å…·</td></tr><tr><td><strong>dfstore</strong></td><td>åˆ†å¸ƒå¼å­˜å‚¨ï¼Œç”¨äºç¼“å­˜åˆ†ç‰‡æ•°æ®</td></tr></tbody></table><hr><h2 id=2-dragonfly-çš„å·¥ä½œåŸç†><strong>2ï¸âƒ£ Dragonfly çš„å·¥ä½œåŸç†</strong>
<a class=anchor href=#2-dragonfly-%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86>#</a></h2><p>Dragonfly ä¸»è¦é€šè¿‡<strong>P2P æ–¹å¼åŠ é€Ÿæ–‡ä»¶åˆ†å‘</strong>ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><h3 id=-1-é•œåƒæ–‡ä»¶ä¸‹è½½è¯·æ±‚><strong>ğŸ›  1. é•œåƒ/æ–‡ä»¶ä¸‹è½½è¯·æ±‚</strong>
<a class=anchor href=#-1-%e9%95%9c%e5%83%8f%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd%e8%af%b7%e6%b1%82>#</a></h3><ul><li>ç”¨æˆ·åœ¨ Kubernetes é›†ç¾¤ä¸­æ‰§è¡Œ <code>docker pull</code> æ‹‰å–é•œåƒã€‚</li><li><code>dfdaemon</code> ä½œä¸º<strong>æœ¬åœ°ä»£ç†</strong>ï¼Œæ‹¦æˆª <code>docker pull</code> è¯·æ±‚ï¼Œæ”¹ä¸ºä½¿ç”¨ Dragonfly ä¸‹è½½ã€‚</li></ul><h3 id=-2-è°ƒåº¦èŠ‚ç‚¹scheduler><strong>ğŸ›  2. è°ƒåº¦èŠ‚ç‚¹ï¼ˆschedulerï¼‰</strong>
<a class=anchor href=#-2-%e8%b0%83%e5%ba%a6%e8%8a%82%e7%82%b9scheduler>#</a></h3><ul><li><p><code>dfdaemon</code> å°†è¯·æ±‚å‘é€ç»™ <code>scheduler</code>ï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰ç¼“å­˜ã€‚</p></li><li><pre tabindex=0><code>scheduler
</code></pre><p>è´Ÿè´£ï¼š</p><ol><li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šæ£€æŸ¥ <code>cdn</code> æ˜¯å¦å·²æœ‰å®Œæ•´æ–‡ä»¶ã€‚</li><li><strong>è°ƒåº¦ P2P ä¸‹è½½</strong>ï¼šå¦‚æœ <code>cdn</code> æ²¡æœ‰å®Œæ•´æ–‡ä»¶ï¼Œåˆ™ä» <code>source</code> ä¸‹è½½å¹¶<strong>åˆ‡åˆ†æˆå¤šä¸ªåˆ†ç‰‡</strong>ï¼Œå¹¶è°ƒåº¦åˆ°å¤šä¸ªèŠ‚ç‚¹ã€‚</li></ol></li></ul><h3 id=-3-p2p-ä¸‹è½½><strong>ğŸ›  3. P2P ä¸‹è½½</strong>
<a class=anchor href=#-3-p2p-%e4%b8%8b%e8%bd%bd>#</a></h3><ul><li><code>scheduler</code> é€‰æ‹©<strong>æœ€ä¼˜ peer</strong> ä½œä¸º<strong>ç§å­èŠ‚ç‚¹</strong>ï¼Œåˆ†å‘æ•°æ®å—ã€‚</li><li>å…¶ä»– <code>dfdaemon</code> äº’ç›¸è¯·æ±‚æ•°æ®ï¼Œå®ç°<strong>P2P ä¼ è¾“</strong>ï¼Œé¿å…æ‰€æœ‰èŠ‚ç‚¹éƒ½å»è®¿é—® <code>cdn</code> æˆ– <code>registry</code>ï¼Œé™ä½å¸¦å®½å‹åŠ›ã€‚</li></ul><h3 id=-4-æœ¬åœ°ç¼“å­˜><strong>ğŸ›  4. æœ¬åœ°ç¼“å­˜</strong>
<a class=anchor href=#-4-%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98>#</a></h3><ul><li>ä¸‹è½½å®Œæˆåï¼Œ<code>dfdaemon</code> ä¼šç¼“å­˜åˆ†ç‰‡æ•°æ®ï¼Œ<strong>åŠ é€Ÿåç»­ä¸‹è½½</strong>ï¼Œé¿å…é‡å¤æ‹‰å–ã€‚</li><li><code>dfdaemon</code> ä¹Ÿå¯ä»¥å……å½“<strong>æ–°ç§å­èŠ‚ç‚¹</strong>ï¼Œä¾›å…¶ä»– Peer ä¸‹è½½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ã€‚</li></ul><hr><h2 id=3-dragonfly-çš„-p2p-ä¸‹è½½æœºåˆ¶><strong>3ï¸âƒ£ Dragonfly çš„ P2P ä¸‹è½½æœºåˆ¶</strong>
<a class=anchor href=#3-dragonfly-%e7%9a%84-p2p-%e4%b8%8b%e8%bd%bd%e6%9c%ba%e5%88%b6>#</a></h2><h3 id=-p2p-åˆ†å—ä¸‹è½½><strong>ğŸ”¥ P2P åˆ†å—ä¸‹è½½</strong>
<a class=anchor href=#-p2p-%e5%88%86%e5%9d%97%e4%b8%8b%e8%bd%bd>#</a></h3><ol><li><strong>ä»»åŠ¡åˆ†ç‰‡</strong>ï¼šæ–‡ä»¶æˆ–é•œåƒè¢«æ‹†åˆ†æˆå¤šä¸ªå°å—ï¼ˆchunkï¼‰ã€‚</li><li><strong>å¹¶è¡Œä¸‹è½½</strong>ï¼šå¤šä¸ª <code>dfdaemon</code> äº’ç›¸ä¸‹è½½åˆ†ç‰‡ï¼Œé¿å…å•ç‚¹ç“¶é¢ˆã€‚</li><li><strong>åŠ¨æ€è°ƒåº¦</strong>ï¼š<code>scheduler</code> è®¡ç®—æœ€ä¼˜ peerï¼Œå‡å°‘å¸¦å®½æ¶ˆè€—ã€‚</li></ol><p><strong>ğŸ” å¯¹æ¯”ä¼ ç»Ÿä¸‹è½½</strong> | æ–¹å¼ | ä¼ ç»Ÿä¸‹è½½ | Dragonfly P2P | |&mdash;&mdash;|&mdash;&mdash;| | ä¸‹è½½æ¨¡å¼ | å•èŠ‚ç‚¹ç›´è¿ | å¤šèŠ‚ç‚¹ P2P | | å¸¦å®½å‹åŠ› | é«˜ | ä½ | | é€Ÿåº¦ | æ…¢ï¼ˆå— CDN/Registry é™åˆ¶ï¼‰ | å¿«ï¼ˆå¤šç‚¹å¹¶è¡Œï¼‰ | | å¯æ‰©å±•æ€§ | å—æœåŠ¡å™¨å¸¦å®½é™åˆ¶ | æ°´å¹³æ‰©å±• |</p><hr><h2 id=4-dragonfly-é«˜å¯ç”¨æ¶æ„><strong>4ï¸âƒ£ Dragonfly é«˜å¯ç”¨æ¶æ„</strong>
<a class=anchor href=#4-dragonfly-%e9%ab%98%e5%8f%af%e7%94%a8%e6%9e%b6%e6%9e%84>#</a></h2><h3 id=-å¤šçº§ç¼“å­˜æ¶æ„><strong>ğŸŒ å¤šçº§ç¼“å­˜æ¶æ„</strong>
<a class=anchor href=#-%e5%a4%9a%e7%ba%a7%e7%bc%93%e5%ad%98%e6%9e%b6%e6%9e%84>#</a></h3><ol><li><strong>æœ¬åœ°ç¼“å­˜ï¼ˆdfdaemonï¼‰</strong>ï¼šåŠ é€Ÿç›¸åŒæ–‡ä»¶çš„é‡å¤æ‹‰å–ã€‚</li><li><strong>é›†ç¾¤çº§ç¼“å­˜ï¼ˆP2Pï¼‰</strong>ï¼šä¸åŒèŠ‚ç‚¹äº’ç›¸æ‹‰å–ï¼Œæé«˜æ•´ä½“ååã€‚</li><li><strong>å…¨å±€ CDN ç¼“å­˜</strong>ï¼šå­˜å‚¨å®Œæ•´æ–‡ä»¶ï¼Œé¿å…å›æº Registryã€‚</li></ol><h3 id=-å…³é”®ç‰¹æ€§><strong>âš¡ å…³é”®ç‰¹æ€§</strong>
<a class=anchor href=#-%e5%85%b3%e9%94%ae%e7%89%b9%e6%80%a7>#</a></h3><ul><li><strong>P2P ä¸‹è½½</strong>ï¼Œå‡å°‘å•ç‚¹å‹åŠ›ï¼Œä¼˜åŒ–å¤§è§„æ¨¡é›†ç¾¤çš„æ‹‰å–æ€§èƒ½ã€‚</li><li><strong>è‡ªåŠ¨é™çº§</strong>ï¼Œå¦‚æœ P2P å¤±è´¥ï¼Œå›é€€ä¸º HTTP ç›´è¿ä¸‹è½½ã€‚</li><li><strong>å¯¹ Kubernetes å‹å¥½</strong>ï¼Œå¯ä¸ <code>containerd</code>ã€<code>docker</code> æ— ç¼é›†æˆã€‚</li></ul><hr><h2 id=5-dragonfly-åœ¨-kubernetes-é›†ç¾¤ä¸­çš„åº”ç”¨><strong>5ï¸âƒ£ Dragonfly åœ¨ Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨</strong>
<a class=anchor href=#5-dragonfly-%e5%9c%a8-kubernetes-%e9%9b%86%e7%be%a4%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8>#</a></h2><p>Dragonfly ä¸»è¦ç”¨äº<strong>ä¼˜åŒ– Kubernetes é›†ç¾¤é•œåƒæ‹‰å–</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨<strong>å¤§è§„æ¨¡ Pod å¯åŠ¨æ—¶</strong>ã€‚</p><h3 id=-åœ¨-kubernetes-ä½¿ç”¨-dragonfly><strong>ğŸ”¥ åœ¨ Kubernetes ä½¿ç”¨ Dragonfly</strong>
<a class=anchor href=#-%e5%9c%a8-kubernetes-%e4%bd%bf%e7%94%a8-dragonfly>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dfdaemon</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>dfdaemon</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>dfdaemon</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dfdaemon</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>dragonflyoss/dfdaemon:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>65001</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dfdaemon-cache</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/cache/dragonfly</span>
</span></span></code></pre></div><h4 id=-ä½¿ç”¨æ–¹å¼><strong>ğŸš€ ä½¿ç”¨æ–¹å¼</strong>
<a class=anchor href=#-%e4%bd%bf%e7%94%a8%e6%96%b9%e5%bc%8f>#</a></h4><ol><li><code>dfdaemon</code> è¿è¡Œåœ¨æ¯ä¸ª Node ä¸Šï¼Œæ‹¦æˆª <code>docker pull</code>ã€‚</li><li>è°ƒåº¦ <code>dfget</code> è¿›è¡Œ P2P ä¸‹è½½ï¼Œæé«˜å¹¶è¡Œåº¦ã€‚</li><li>åŠ é€Ÿå¤§è§„æ¨¡ Kubernetes Pod å¯åŠ¨ï¼Œé¿å… Registry å‹åŠ›è¿‡å¤§ã€‚</li></ol><hr><h2 id=6-dragonfly-å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ><strong>6ï¸âƒ£ Dragonfly å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ</strong>
<a class=anchor href=#6-dragonfly-%e5%af%b9%e6%af%94%e5%85%b6%e4%bb%96%e5%8a%a0%e9%80%9f%e6%96%b9%e6%a1%88>#</a></h2><table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼ ç»Ÿ Registry</th><th>Dragonfly</th><th>é•œåƒåŠ é€Ÿ Proxy</th></tr></thead><tbody><tr><td>æ‹‰å–æ–¹å¼</td><td>å•ç‚¹æ‹‰å–</td><td>P2P ä¸‹è½½</td><td>CDN ç¼“å­˜</td></tr><tr><td>é€‚ç”¨äº</td><td>å°è§„æ¨¡é›†ç¾¤</td><td>å¤§è§„æ¨¡åˆ†å‘</td><td>æ™®é€šåŠ é€Ÿ</td></tr><tr><td>èµ„æºæ¶ˆè€—</td><td>é«˜</td><td>ä½</td><td>é€‚ä¸­</td></tr><tr><td>å¯é æ€§</td><td>ä¾èµ– CDN</td><td>P2P è‡ªé€‚åº”</td><td>ä¾èµ–æºç«™</td></tr></tbody></table><hr><h2 id=-æ€»ç»“-2><strong>âœ… æ€»ç»“</strong>
<a class=anchor href=#-%e6%80%bb%e7%bb%93-2>#</a></h2><ul><li>Dragonfly é‡‡ç”¨ <strong>P2P</strong> + <strong>CDN</strong>ï¼Œä¼˜åŒ–<strong>å¤§è§„æ¨¡é•œåƒ/æ–‡ä»¶åˆ†å‘</strong>ã€‚</li><li>é€šè¿‡ <strong>dfdaemonã€schedulerã€cdn</strong> ç»„ä»¶ï¼Œå®ç°<strong>é«˜æ•ˆè°ƒåº¦ã€ç¼“å­˜ä¼˜åŒ–</strong>ã€‚</li><li><strong>é€‚ç”¨äº Kubernetes é›†ç¾¤</strong>ï¼Œæå‡å¤§è§„æ¨¡ Pod å¯åŠ¨çš„ä¸‹è½½æ€§èƒ½ï¼Œå‡å°‘ Registry å‹åŠ›ã€‚</li></ul><p>ğŸš€ <strong>åœ¨ K8s å¤§è§„æ¨¡é›†ç¾¤ä¸­ï¼ŒDragonfly æ˜¯è§£å†³é•œåƒæ‹‰å–æ…¢çš„åˆ©å™¨ï¼</strong></p><h1 id=ç›‘æ§å’Œcicdäº†è§£å“ªäº›ç›‘æ§æ—¥æ´»åƒä¸‡çš„appè®¾è®¡ç›‘æ§ä½“ç³»å’Œå…³æ³¨å“ªäº›æŒ‡æ ‡>ç›‘æ§å’Œcicdäº†è§£å“ªäº›ï¼Ÿç›‘æ§æ—¥æ´»åƒä¸‡çš„appï¼Œè®¾è®¡ç›‘æ§ä½“ç³»å’Œå…³æ³¨å“ªäº›æŒ‡æ ‡ï¼Ÿ
<a class=anchor href=#%e7%9b%91%e6%8e%a7%e5%92%8ccicd%e4%ba%86%e8%a7%a3%e5%93%aa%e4%ba%9b%e7%9b%91%e6%8e%a7%e6%97%a5%e6%b4%bb%e5%8d%83%e4%b8%87%e7%9a%84app%e8%ae%be%e8%ae%a1%e7%9b%91%e6%8e%a7%e4%bd%93%e7%b3%bb%e5%92%8c%e5%85%b3%e6%b3%a8%e5%93%aa%e4%ba%9b%e6%8c%87%e6%a0%87>#</a></h1><h2 id=ç›‘æ§æ—¥æ´»åƒä¸‡çº§-app-çš„ç›‘æ§ä½“ç³»è®¾è®¡><strong>ç›‘æ§æ—¥æ´»åƒä¸‡çº§ App çš„ç›‘æ§ä½“ç³»è®¾è®¡</strong>
<a class=anchor href=#%e7%9b%91%e6%8e%a7%e6%97%a5%e6%b4%bb%e5%8d%83%e4%b8%87%e7%ba%a7-app-%e7%9a%84%e7%9b%91%e6%8e%a7%e4%bd%93%e7%b3%bb%e8%ae%be%e8%ae%a1>#</a></h2><p>æ—¥æ´»åƒä¸‡çº§ App éœ€è¦æ„å»ºä¸€ä¸ª <strong>é«˜å¯ç”¨ã€ä½å»¶è¿Ÿã€å¯è§‚æµ‹æ€§å¼º</strong> çš„ç›‘æ§ä½“ç³»ï¼Œä»¥ä¿éšœç¨³å®šè¿è¡Œã€å¿«é€Ÿå‘ç°é—®é¢˜ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„ç›‘æ§è®¾è®¡æ–¹æ¡ˆï¼š</p><hr><h2 id=1-ç›‘æ§ä½“ç³»è®¾è®¡><strong>1. ç›‘æ§ä½“ç³»è®¾è®¡</strong>
<a class=anchor href=#1-%e7%9b%91%e6%8e%a7%e4%bd%93%e7%b3%bb%e8%ae%be%e8%ae%a1>#</a></h2><h3 id=1ç›‘æ§æ¶æ„><strong>ï¼ˆ1ï¼‰ç›‘æ§æ¶æ„</strong>
<a class=anchor href=#1%e7%9b%91%e6%8e%a7%e6%9e%b6%e6%9e%84>#</a></h3><p>ç›‘æ§ä½“ç³»ä¸€èˆ¬ç”± <strong>æ•°æ®é‡‡é›†ã€å­˜å‚¨ã€åˆ†æã€å‘Šè­¦</strong> å››ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š</p><ol><li><strong>æ•°æ®é‡‡é›†ï¼ˆAgent/SDK/Exporterï¼‰</strong><ul><li>ä¸šåŠ¡æŒ‡æ ‡ï¼šåŸ‹ç‚¹æ—¥å¿—ã€APMï¼ˆSkyWalkingã€Zipkinï¼‰</li><li>ç³»ç»Ÿç›‘æ§ï¼šPrometheus Node Exporterã€cAdvisor</li><li>æ—¥å¿—åˆ†æï¼šELKã€Fluentd</li><li>ç½‘ç»œç›‘æ§ï¼šPingã€Tracerouteã€NetFlow</li></ul></li><li><strong>æ•°æ®å­˜å‚¨</strong><ul><li><strong>æ—¶åºæ•°æ®åº“</strong>ï¼šPrometheusã€Thanosã€VictoriaMetrics</li><li><strong>æ—¥å¿—å­˜å‚¨</strong>ï¼šElasticsearchã€Loki</li><li><strong>APM åˆ†æ</strong>ï¼šSkyWalkingã€Jaeger</li></ul></li><li><strong>æ•°æ®åˆ†æ</strong><ul><li><strong>æŒ‡æ ‡æŸ¥è¯¢</strong>ï¼šGrafana</li><li><strong>å¼‚å¸¸æ£€æµ‹</strong>ï¼šAnomaly Detectionï¼ˆAI ç»“åˆ PromQLï¼‰</li></ul></li><li><strong>å‘Šè­¦æœºåˆ¶</strong><ul><li><strong>å®æ—¶å‘Šè­¦</strong>ï¼šPrometheus Alertmanagerã€ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€çŸ­ä¿¡</li><li><strong>è‡ªåŠ¨æ‰©ç¼©å®¹</strong>ï¼šHPAï¼ˆHorizontal Pod Autoscalerï¼‰</li><li><strong>æ™ºèƒ½æ•…éšœè¯Šæ–­</strong>ï¼šAI é¢„æµ‹ + æœºå™¨å­¦ä¹ </li></ul></li></ol><hr><h2 id=2-å…³é”®ç›‘æ§æŒ‡æ ‡><strong>2. å…³é”®ç›‘æ§æŒ‡æ ‡</strong>
<a class=anchor href=#2-%e5%85%b3%e9%94%ae%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87>#</a></h2><h3 id=1ä¸šåŠ¡å±‚ç›‘æ§><strong>ï¼ˆ1ï¼‰ä¸šåŠ¡å±‚ç›‘æ§</strong>
<a class=anchor href=#1%e4%b8%9a%e5%8a%a1%e5%b1%82%e7%9b%91%e6%8e%a7>#</a></h3><p>ğŸ’¡ ä¸šåŠ¡æŒ‡æ ‡èƒ½ç›´è§‚åæ˜  App è¿è¡Œæƒ…å†µï¼š</p><table><thead><tr><th>ç›‘æ§é¡¹</th><th>è¯´æ˜</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>DAUï¼ˆæ—¥æ´»ï¼‰</strong></td><td>æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°</td><td>ä½äºé¢„æœŸéœ€æ’æŸ¥ç”¨æˆ·æµå¤±åŸå› </td></tr><tr><td><strong>MAUï¼ˆæœˆæ´»ï¼‰</strong></td><td>æ¯æœˆæ´»è·ƒç”¨æˆ·æ•°</td><td>åæ˜ é•¿æœŸç”¨æˆ·è¶‹åŠ¿</td></tr><tr><td><strong>UV/PV</strong></td><td>è®¿é—®äººæ•°/é¡µé¢æµè§ˆé‡</td><td>ç›‘æ§ç”¨æˆ·è®¿é—®æƒ…å†µ</td></tr><tr><td><strong>ç•™å­˜ç‡</strong></td><td>N æ—¥ç•™å­˜ç‡</td><td>ç”¨æˆ·ç²˜æ€§ & è¥é”€æ•ˆæœ</td></tr><tr><td><strong>ç”¨æˆ·è¯·æ±‚é‡</strong></td><td>æ¯ç§’è¯·æ±‚æ•°ï¼ˆQPSï¼‰</td><td>çªå¢å¯èƒ½ DDoS æ”»å‡»æˆ–æ´»åŠ¨æµé‡æ¿€å¢</td></tr><tr><td><strong>å¹³å‡å“åº”æ—¶é—´ï¼ˆP99/P95ï¼‰</strong></td><td>ç”¨æˆ·è¯·æ±‚å¤„ç†æ—¶é—´</td><td>è¿‡é«˜è¯´æ˜ç³»ç»Ÿæˆ–æ•°æ®åº“æœ‰ç“¶é¢ˆ</td></tr><tr><td><strong>æ”¯ä»˜æˆåŠŸç‡</strong></td><td>è®¢å•æ”¯ä»˜æˆåŠŸç‡</td><td>ä½äºé¢„æœŸéœ€æ’æŸ¥æ”¯ä»˜æ¸ é“é—®é¢˜</td></tr><tr><td><strong>Crash ç‡</strong></td><td>App å´©æºƒç‡</td><td>å½±å“ç”¨æˆ·ä½“éªŒ</td></tr></tbody></table><hr><h3 id=2ç³»ç»Ÿå±‚ç›‘æ§><strong>ï¼ˆ2ï¼‰ç³»ç»Ÿå±‚ç›‘æ§</strong>
<a class=anchor href=#2%e7%b3%bb%e7%bb%9f%e5%b1%82%e7%9b%91%e6%8e%a7>#</a></h3><p>ğŸ’¡ ä¿éšœ App æœåŠ¡å™¨å’ŒåŸºç¡€è®¾æ–½ç¨³å®šï¼š</p><table><thead><tr><th>ç›‘æ§é¡¹</th><th>è¯´æ˜</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>CPU ä½¿ç”¨ç‡</strong></td><td>æœåŠ¡å™¨ CPU è´Ÿè½½</td><td>æŒç»­é«˜è´Ÿè½½å¯èƒ½å¯¼è‡´è¯·æ±‚é˜»å¡</td></tr><tr><td><strong>å†…å­˜å ç”¨ï¼ˆRSSã€OOMï¼‰</strong></td><td>è¿›ç¨‹å†…å­˜æ¶ˆè€—æƒ…å†µ</td><td>OOM å¯èƒ½å¯¼è‡´æœåŠ¡å¼‚å¸¸</td></tr><tr><td><strong>ç£ç›˜ IO & ç£ç›˜ç©ºé—´</strong></td><td>è¯»å†™é€Ÿç‡ & å‰©ä½™ç©ºé—´</td><td>é«˜ IO å¯èƒ½å½±å“æ•°æ®åº“æ€§èƒ½</td></tr><tr><td><strong>ç½‘ç»œæµé‡</strong></td><td>å‡ºå…¥å¸¦å®½ã€ä¸¢åŒ…ç‡ã€RTT</td><td>çªç„¶å‡é«˜å¯èƒ½æ˜¯æ”»å‡»æˆ–ç”¨æˆ·æ¿€å¢</td></tr><tr><td><strong>Pod å‰¯æœ¬æ•°</strong></td><td>Kubernetes Pod è¿è¡ŒçŠ¶æ€</td><td>Pod å¼‚å¸¸å‡å°‘è¯´æ˜ K8s å¯èƒ½æœ‰é—®é¢˜</td></tr><tr><td><strong>ä¾èµ–æœåŠ¡å¥åº·</strong></td><td>Redisã€Kafkaã€MySQLã€å¤–éƒ¨ API</td><td>ä¾èµ–å¼‚å¸¸å¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨</td></tr></tbody></table><hr><h3 id=3åº”ç”¨å±‚ç›‘æ§apm><strong>ï¼ˆ3ï¼‰åº”ç”¨å±‚ç›‘æ§ï¼ˆAPMï¼‰</strong>
<a class=anchor href=#3%e5%ba%94%e7%94%a8%e5%b1%82%e7%9b%91%e6%8e%a7apm>#</a></h3><p>ğŸ’¡ ç»“åˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼ˆSkyWalking/Jaegerï¼‰ï¼š</p><table><thead><tr><th>ç›‘æ§é¡¹</th><th>è¯´æ˜</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>æ¥å£å“åº”æ—¶é—´</strong></td><td>API å“åº”æ—¶é—´ï¼ˆP99/P95ï¼‰</td><td>å½±å“ç”¨æˆ·ä½“éªŒ</td></tr><tr><td><strong>æ•°æ®åº“æŸ¥è¯¢è€—æ—¶</strong></td><td>SQL æŸ¥è¯¢æ…¢æŸ¥è¯¢åˆ†æ</td><td>æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–</td></tr><tr><td><strong>HTTP çŠ¶æ€ç ï¼ˆ5xxã€4xxï¼‰</strong></td><td>HTTP é”™è¯¯æ¯”ä¾‹</td><td>5xx è¯´æ˜æœåŠ¡å™¨å¼‚å¸¸</td></tr><tr><td><strong>çº¿ç¨‹æ± ä½¿ç”¨æƒ…å†µ</strong></td><td>çº¿ç¨‹æ•°é‡ã€é˜»å¡ç‡</td><td>å½±å“ååé‡</td></tr><tr><td><strong>æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹</strong></td><td>Kafka/RabbitMQ é˜Ÿåˆ—é•¿åº¦</td><td>å½±å“æ•°æ®å¤„ç†é€Ÿåº¦</td></tr></tbody></table><hr><h3 id=4æ—¥å¿—--å¼‚å¸¸ç›‘æ§><strong>ï¼ˆ4ï¼‰æ—¥å¿— & å¼‚å¸¸ç›‘æ§</strong>
<a class=anchor href=#4%e6%97%a5%e5%bf%97--%e5%bc%82%e5%b8%b8%e7%9b%91%e6%8e%a7>#</a></h3><p>ğŸ’¡ é€šè¿‡ ELK æˆ– Loki ç›‘æ§æ—¥å¿—å¼‚å¸¸ï¼š</p><table><thead><tr><th>ç›‘æ§é¡¹</th><th>è¯´æ˜</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>é”™è¯¯æ—¥å¿—æ•°é‡</strong></td><td>æ¯ç§’äº§ç”Ÿçš„ ERROR çº§åˆ«æ—¥å¿—</td><td>çªå¢å¯èƒ½æ˜¯ bug</td></tr><tr><td><strong>OOM Kill è®°å½•</strong></td><td>è¿›ç¨‹è¢«æ€è®°å½•</td><td>å®¹å™¨å†…å­˜ä¸è¶³</td></tr><tr><td><strong>API è¶…æ—¶æ—¥å¿—</strong></td><td>API å“åº”è¶…æ—¶æƒ…å†µ</td><td>åç«¯å‹åŠ›è¿‡å¤§</td></tr><tr><td><strong>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—</strong></td><td>ç”¨æˆ·è¡Œä¸ºåˆ†æ</td><td>ç”¨æˆ·æµå¤±è¯Šæ–­</td></tr><tr><td><strong>æ”»å‡»è¡Œä¸ºæ—¥å¿—</strong></td><td>404/403/SQL æ³¨å…¥ç­‰æ”»å‡»è¡Œä¸º</td><td>å¯èƒ½æ˜¯å®‰å…¨æ¼æ´</td></tr></tbody></table><hr><h2 id=3-ç›‘æ§å·¥å…·é€‰å‹><strong>3. ç›‘æ§å·¥å…·é€‰å‹</strong>
<a class=anchor href=#3-%e7%9b%91%e6%8e%a7%e5%b7%a5%e5%85%b7%e9%80%89%e5%9e%8b>#</a></h2><table><thead><tr><th>ç›‘æ§ç±»å‹</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>ç³»ç»Ÿç›‘æ§</strong></td><td>Prometheus + Node Exporter</td></tr><tr><td><strong>æ—¥å¿—åˆ†æ</strong></td><td>ELK / Loki / Fluentd</td></tr><tr><td><strong>APMï¼ˆé“¾è·¯è¿½è¸ªï¼‰</strong></td><td>SkyWalking / Jaeger</td></tr><tr><td><strong>æ•°æ®åº“ç›‘æ§</strong></td><td>MySQL Exporterã€Redis Exporter</td></tr><tr><td><strong>å‘Šè­¦é€šçŸ¥</strong></td><td>Prometheus Alertmanager + é’‰é’‰/å¾®ä¿¡</td></tr></tbody></table><hr><h2 id=4-å‘Šè­¦ç­–ç•¥><strong>4. å‘Šè­¦ç­–ç•¥</strong>
<a class=anchor href=#4-%e5%91%8a%e8%ad%a6%e7%ad%96%e7%95%a5>#</a></h2><h3 id=1å‘Šè­¦åˆ†çº§><strong>ï¼ˆ1ï¼‰å‘Šè­¦åˆ†çº§</strong>
<a class=anchor href=#1%e5%91%8a%e8%ad%a6%e5%88%86%e7%ba%a7>#</a></h3><table><thead><tr><th>çº§åˆ«</th><th>å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><strong>ä¸¥é‡ï¼ˆS1ï¼‰</strong></td><td>å½±å“å…¨ç«™ï¼Œç«‹å³ç”µè¯é€šçŸ¥</td></tr><tr><td><strong>é«˜ï¼ˆS2ï¼‰</strong></td><td>å½±å“éƒ¨åˆ†ç”¨æˆ·ï¼Œ5 åˆ†é’Ÿå†…å¤„ç†</td></tr><tr><td><strong>ä¸­ï¼ˆS3ï¼‰</strong></td><td>å½±å“å°‘é‡ç”¨æˆ·ï¼Œ1 å°æ—¶å†…å¤„ç†</td></tr><tr><td><strong>ä½ï¼ˆS4ï¼‰</strong></td><td>å½±å“è¾ƒå°ï¼Œä¸šåŠ¡å›¢é˜Ÿè·Ÿè¿›</td></tr></tbody></table><h3 id=2è‡ªåŠ¨åŒ–è¿ç»´><strong>ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–è¿ç»´</strong>
<a class=anchor href=#2%e8%87%aa%e5%8a%a8%e5%8c%96%e8%bf%90%e7%bb%b4>#</a></h3><ul><li><strong>è‡ªæ„ˆæœºåˆ¶</strong>ï¼šPod OOM è‡ªåŠ¨é‡å¯ï¼ˆK8s HPAï¼‰</li><li><strong>æ‰©ç¼©å®¹</strong>ï¼šCPU / QPS è¶…é˜ˆå€¼æ—¶è‡ªåŠ¨æ‰©å®¹</li><li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šè‡ªåŠ¨è¯†åˆ«å¼‚å¸¸æ—¥å¿—ï¼Œé¢„æµ‹æ•…éšœ</li></ul><hr><h2 id=5-å…¸å‹æ•…éšœåœºæ™¯--å¤„ç†><strong>5. å…¸å‹æ•…éšœåœºæ™¯ & å¤„ç†</strong>
<a class=anchor href=#5-%e5%85%b8%e5%9e%8b%e6%95%85%e9%9a%9c%e5%9c%ba%e6%99%af--%e5%a4%84%e7%90%86>#</a></h2><table><thead><tr><th>æ•…éšœç±»å‹</th><th>å¯èƒ½åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>é«˜å¹¶å‘ QPS çªå¢</strong></td><td>æ´»åŠ¨æµé‡æ¿€å¢</td><td>å¢åŠ  Pod å‰¯æœ¬ã€å¼€å¯ç¼“å­˜</td></tr><tr><td><strong>æ•°æ®åº“æ…¢æŸ¥è¯¢</strong></td><td>SQL è¯­å¥æœªä¼˜åŒ–</td><td>å¢åŠ ç´¢å¼•ã€åˆ†åº“åˆ†è¡¨</td></tr><tr><td><strong>Redis è¿æ¥æ•°è¿‡é«˜</strong></td><td>è¿æ¥æœªå¤ç”¨</td><td>ä½¿ç”¨è¿æ¥æ± </td></tr><tr><td><strong>æœåŠ¡å™¨ CPU 100%</strong></td><td>GC é¢‘ç¹</td><td>è°ƒæ•´ JVM å‚æ•°</td></tr><tr><td><strong>æµé‡å¼‚å¸¸ä¸‹é™</strong></td><td>CDN/è´Ÿè½½å‡è¡¡å¼‚å¸¸</td><td>æ£€æŸ¥ Nginx/Ingress</td></tr><tr><td><strong>è¯·æ±‚å“åº”æ—¶é—´å˜é•¿</strong></td><td>API é™æµ</td><td>å¢åŠ å®ä¾‹æ•°</td></tr></tbody></table><hr><h2 id=æ€»ç»“-2><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-2>#</a></h2><ol><li><strong>å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»</strong>ï¼ˆé‡‡é›†ã€å­˜å‚¨ã€åˆ†æã€å‘Šè­¦ï¼‰</li><li><strong>è¦†ç›–ä¸šåŠ¡ã€ç³»ç»Ÿã€APMã€æ—¥å¿—ç­‰å¤šç»´åº¦</strong></li><li><strong>ä½¿ç”¨ Prometheusã€ELKã€SkyWalking è¿›è¡Œå…¨æ–¹ä½ç›‘æ§</strong></li><li><strong>é€šè¿‡ AI é¢„æµ‹å’Œè‡ªåŠ¨åŒ–è¿ç»´å‡å°‘äººå·¥å¹²é¢„</strong></li><li><strong>ç¡®ä¿å…³é”®æŒ‡æ ‡æœ‰åˆç†çš„å‘Šè­¦ç­–ç•¥</strong></li></ol><p>è¿™æ ·å¯ä»¥ <strong>å¿«é€Ÿå‘ç°é—®é¢˜ï¼Œä¿éšœ App çš„é«˜å¯ç”¨æ€§</strong> ğŸš€</p><h1 id=prometheus-oomæ€ä¹ˆè§£å†³çš„>prometheus oomæ€ä¹ˆè§£å†³çš„ï¼Ÿ
<a class=anchor href=#prometheus-oom%e6%80%8e%e4%b9%88%e8%a7%a3%e5%86%b3%e7%9a%84>#</a></h1><p>åœ¨ä½¿ç”¨ Prometheus è¿›è¡Œç›‘æ§æ—¶ï¼Œé‡åˆ° OOMï¼ˆOut Of Memoryï¼Œå†…å­˜æº¢å‡ºï¼‰é—®é¢˜å¯èƒ½æ˜¯ç”±äºå¤šç§åŸå› å¯¼è‡´çš„ï¼Œä¾‹å¦‚æ•°æ®é‡è¿‡å¤§ã€é…ç½®ä¸å½“ç­‰ã€‚ä»¥ä¸‹æ˜¯è§£å†³ Prometheus OOMé—®é¢˜çš„ä¸€äº›å¸¸è§æ–¹æ³•ï¼š</p><h3 id=1-å¢åŠ -prometheus-çš„å†…å­˜é™åˆ¶>1. <strong>å¢åŠ  Prometheus çš„å†…å­˜é™åˆ¶</strong>
<a class=anchor href=#1-%e5%a2%9e%e5%8a%a0-prometheus-%e7%9a%84%e5%86%85%e5%ad%98%e9%99%90%e5%88%b6>#</a></h3><ul><li><strong>æ–¹æ³•</strong>ï¼šé€šè¿‡è°ƒæ•´ Prometheus å¯åŠ¨å‚æ•°æ¥å¢åŠ å…¶å¯ç”¨çš„å†…å­˜ã€‚</li><li><strong>å‚æ•°</strong>ï¼š<code>--storage.tsdb.max-block-duration</code>ã€<code>--storage.tsdb.retention.time</code> ç­‰ã€‚</li><li><strong>å…·ä½“æ“ä½œ</strong>ï¼šå¯ä»¥é€šè¿‡åœ¨ Prometheus çš„å¯åŠ¨å‘½ä»¤ä¸­å¢åŠ å¦‚ <code>--storage.tsdb.retention.time=15d</code> æ¥é™åˆ¶æ•°æ®çš„ä¿ç•™æ—¶é—´ï¼Œå‡å°‘å†…å­˜å‹åŠ›ã€‚</li></ul><h3 id=2-è°ƒæ•´>2. <strong>è°ƒæ•´ <code>max-memory</code> é™åˆ¶</strong>
<a class=anchor href=#2-%e8%b0%83%e6%95%b4>#</a></h3><ul><li><p>Prometheus é»˜è®¤ä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜æ¥å­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ã€‚å¦‚æœä½ é‡åˆ° OOMï¼Œå¯ä»¥å¢åŠ  Prometheus å®¹å™¨çš„å†…å­˜é™åˆ¶ã€‚</p></li><li><p>æ–¹æ³•</p><p>ï¼šåœ¨ Kubernetes ä¸­å¯ä»¥é€šè¿‡é…ç½®èµ„æºè¯·æ±‚å’Œé™åˆ¶æ¥å¢åŠ å†…å­˜é™åˆ¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;4Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;8Gi&#34;</span>
</span></span></code></pre></div></li></ul><h3 id=3-å‡å°‘-prometheus-å­˜å‚¨æ•°æ®çš„é‡>3. <strong>å‡å°‘ Prometheus å­˜å‚¨æ•°æ®çš„é‡</strong>
<a class=anchor href=#3-%e5%87%8f%e5%b0%91-prometheus-%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae%e7%9a%84%e9%87%8f>#</a></h3><ul><li><p><strong>æ—¶é—´åºåˆ—ä¿ç•™ç­–ç•¥</strong>ï¼šè°ƒæ•´ <code>--storage.tsdb.retention.time</code>ï¼Œå‡å°‘ä¿ç•™çš„æ•°æ®é‡ï¼Œå¯ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</p></li><li><p>ç¤ºä¾‹</p><p>ï¼šå¯ä»¥å°†æ•°æ®çš„ä¿ç•™æ—¶é—´è®¾ç½®ä¸º 7 å¤©ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ 15 å¤©æˆ–æ›´é•¿ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--storage.tsdb.retention.time<span style=color:#f92672>=</span>7d
</span></span></code></pre></div></li></ul><h3 id=4-ä½¿ç”¨è¾ƒå°çš„>4. <strong>ä½¿ç”¨è¾ƒå°çš„ <code>scrape_interval</code></strong>
<a class=anchor href=#4-%e4%bd%bf%e7%94%a8%e8%be%83%e5%b0%8f%e7%9a%84>#</a></h3><ul><li><p><strong>é—®é¢˜</strong>ï¼šPrometheus åœ¨æ¯ä¸ª <code>scrape_interval</code> æ—¶é—´é—´éš”å†…æ‹‰å–ç›®æ ‡æ•°æ®ã€‚å¦‚æœ <code>scrape_interval</code> å¤ªçŸ­ï¼ŒPrometheus ä¼šé¢‘ç¹æŠ“å–æ•°æ®ï¼Œå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚</p></li><li><p>è§£å†³</p><p>ï¼šé€‚å½“å¢åŠ </p><pre tabindex=0><code>scrape_interval
</code></pre><p>ï¼Œä¾‹å¦‚å°†é»˜è®¤çš„</p><pre tabindex=0><code>15s
</code></pre><p>æ”¹ä¸º</p><pre tabindex=0><code>30s
</code></pre><p>æˆ–æ›´é•¿ï¼Œå‡å°‘æ¯æ¬¡æŠ“å–çš„æ•°æ®é‡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>30s</span>
</span></span></code></pre></div></li></ul><h3 id=5-ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢>5. <strong>ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢</strong>
<a class=anchor href=#5-%e4%bc%98%e5%8c%96%e6%95%b0%e6%8d%ae%e6%ba%90%e5%92%8c%e6%9f%a5%e8%af%a2>#</a></h3><ul><li><strong>é—®é¢˜</strong>ï¼šå¦‚æœä½ çš„æ•°æ®æºåŒ…å«å¤§é‡çš„æ•°æ®ç‚¹ï¼ŒPrometheus åœ¨è¿›è¡ŒèšåˆæŸ¥è¯¢æ—¶å¯èƒ½ä¼šå¯¼è‡´é«˜å†…å­˜å ç”¨ã€‚</li><li><strong>è§£å†³</strong>ï¼šä¼˜åŒ–æŸ¥è¯¢ï¼Œé¿å…åœ¨çŸ­æ—¶é—´å†…è¿›è¡Œå¤§é‡æ•°æ®çš„èšåˆï¼Œæˆ–è€…é€šè¿‡åˆ†æ®µæŸ¥è¯¢çš„æ–¹å¼å‡å°‘å†…å­˜ä½¿ç”¨ã€‚</li></ul><h3 id=6-å¯ç”¨>6. <strong>å¯ç”¨ <code>remote_write</code> å’Œå¤–éƒ¨å­˜å‚¨</strong>
<a class=anchor href=#6-%e5%90%af%e7%94%a8>#</a></h3><ul><li><p>å¦‚æœ Prometheus å†…å­˜ä½¿ç”¨è¾ƒé«˜ï¼Œå¯ä»¥å°†æ•°æ®é€šè¿‡ <code>remote_write</code> å‘é€åˆ°å¤–éƒ¨å­˜å‚¨ï¼Œå¦‚ Thanos æˆ– Cortexã€‚è¿™æ ·å¯ä»¥å°†å¤§é‡å†å²æ•°æ®ä» Prometheus ä¸­ç§»é™¤ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p></li><li><p>é…ç½®</p><p>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>remote_write</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://thanos-receiver:9201/api/v1/receive&#34;</span>
</span></span></code></pre></div></li></ul><h3 id=7-æé«˜-prometheus-æ€§èƒ½>7. <strong>æé«˜ Prometheus æ€§èƒ½</strong>
<a class=anchor href=#7-%e6%8f%90%e9%ab%98-prometheus-%e6%80%a7%e8%83%bd>#</a></h3><ul><li><p><strong>æ–¹æ³•</strong>ï¼šé€šè¿‡è°ƒæ•´ TSDBï¼ˆæ—¶é—´åºåˆ—æ•°æ®åº“ï¼‰ç›¸å…³çš„é…ç½®æ¥æå‡ Prometheus æ€§èƒ½ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</p></li><li><p>é…ç½®</p><p>ï¼šä¾‹å¦‚è°ƒæ•´</p><pre tabindex=0><code>--storage.tsdb.min-block-duration
</code></pre><p>æ¥å‡å°‘æ•°æ®å—çš„å¤§å°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--storage.tsdb.min-block-duration<span style=color:#f92672>=</span>2h
</span></span></code></pre></div></li></ul><h3 id=8-æ‰©å±•-prometheus-é›†ç¾¤>8. <strong>æ‰©å±• Prometheus é›†ç¾¤</strong>
<a class=anchor href=#8-%e6%89%a9%e5%b1%95-prometheus-%e9%9b%86%e7%be%a4>#</a></h3><ul><li><strong>æ–¹æ³•</strong>ï¼šåœ¨é«˜è´Ÿè½½ç¯å¢ƒä¸‹ï¼Œå¯ä»¥è€ƒè™‘å°† Prometheus æ‰©å±•ä¸ºé›†ç¾¤æ¨¡å¼ï¼Œä½¿ç”¨å¦‚ Thanos æˆ– Cortex ç­‰è§£å†³æ–¹æ¡ˆè¿›è¡Œæ°´å¹³æ‰©å±•ã€‚è¿™èƒ½æœ‰æ•ˆåœ°åˆ†æ•£è´Ÿè½½ï¼Œé¿å…å•ä¸ª Prometheus å®ä¾‹å†…å­˜æº¢å‡ºã€‚</li></ul><h3 id=æ€»ç»“-3>æ€»ç»“ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-3>#</a></h3><p>è§£å†³ Prometheus OOM é—®é¢˜é€šå¸¸éœ€è¦ä»å†…å­˜é…ç½®ã€æ•°æ®ä¿ç•™ç­–ç•¥ã€æŸ¥è¯¢ä¼˜åŒ–ã€å¤–éƒ¨å­˜å‚¨ç­‰æ–¹é¢å…¥æ‰‹ã€‚æ ¹æ®å®é™…çš„ç›‘æ§éœ€æ±‚ï¼Œåˆç†è°ƒæ•´è¿™äº›é…ç½®ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å†…å­˜æº¢å‡ºï¼Œå¹¶æå‡ Prometheus çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><p>Prometheus è”é‚¦ï¼ˆFederationï¼‰æ˜¯ Prometheus ç›‘æ§ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œæ—¨åœ¨å¸®åŠ©è§£å†³å¤§è§„æ¨¡ç›‘æ§é›†ç¾¤ä¸­çš„æ•°æ®èšåˆé—®é¢˜ï¼Œå°¤å…¶æ˜¯å½“å¤šä¸ª Prometheus å®ä¾‹ï¼ˆæˆ–é›†ç¾¤ï¼‰éœ€è¦æ±‡æ€»åˆ°ä¸€ä¸ªä¸­å¤® Prometheus å®ä¾‹æ—¶ã€‚é€šè¿‡è”é‚¦ï¼Œæ‚¨å¯ä»¥è·¨å¤šä¸ª Prometheus å®ä¾‹æ”¶é›†å’Œèšåˆæ•°æ®ï¼Œä»è€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°é›†ä¸­ç›‘æ§ã€‚</p><h3 id=prometheus-è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ><strong>Prometheus è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ</strong>
<a class=anchor href=#prometheus-%e8%81%94%e9%82%a6%e7%9a%84%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5>#</a></h3><p>Prometheus è”é‚¦æ˜¯ä¸€ç§å°†ä¸€ä¸ª Prometheus å®ä¾‹çš„æ•°æ®æš´éœ²ç»™å¦ä¸€ä¸ª Prometheus å®ä¾‹çš„æœºåˆ¶ã€‚ä¸­å¤® Prometheus å®ä¾‹å¯ä»¥å®šæœŸä»å…¶ä»– Prometheus å®ä¾‹æŠ“å–æ•°æ®ï¼ˆscrapeï¼‰ï¼Œä»è€Œå®ç°è·¨ Prometheus å®ä¾‹çš„æ•°æ®æ±‡èšå’ŒæŸ¥è¯¢ã€‚</p><h3 id=è”é‚¦çš„å·¥ä½œåŸç†><strong>è”é‚¦çš„å·¥ä½œåŸç†</strong>
<a class=anchor href=#%e8%81%94%e9%82%a6%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86>#</a></h3><ol><li><strong>æ•°æ®é‡‡é›†ï¼ˆScrapingï¼‰</strong>ï¼š<ul><li>æ¯ä¸ª Prometheus å®ä¾‹éƒ½ä¼šæ”¶é›†è‡ªå·±æ‰€åœ¨åŒºåŸŸçš„ç›‘æ§æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æœ¬åœ°çš„ TSDBï¼ˆæ—¶é—´åºåˆ—æ•°æ®åº“ï¼‰ä¸­ã€‚</li><li>ä¸­å¤® Prometheus å®ä¾‹ï¼ˆå³ä¸» Prometheus å®ä¾‹ï¼‰é…ç½®ä¸ºå®šæœŸä»å„ä¸ªå­ Prometheus å®ä¾‹æŠ“å–æ•°æ®ã€‚è¿™äº›æ•°æ®é€šå¸¸æ˜¯é€šè¿‡ HTTP è®¿é—®æš´éœ²å‡ºæ¥çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚</li></ul></li><li><strong>æ•°æ®èšåˆ</strong>ï¼š<ul><li>è”é‚¦å…è®¸ä¸­å¤® Prometheus å®ä¾‹é€šè¿‡å‘å…¶ä»– Prometheus å®ä¾‹å‘é€æŠ“å–è¯·æ±‚æ¥æ±‡æ€»æ•°æ®ã€‚æ¯ä¸ª Prometheus å®ä¾‹å¯ä»¥ä½œä¸ºä¸€ä¸ªâ€œå­é›†â€ï¼Œå°†éƒ¨åˆ†æ•°æ®æš´éœ²ç»™ä¸» Prometheus å®ä¾‹ã€‚</li><li>è¢«æŠ“å–çš„æ•°æ®å¯ä»¥åŒ…æ‹¬æ—¶é—´åºåˆ—æ•°æ®ã€æŒ‡æ ‡æ•°æ®ã€Alertmanager é…ç½®ç­‰ã€‚</li></ul></li><li><strong>å­˜å‚¨å’ŒæŸ¥è¯¢</strong>ï¼š<ul><li>ä¸­å¤® Prometheus å®ä¾‹å¯ä»¥å­˜å‚¨æ¥è‡ªä¸åŒ Prometheus å®ä¾‹çš„æ•°æ®ï¼Œå¹¶å¯ä»¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œç»Ÿä¸€çš„æŸ¥è¯¢å’Œåˆ†æã€‚</li><li>ä½¿ç”¨ <code>Prometheus</code> æŸ¥è¯¢è¯­è¨€ï¼ˆPromQLï¼‰æ—¶ï¼Œä¸­å¤® Prometheus å®ä¾‹å¯ä»¥å¯¹æ‰€æœ‰è”é‚¦çš„ Prometheus å®ä¾‹çš„æ•°æ®è¿›è¡ŒèšåˆæŸ¥è¯¢ã€‚</li></ul></li></ol><h3 id=è”é‚¦çš„å…¸å‹ç”¨é€”><strong>è”é‚¦çš„å…¸å‹ç”¨é€”</strong>
<a class=anchor href=#%e8%81%94%e9%82%a6%e7%9a%84%e5%85%b8%e5%9e%8b%e7%94%a8%e9%80%94>#</a></h3><ol><li><strong>è·¨æ•°æ®ä¸­å¿ƒçš„æ•°æ®æ±‡èš</strong>ï¼š<ul><li>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–è€…å¤šä¸ªç‹¬ç«‹çš„ Prometheus å®ä¾‹è¿è¡Œåœ¨ä¸åŒçš„åœ°ç†ä½ç½®ã€‚é€šè¿‡è”é‚¦ï¼Œå¯ä»¥å°†æ‰€æœ‰è¿™äº›å®ä¾‹çš„æ•°æ®æ±‡èšåˆ°ä¸€ä¸ªä¸­å¤®å®ä¾‹ï¼Œä»¥ä¾¿ç»Ÿä¸€ç›‘æ§å’ŒæŠ¥è­¦ã€‚</li></ul></li><li><strong>è·¨é›†ç¾¤ç›‘æ§</strong>ï¼š<ul><li>åœ¨ Kubernetes ç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªé›†ç¾¤ï¼Œä¸”æ¯ä¸ªé›†ç¾¤éƒ½æœ‰è‡ªå·±çš„ Prometheus å®ä¾‹ã€‚é€šè¿‡ Prometheus è”é‚¦ï¼Œæ‚¨å¯ä»¥ä»å„ä¸ªé›†ç¾¤çš„ Prometheus å®ä¾‹æŠ“å–æ•°æ®ï¼Œå¹¶é›†ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚</li></ul></li><li><strong>åˆ†å±‚æ¶æ„</strong>ï¼š<ul><li>ä½¿ç”¨è”é‚¦å¯ä»¥å®ç°åˆ†å±‚ç›‘æ§æ¶æ„ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§å‹ä¼ä¸šç¯å¢ƒä¸­ï¼Œå¯ä»¥é€šè¿‡è”é‚¦å°†å­é›†ç¾¤çš„æ•°æ®æš´éœ²ç»™æ€»éƒ¨çš„ä¸­å¤® Prometheus å®ä¾‹ï¼Œæ–¹ä¾¿è¿›è¡Œæ±‡æ€»ã€æŠ¥è­¦å’Œå…¨å±€æŸ¥è¯¢ã€‚</li></ul></li><li><strong>å±€éƒ¨æ•°æ®å­˜å‚¨ä¸æŸ¥è¯¢</strong>ï¼š<ul><li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¸Œæœ›åœ¨æœ¬åœ° Prometheus å®ä¾‹ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢ç‰¹å®šçš„ã€ä¸è¯¥åŒºåŸŸç›¸å…³çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œè€Œå°†æŸäº›è·¨åŒºåŸŸçš„æ•°æ®èšåˆåˆ°ä¸­å¤® Prometheus å®ä¾‹ã€‚</li></ul></li></ol><h3 id=prometheus-è”é‚¦çš„é…ç½®><strong>Prometheus è”é‚¦çš„é…ç½®</strong>
<a class=anchor href=#prometheus-%e8%81%94%e9%82%a6%e7%9a%84%e9%85%8d%e7%bd%ae>#</a></h3><p>Prometheus è”é‚¦çš„é…ç½®å®é™…ä¸Šæ˜¯å°†ä¸€ä¸ª Prometheus å®ä¾‹é…ç½®ä¸ºä»å¦ä¸€ä¸ª Prometheus å®ä¾‹æŠ“å–æ•°æ®ã€‚è¿™å¯ä»¥é€šè¿‡ <code>scrape_config</code> æ¥é…ç½®ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;federation&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>metrics_path</span>: <span style=color:#e6db74>&#39;/federate&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#39;match[]&#39;</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;{job=&#34;kubernetes-cadvisor&#34;}&#39;</span>  <span style=color:#75715e># åªæŠ“å–ç‰¹å®šçš„æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;prometheus-server-1:9090&#39;</span>
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;prometheus-server-2:9090&#39;</span>
</span></span></code></pre></div><h3 id=å…³é”®å‚æ•°è§£é‡Š><strong>å…³é”®å‚æ•°è§£é‡Š</strong>
<a class=anchor href=#%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e8%a7%a3%e9%87%8a>#</a></h3><ul><li><strong><code>metrics_path: /federate</code></strong>ï¼šè¿™æ˜¯ Prometheus è”é‚¦è¯·æ±‚çš„è·¯å¾„ï¼ŒPrometheus ä¼šä»å…¶ä»–å®ä¾‹çš„ <code>/federate</code> è·¯å¾„æ‹‰å–æ•°æ®ã€‚</li><li><strong><code>params</code></strong>ï¼šä½¿ç”¨ <code>match[]</code> å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šè¦æŠ“å–çš„æŒ‡æ ‡çš„è¿‡æ»¤æ¡ä»¶ã€‚è¿™æ ·å¯ä»¥åªæŠ“å–ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œé¿å…æŠ“å–ä¸å¿…è¦çš„æ•°æ®ã€‚</li><li><strong><code>targets</code></strong>ï¼šæŒ‡å®šä»å“ªäº› Prometheus å®ä¾‹æŠ“å–æ•°æ®ï¼Œå¯ä»¥åˆ—å‡ºå¤šä¸ª Prometheus å®ä¾‹ã€‚</li></ul><h3 id=ä¼˜åŠ¿><strong>ä¼˜åŠ¿</strong>
<a class=anchor href=#%e4%bc%98%e5%8a%bf>#</a></h3><ol><li><strong>é›†ä¸­ç®¡ç†</strong>ï¼šé€šè¿‡è”é‚¦ï¼Œå¯ä»¥å®ç°è·¨å¤šä¸ª Prometheus å®ä¾‹çš„æ•°æ®æ±‡æ€»å’Œé›†ä¸­æŸ¥è¯¢ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†ã€‚</li><li><strong>é«˜å¯æ‰©å±•æ€§</strong>ï¼šéšç€ç›‘æ§çš„æ‰©å±•ï¼Œæ–°çš„ Prometheus å®ä¾‹å¯ä»¥å¾ˆå®¹æ˜“åœ°åŠ å…¥è”é‚¦ï¼Œæ•°æ®ä¼šè‡ªåŠ¨è¢«é›†æˆã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥çµæ´»åœ°é€‰æ‹©å“ªäº›æ•°æ®éœ€è¦é›†ä¸­å­˜å‚¨ï¼Œå“ªäº›æ•°æ®åœ¨æœ¬åœ°å¤„ç†ã€‚</li><li><strong>åˆ†å¸ƒå¼æ¶æ„æ”¯æŒ</strong>ï¼šæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒã€è·¨é›†ç¾¤çš„åˆ†å¸ƒå¼ç›‘æ§ã€‚</li></ol><h3 id=é™åˆ¶å’ŒæŒ‘æˆ˜><strong>é™åˆ¶å’ŒæŒ‘æˆ˜</strong>
<a class=anchor href=#%e9%99%90%e5%88%b6%e5%92%8c%e6%8c%91%e6%88%98>#</a></h3><ol><li><strong>å­˜å‚¨é™åˆ¶</strong>ï¼šè”é‚¦æ•°æ®ä¼šå¢åŠ ä¸­å¤® Prometheus å®ä¾‹çš„å­˜å‚¨éœ€æ±‚ã€‚éœ€è¦é…ç½®åˆé€‚çš„å­˜å‚¨å’Œå¤„ç†ç­–ç•¥ã€‚</li><li><strong>æŸ¥è¯¢å¤æ‚æ€§</strong>ï¼šè”é‚¦çš„ Prometheus å®ä¾‹é—´çš„æŸ¥è¯¢å¯èƒ½ä¼šå¼•å…¥ä¸€å®šçš„å»¶è¿Ÿï¼Œå› ä¸ºéœ€è¦ä»å¤šä¸ªå®ä¾‹æŠ“å–æ•°æ®å¹¶è¿›è¡Œæ±‡æ€»ã€‚</li><li><strong>ç»´æŠ¤å’Œç®¡ç†</strong>ï¼šéšç€ Prometheus å®ä¾‹çš„å¢åŠ ï¼Œè”é‚¦ç®¡ç†å¯èƒ½ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹ç¯å¢ƒä¸­ã€‚</li></ol><h3 id=æ€»ç»“-4><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-4>#</a></h3><p>Prometheus è”é‚¦æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆæ¥æ‰©å±• Prometheus ç›‘æ§ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åœ¨è·¨å¤šä¸ªé›†ç¾¤ã€æ•°æ®ä¸­å¿ƒæˆ–åŒºåŸŸçš„ç¯å¢ƒä¸­ã€‚é€šè¿‡åˆç†é…ç½®è”é‚¦ï¼Œå¯ä»¥å®ç°å¤§è§„æ¨¡çš„ç›‘æ§æ•°æ®æ±‡èšå’Œç»Ÿä¸€æŸ¥è¯¢ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦è€ƒè™‘æ€§èƒ½å’Œå­˜å‚¨ç­‰æ–¹é¢çš„æŒ‘æˆ˜ã€‚</p><h1 id=ç”¨ansibleéƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤æ€ä¹ˆä¿è¯play-bookçš„å¹‚ç­‰æ€§å’Œå®‰å…¨æ€§>ç”¨ansibleéƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤ï¼Ÿæ€ä¹ˆä¿è¯play-bookçš„å¹‚ç­‰æ€§å’Œå®‰å…¨æ€§ï¼Ÿ
<a class=anchor href=#%e7%94%a8ansible%e9%83%a8%e7%bd%b2%e4%ba%8c%e8%bf%9b%e5%88%b6%e9%9b%86%e7%be%a4%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81play-book%e7%9a%84%e5%b9%82%e7%ad%89%e6%80%a7%e5%92%8c%e5%ae%89%e5%85%a8%e6%80%a7>#</a></h1><p>ä½¿ç”¨ <strong>Ansible</strong> éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™ playbook æ¥ç®¡ç†é›†ç¾¤çš„å®‰è£…ã€é…ç½®ã€æ›´æ–°ç­‰æ“ä½œã€‚ä¸ºäº†ç¡®ä¿ <strong>å¹‚ç­‰æ€§</strong> å’Œ <strong>å®‰å…¨æ€§</strong>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ playbook ä¸­éµå¾ªä¸€äº›æœ€ä½³å®è·µï¼Œç¡®ä¿æ¯æ¬¡è¿è¡Œæ—¶ç»“æœä¸€è‡´ï¼ŒåŒæ—¶é¿å…æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</p><h3 id=éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤><strong>éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e9%83%a8%e7%bd%b2%e4%ba%8c%e8%bf%9b%e5%88%b6%e9%9b%86%e7%be%a4%e7%9a%84%e6%ad%a5%e9%aa%a4>#</a></h3><p>å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨ Ansible éƒ¨ç½²ä¸€ä¸ªåŸºäºäºŒè¿›åˆ¶å®‰è£…çš„ <strong>Kubernetes é›†ç¾¤</strong>ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><h4 id=1-å‡†å¤‡å·¥ä½œ>1. <strong>å‡†å¤‡å·¥ä½œ</strong>
<a class=anchor href=#1-%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c>#</a></h4><ul><li>å…ˆç¡®ä¿æ¯å°èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç¬¦åˆè¦æ±‚ï¼Œä¸”èƒ½é€šè¿‡ SSH è®¿é—®ã€‚</li><li>å°†éœ€è¦éƒ¨ç½²çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ <code>kubeadm</code>ã€<code>kubelet</code>ã€<code>kubectl</code>ï¼‰ä¸Šä¼ åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</li></ul><h4 id=2-ansible-playbook-ç¤ºä¾‹>2. <strong>Ansible Playbook ç¤ºä¾‹</strong>
<a class=anchor href=#2-ansible-playbook-%e7%a4%ba%e4%be%8b>#</a></h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ playbook ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡ Ansible åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½² Kubernetes äºŒè¿›åˆ¶é›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy Kubernetes Cluster</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>k8s_nodes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure the necessary directories exist</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#34;{{ item }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>state</span>: <span style=color:#ae81ff>directory</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0755&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>loop</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/etc/kubernetes</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/etc/kubernetes/manifests</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/var/lib/kubelet</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>/var/lib/kubernetes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Copy kubeadm, kubelet, and kubectl binaries</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>copy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;/path/to/binaries/{{ item }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>dest</span>: <span style=color:#e6db74>&#34;/usr/local/bin/{{ item }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0755&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>loop</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>kubeadm</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>kubelet</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>kubectl</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>notify</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>restart kubelet</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Initialize Kubernetes master using kubeadm</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: <span style=color:#ae81ff>kubeadm init --pod-network-cidr=10.244.0.0/16</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>when</span>: <span style=color:#ae81ff>inventory_hostname == groups[&#39;k8s_master&#39;][0]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>register</span>: <span style=color:#ae81ff>kubeadm_init_output</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set up kubeconfig for the master node</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>copy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>src</span>: <span style=color:#e6db74>&#34;/etc/kubernetes/admin.conf&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>dest</span>: <span style=color:#e6db74>&#34;~/.kube/config&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>remote_src</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>when</span>: <span style=color:#ae81ff>inventory_hostname == groups[&#39;k8s_master&#39;][0]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Apply CNI network plugin (flannel)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: <span style=color:#ae81ff>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>when</span>: <span style=color:#ae81ff>inventory_hostname == groups[&#39;k8s_master&#39;][0]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Join the worker nodes to the cluster</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: <span style=color:#e6db74>&#34;{{ kubeadm_init_output.stdout_lines[0] | regex_replace(&#39;.*(kubeadm join.*)&#39;, &#39;\\1&#39;) }}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>when</span>: <span style=color:#ae81ff>inventory_hostname != groups[&#39;k8s_master&#39;][0]</span>
</span></span></code></pre></div><h3 id=ä¿è¯-playbook-çš„å¹‚ç­‰æ€§><strong>ä¿è¯ Playbook çš„å¹‚ç­‰æ€§ï¼š</strong>
<a class=anchor href=#%e4%bf%9d%e8%af%81-playbook-%e7%9a%84%e5%b9%82%e7%ad%89%e6%80%a7>#</a></h3><p>Ansible çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€å°±æ˜¯ <strong>å¹‚ç­‰æ€§</strong>ï¼Œå®ƒæ„å‘³ç€å½“ä½ å¤šæ¬¡è¿è¡ŒåŒä¸€ä¸ª playbook æ—¶ï¼Œç»“æœæ˜¯ç›¸åŒçš„ï¼Œä¸ä¼šå¯¹ç³»ç»Ÿåšä¸å¿…è¦çš„æ›´æ”¹ã€‚ä¸ºäº†ä¿è¯ playbook çš„å¹‚ç­‰æ€§ï¼Œéœ€è¦ï¼š</p><ol><li><p><strong>æ£€æŸ¥èµ„æºçš„å½“å‰çŠ¶æ€</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>state</code> å‚æ•°æ¥æŒ‡å®šç›®æ ‡èµ„æºçš„çŠ¶æ€ï¼ˆå¦‚ï¼š<code>file</code>ã€<code>service</code> æ¨¡å—ï¼‰ã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨éƒ¨ç½² Kubernetes äºŒè¿›åˆ¶æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿æ–‡ä»¶å·²å­˜åœ¨ä¸”ä¸ºæ­£ç¡®çš„ç‰ˆæœ¬ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨é€‚å½“çš„ Ansible æ¨¡å—</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>file</code>ã€<code>copy</code>ã€<code>yum</code>ã€<code>apt</code> ç­‰æ¨¡å—æ—¶ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ£€æŸ¥ç›®æ ‡çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ç›®æ ‡å·²è¾¾åˆ°æœŸæœ›çŠ¶æ€æ—¶ï¼Œä¸ä¼šå†æ¬¡æ‰§è¡Œã€‚</li><li>ä¾‹å¦‚ï¼Œ<code>copy</code> æ¨¡å—ä¼šåœ¨æ–‡ä»¶å·²ç»å­˜åœ¨å¹¶ä¸”å†…å®¹ä¸€è‡´æ—¶è·³è¿‡æ–‡ä»¶çš„å¤åˆ¶ã€‚</li></ul></li><li><p><strong>é¿å…å†—ä½™æ“ä½œ</strong>ï¼š</p><ul><li>åœ¨ <code>command</code> æˆ– <code>shell</code> æ¨¡å—ä¸­ï¼Œç¡®ä¿å‘½ä»¤ä¸ä¼šé‡å¤æ‰§è¡Œï¼Œæˆ–è€…åœ¨æ¡ä»¶æ»¡è¶³æ—¶æ‰æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰§è¡Œ <code>kubeadm init</code> æ—¶ï¼Œåªåœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚</li></ul></li><li><p><strong>é…ç½®æ–‡ä»¶å˜æ›´</strong>ï¼š</p><ul><li>å¯¹äºéœ€è¦æ›´æ”¹é…ç½®æ–‡ä»¶çš„æ“ä½œï¼ˆä¾‹å¦‚ Kubernetes é…ç½®æ–‡ä»¶ã€ç³»ç»Ÿå‚æ•°ç­‰ï¼‰ï¼Œç¡®ä¿ä½¿ç”¨ <code>lineinfile</code> æˆ– <code>template</code> æ¨¡å—ï¼Œè¿™äº›æ¨¡å—ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»æŒ‰é¢„æœŸé…ç½®ï¼Œé¿å…é‡å¤ä¿®æ”¹ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Ensure kubelet service is enabled and running</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kubelet</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>started</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div></li></ol><h4 id=å¹‚ç­‰æ€§ç›¸å…³æ¨¡å—ç¤ºä¾‹><strong>å¹‚ç­‰æ€§ç›¸å…³æ¨¡å—ç¤ºä¾‹ï¼š</strong>
<a class=anchor href=#%e5%b9%82%e7%ad%89%e6%80%a7%e7%9b%b8%e5%85%b3%e6%a8%a1%e5%9d%97%e7%a4%ba%e4%be%8b>#</a></h4><ul><li><strong>file</strong> æ¨¡å—ï¼šç¡®ä¿æ–‡ä»¶å’Œç›®å½•çš„çŠ¶æ€ï¼Œå¦‚æƒé™ã€å­˜åœ¨ä¸å¦ã€‚</li><li><strong>copy</strong> æ¨¡å—ï¼šç¡®ä¿æ–‡ä»¶åªè¢«å¤åˆ¶ä¸€æ¬¡ï¼Œä¸”å†…å®¹ä¸€è‡´ã€‚</li><li><strong>template</strong> æ¨¡å—ï¼šä½¿ç”¨ Jinja2 æ¨¡æ¿æ¥ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿å†…å®¹ä¸€è‡´ã€‚</li><li><strong>service</strong> æ¨¡å—ï¼šç¡®ä¿æœåŠ¡å¯åŠ¨ã€åœæ­¢å’Œå¯ç”¨çš„çŠ¶æ€ã€‚</li><li><strong>lineinfile</strong> æ¨¡å—ï¼šç¡®ä¿æ–‡ä»¶ä¸­æŸè¡Œæ˜¯å­˜åœ¨çš„æˆ–è¢«ä¿®æ”¹ä¸ºæŒ‡å®šçš„å†…å®¹ã€‚</li></ul><h3 id=ä¿è¯-playbook-çš„å®‰å…¨æ€§><strong>ä¿è¯ Playbook çš„å®‰å…¨æ€§ï¼š</strong>
<a class=anchor href=#%e4%bf%9d%e8%af%81-playbook-%e7%9a%84%e5%ae%89%e5%85%a8%e6%80%a7>#</a></h3><ol><li><p><strong>é¿å…ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯</strong>ï¼š</p><ul><li>åœ¨ playbook ä¸­é¿å…ç›´æ¥å†™å…¥æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€å¯†é’¥ç­‰ã€‚å¯ä»¥é€šè¿‡ <strong>Ansible Vault</strong> æ¥åŠ å¯†æ•æ„Ÿä¿¡æ¯ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-vault create secrets.yml
</span></span></code></pre></div><p>ç„¶ååœ¨ playbook ä¸­å¼•ç”¨è¿™ä¸ªæ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy Kubernetes Cluster</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vars_files</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>secrets.yml</span>
</span></span></code></pre></div></li><li><p><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>become: true</code> æå‡æƒé™æ—¶ï¼Œç¡®ä¿åªåœ¨å¿…è¦çš„ä»»åŠ¡ä¸­ä½¿ç”¨ <code>sudo</code> æƒé™ï¼Œä¸è¦åœ¨æ‰€æœ‰ä»»åŠ¡ä¸­éƒ½æå‡æƒé™ã€‚</li><li>ä½¿ç”¨é€‚å½“çš„ç”¨æˆ·å’Œç»„æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç¡®ä¿ä¸ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚</li></ul></li><li><p><strong>ç¡®ä¿æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ</strong>ï¼š</p><ul><li>é€šè¿‡ Ansible çš„ <code>file</code> æ¨¡å—ç¡®ä¿é…ç½®æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™å’Œæ‰€æœ‰æƒç¬¦åˆå®‰å…¨è¦æ±‚ï¼Œé¿å…æ–‡ä»¶è¢«æœªæˆæƒç”¨æˆ·è®¿é—®ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set permissions on kubeconfig</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#34;~/.kube/config&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>owner</span>: <span style=color:#e6db74>&#34;{{ ansible_user }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#34;{{ ansible_user }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0600&#34;</span>
</span></span></code></pre></div></li><li><p><strong>å®‰å…¨çš„ç½‘ç»œé…ç½®</strong>ï¼š</p><ul><li>åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œç½‘ç»œé…ç½®æ˜¯å®‰å…¨çš„å…³é”®ã€‚ç¡®ä¿åªæœ‰å…è®¸çš„ IP åœ°å€èƒ½è®¿é—® Kubernetes API æœåŠ¡å™¨ç­‰å…³é”®ç»„ä»¶ï¼Œä½¿ç”¨ <code>firewalld</code> æˆ– <code>iptables</code> é…ç½®ç½‘ç»œé˜²ç«å¢™è§„åˆ™ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®</strong>ï¼š</p><ul><li>ä½¿ç”¨ Ansible æ¥ç®¡ç†é˜²ç«å¢™è§„åˆ™ï¼Œç¡®ä¿åªæœ‰å—ä¿¡ä»»çš„ä¸»æœºå¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„å…³é”®ç«¯å£ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Allow access to Kubernetes API server</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ufw</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>rule</span>: <span style=color:#ae81ff>allow</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Kubernetes API&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>6443</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proto</span>: <span style=color:#ae81ff>tcp</span>
</span></span></code></pre></div></li><li><p><strong>ä¿æŒè½¯ä»¶æ›´æ–°</strong>ï¼š</p><ul><li>å®šæœŸæ›´æ–° Kubernetes ç»„ä»¶å’Œä¾èµ–é¡¹ï¼Œä»¥é¿å…å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚</li></ul></li></ol><p>é€šè¿‡éµå¾ªä»¥ä¸Šå®è·µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <strong>Ansible</strong> éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤ï¼Œå¹¶ç¡®ä¿ playbook å…·æœ‰å¹‚ç­‰æ€§å’Œå®‰å…¨æ€§ã€‚</p><h1 id=ä¸šåŠ¡è¦å®ç°ç°åº¦å‘å¸ƒæ€ä¹ˆè®¾è®¡æµæ°´çº¿>ä¸šåŠ¡è¦å®ç°ç°åº¦å‘å¸ƒï¼Ÿæ€ä¹ˆè®¾è®¡æµæ°´çº¿ï¼Ÿ
<a class=anchor href=#%e4%b8%9a%e5%8a%a1%e8%a6%81%e5%ae%9e%e7%8e%b0%e7%81%b0%e5%ba%a6%e5%8f%91%e5%b8%83%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1%e6%b5%81%e6%b0%b4%e7%ba%bf>#</a></h1><p>ç°åº¦å‘å¸ƒï¼ˆGray Releaseï¼‰æ˜¯ä¸€ç§é€æ­¥å‘å¸ƒæ–°ç‰ˆæœ¬çš„ç­–ç•¥ï¼Œé€šè¿‡æ§åˆ¶æ–°ç‰ˆæœ¬çš„å‘å¸ƒèŒƒå›´å’Œç”¨æˆ·ç¾¤ä½“ï¼Œç¡®ä¿åœ¨å‘ç°é—®é¢˜æ—¶èƒ½å¤Ÿå¿«é€Ÿå›æ»šï¼Œé¿å…å…¨é‡å‘å¸ƒçš„é£é™©ã€‚åœ¨å®æ–½ç°åº¦å‘å¸ƒæ—¶ï¼ŒCI/CD æµæ°´çº¿çš„è®¾è®¡éœ€è¦ä¿è¯å¯ä»¥çµæ´»åœ°æ§åˆ¶ç‰ˆæœ¬çš„å‘å¸ƒèŒƒå›´ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸ä¸åŒçš„ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚</p><h3 id=ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯><strong>ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯</strong>
<a class=anchor href=#%e7%81%b0%e5%ba%a6%e5%8f%91%e5%b8%83%e6%b5%81%e6%b0%b4%e7%ba%bf%e8%ae%be%e8%ae%a1%e6%80%9d%e8%b7%af>#</a></h3><ol><li><strong>åˆ†é˜¶æ®µå‘å¸ƒ</strong>ï¼š ç°åº¦å‘å¸ƒé€šå¸¸ä¼šåˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œä»æœ€å°çš„ç”¨æˆ·ç¾¤ä½“å¼€å§‹ï¼Œé€æ­¥æ‰©å¤§åˆ°å…¨ä½“ç”¨æˆ·ã€‚åœ¨æµæ°´çº¿è®¾è®¡ä¸Šï¼Œéœ€è¦æ”¯æŒé€æ­¥å‘å¸ƒçš„è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼š<ul><li><strong>é˜¶æ®µ1</strong>ï¼šä»…åœ¨å†…éƒ¨æˆ–å¼€å‘ç¯å¢ƒä¸­å‘å¸ƒã€‚</li><li><strong>é˜¶æ®µ2</strong>ï¼šå°èŒƒå›´çš„çœŸå®ç”¨æˆ·ç¾¤ä½“ï¼ˆä¾‹å¦‚ï¼Œ10%çš„ç”Ÿäº§æµé‡ï¼‰ã€‚</li><li><strong>é˜¶æ®µ3</strong>ï¼šå…¨é‡å‘å¸ƒç»™æ‰€æœ‰ç”¨æˆ·ã€‚</li></ul></li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š ç°åº¦å‘å¸ƒé€šå¸¸æ¶‰åŠå¤šä¸ªç‰ˆæœ¬çš„å¹¶å­˜ï¼Œéœ€è¦æµæ°´çº¿æ”¯æŒä¸åŒç‰ˆæœ¬çš„éƒ¨ç½²ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åŒæ—¶éƒ¨ç½²æ—§ç‰ˆæœ¬å’Œæ–°ç‰ˆæœ¬ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬èƒ½å¤Ÿä¸æ—§ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶èƒ½å¹³æ»‘è¿‡æ¸¡ã€‚</li><li><strong>A/B æµ‹è¯•</strong>ï¼š ç°åº¦å‘å¸ƒå¯ä»¥ä¸ A/B æµ‹è¯•ç»“åˆï¼Œæ§åˆ¶ä¸åŒç”¨æˆ·ç»„çš„æµé‡ã€‚æµæ°´çº¿éœ€è¦èƒ½å¤Ÿå°†ç”¨æˆ·æµé‡æŒ‰ç…§è®¾å®šçš„è§„åˆ™ï¼ˆä¾‹å¦‚ 80% æµé‡èµ°æ—§ç‰ˆæœ¬ï¼Œ20% æµé‡èµ°æ–°ç‰ˆæœ¬ï¼‰è¿›è¡Œåˆ†é…ã€‚</li></ol><h3 id=è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤><strong>è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤ï¼š</strong>
<a class=anchor href=#%e8%ae%be%e8%ae%a1%e7%81%b0%e5%ba%a6%e5%8f%91%e5%b8%83%e6%b5%81%e6%b0%b4%e7%ba%bf%e7%9a%84%e6%ad%a5%e9%aa%a4>#</a></h3><ol><li><p><strong>ä»£ç æäº¤è§¦å‘</strong>ï¼š æ¯å½“ä»£ç æäº¤åˆ° Git ä»“åº“æ—¶ï¼ŒCI æµæ°´çº¿å¼€å§‹è§¦å‘ã€‚ä½¿ç”¨å·¥å…·å¦‚ <strong>Jenkins</strong>ã€<strong>GitLab CI</strong>ã€<strong>GitHub Actions</strong>ã€<strong>ArgoCD</strong> ç­‰ã€‚</p><ul><li><strong>æ„å»ºé˜¶æ®µ</strong>ï¼šä½¿ç”¨æ„å»ºå·¥å…·ï¼ˆå¦‚ <strong>Maven</strong>ã€<strong>Gradle</strong>ã€<strong>Docker</strong> ç­‰ï¼‰æ„å»ºåº”ç”¨ç¨‹åºå¹¶ç”Ÿæˆé•œåƒã€‚</li><li><strong>å•å…ƒæµ‹è¯•</strong>ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚</li><li><strong>é•œåƒæ¨é€</strong>ï¼šå°†æ„å»ºçš„é•œåƒæ¨é€åˆ°å®¹å™¨é•œåƒä»“åº“ï¼ˆä¾‹å¦‚ Docker Hubã€Harborï¼‰ã€‚</li></ul></li><li><p><strong>ç°åº¦å‘å¸ƒç­–ç•¥</strong>ï¼š ç°åº¦å‘å¸ƒç­–ç•¥é€šå¸¸åŸºäº Kubernetes çš„ <strong>Deployment</strong> å’Œ <strong>Ingress</strong> æ§åˆ¶æµé‡çš„åˆ†å‘ã€‚æµæ°´çº¿å¯ä»¥é€šè¿‡è°ƒæ•´ <strong>ReplicaSet</strong> æˆ– <strong>Pod</strong> çš„å‰¯æœ¬æ•°æ¥å®ç°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ <strong>Kubernetes</strong> ç°åº¦å‘å¸ƒæµç¨‹ï¼š</p><ul><li><strong>é˜¶æ®µ1ï¼šå°èŒƒå›´å‘å¸ƒ</strong>ï¼šä½¿ç”¨ <code>canary</code> æˆ– <code>blue-green</code> æ¨¡å¼éƒ¨ç½²æ–°ç‰ˆæœ¬ã€‚<ul><li>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œæµé‡åªæŒ‡å‘æ–°ç‰ˆæœ¬çš„ <strong>Pod</strong> çš„ä¸€éƒ¨åˆ†ã€‚</li><li>ä½¿ç”¨ Kubernetes <strong>Deployment</strong> æ§åˆ¶å‰¯æœ¬æ•°ï¼Œä»è€Œæ§åˆ¶æµé‡æ¯”ä¾‹ã€‚</li></ul></li><li><strong>é˜¶æ®µ2ï¼šæ‰©å¤§èŒƒå›´</strong>ï¼šåœ¨æ–°ç‰ˆæœ¬æ— é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œé€æ¸å¢åŠ æ–°ç‰ˆæœ¬çš„æµé‡ã€‚<ul><li>ä½¿ç”¨ <strong>Service</strong> çš„æµé‡ç®¡ç†å’Œ <strong>Ingress</strong> æ§åˆ¶æµé‡æ¯”ä¾‹ã€‚</li></ul></li><li><strong>é˜¶æ®µ3ï¼šå…¨é‡å‘å¸ƒ</strong>ï¼šåœ¨æ²¡æœ‰é—®é¢˜åï¼Œå®Œå…¨æ›¿æ¢æ—§ç‰ˆæœ¬ï¼Œè¿›è¡Œå…¨é‡å‘å¸ƒã€‚</li></ul></li><li><p><strong>ç°åº¦å‘å¸ƒæµæ°´çº¿çš„ä»»åŠ¡</strong>ï¼š</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ª <strong>Jenkins</strong> å’Œ <strong>Kubernetes</strong> ç°åº¦å‘å¸ƒæµæ°´çº¿ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>pipeline {</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>agent any</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>environment {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>DOCKER_IMAGE = &#34;your_image_name&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>NAMESPACE = &#34;production&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>stages {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Build&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// æ„å»º Docker é•œåƒ</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;docker build -t ${DOCKER_IMAGE}:${BUILD_NUMBER} .&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// æ¨é€é•œåƒåˆ° Docker Hub</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;docker push ${DOCKER_IMAGE}:${BUILD_NUMBER}&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Deploy to Staging&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// éƒ¨ç½²åˆ° Staging ç¯å¢ƒ</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl apply -f kubernetes/staging.yaml&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Canary Release&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// éƒ¨ç½²å°‘é‡å‰¯æœ¬åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆæ¯”å¦‚ 10% æµé‡ï¼‰</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl set image deployment/your-deployment your-container=${DOCKER_IMAGE}:${BUILD_NUMBER} --record&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl scale deployment your-deployment --replicas=10&#39; // éƒ¨ç½² 10 ä¸ª Pod</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Monitor Canary&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›‘æ§æ–°ç‰ˆæœ¬æ˜¯å¦æ­£å¸¸</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>sleep(time: 5, unit</span>: <span style=color:#e6db74>&#39;MINUTES&#39;</span><span style=color:#ae81ff>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl get pods&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Rollout&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// æ‰©å±•æ–°ç‰ˆæœ¬çš„ Pod æ•°é‡ï¼Œé€æ­¥å¢åŠ æµé‡</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl scale deployment your-deployment --replicas=50&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>stage(&#39;Full Release&#39;) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>steps {</span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>script {</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>// å®Œå…¨æ›¿æ¢ä¸ºæ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl set image deployment/your-deployment your-container=${DOCKER_IMAGE}:${BUILD_NUMBER} --record&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>sh &#39;kubectl scale deployment your-deployment --replicas=100&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>post {</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>always {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>// æ¸…ç†æ“ä½œ</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>sh &#39;kubectl delete -f kubernetes/staging.yaml&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><h3 id=ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·><strong>ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·ï¼š</strong>
<a class=anchor href=#%e7%81%b0%e5%ba%a6%e5%8f%91%e5%b8%83%e4%b8%ad%e7%9a%84%e5%85%b3%e9%94%ae%e6%8a%80%e6%9c%af%e5%92%8c%e5%b7%a5%e5%85%b7>#</a></h3><ol><li><strong>Kubernetes</strong>ï¼š<ul><li><strong>Deployment</strong>ï¼šä½¿ç”¨ <strong>Deployment</strong> æ§åˆ¶ Pod å‰¯æœ¬æ•°é‡ï¼Œè¿›è¡Œé€æ­¥å‘å¸ƒã€‚</li><li><strong>ReplicaSet</strong>ï¼šè°ƒæ•´å‰¯æœ¬æ•°æ¥æ§åˆ¶æµé‡ã€‚</li><li><strong>RollingUpdate</strong> ç­–ç•¥ï¼šä½¿å¾— Kubernetes å¯ä»¥é€æ­¥æ›´æ–° Podsã€‚</li></ul></li><li><strong>æµé‡æ§åˆ¶</strong>ï¼š<ul><li><strong>Ingress Controller</strong>ï¼šå¯ä»¥ä½¿ç”¨ Nginx æˆ– Traefik æ¥ç®¡ç† HTTP æµé‡ï¼Œæ§åˆ¶ç°åº¦å‘å¸ƒæµé‡çš„æ¯”ä¾‹ï¼ˆä¾‹å¦‚ï¼š80% æ—§ç‰ˆæœ¬ï¼Œ20% æ–°ç‰ˆæœ¬ï¼‰ã€‚</li><li><strong>Service</strong>ï¼šæ§åˆ¶æ–°æ—§ç‰ˆæœ¬ Pod çš„æµé‡åˆ†é…ã€‚</li></ul></li><li><strong>ç›‘æ§ä¸å‘Šè­¦</strong>ï¼š<ul><li>åœ¨ç°åº¦å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¿…é¡»æœ‰å®Œå–„çš„ç›‘æ§æœºåˆ¶ï¼Œç¡®ä¿åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶èƒ½å¤ŸåŠæ—¶å‘ç°é—®é¢˜ã€‚</li><li>ä½¿ç”¨ Prometheus + Grafana ç›‘æ§ç³»ç»Ÿï¼Œç¡®ä¿åº”ç”¨æ€§èƒ½æ­£å¸¸ã€‚</li><li>è®¾ç½®å‘Šè­¦æœºåˆ¶ï¼ˆå¦‚åœ¨æ€§èƒ½ä¸‹é™æ—¶è‡ªåŠ¨å›æ»šï¼‰ã€‚</li></ul></li><li><strong>å›æ»šæœºåˆ¶</strong>ï¼š<ul><li>å½“å‘ç°é—®é¢˜æ—¶ï¼Œæµæ°´çº¿åº”æ”¯æŒè‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚</li><li>å¯ä»¥é€šè¿‡ Kubernetes çš„ <strong>kubectl rollout undo</strong> å‘½ä»¤å›æ»šéƒ¨ç½²ï¼Œæˆ–è€…ä½¿ç”¨ <strong>ArgoCD</strong> ç­‰å·¥å…·æ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</li></ul></li></ol><h3 id=æ€»ç»“-5><strong>æ€»ç»“</strong>ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-5>#</a></h3><p>ç°åº¦å‘å¸ƒæµæ°´çº¿çš„è®¾è®¡è¦ä¿è¯åœ¨å„ä¸ªé˜¶æ®µéƒ½æœ‰è‡ªåŠ¨åŒ–çš„æ§åˆ¶å’Œç›‘æ§æœºåˆ¶ã€‚æµæ°´çº¿é€šå¸¸åŒ…æ‹¬ä»£ç æäº¤ã€é•œåƒæ„å»ºã€éƒ¨ç½²ã€ç›‘æ§å’Œå›æ»šç­‰å¤šä¸ªæ­¥éª¤ã€‚é€šè¿‡ä¸ Kubernetes å’Œæµé‡ç®¡ç†å·¥å…·é…åˆï¼Œç°åº¦å‘å¸ƒå¯ä»¥æœ‰æ•ˆå‡å°‘å‘å¸ƒå¸¦æ¥çš„é£é™©ï¼Œå¹¶ç¡®ä¿åº”ç”¨ç¨³å®šè¿è¡Œã€‚</p><h1 id=ä¸šåŠ¡åœºæ™¯é“¾è·¯åˆ†å‘ä¸šåŠ¡è¿ç»´æµé‡æ´ªå³°è®¾è®¡è‡ªåŠ¨æ‰©ç¼©çš„æ–¹æ¡ˆ>ä¸šåŠ¡åœºæ™¯ï¼Œé“¾è·¯åˆ†å‘ã€‚ä¸šåŠ¡è¿ç»´ï¼Œæµé‡æ´ªå³°ï¼Œè®¾è®¡è‡ªåŠ¨æ‰©ç¼©çš„æ–¹æ¡ˆï¼Ÿ
<a class=anchor href=#%e4%b8%9a%e5%8a%a1%e5%9c%ba%e6%99%af%e9%93%be%e8%b7%af%e5%88%86%e5%8f%91%e4%b8%9a%e5%8a%a1%e8%bf%90%e7%bb%b4%e6%b5%81%e9%87%8f%e6%b4%aa%e5%b3%b0%e8%ae%be%e8%ae%a1%e8%87%aa%e5%8a%a8%e6%89%a9%e7%bc%a9%e7%9a%84%e6%96%b9%e6%a1%88>#</a></h1><h2 id=æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡-><strong>æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡</strong> ğŸš€
<a class=anchor href=#%e6%b5%81%e9%87%8f%e6%b4%aa%e5%b3%b0%e8%87%aa%e5%8a%a8%e6%89%a9%e7%bc%a9%e5%ae%b9%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1->#</a></h2><p>ä¸šåŠ¡è¿ç»´ä¸­ï¼Œé¢å¯¹ <strong>å¤§ä¿ƒã€èŠ‚å‡æ—¥ã€çªå‘æµé‡</strong> æ—¶ï¼Œ<strong>è‡ªåŠ¨æ‰©ç¼©å®¹</strong> æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šçš„å…³é”®ã€‚é’ˆå¯¹ Kubernetesï¼ˆK8sï¼‰å®¹å™¨åŒ–ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ <strong>HPAï¼ˆæ°´å¹³æ‰©å±•ï¼‰ã€VPAï¼ˆå‚ç›´æ‰©å±•ï¼‰å’Œ CAï¼ˆCluster Autoscalerï¼‰</strong> æ¥åº”å¯¹æµé‡æ´ªå³°ã€‚</p><hr><h2 id=1-æµé‡æ´ªå³°çš„ç‰¹å¾><strong>1. æµé‡æ´ªå³°çš„ç‰¹å¾</strong>
<a class=anchor href=#1-%e6%b5%81%e9%87%8f%e6%b4%aa%e5%b3%b0%e7%9a%84%e7%89%b9%e5%be%81>#</a></h2><ul><li><strong>çªå¢ QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰</strong>ï¼Œé€šå¸¸è¡¨ç°ä¸ºè®¿é—®é‡çŸ­æ—¶é—´å†…é£™å‡</li><li><strong>CPUã€å†…å­˜é£™å‡</strong>ï¼Œå•ä¸ªå®ä¾‹èµ„æºç´§å¼ </li><li><strong>æ•°æ®åº“è¿æ¥æ•°æš´æ¶¨</strong>ï¼Œå¯¼è‡´æ…¢æŸ¥è¯¢æˆ–è¶…æ—¶</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹</strong>ï¼Œæ¶ˆè´¹ç«¯å¤„ç†ä¸è¿‡æ¥</li><li><strong>å¤–éƒ¨ API å“åº”å˜æ…¢</strong>ï¼Œä¾èµ–æœåŠ¡å‹åŠ›è¿‡å¤§</li></ul><hr><h2 id=2-è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„><strong>2. è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„</strong>
<a class=anchor href=#2-%e8%87%aa%e5%8a%a8%e6%89%a9%e7%bc%a9%e5%ae%b9%e6%9e%b6%e6%9e%84>#</a></h2><p>ğŸš€ <strong>æ ¸å¿ƒç»„ä»¶</strong></p><ul><li><strong>HPAï¼ˆHorizontal Pod Autoscalerï¼‰</strong>ï¼šåŸºäº CPUã€å†…å­˜ã€QPS ç­‰æŒ‡æ ‡ï¼Œè‡ªåŠ¨æ‰©å±• Pod å‰¯æœ¬</li><li><strong>VPAï¼ˆVertical Pod Autoscalerï¼‰</strong>ï¼šåŠ¨æ€è°ƒæ•´ Pod èµ„æºï¼ˆCPU/å†…å­˜ï¼‰è¯·æ±‚</li><li><strong>Cluster Autoscalerï¼ˆCAï¼‰</strong>ï¼šèŠ‚ç‚¹èµ„æºä¸è¶³æ—¶è‡ªåŠ¨æ‰©å±•è®¡ç®—èŠ‚ç‚¹</li><li><strong>KEDAï¼ˆKubernetes Event-driven Autoscalingï¼‰</strong>ï¼šåŸºäºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰è´Ÿè½½è¿›è¡Œæ‰©ç¼©å®¹</li></ul><p>ğŸ“Œ <strong>æ–¹æ¡ˆæ¶æ„å›¾</strong></p><pre tabindex=0><code>+----------------------------------+
|   Cluster Autoscaler (CA)        |  &lt;==&gt;  æ‰©å±• Kubernetes è®¡ç®—èŠ‚ç‚¹
+----------------------------------+
          |
          v
+---------------------------+
|  Horizontal Pod Autoscaler (HPA)  |  &lt;==&gt;  æ‰©å±• Pod æ•°é‡
+---------------------------+
          |
          v
+---------------------------+
|  Vertical Pod Autoscaler (VPA)    |  &lt;==&gt;  è°ƒæ•´ Pod èµ„æº (CPU/å†…å­˜)
+---------------------------+
          |
          v
+---------------------------+
|  KEDA (äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹)      |  &lt;==&gt;  åŸºäºæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½æ‰©å®¹
+---------------------------+
</code></pre><hr><h2 id=3-å…³é”®æ‰©ç¼©å®¹ç­–ç•¥><strong>3. å…³é”®æ‰©ç¼©å®¹ç­–ç•¥</strong>
<a class=anchor href=#3-%e5%85%b3%e9%94%ae%e6%89%a9%e7%bc%a9%e5%ae%b9%e7%ad%96%e7%95%a5>#</a></h2><h3 id=1pod-æ°´å¹³æ‰©å±•hpa><strong>ï¼ˆ1ï¼‰Pod æ°´å¹³æ‰©å±•ï¼ˆHPAï¼‰</strong>
<a class=anchor href=#1pod-%e6%b0%b4%e5%b9%b3%e6%89%a9%e5%b1%95hpa>#</a></h3><p>é€‚ç”¨äº <strong>QPSã€CPUã€å†…å­˜ã€å“åº”æ—¶é—´</strong> æ³¢åŠ¨çš„æƒ…å†µã€‚</p><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼šåŸºäº CPU è‡ªåŠ¨æ‰©ç¼©å®¹</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>autoscaling/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HorizontalPodAutoscaler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app-hpa</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scaleTargetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>50</span>  <span style=color:#75715e># æœ€å¤§æ‰©å±• 50 ä¸ª Pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>metrics</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resource</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cpu</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Utilization</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>averageUtilization</span>: <span style=color:#ae81ff>60</span>  <span style=color:#75715e># CPU è¶…è¿‡ 60% æ—¶æ‰©å®¹</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>HPA è§¦å‘æ¡ä»¶</strong></p><ul><li><strong>CPU > 60%</strong></li><li><strong>å†…å­˜å ç”¨ç‡é«˜</strong></li><li><strong>QPS > é˜ˆå€¼</strong></li></ul><hr><h3 id=2pod-å‚ç›´æ‰©å±•vpa><strong>ï¼ˆ2ï¼‰Pod å‚ç›´æ‰©å±•ï¼ˆVPAï¼‰</strong>
<a class=anchor href=#2pod-%e5%9e%82%e7%9b%b4%e6%89%a9%e5%b1%95vpa>#</a></h3><p>é€‚ç”¨äº <strong>å•ä¸ª Pod èµ„æºä¸è¶³ï¼ˆCPU/å†…å­˜ï¼‰</strong> çš„æƒ…å†µã€‚</p><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼šVPA è‡ªåŠ¨è°ƒæ•´ Pod èµ„æº</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>autoscaling.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VerticalPodAutoscaler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app-vpa</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>targetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;apps/v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>updatePolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>updateMode</span>: <span style=color:#e6db74>&#34;Auto&#34;</span>  <span style=color:#75715e># è‡ªåŠ¨è°ƒæ•´ CPU å’Œå†…å­˜</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>VPA è§¦å‘æ¡ä»¶</strong></p><ul><li><strong>å•ä¸ª Pod CPU é•¿æœŸ 100%</strong></li><li><strong>å†…å­˜æŒç»­è¶…å‡ºé™é¢</strong></li><li><strong>é«˜å¹¶å‘åœºæ™¯ä¸‹å•ä¸ª Pod å¤„ç†èƒ½åŠ›ä¸è¶³</strong></li></ul><hr><h3 id=3é›†ç¾¤èŠ‚ç‚¹æ‰©å±•cluster-autoscaler><strong>ï¼ˆ3ï¼‰é›†ç¾¤èŠ‚ç‚¹æ‰©å±•ï¼ˆCluster Autoscalerï¼‰</strong>
<a class=anchor href=#3%e9%9b%86%e7%be%a4%e8%8a%82%e7%82%b9%e6%89%a9%e5%b1%95cluster-autoscaler>#</a></h3><p>é€‚ç”¨äº <strong>æ‰€æœ‰ Pod éƒ½å·²è°ƒåº¦ä½†æ— å¯ç”¨èŠ‚ç‚¹</strong> çš„æƒ…å†µã€‚</p><p>ğŸ“Œ <strong>å¦‚ä½•å·¥ä½œ</strong></p><ul><li>HPA æ‰©å±• Pod å¤±è´¥ â†’ è®¡ç®—èµ„æºä¸è¶³ â†’ è§¦å‘ CA å¢åŠ æ–°èŠ‚ç‚¹</li><li>CA ä¼šæ ¹æ® Pod éœ€æ±‚ï¼Œè‡ªåŠ¨æ‰©å±•äº‘å‚å•†ä¸Šçš„èŠ‚ç‚¹ï¼ˆé˜¿é‡Œäº‘ ACKã€AWS EKSã€GKEï¼‰</li></ul><p>ğŸ“Œ <strong>é…ç½® Cluster Autoscaler</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cluster-autoscaler --nodes=3:50 </span> <span style=color:#75715e># èŠ‚ç‚¹æœ€å°‘ 3 ä¸ªï¼Œæœ€å¤š 50 ä¸ª</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>CA è§¦å‘æ¡ä»¶</strong></p><ul><li><strong>Pod å¤„äº Pending çŠ¶æ€</strong>ï¼ˆè°ƒåº¦å¤±è´¥ï¼‰</li><li><strong>èŠ‚ç‚¹ CPU / å†…å­˜ä¸è¶³</strong></li></ul><hr><h3 id=4äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹keda><strong>ï¼ˆ4ï¼‰äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹ï¼ˆKEDAï¼‰</strong>
<a class=anchor href=#4%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8%e6%89%a9%e7%bc%a9%e5%ae%b9keda>#</a></h3><p>é€‚ç”¨äº <strong>æ¶ˆæ¯é˜Ÿåˆ—ã€Kafka è®¢é˜…ä»»åŠ¡æ¿€å¢</strong> çš„æƒ…å†µã€‚</p><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼šåŸºäº Kafka æ¶ˆè´¹ç§¯å‹è‡ªåŠ¨æ‰©ç¼©</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>keda.sh/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ScaledObject</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-consumer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scaleTargetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-consumer-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>minReplicaCount</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxReplicaCount</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>triggers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>topic</span>: <span style=color:#ae81ff>my-topic</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bootstrapServers</span>: <span style=color:#ae81ff>my-kafka-broker:9092</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>lagThreshold</span>: <span style=color:#e6db74>&#34;1000&#34;</span>  <span style=color:#75715e># æ¶ˆæ¯ç§¯å‹è¶…è¿‡ 1000 æ¡æ—¶æ‰©å®¹</span>
</span></span></code></pre></div><p>ğŸ“Œ <strong>KEDA è§¦å‘æ¡ä»¶</strong></p><ul><li><strong>Kafka/RabbitMQ æ¶ˆæ¯ç§¯å‹</strong></li><li><strong>å¤–éƒ¨ API è¯·æ±‚æ’é˜Ÿ</strong></li><li><strong>æ•°æ®åº“è¿æ¥æ•°æš´æ¶¨</strong></li></ul><hr><h2 id=4-é¢„æ¡ˆ--é«˜å¯ç”¨ç­–ç•¥><strong>4. é¢„æ¡ˆ & é«˜å¯ç”¨ç­–ç•¥</strong>
<a class=anchor href=#4-%e9%a2%84%e6%a1%88--%e9%ab%98%e5%8f%af%e7%94%a8%e7%ad%96%e7%95%a5>#</a></h2><h3 id=1æµé‡é¢„æ¡ˆ><strong>ï¼ˆ1ï¼‰æµé‡é¢„æ¡ˆ</strong>
<a class=anchor href=#1%e6%b5%81%e9%87%8f%e9%a2%84%e6%a1%88>#</a></h3><p>ğŸ“Œ <strong>æå‰æ‰©å®¹</strong></p><ul><li>æ´»åŠ¨å‰æ‰‹åŠ¨æ‰©å®¹ Pod å’ŒèŠ‚ç‚¹ï¼ˆé¢„æ‰©å®¹ï¼‰</li><li>é¢„ä¼° QPS å³°å€¼ï¼Œæå‰åŠ æœºå™¨</li></ul><p>ğŸ“Œ <strong>ç°åº¦å‘å¸ƒ</strong></p><ul><li><strong>è“ç»¿å‘å¸ƒ</strong>ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬æ— å¼‚å¸¸</li><li><strong>é‡‘ä¸é›€å‘å¸ƒ</strong>ï¼Œé€æ­¥æ”¾é‡</li></ul><p>ğŸ“Œ <strong>å¼¹æ€§æµé‡è°ƒåº¦</strong></p><ul><li><strong>æµé‡åˆ†çº§</strong>ï¼šé«˜ä¼˜å…ˆçº§ç”¨æˆ·ä¼˜å…ˆå¤„ç†</li><li><strong>ç†”æ–­é™æµ</strong>ï¼šRedis + Sentinel åšé™æµé™çº§</li><li><strong>åŠ¨æ€é™çº§</strong>ï¼šè¶…æ—¶æ¥å£è‡ªåŠ¨é™çº§</li></ul><hr><h3 id=2æ•…éšœæ¢å¤><strong>ï¼ˆ2ï¼‰æ•…éšœæ¢å¤</strong>
<a class=anchor href=#2%e6%95%85%e9%9a%9c%e6%81%a2%e5%a4%8d>#</a></h3><p>ğŸ“Œ <strong>è‡ªæ„ˆæœºåˆ¶</strong></p><ul><li><strong>Pod OOM è‡ªåŠ¨é‡å¯</strong></li><li><strong>èŠ‚ç‚¹å®•æœºè‡ªåŠ¨è¿ç§»</strong></li><li><strong>æ•°æ®åº“è¶…æ—¶è‡ªåŠ¨é™çº§</strong></li></ul><p>ğŸ“Œ <strong>å¿«é€Ÿæ‰©å±•</strong></p><ul><li><strong>æ‰‹åŠ¨å¿«é€Ÿæ‰©å±•</strong>ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span> deployment/my-app
</span></span></code></pre></div><ul><li>è‡ªåŠ¨æ¢å¤ï¼ˆPrometheus + Alertmanagerï¼‰<ul><li>å‘ç° CPU è¿‡é«˜ â†’ è§¦å‘ HPA æ‰©å®¹</li><li>å‘ç° Pod è¿‡è½½ â†’ è§¦å‘ CA å¢åŠ èŠ‚ç‚¹</li></ul></li></ul><hr><h2 id=5-æ–¹æ¡ˆæ€»ç»“><strong>5. æ–¹æ¡ˆæ€»ç»“</strong>
<a class=anchor href=#5-%e6%96%b9%e6%a1%88%e6%80%bb%e7%bb%93>#</a></h2><table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><strong>HPAï¼ˆæ°´å¹³æ‰©å±•ï¼‰</strong></td><td>CPUã€QPSã€å†…å­˜</td><td>å¿«é€Ÿæ‰©å±• Pod å‰¯æœ¬</td></tr><tr><td><strong>VPAï¼ˆå‚ç›´æ‰©å±•ï¼‰</strong></td><td>CPU / å†…å­˜ä¸è¶³</td><td>è°ƒæ•´å•ä¸ª Pod èµ„æº</td></tr><tr><td><strong>Cluster Autoscaler</strong></td><td>æ— å¯ç”¨èŠ‚ç‚¹</td><td>è‡ªåŠ¨å¢åŠ è®¡ç®—èµ„æº</td></tr><tr><td><strong>KEDAï¼ˆäº‹ä»¶é©±åŠ¨æ‰©å®¹ï¼‰</strong></td><td>æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹</td><td>ä½å»¶è¿Ÿæ‰©ç¼©å®¹</td></tr></tbody></table><h3 id=æœ€ç»ˆæ¶æ„><strong>æœ€ç»ˆæ¶æ„</strong>
<a class=anchor href=#%e6%9c%80%e7%bb%88%e6%9e%b6%e6%9e%84>#</a></h3><ul><li><strong>HPA + VPA + CA + KEDA ç»„åˆæ–¹æ¡ˆ</strong></li><li><strong>é«˜å¹¶å‘æ—¶ HPA è¿…é€Ÿæ‰©å®¹</strong></li><li><strong>è®¡ç®—èµ„æºä¸è¶³æ—¶ CA æ‰©å±•èŠ‚ç‚¹</strong></li><li><strong>VPA ç¡®ä¿å•ä¸ª Pod æ€§èƒ½</strong></li><li><strong>KEDA åº”å¯¹äº‹ä»¶é©±åŠ¨åœºæ™¯</strong></li></ul><p>è¿™æ ·å¯ä»¥ <strong>ä½æˆæœ¬ã€è‡ªåŠ¨åŒ–</strong> å¤„ç†æµé‡æ´ªå³°ï¼Œä¿éšœä¸šåŠ¡ç¨³å®š ğŸ’ªğŸš€</p><h1 id=æ•…éšœæ’æŸ¥è§†é¢‘åŠ è½½ç¼“æ…¢ç½‘ç»œ-å­˜å‚¨-é“¾è·¯åˆ†ææ€ä¹ˆä¸€ä¸ªæ’æŸ¥æ€è·¯>æ•…éšœæ’æŸ¥ï¼Ÿè§†é¢‘åŠ è½½ç¼“æ…¢,ç½‘ç»œ å­˜å‚¨ é“¾è·¯åˆ†æï¼Œæ€ä¹ˆä¸€ä¸ªæ’æŸ¥æ€è·¯ï¼Ÿ
<a class=anchor href=#%e6%95%85%e9%9a%9c%e6%8e%92%e6%9f%a5%e8%a7%86%e9%a2%91%e5%8a%a0%e8%bd%bd%e7%bc%93%e6%85%a2%e7%bd%91%e7%bb%9c-%e5%ad%98%e5%82%a8-%e9%93%be%e8%b7%af%e5%88%86%e6%9e%90%e6%80%8e%e4%b9%88%e4%b8%80%e4%b8%aa%e6%8e%92%e6%9f%a5%e6%80%9d%e8%b7%af>#</a></h1><p>æ’æŸ¥è§†é¢‘åŠ è½½ç¼“æ…¢çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œã€å­˜å‚¨å’Œé“¾è·¯æ–¹é¢ï¼Œé€šå¸¸éœ€è¦æŒ‰æ­¥éª¤è¿›è¡Œç»†è‡´çš„åˆ†æã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¸¸è§çš„æ’æŸ¥æ€è·¯ï¼š</p><h3 id=1-ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°><strong>1. ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°</strong>
<a class=anchor href=#1-%e7%a1%ae%e5%ae%9a%e8%a7%86%e9%a2%91%e5%8a%a0%e8%bd%bd%e7%bc%93%e6%85%a2%e7%9a%84%e8%a1%a8%e7%8e%b0>#</a></h3><ul><li><strong>æ˜¯å¦æ‰€æœ‰è§†é¢‘éƒ½æ…¢</strong>ï¼šé—®é¢˜æ˜¯æ™®éçš„è¿˜æ˜¯ä»…é™äºæŸäº›è§†é¢‘ï¼Ÿ</li><li><strong>å»¶è¿Ÿåœ¨å“ªä¸ªç¯èŠ‚</strong>ï¼šæ˜¯è§†é¢‘æ’­æ”¾å¼€å§‹æ…¢ï¼Œè¿˜æ˜¯åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­å¡é¡¿ï¼Ÿ</li><li><strong>ç½‘ç»œæˆ–å­˜å‚¨</strong>ï¼šæ˜¯å¦ä¸ç½‘ç»œå¸¦å®½ã€å­˜å‚¨è¯»å†™é€Ÿåº¦ã€ç¼“å­˜ç­‰å› ç´ æœ‰å…³ï¼Ÿ</li></ul><h3 id=2-åˆ†æç½‘ç»œé“¾è·¯><strong>2. åˆ†æç½‘ç»œé“¾è·¯</strong>
<a class=anchor href=#2-%e5%88%86%e6%9e%90%e7%bd%91%e7%bb%9c%e9%93%be%e8%b7%af>#</a></h3><ul><li><strong>æ£€æŸ¥å¸¦å®½</strong>ï¼š<ul><li><strong>ä¸‹è½½é€Ÿåº¦</strong>ï¼šæµ‹è¯•ç½‘ç»œçš„ä¸‹è½½é€Ÿåº¦ï¼Œç¡®ä¿å¸¦å®½è¶³å¤Ÿã€‚ä½¿ç”¨å·¥å…·å¦‚ <code>speedtest-cli</code> æ£€æŸ¥ç½‘ç»œçš„ä¸Šä¼ å’Œä¸‹è½½é€Ÿåº¦ã€‚</li><li><strong>æ˜¯å¦æœ‰å¸¦å®½ç“¶é¢ˆ</strong>ï¼šä½¿ç”¨ <code>iperf3</code> è¿›è¡Œå¸¦å®½æµ‹è¯•ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆã€‚</li></ul></li><li><strong>ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…</strong>ï¼š<ul><li><strong>ping æµ‹è¯•</strong>ï¼šä½¿ç”¨ <code>ping</code> æµ‹è¯•åˆ°æœåŠ¡å™¨çš„å»¶è¿Ÿï¼Œç¡®ä¿ç½‘ç»œå»¶è¿Ÿä¸ä¼šå½±å“è§†é¢‘åŠ è½½ã€‚</li><li><strong>traceroute è·¯ç”±è¿½è¸ª</strong>ï¼šä½¿ç”¨ <code>traceroute</code> æˆ– <code>mtr</code> è¿½è¸ªç½‘ç»œè·¯ç”±ï¼Œçœ‹æ˜¯å¦æœ‰æŸä¸€è·³å­˜åœ¨æ˜¾è‘—çš„å»¶è¿Ÿæˆ–ä¸¢åŒ…ç°è±¡ã€‚</li></ul></li><li><strong>ç½‘ç»œè´¨é‡</strong>ï¼š<ul><li><strong>TCPè¿æ¥æ•°é™åˆ¶</strong>ï¼šå¦‚æœæœåŠ¡å™¨æ¥å…¥äº†å¤§é‡çš„å¹¶å‘è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´ TCP è¿æ¥æ± æº¢å‡ºã€‚æ£€æŸ¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿æ¥æ•°ã€‚</li><li><strong>å†…å®¹åˆ†å‘ç½‘ç»œ (CDN)</strong>ï¼šå¦‚æœä½¿ç”¨äº† CDNï¼Œæ£€æŸ¥ CDN èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸ã€‚å¦‚æœæ˜¯å•ä¸€èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´æŸäº›ç”¨æˆ·åŠ è½½ç¼“æ…¢ã€‚</li></ul></li><li><strong>HTTP å“åº”æ—¶é—´</strong>ï¼š<ul><li><strong>ä½¿ç”¨ <code>curl</code> æˆ– <code>wget</code></strong>ï¼šæ£€æŸ¥è§†é¢‘æ–‡ä»¶è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œç¡®è®¤æ˜¯å¦æ˜¯æœåŠ¡å™¨ç«¯çš„å“åº”æ…¢å¯¼è‡´åŠ è½½å»¶è¿Ÿã€‚</li><li><strong>HTTP ç¼“å­˜</strong>ï¼šç¡®è®¤æ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„ HTTP ç¼“å­˜æœºåˆ¶ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°ç”Ÿæˆè§†é¢‘æµï¼Œå¯èƒ½å¯¼è‡´å»¶è¿Ÿã€‚</li></ul></li><li><strong>åè®®ä¼˜åŒ–</strong>ï¼š<ul><li>å¦‚æœä½¿ç”¨çš„æ˜¯ HTTP/1ï¼Œè€ƒè™‘åˆ‡æ¢åˆ° HTTP/2ï¼Œåè€…åœ¨å¤šè¿æ¥ã€å¤´éƒ¨å‹ç¼©ã€è¯·æ±‚ä¼˜å…ˆçº§ç­‰æ–¹é¢æœ‰è¾ƒå¤§æ”¹è¿›ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å»¶è¿Ÿã€‚</li></ul></li></ul><h3 id=3-å­˜å‚¨å±‚æ’æŸ¥><strong>3. å­˜å‚¨å±‚æ’æŸ¥</strong>
<a class=anchor href=#3-%e5%ad%98%e5%82%a8%e5%b1%82%e6%8e%92%e6%9f%a5>#</a></h3><ul><li>ç£ç›˜ I/O æ€§èƒ½ï¼š<ul><li><strong>ç£ç›˜æ€§èƒ½</strong>ï¼šæ£€æŸ¥å­˜å‚¨æœåŠ¡å™¨çš„ç£ç›˜ I/O æ€§èƒ½ï¼Œä½¿ç”¨å·¥å…·å¦‚ <code>iostat</code>ã€<code>vmstat</code> ç­‰æŸ¥çœ‹ç£ç›˜çš„ååé‡å’Œå»¶è¿Ÿã€‚</li><li><strong>ç£ç›˜ä½¿ç”¨ç‡</strong>ï¼šç¡®è®¤å­˜å‚¨ç©ºé—´æ˜¯å¦æ»¡ï¼Œæˆ–ç£ç›˜æ˜¯å¦è¾¾åˆ°è´Ÿè½½ä¸Šé™ã€‚<code>df -h</code> å’Œ <code>iostat</code> å¯ä»¥å¸®åŠ©åˆ†æå­˜å‚¨è®¾å¤‡çš„ä½¿ç”¨æƒ…å†µã€‚</li></ul></li><li>å­˜å‚¨ç¼“å­˜ï¼š<ul><li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ CDN ç¼“å­˜ã€åå‘ä»£ç†ç¼“å­˜ç­‰ï¼‰ï¼Œå¹¶éªŒè¯ç¼“å­˜æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œå­˜å‚¨çš„è¯»å–è´Ÿè½½ä¼šå¯¼è‡´å»¶è¿Ÿã€‚</li><li><strong>SSD vs HDD</strong>ï¼šå¦‚æœå­˜å‚¨è®¾å¤‡æ˜¯ HDDï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯»å–é€Ÿåº¦è¾ƒæ…¢ã€‚SSD å¯ä»¥å¤§å¹…æé«˜è¯»å–é€Ÿåº¦ã€‚</li></ul></li><li>å­˜å‚¨ç³»ç»Ÿè´Ÿè½½ï¼š<ul><li><strong>å­˜å‚¨æœåŠ¡çš„è´Ÿè½½</strong>ï¼šå¦‚æœæ˜¯ä½¿ç”¨çš„å…±äº«å­˜å‚¨æˆ–ç½‘ç»œå­˜å‚¨ï¼ˆå¦‚ NASã€SANï¼‰ï¼Œç¡®ä¿å­˜å‚¨ç³»ç»Ÿæœ¬èº«æ²¡æœ‰è¿‡è½½ï¼Œç½‘ç»œå»¶è¿Ÿå’Œå­˜å‚¨ I/O é«˜å³°æœŸå¯èƒ½ä¼šå½±å“è§†é¢‘åŠ è½½é€Ÿåº¦ã€‚</li></ul></li></ul><h3 id=4-è§†é¢‘æ–‡ä»¶åˆ†æ><strong>4. è§†é¢‘æ–‡ä»¶åˆ†æ</strong>
<a class=anchor href=#4-%e8%a7%86%e9%a2%91%e6%96%87%e4%bb%b6%e5%88%86%e6%9e%90>#</a></h3><ul><li><strong>è§†é¢‘æ–‡ä»¶æ ¼å¼</strong>ï¼šæ£€æŸ¥è§†é¢‘æ–‡ä»¶çš„æ ¼å¼å’Œç¼–ç ã€‚æŸäº›è§†é¢‘æ ¼å¼å¯èƒ½ä¸é€‚åˆç½‘ç»œä¼ è¾“ï¼Œæˆ–è€…æ²¡æœ‰è¿›è¡Œåˆé€‚çš„ç¼–ç ä¼˜åŒ–ã€‚</li><li><strong>è§†é¢‘åˆ†è¾¨ç‡å’Œç ç‡</strong>ï¼šå¦‚æœè§†é¢‘çš„åˆ†è¾¨ç‡å’Œç ç‡è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°ç¼“å†²ã€‚è€ƒè™‘æä¾›å¤šç§åˆ†è¾¨ç‡çš„è§†é¢‘ç‰ˆæœ¬ï¼Œå…è®¸å®¢æˆ·ç«¯æ ¹æ®ç½‘ç»œæ¡ä»¶è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç ç‡ã€‚</li><li><strong>è§†é¢‘åˆ†ç‰‡</strong>ï¼šç¡®ä¿è§†é¢‘æ–‡ä»¶é‡‡ç”¨äº†åˆ†ç‰‡å¤„ç†ï¼ˆå¦‚ HLSã€DASH ç­‰æµåª’ä½“åè®®ï¼‰ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€æ­¥ä¸‹è½½è§†é¢‘è€Œä¸æ˜¯ä¸€æ¬¡æ€§ä¸‹è½½å®Œæ•´è§†é¢‘æ–‡ä»¶ã€‚</li></ul><h3 id=5-å®¢æˆ·ç«¯æ’æŸ¥><strong>5. å®¢æˆ·ç«¯æ’æŸ¥</strong>
<a class=anchor href=#5-%e5%ae%a2%e6%88%b7%e7%ab%af%e6%8e%92%e6%9f%a5>#</a></h3><ul><li>å®¢æˆ·ç«¯æ€§èƒ½ï¼š<ul><li>ç¡®è®¤å®¢æˆ·ç«¯è®¾å¤‡æ˜¯å¦æ€§èƒ½ä¸è¶³ï¼ˆCPUã€å†…å­˜ã€GPU ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼Œä½æ€§èƒ½è®¾å¤‡å¯èƒ½æ— æ³•å¤„ç†é«˜åˆ†è¾¨ç‡æˆ–é«˜ç ç‡çš„è§†é¢‘æµã€‚</li><li>æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„è§†é¢‘æ’­æ”¾å™¨ï¼Œå¹¶ä¸”æ˜¯å¦æ”¯æŒç¡¬ä»¶è§£ç ã€‚è½¯ä»¶è§£ç å¯èƒ½ä¼šå¯¼è‡´æ’­æ”¾å¡é¡¿ã€‚</li></ul></li><li>æµè§ˆå™¨/æ’­æ”¾å™¨ä¼˜åŒ–ï¼š<ul><li><strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼šæ£€æŸ¥æµè§ˆå™¨ç¼“å­˜æ˜¯å¦æ­£ç¡®å·¥ä½œã€‚æµè§ˆå™¨å¯ä»¥ç¼“å­˜éƒ¨åˆ†è§†é¢‘æ•°æ®ï¼Œé¿å…æ¯æ¬¡éƒ½ä»å¤´å¼€å§‹åŠ è½½ã€‚</li><li><strong>è§†é¢‘æ’­æ”¾å™¨è®¾ç½®</strong>ï¼šç¡®ä¿æ’­æ”¾å™¨è®¾ç½®äº†é€‚å½“çš„ç¼“å†²ç­–ç•¥ï¼Œä¾‹å¦‚è®¾ç½®è¶³å¤Ÿçš„ç¼“å†²åŒºå¤§å°æ¥å¹³æ»‘æ’­æ”¾ã€‚</li></ul></li><li>ç½‘ç»œç¯å¢ƒï¼š<ul><li>ç¡®è®¤å®¢æˆ·ç«¯ç½‘ç»œæ˜¯å¦ç¨³å®šï¼Œå¦‚æœä½¿ç”¨ Wi-Fiï¼Œå°è¯•åˆ‡æ¢åˆ°æœ‰çº¿ç½‘ç»œè¿›è¡Œæµ‹è¯•ï¼Œæ’é™¤æ— çº¿ç½‘ç»œå¸¦æ¥çš„ä¸ç¨³å®šå› ç´ ã€‚</li></ul></li></ul><h3 id=6-æµç¨‹ç›‘æ§ä¸æ—¥å¿—><strong>6. æµç¨‹ç›‘æ§ä¸æ—¥å¿—</strong>
<a class=anchor href=#6-%e6%b5%81%e7%a8%8b%e7%9b%91%e6%8e%a7%e4%b8%8e%e6%97%a5%e5%bf%97>#</a></h3><ul><li>æ—¥å¿—åˆ†æï¼š<ul><li><strong>è§†é¢‘æ’­æ”¾å™¨æ—¥å¿—</strong>ï¼šæŸ¥çœ‹è§†é¢‘æ’­æ”¾å™¨çš„æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åŠ è½½å¤±è´¥æˆ–å»¶è¿Ÿçš„é”™è¯¯ä¿¡æ¯ã€‚</li><li><strong>Web æœåŠ¡å™¨æ—¥å¿—</strong>ï¼šæ£€æŸ¥è§†é¢‘è¯·æ±‚çš„æœåŠ¡å™¨æ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨é”™è¯¯æˆ–å¼‚å¸¸çš„ HTTP å“åº”ç ï¼ˆå¦‚ 404ã€500 ç­‰ï¼‰ã€‚</li><li><strong>å­˜å‚¨æ—¥å¿—</strong>ï¼šå¦‚æœä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨æˆ–å¯¹è±¡å­˜å‚¨ï¼Œæ£€æŸ¥ç›¸å…³å­˜å‚¨æœåŠ¡çš„æ—¥å¿—ï¼Œç¡®ä¿æ²¡æœ‰å‡ºç°æ•…éšœã€‚</li></ul></li><li>ç›‘æ§ç³»ç»Ÿï¼š<ul><li>è®¾ç½®ç›‘æ§æŒ‡æ ‡ï¼Œç›‘æ§å­˜å‚¨ã€ç½‘ç»œã€æœåŠ¡å™¨ç­‰å…³é”®èµ„æºçš„æ€§èƒ½ï¼Œåˆ©ç”¨ Prometheusã€Grafana ç­‰å·¥å…·å®æ—¶æŸ¥çœ‹èµ„æºçš„è´Ÿè½½æƒ…å†µã€‚</li></ul></li></ul><h3 id=7-è¿›è¡Œå‹åŠ›æµ‹è¯•><strong>7. è¿›è¡Œå‹åŠ›æµ‹è¯•</strong>
<a class=anchor href=#7-%e8%bf%9b%e8%a1%8c%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95>#</a></h3><ul><li>åœ¨æ’æŸ¥è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <strong>å‹åŠ›æµ‹è¯•</strong> å·¥å…·ï¼ˆå¦‚ <strong>Apache Benchmark</strong>ã€<strong>JMeter</strong>ï¼‰æ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨å’Œå­˜å‚¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯è§†é¢‘æ–‡ä»¶çš„è¯»å†™èƒ½åŠ›ã€‚</li></ul><h3 id=æ€»ç»“-6><strong>æ€»ç»“</strong>ï¼š
<a class=anchor href=#%e6%80%bb%e7%bb%93-6>#</a></h3><p>è§†é¢‘åŠ è½½ç¼“æ…¢é—®é¢˜çš„æ’æŸ¥éœ€è¦ä» <strong>ç½‘ç»œé“¾è·¯ã€å­˜å‚¨æ€§èƒ½ã€è§†é¢‘æ–‡ä»¶ã€å®¢æˆ·ç«¯æ€§èƒ½</strong> ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œåˆ†æã€‚é€šè¿‡é€æ­¥æ£€æŸ¥å„ä¸ªç¯èŠ‚ï¼Œå®šä½ç“¶é¢ˆï¼Œå¹¶æ ¹æ®å‘ç°çš„é—®é¢˜è¿›è¡Œä¼˜åŒ–ã€‚å¦‚æœæ˜¯ç½‘ç»œå»¶è¿Ÿæˆ–å¸¦å®½ä¸è¶³ï¼Œå¯ä»¥é€šè¿‡å‡çº§ç½‘ç»œè®¾æ–½ã€å¢åŠ  CDN èŠ‚ç‚¹ç­‰æ–¹å¼è§£å†³ï¼›å¦‚æœæ˜¯å­˜å‚¨ç“¶é¢ˆï¼Œå¯ä»¥è€ƒè™‘å‡çº§å­˜å‚¨ç¡¬ä»¶æˆ–ä¼˜åŒ–å­˜å‚¨æ¶æ„ï¼›å¦‚æœæ˜¯è§†é¢‘ç¼–ç æˆ–æ’­æ”¾å™¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è§†é¢‘çš„åˆ†è¾¨ç‡å’Œç ç‡ï¼Œæˆ–è€…æ”¹è¿›å®¢æˆ·ç«¯æ’­æ”¾å™¨æ¥è§£å†³ã€‚</p><h1 id=å¤šä¸ªæ•…éšœæ€ä¹ˆåŒºåˆ†ä¼˜å…ˆçº§>å¤šä¸ªæ•…éšœï¼Œæ€ä¹ˆåŒºåˆ†ä¼˜å…ˆçº§ï¼Ÿ
<a class=anchor href=#%e5%a4%9a%e4%b8%aa%e6%95%85%e9%9a%9c%e6%80%8e%e4%b9%88%e5%8c%ba%e5%88%86%e4%bc%98%e5%85%88%e7%ba%a7>#</a></h1><p>åŒºåˆ†å¤šä¸ªæ•…éšœçš„ä¼˜å…ˆçº§ï¼Œé€šå¸¸éœ€è¦ä¾æ®æ•…éšœçš„ä¸¥é‡æ€§ã€å¯¹ä¸šåŠ¡çš„å½±å“ã€æ¢å¤çš„éš¾æ˜“ç¨‹åº¦å’Œæ—¶é—´ç´§è¿«æ€§æ¥è¿›è¡Œåˆ¤æ–­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¼˜å…ˆçº§åˆ†ç±»æ–¹æ³•ï¼Œå¸®åŠ©ä½ å¿«é€Ÿã€æœ‰æ•ˆåœ°åŒºåˆ†å’Œå¤„ç†å¤šä¸ªæ•…éšœã€‚</p><h3 id=1-æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»><strong>1. æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»</strong>
<a class=anchor href=#1-%e6%a0%b9%e6%8d%ae%e6%95%85%e9%9a%9c%e5%bd%b1%e5%93%8d%e8%8c%83%e5%9b%b4%e5%88%86%e7%b1%bb>#</a></h3><ul><li><strong>é«˜ä¼˜å…ˆçº§ï¼ˆCritical / P1ï¼‰</strong>ï¼š<ul><li>æ•…éšœå¯¼è‡´ <strong>å…³é”®ä¸šåŠ¡ä¸­æ–­</strong>ï¼Œå¯¹å…¬å¸æ”¶å…¥ã€å®¢æˆ·ä½“éªŒã€å®‰å…¨ç­‰äº§ç”Ÿ <strong>ä¸¥é‡å½±å“</strong>ã€‚</li><li><strong>ä¾‹å¦‚</strong>ï¼šæ•°æ®åº“å®•æœºã€æ ¸å¿ƒç³»ç»Ÿæ— æ³•è®¿é—®ã€å¤§è§„æ¨¡çš„æœåŠ¡ä¸­æ–­ã€‚</li><li><strong>å¤„ç†æ–¹å¼</strong>ï¼šç«‹å³å“åº”ï¼Œç´§æ€¥ä¿®å¤ï¼Œç”šè‡³éœ€è¦å…¨å‘˜å‚ä¸å¤„ç†ã€‚</li></ul></li><li><strong>ä¸­ä¼˜å…ˆçº§ï¼ˆMajor / P2ï¼‰</strong>ï¼š<ul><li>æ•…éšœå½±å“åˆ°éƒ¨åˆ†ç”¨æˆ·æˆ–æœåŠ¡ï¼Œå¯¼è‡´ <strong>åŠŸèƒ½å—é™</strong>ï¼Œä½† <strong>ä¸šåŠ¡ä»å¯è¿›è¡Œ</strong>ã€‚</li><li><strong>ä¾‹å¦‚</strong>ï¼šæŸäº›æœåŠ¡å“åº”ç¼“æ…¢ã€å•ä¸ªåŠŸèƒ½ä¸å¯ç”¨ï¼Œéƒ¨åˆ†ç”¨æˆ·å—å½±å“ã€‚</li><li><strong>å¤„ç†æ–¹å¼</strong>ï¼šå°½å¿«å“åº”ï¼Œä¼˜å…ˆä¿®å¤å—å½±å“èŒƒå›´å¹¿ã€å½±å“è¾ƒå¤§çš„éƒ¨åˆ†ã€‚</li></ul></li><li><strong>ä½ä¼˜å…ˆçº§ï¼ˆMinor / P3ï¼‰</strong>ï¼š<ul><li>æ•…éšœå¯¹ä¸šåŠ¡æ²¡æœ‰ç›´æ¥å½±å“æˆ–ä»…é€ æˆ <strong>å°èŒƒå›´</strong>çš„åŠŸèƒ½æŸå¤±ã€‚</li><li><strong>ä¾‹å¦‚</strong>ï¼šæŸäº›éå…³é”®æœåŠ¡çš„æ€§èƒ½é—®é¢˜ã€UI bugï¼Œç”šè‡³æ˜¯æ—¥å¿—ä¸­çš„è­¦å‘Šä¿¡æ¯ã€‚</li><li><strong>å¤„ç†æ–¹å¼</strong>ï¼šé€šå¸¸å¯ä»¥æ’åœ¨åé¢å¤„ç†ï¼Œæ ¹æ®å®é™…æƒ…å†µåˆ†é…æ—¶é—´ã€‚</li></ul></li></ul><h3 id=2-æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»><strong>2. æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»</strong>
<a class=anchor href=#2-%e6%a0%b9%e6%8d%ae%e6%95%85%e9%9a%9c%e6%81%a2%e5%a4%8d%e9%9a%be%e6%98%93%e5%ba%a6%e5%88%86%e7%b1%bb>#</a></h3><ul><li><strong>é«˜ä¼˜å…ˆçº§</strong>ï¼šå¦‚æœæ•…éšœè¾ƒéš¾ä¿®å¤æˆ–éœ€è¦å¤æ‚çš„æ“ä½œï¼Œå¦‚æ¶‰åŠåˆ°ç³»ç»Ÿé‡å¯ã€ç¡¬ä»¶æ•…éšœã€æ•°æ®åº“æ¢å¤ç­‰ï¼Œåº”è¯¥ä¼˜å…ˆå¤„ç†ã€‚</li><li><strong>ä½ä¼˜å…ˆçº§</strong>ï¼šå¦‚æœæ•…éšœç®€å•æ˜“ä¿®å¤ï¼Œæ¯”å¦‚æŸä¸ªé…ç½®é”™è¯¯æˆ–å°èŒƒå›´çš„ä»£ç bugï¼Œä¿®å¤æ—¶é—´çŸ­ï¼Œåˆ™ä¼˜å…ˆçº§è¾ƒä½ã€‚</li></ul><h3 id=3-æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»><strong>3. æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»</strong>
<a class=anchor href=#3-%e6%a0%b9%e6%8d%ae%e6%97%b6%e9%97%b4%e6%95%8f%e6%84%9f%e6%80%a7%e5%88%86%e7%b1%bb>#</a></h3><ul><li><strong>ç´§æ€¥ï¼ˆHigh urgencyï¼‰</strong>ï¼šå¦‚æœæ•…éšœéœ€è¦ <strong>å°½å¿«æ¢å¤</strong>ï¼Œæ¯”å¦‚å½±å“åˆ° <strong>å®¢æˆ·æœåŠ¡æˆ–æ”¶å…¥</strong>ï¼Œåº”è¯¥ä¼˜å…ˆå¤„ç†ã€‚</li><li><strong>æ™®é€šï¼ˆMedium urgencyï¼‰</strong>ï¼šå¦‚æœæ•…éšœä¸æ¶‰åŠç›´æ¥çš„ä¸šåŠ¡æŸå¤±ï¼Œä½†ä»ç„¶éœ€è¦åœ¨ä¸€å®šæ—¶é—´å†…è§£å†³ï¼Œå¦‚å½±å“åˆ°éé«˜å³°æ—¶æ®µçš„æµé‡ã€‚</li><li><strong>ä¸ç´§æ€¥ï¼ˆLow urgencyï¼‰</strong>ï¼šå¦‚æœæ•…éšœä¸ä¼šåœ¨çŸ­æœŸå†…å¯¹ä¸šåŠ¡äº§ç”Ÿä»»ä½•å½±å“ï¼Œä¸”å¯ä»¥åœ¨åç»­çš„ç»´æŠ¤çª—å£ä¸­è§£å†³ï¼Œå±äºä½ä¼˜å…ˆçº§ã€‚</li></ul><h3 id=4-æ•…éšœåˆ†ç±»><strong>4. æ•…éšœåˆ†ç±»</strong>
<a class=anchor href=#4-%e6%95%85%e9%9a%9c%e5%88%86%e7%b1%bb>#</a></h3><ul><li><strong>åŠŸèƒ½æ€§æ•…éšœ</strong>ï¼šä¾‹å¦‚ï¼ŒAPI è°ƒç”¨å¤±è´¥ã€æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ç­‰ï¼Œè¿™ç±»æ•…éšœé€šå¸¸éœ€è¦å¿«é€Ÿæ¢å¤ã€‚</li><li><strong>æ€§èƒ½æ€§æ•…éšœ</strong>ï¼šä¾‹å¦‚ï¼Œå“åº”æ—¶é—´è¿‡é•¿ã€ç³»ç»Ÿå¡é¡¿ç­‰ï¼Œå¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦åŠæ—¶ä¿®å¤ã€‚</li><li><strong>å®‰å…¨æ€§æ•…éšœ</strong>ï¼šå¦‚æ•°æ®æ³„æ¼ã€æƒé™æ¼æ´ç­‰ï¼Œè¿™ç±»é—®é¢˜å…·æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œé€šå¸¸éœ€è¦ç¬¬ä¸€æ—¶é—´å¤„ç†ã€‚</li><li><strong>å¯ç”¨æ€§é—®é¢˜</strong>ï¼šä¾‹å¦‚æœåŠ¡é—´æ­‡æ€§ä¸å¯ç”¨ï¼Œåº”è¯¥å°½å¿«å®šä½æ•…éšœæºï¼Œä¿®å¤æ—¶è¿›è¡Œé€‚å½“ç›‘æ§ï¼Œç¡®ä¿ä¸šåŠ¡æ¢å¤ã€‚</li></ul><h3 id=5-ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ><strong>5. ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ</strong>
<a class=anchor href=#5-%e4%bd%bf%e7%94%a8%e6%95%85%e9%9a%9c%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f>#</a></h3><ul><li><strong>æœåŠ¡çº§åˆ«åè®®ï¼ˆSLAï¼‰</strong>ï¼šä¾æ® SLAï¼Œå®šä¹‰æ¯ä¸ªæ•…éšœç±»å‹çš„å“åº”æ—¶é—´å’Œæ¢å¤æ—¶é—´ã€‚éµå®ˆ SLA æ˜¯ç¡®ä¿ä¸šåŠ¡æ­£å¸¸è¿è¥çš„å…³é”®ã€‚</li><li><strong>è‡ªåŠ¨åŒ–æ•…éšœç›‘æ§ä¸å‘Šè­¦</strong>ï¼šåˆ©ç”¨ Prometheusã€Grafana ç­‰ç›‘æ§å·¥å…·è®¾ç½® <strong>å‘Šè­¦é˜ˆå€¼</strong>ï¼Œå¸®åŠ©å®æ—¶è·å–æ•…éšœä¿¡æ¯ï¼Œå¹¶è‡ªåŠ¨å°†æ•…éšœåˆ†ç±»å¹¶æ ‡è®°ä¼˜å…ˆçº§ã€‚</li><li><strong>æ•…éšœç®¡ç†å·¥å…·</strong>ï¼šä½¿ç”¨å¦‚ <strong>Jira</strong>ã€<strong>ServiceNow</strong> ç­‰æ•…éšœç®¡ç†å·¥å…·ï¼Œè®¾å®šä¼˜å…ˆçº§ã€åˆ†é…è´£ä»»äººå¹¶è·Ÿè¸ªä¿®å¤è¿›åº¦ã€‚</li></ul><h3 id=6-åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°><strong>6. åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°</strong>
<a class=anchor href=#6-%e5%9f%ba%e4%ba%8e%e4%b8%9a%e5%8a%a1%e4%bb%b7%e5%80%bc%e8%af%84%e4%bc%b0>#</a></h3><ul><li><strong>å…³é”®ç³»ç»Ÿ</strong>ï¼šå¦‚æœæ•…éšœæ¶‰åŠåˆ°å½±å“æ ¸å¿ƒä¸šåŠ¡çš„ç³»ç»Ÿæˆ–ç»„ä»¶ï¼Œåº”è¯¥ä¼˜å…ˆå¤„ç†ã€‚æ¯”å¦‚æ”¯ä»˜ç³»ç»Ÿã€æ ¸å¿ƒæ•°æ®åº“ã€ç”¨æˆ·è®¤è¯ç³»ç»Ÿç­‰ã€‚</li><li><strong>éæ ¸å¿ƒç³»ç»Ÿ</strong>ï¼šå¯¹ä¸šåŠ¡å½±å“è¾ƒå°çš„ç³»ç»Ÿå¯ä»¥æ’åœ¨åé¢ï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€ç›‘æ§ç³»ç»Ÿç­‰ã€‚</li></ul><h3 id=7-ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ><strong>7. ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ</strong>
<a class=anchor href=#7-%e7%a1%ae%e5%ae%9a%e6%81%a2%e5%a4%8d%e7%9a%84%e6%9c%80%e5%b0%8f%e5%8f%af%e8%a1%8c%e6%96%b9%e6%a1%88>#</a></h3><ul><li>å¯¹äºæ¯ä¸ªæ•…éšœï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œåˆ¶å®š <strong>æœ€å°å¯è¡Œæ¢å¤æ–¹æ¡ˆ</strong>ã€‚æœ‰äº›æ•…éšœå¯ä»¥ä¸´æ—¶ç»•è¿‡æˆ–é‡‡ç”¨ç®€åŒ–æ–¹å¼æ¢å¤æœåŠ¡ï¼Œè€Œæ— éœ€ç«‹å³å®Œå…¨ä¿®å¤ã€‚</li></ul><h3 id=æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹><strong>æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹</strong>ï¼š
<a class=anchor href=#%e6%8e%92%e6%9f%a5%e6%95%85%e9%9a%9c%e7%9a%84%e4%bc%98%e5%85%88%e7%ba%a7%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b>#</a></h3><ol><li><strong>ç´§æ€¥å“åº”</strong>ï¼šé¦–å…ˆå¤„ç†å¯¹ä¸šåŠ¡å½±å“è¾ƒå¤§ã€éœ€è¿…é€Ÿæ¢å¤çš„æ•…éšœï¼ˆå¦‚ç³»ç»Ÿå®•æœºã€ç”¨æˆ·æ— æ³•è®¿é—®ç­‰ï¼‰ã€‚</li><li><strong>é€ä¸€å¤„ç†æ¬¡è¦æ•…éšœ</strong>ï¼šåœ¨å¤„ç†å®Œé«˜ä¼˜å…ˆçº§æ•…éšœåï¼Œé€æ­¥æ’æŸ¥å¹¶å¤„ç†ä¸­ä¼˜å…ˆçº§çš„æ•…éšœã€‚</li><li><strong>ç›‘æ§ä¸è°ƒæ•´</strong>ï¼šè®¾ç½®ç›‘æ§ï¼Œç¡®ä¿ä¸šåŠ¡æ¢å¤è¿‡ç¨‹ä¸­æ²¡æœ‰æ–°çš„é—®é¢˜ï¼Œéšæ—¶è°ƒæ•´å¤„ç†ä¼˜å…ˆçº§ã€‚</li></ol><h3 id=æ€»ç»“-7><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-7>#</a></h3><p>æ•…éšœçš„ä¼˜å…ˆçº§åº”è¯¥æ ¹æ®æ•…éšœçš„ <strong>ä¸¥é‡æ€§ã€å½±å“èŒƒå›´ã€æ¢å¤éš¾åº¦</strong> å’Œ <strong>æ—¶é—´æ•æ„Ÿæ€§</strong> æ¥åˆ¤æ–­ã€‚é€šè¿‡åˆç†åˆ†ç±»ï¼Œèƒ½å¤Ÿç¡®ä¿é«˜ä¼˜å…ˆçº§çš„é—®é¢˜å°½å¿«å¾—åˆ°å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿä¸å¿½è§†è¾ƒä½ä¼˜å…ˆçº§çš„é•¿æœŸæ”¹è¿›ã€‚ä¼˜å…ˆçº§åˆ†ç±»éœ€è¦çµæ´»ï¼Œæ ¹æ®ä¸åŒåœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­å¹¶ä¿æŒæœ€ä½³è¿è¡ŒçŠ¶æ€ã€‚</p><h1 id=äºŒçº¿åšä»€ä¹ˆäº‹æƒ…ä¸€çº¿åé¦ˆåˆ°ä½ è¿™è¾¹æ€ä¹ˆå»è§£å†³>äºŒçº¿åšä»€ä¹ˆäº‹æƒ…ï¼Ÿä¸€çº¿åé¦ˆåˆ°ä½ è¿™è¾¹ï¼Œæ€ä¹ˆå»è§£å†³ï¼Ÿ
<a class=anchor href=#%e4%ba%8c%e7%ba%bf%e5%81%9a%e4%bb%80%e4%b9%88%e4%ba%8b%e6%83%85%e4%b8%80%e7%ba%bf%e5%8f%8d%e9%a6%88%e5%88%b0%e4%bd%a0%e8%bf%99%e8%be%b9%e6%80%8e%e4%b9%88%e5%8e%bb%e8%a7%a3%e5%86%b3>#</a></h1><p>åœ¨è¿ç»´æˆ–æŠ€æœ¯æ”¯æŒä¸­ï¼Œ<strong>äºŒçº¿æ”¯æŒ</strong>ï¼ˆL2ï¼‰é€šå¸¸æ˜¯ <strong>å¤„ç†å’Œè§£å†³ä¸€çº¿æ”¯æŒ</strong>ï¼ˆL1ï¼‰æ— æ³•è§£å†³çš„æ›´å¤æ‚é—®é¢˜çš„éƒ¨é—¨ã€‚äºŒçº¿æ”¯æŒé€šå¸¸å¤„ç†çš„é—®é¢˜æ¯”ä¸€çº¿æ›´å¤æ‚ï¼Œæ¶‰åŠåˆ°æ·±å…¥çš„æŠ€æœ¯åˆ†æã€æ•…éšœæ’æŸ¥ä»¥åŠç³»ç»Ÿä¼˜åŒ–ç­‰å·¥ä½œã€‚</p><h3 id=äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£><strong>äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£</strong>ï¼š
<a class=anchor href=#%e4%ba%8c%e7%ba%bf%e7%9a%84%e4%b8%bb%e8%a6%81%e5%b7%a5%e4%bd%9c%e8%81%8c%e8%b4%a3>#</a></h3><ol><li><strong>å¤æ‚é—®é¢˜æ’æŸ¥</strong>ï¼š<ul><li>ä¸€çº¿å¯èƒ½ä¼šæ”¶åˆ°æ¥è‡ªç”¨æˆ·çš„æ•…éšœåé¦ˆï¼ˆå¦‚ç³»ç»Ÿå´©æºƒã€æ€§èƒ½ä¸‹é™ç­‰ï¼‰ï¼Œä½†æ˜¯è¿™äº›é—®é¢˜è¶…å‡ºäº†ä»–ä»¬çš„è§£å†³èŒƒå›´ã€‚äºŒçº¿éœ€è¦æ¥æ‰‹è¿™äº›é—®é¢˜ï¼Œå¹¶é€šè¿‡æ›´è¯¦ç»†çš„æ—¥å¿—åˆ†æã€ç³»ç»Ÿé…ç½®æ£€æŸ¥ç­‰æ–¹æ³•è¿›è¡Œæ•…éšœå®šä½å’Œè§£å†³ã€‚</li><li>æ¯”å¦‚ï¼Œé’ˆå¯¹æœåŠ¡ç«¯å‡ºç°çš„æ€§èƒ½ç“¶é¢ˆã€æ•°æ®åº“æŸ¥è¯¢æ…¢ç­‰é—®é¢˜ï¼ŒäºŒçº¿å·¥ç¨‹å¸ˆéœ€è¦æ·±å…¥åˆ°ä»£ç ã€æ•°æ®åº“ã€é…ç½®æ–‡ä»¶ä»¥åŠç½‘ç»œå±‚çº§è¿›è¡Œæ’æŸ¥ã€‚</li></ul></li><li><strong>é—®é¢˜çš„æ ¹æœ¬åŸå› åˆ†æ</strong>ï¼š<ul><li>ä¸€çº¿é€šå¸¸é€šè¿‡æ ‡å‡†æµç¨‹è§£å†³å·²çŸ¥é—®é¢˜ï¼Œä½†å¦‚æœé—®é¢˜è¾ƒä¸ºå¤æ‚æˆ–æ²¡æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼ŒäºŒçº¿ä¼šè¿›è¡Œæ ¹æœ¬åŸå› åˆ†æï¼ˆRoot Cause Analysisï¼ŒRCAï¼‰ã€‚ä»–ä»¬ä¼šæŸ¥é˜…æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Œåˆ†æç³»ç»Ÿå¥åº·çŠ¶å†µï¼Œè¯Šæ–­å‡ºé—®é¢˜çš„æ ¹æºå¹¶åˆ¶å®šä¿®å¤æ–¹æ¡ˆã€‚</li></ul></li><li><strong>å¤„ç†ç³»ç»Ÿå¼‚å¸¸å’Œæ•…éšœ</strong>ï¼š<ul><li>äºŒçº¿æ”¯æŒå¤„ç†çš„ä¸€äº›é—®é¢˜å¯èƒ½æ¶‰åŠåˆ°ç³»ç»Ÿå´©æºƒã€ç¡¬ä»¶æ•…éšœã€ç½‘ç»œé—®é¢˜æˆ–æ˜¯ä¸ç¬¬ä¸‰æ–¹é›†æˆçš„æ•…éšœã€‚ä¾‹å¦‚ï¼ŒKubernetes é›†ç¾¤æ•…éšœã€ç½‘ç»œè¿æ¥ä¸­æ–­ç­‰ã€‚è¿™äº›éƒ½è¶…å‡ºäº†åŸºç¡€æ”¯æŒçš„èŒƒå›´ï¼ŒäºŒçº¿æ”¯æŒéœ€è¦å…·å¤‡è¾ƒå¼ºçš„æŠ€æœ¯èƒ½åŠ›æ¥è§£å†³ã€‚</li></ul></li><li><strong>éƒ¨ç½²ã€ç»´æŠ¤ä¸ä¼˜åŒ–</strong>ï¼š<ul><li>äºŒçº¿æ”¯æŒè¿˜ä¼šå‚ä¸ç³»ç»Ÿçš„ç»´æŠ¤å·¥ä½œï¼Œå¦‚å‡çº§ã€è¡¥ä¸ç®¡ç†ã€é…ç½®ä¼˜åŒ–ç­‰ã€‚ä»–ä»¬ä¼šå¯¹ç³»ç»Ÿè¿›è¡Œä¼˜åŒ–ï¼Œç¡®ä¿ç³»ç»Ÿè¿è¡Œç¨³å®šã€‚</li></ul></li><li><strong>ä¸å¼€å‘å›¢é˜Ÿçš„åä½œ</strong>ï¼š<ul><li>å½“é—®é¢˜æ¶‰åŠåˆ°ä»£ç æˆ–å¼€å‘å±‚é¢çš„ç¼ºé™·æ—¶ï¼ŒäºŒçº¿éœ€è¦ä¸å¼€å‘å›¢é˜Ÿç´§å¯†é…åˆï¼Œè¿›è¡Œä»£ç æ’æŸ¥ã€åŠŸèƒ½éªŒè¯å’Œä¿®å¤ã€‚</li></ul></li><li><strong>çŸ¥è¯†åº“ç®¡ç†</strong>ï¼š<ul><li>åœ¨å¤„ç†é—®é¢˜æ—¶ï¼ŒäºŒçº¿å›¢é˜Ÿè¿˜ä¼šç§¯ç´¯å¤§é‡çš„æŠ€æœ¯æ–‡æ¡£å’Œè§£å†³æ–¹æ¡ˆï¼Œè¿™äº›å¯ä»¥å¸®åŠ©ä¸€çº¿å¿«é€Ÿå®šä½å’Œè§£å†³å¸¸è§é—®é¢˜ã€‚å› æ­¤ï¼ŒäºŒçº¿æ”¯æŒéœ€è¦æŒç»­æ›´æ–°æŠ€æœ¯æ–‡æ¡£å’ŒçŸ¥è¯†åº“ã€‚</li></ul></li><li><strong>æä¾›æŠ€æœ¯æ”¯æŒä¸åŸ¹è®­</strong>ï¼š<ul><li>äºŒçº¿æ”¯æŒè¿˜è´Ÿè´£ä¸ºä¸€çº¿å›¢é˜Ÿæä¾›æŠ€æœ¯åŸ¹è®­å’ŒæŒ‡å¯¼ï¼Œä»¥æé«˜ä»–ä»¬çš„æŠ€æœ¯æ°´å¹³ï¼Œå‡å°‘é‡å¤æ€§æ•…éšœã€‚</li></ul></li></ol><h3 id=ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åå¦‚ä½•è§£å†³é—®é¢˜><strong>ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åï¼Œå¦‚ä½•è§£å†³é—®é¢˜ï¼Ÿ</strong>
<a class=anchor href=#%e4%b8%80%e7%ba%bf%e5%8f%8d%e9%a6%88%e5%88%b0%e4%ba%8c%e7%ba%bf%e5%90%8e%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98>#</a></h3><p>å½“ä¸€çº¿æ— æ³•è§£å†³çš„é—®é¢˜åé¦ˆç»™äºŒçº¿æ—¶ï¼Œè§£å†³è¿‡ç¨‹ä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>é—®é¢˜ç¡®è®¤ä¸åˆ†ç±»</strong>ï¼š<ul><li>é¦–å…ˆï¼ŒäºŒçº¿æ”¯æŒäººå‘˜ä¼šç¡®è®¤é—®é¢˜çš„æ€§è´¨ï¼Œå¹¶è¿›è¡Œåˆæ­¥åˆ†ç±»ã€‚æ¯”å¦‚ï¼Œæ˜¯ç¡¬ä»¶æ•…éšœã€è½¯ä»¶é—®é¢˜è¿˜æ˜¯ç½‘ç»œé—®é¢˜ã€‚</li><li>ç¡®è®¤ä¸€çº¿å·²ç»å°è¯•è¿‡çš„è§£å†³æ–¹æ³•ï¼Œå¹¶ç¡®è®¤æ‰€æœ‰åŸºæœ¬æ­¥éª¤ï¼ˆå¦‚é‡å¯æœåŠ¡ã€æ£€æŸ¥ç½‘ç»œè¿æ¥ç­‰ï¼‰å·²è¢«ä¸€çº¿æ‰§è¡Œã€‚</li></ul></li><li><strong>è·å–æ›´å¤šä¿¡æ¯</strong>ï¼š<ul><li>äºŒçº¿æ”¯æŒä¼šæ”¶é›†æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š<ul><li>é”™è¯¯æ—¥å¿—ã€ç³»ç»Ÿç›‘æ§æ•°æ®ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰</li><li>æ•…éšœå‘ç”Ÿæ—¶çš„ç¯å¢ƒï¼ˆå¦‚è´Ÿè½½ã€æµé‡ã€ç”¨æˆ·æ“ä½œç­‰ï¼‰</li><li>å‡ºç°é—®é¢˜çš„å…·ä½“æ­¥éª¤å’Œæ“ä½œæµç¨‹</li></ul></li><li>å¯ä»¥ä¸ç”¨æˆ·æˆ–ä¸€çº¿è¿›ä¸€æ­¥æ²Ÿé€šï¼Œç¡®è®¤è¯¦ç»†ä¿¡æ¯ã€‚</li></ul></li><li><strong>æ·±åº¦æ’æŸ¥ä¸åˆ†æ</strong>ï¼š<ul><li>åŸºäºæ”¶é›†åˆ°çš„ä¿¡æ¯ï¼ŒäºŒçº¿å·¥ç¨‹å¸ˆå¼€å§‹æ·±å…¥æ’æŸ¥ï¼Œå¯èƒ½ä¼šä½¿ç”¨æ›´å¤šçš„ç›‘æ§å·¥å…·ã€åˆ†æå·¥å…·æˆ–è€…æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç³»ç»Ÿç“¶é¢ˆã€é…ç½®é”™è¯¯æˆ–è€…å…¶ä»–å½±å“å› ç´ ã€‚</li><li>å¦‚æ¶‰åŠåˆ°å¤æ‚çš„ç³»ç»Ÿæ¶æ„é—®é¢˜ï¼ŒäºŒçº¿æ”¯æŒäººå‘˜å¯èƒ½éœ€è¦æ’æŸ¥ç½‘ç»œã€æ•°æ®åº“ã€å¾®æœåŠ¡ä¹‹é—´çš„ä¾èµ–ï¼ŒæŸ¥æ‰¾å¯èƒ½çš„ç“¶é¢ˆã€‚</li></ul></li><li><strong>è§£å†³æ–¹æ¡ˆçš„è®¾è®¡ä¸éªŒè¯</strong>ï¼š<ul><li>äºŒçº¿æ”¯æŒäººå‘˜ä¼šæ ¹æ®æ•…éšœçš„æ ¹æœ¬åŸå› ï¼Œè®¾è®¡ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆå¯èƒ½æ¶‰åŠåˆ°ï¼š<ul><li>ç³»ç»Ÿé‡å¯</li><li>åº”ç”¨é…ç½®ä¿®æ”¹</li><li>è½¯ä»¶å‡çº§æˆ–å›æ»š</li><li>å¢åŠ ç¡¬ä»¶èµ„æº</li></ul></li><li>è®¾è®¡å®Œæ–¹æ¡ˆåï¼ŒäºŒçº¿ä¼šè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿æ–¹æ¡ˆæœ‰æ•ˆå¹¶ä¸ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚</li></ul></li><li><strong>æ‰§è¡Œä¿®å¤</strong>ï¼š<ul><li>ç¡®è®¤è§£å†³æ–¹æ¡ˆåï¼ŒäºŒçº¿æ”¯æŒå›¢é˜Ÿä¼šæ‰§è¡Œä¿®å¤å·¥ä½œï¼Œæ¢å¤ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ä¿®å¤è¿‡ç¨‹ä¸­ï¼ŒäºŒçº¿æ”¯æŒäººå‘˜éœ€è¦ç¡®ä¿ä¸å½±å“å…¶ä»–æ­£å¸¸è¿è¡Œçš„æœåŠ¡æˆ–ç³»ç»Ÿã€‚</li></ul></li><li><strong>éªŒè¯ä¸ç›‘æ§</strong>ï¼š<ul><li>æ•…éšœä¿®å¤åï¼ŒäºŒçº¿å›¢é˜Ÿä¼šè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿ç³»ç»Ÿæ¢å¤æ­£å¸¸ï¼Œå¹¶é€šè¿‡ç›‘æ§å·¥å…·è¿›è¡ŒæŒç»­è·Ÿè¸ªï¼Œç¡®è®¤é—®é¢˜æ²¡æœ‰å¤å‘ã€‚</li></ul></li><li><strong>æŠ¥å‘Šä¸åé¦ˆ</strong>ï¼š<ul><li>æ•…éšœè§£å†³åï¼ŒäºŒçº¿ä¼šå‘ä¸€çº¿æä¾›è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆä¸æŠ¥å‘Šï¼Œå¸®åŠ©ä¸€çº¿äº†è§£å¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜çš„å‘ç”Ÿã€‚</li><li>è®°å½•è§£å†³æ–¹æ¡ˆå’Œè¿‡ç¨‹ï¼Œä»¥ä¾¿åç»­å‚è€ƒã€‚</li></ul></li><li><strong>æ€»ç»“ä¸çŸ¥è¯†åº“æ›´æ–°</strong>ï¼š<ul><li>å°†è¯¥æ•…éšœçš„è¯¦ç»†å¤„ç†è¿‡ç¨‹ã€è§£å†³æ–¹æ³•æ€»ç»“åˆ°çŸ¥è¯†åº“æˆ–æ–‡æ¡£ä¸­ï¼Œæ–¹ä¾¿æœªæ¥ç›¸ä¼¼é—®é¢˜çš„å¿«é€Ÿè§£å†³ã€‚</li></ul></li></ol><h3 id=æ€»ç»“-8><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-8>#</a></h3><ul><li><strong>ä¸€çº¿åé¦ˆ</strong>ç»™äºŒçº¿åï¼ŒäºŒçº¿è¦é¦–å…ˆç¡®è®¤é—®é¢˜çš„æ€§è´¨ï¼Œæ”¶é›†æ›´å¤šçš„ä¿¡æ¯ï¼Œè¿›è¡Œæ·±åº¦åˆ†æï¼Œè®¾è®¡å’Œæ‰§è¡Œä¿®å¤æ–¹æ¡ˆã€‚</li><li>æ•´ä¸ªè¿‡ç¨‹éœ€è¦æ ¹æ®æ•…éšœçš„ä¸¥é‡æ€§ã€å½±å“èŒƒå›´å’Œä¼˜å…ˆçº§æ¥è¿›è¡Œï¼Œæœ‰æ—¶éœ€è¦å’Œå…¶ä»–å›¢é˜Ÿï¼ˆå¦‚å¼€å‘ã€è¿ç»´ï¼‰åˆä½œè§£å†³é—®é¢˜ã€‚</li><li>äºŒçº¿æ”¯æŒä¸ä»…ä»…æ˜¯ä¿®å¤é—®é¢˜ï¼Œè¿˜è¦ä¸æ–­æ€»ç»“ç»éªŒï¼Œä¼˜åŒ–å·¥ä½œæµç¨‹ï¼Œæé«˜æ•´ä½“çš„è§£å†³æ•ˆç‡ã€‚</li></ul><h1 id=ç¦»èŒåŸå› >ç¦»èŒåŸå› ï¼Ÿ
<a class=anchor href=#%e7%a6%bb%e8%81%8c%e5%8e%9f%e5%9b%a0>#</a></h1><p>å®¶åº­åŸå› </p><h1 id=æ›´ååŸºç¡€è¿ç»´-ç³»ç»Ÿè¿ç»´é’ˆå¯¹ä¸šåŠ¡å»è¿ç»´>æ›´ååŸºç¡€è¿ç»´ ï¼Œç³»ç»Ÿè¿ç»´ï¼Œé’ˆå¯¹ä¸šåŠ¡å»è¿ç»´ï¼Ÿ
<a class=anchor href=#%e6%9b%b4%e5%81%8f%e5%9f%ba%e7%a1%80%e8%bf%90%e7%bb%b4-%e7%b3%bb%e7%bb%9f%e8%bf%90%e7%bb%b4%e9%92%88%e5%af%b9%e4%b8%9a%e5%8a%a1%e5%8e%bb%e8%bf%90%e7%bb%b4>#</a></h1><p><strong>ä¸šåŠ¡è¿ç»´</strong>å’Œ<strong>ç³»ç»Ÿè¿ç»´</strong>è™½ç„¶åœ¨ç›®æ ‡ä¸Šæœ‰é‡å ï¼Œä½†ä¾§é‡ç‚¹å’ŒèŒè´£ä¸åŒã€‚ä¸‹é¢æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼š</p><h3 id=1-å®šä¹‰å’Œé‡ç‚¹><strong>1. å®šä¹‰å’Œé‡ç‚¹</strong>
<a class=anchor href=#1-%e5%ae%9a%e4%b9%89%e5%92%8c%e9%87%8d%e7%82%b9>#</a></h3><ul><li><strong>ä¸šåŠ¡è¿ç»´</strong>ï¼š<ul><li><strong>å®šä¹‰</strong>ï¼šä¸šåŠ¡è¿ç»´ä¸»è¦å…³æ³¨çš„æ˜¯é€šè¿‡æŠ€æœ¯æ‰‹æ®µæ”¯æŒå’Œä¼˜åŒ–ä¸šåŠ¡æµç¨‹ï¼Œç¡®ä¿ä¸šåŠ¡ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€æ€§èƒ½ã€æ‰©å±•æ€§ã€å®‰å…¨æ€§ç­‰ï¼Œæœ€å¤§åŒ–åœ°æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</li><li><strong>é‡ç‚¹</strong>ï¼šä¸šåŠ¡è¿ç»´çš„é‡ç‚¹æ˜¯æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚æ¥ä¼˜åŒ–ç³»ç»Ÿæ¶æ„å’Œæµç¨‹ã€‚å®ƒä¾§é‡äºä¸šåŠ¡å±‚é¢çš„æ”¯æŒï¼Œæ¯”å¦‚ä¸šåŠ¡é«˜å³°æœŸæµé‡çš„ä¿éšœã€åº”ç”¨çš„å¯ç”¨æ€§ã€æ•°æ®å¤„ç†èƒ½åŠ›ç­‰ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šä¸ºä¸šåŠ¡æä¾›æŒç»­ã€ç¨³å®šã€é«˜æ•ˆçš„è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¿è¯ä¸šåŠ¡ç³»ç»Ÿèƒ½å¤Ÿçµæ´»åº”å¯¹ä¸šåŠ¡å˜åŠ¨ï¼Œæä¾›é«˜è´¨é‡çš„æœåŠ¡ã€‚</li></ul></li><li><strong>ç³»ç»Ÿè¿ç»´</strong>ï¼š<ul><li><strong>å®šä¹‰</strong>ï¼šç³»ç»Ÿè¿ç»´æ˜¯æŒ‡å¯¹ IT åŸºç¡€è®¾æ–½ï¼ˆå¦‚æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€å­˜å‚¨ç­‰ï¼‰è¿›è¡Œæ—¥å¸¸ç®¡ç†å’Œç»´æŠ¤ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šã€å¯ç”¨å’Œå®‰å…¨ã€‚å…¶èŒè´£é€šå¸¸åŒ…æ‹¬ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€ä¸­é—´ä»¶ç­‰æŠ€æœ¯å±‚é¢çš„ç»´æŠ¤ã€‚</li><li><strong>é‡ç‚¹</strong>ï¼šç³»ç»Ÿè¿ç»´ä¸»è¦å…³æ³¨åº•å±‚ IT èµ„æºçš„ç®¡ç†å’Œä¼˜åŒ–ï¼Œå¦‚æœåŠ¡å™¨ã€å­˜å‚¨ã€ç½‘ç»œç­‰ç¡¬ä»¶èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€åº”ç”¨æœåŠ¡å™¨ç­‰çš„è½¯ä»¶ç»´æŠ¤ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šç¡®ä¿æŠ€æœ¯åŸºç¡€è®¾æ–½ç¨³å®šè¿è¡Œï¼Œä¸ºä¸Šå±‚ä¸šåŠ¡æä¾›æ”¯æ’‘ï¼Œä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œå¤„ç†ç¡¬ä»¶æ•…éšœã€ç³»ç»Ÿæ¼æ´ã€å®‰å…¨æ€§é—®é¢˜ç­‰ã€‚</li></ul></li></ul><h3 id=2-ä¸»è¦èŒè´£><strong>2. ä¸»è¦èŒè´£</strong>
<a class=anchor href=#2-%e4%b8%bb%e8%a6%81%e8%81%8c%e8%b4%a3>#</a></h3><ul><li><strong>ä¸šåŠ¡è¿ç»´çš„èŒè´£</strong>ï¼š<ul><li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡ç³»ç»Ÿæ¶æ„å’Œèµ„æºè§„åˆ’ï¼Œç¡®ä¿ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</li><li>ç›‘æ§ä¸åˆ†æä¸šåŠ¡ç³»ç»Ÿçš„æ€§èƒ½ã€æµé‡ç­‰æŒ‡æ ‡ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ã€‚</li><li>é…ç½®å’Œç»´æŠ¤ä¸ä¸šåŠ¡ç´§å¯†ç›¸å…³çš„åº”ç”¨ã€æœåŠ¡ï¼ˆå¦‚ Web æœåŠ¡ã€æ•°æ®åº“é›†ç¾¤ã€ç¼“å­˜æœåŠ¡ç­‰ï¼‰ã€‚</li><li>ç®¡ç†ä¸šåŠ¡çº§åˆ«çš„æ•…éšœæ’æŸ¥å’Œæ¢å¤ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚</li><li>ä¸å¼€å‘å›¢é˜Ÿç´§å¯†åä½œï¼Œç¡®ä¿éƒ¨ç½²æµç¨‹ã€ä»£ç å‘å¸ƒç­‰ä¸ä¸šåŠ¡éœ€æ±‚ç›¸åŒ¹é…ã€‚</li><li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®¹é‡è§„åˆ’ï¼Œæ”¯æŒä¸šåŠ¡å¢é•¿ã€‚</li><li>ç¾éš¾æ¢å¤è§„åˆ’å’Œä¸šåŠ¡ç³»ç»Ÿå¤‡ä»½ï¼Œç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæ—¶ä¸šåŠ¡èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚</li></ul></li><li><strong>ç³»ç»Ÿè¿ç»´çš„èŒè´£</strong>ï¼š<ul><li>ç®¡ç†å’Œç»´æŠ¤ IT åŸºç¡€è®¾æ–½ï¼ˆæœåŠ¡å™¨ã€å­˜å‚¨ã€ç½‘ç»œç­‰ç¡¬ä»¶èµ„æºï¼‰ã€‚</li><li>é…ç½®å’Œç»´æŠ¤æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€ä¸­é—´ä»¶ç­‰åŸºç¡€è½¯ä»¶ã€‚</li><li>æ‰§è¡Œæ—¥å¸¸ç›‘æ§ã€æ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</li><li>ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œç®¡ç†æƒé™å’Œå®‰å…¨ç­–ç•¥ã€‚</li><li>æ‰§è¡Œå®šæœŸå¤‡ä»½ã€è¡¥ä¸ç®¡ç†ã€æ—¥å¿—ç®¡ç†ç­‰ä»»åŠ¡ã€‚</li><li>å¤„ç†ç¡¬ä»¶æ•…éšœã€ç³»ç»Ÿå´©æºƒã€ç½‘ç»œå»¶è¿Ÿç­‰æŠ€æœ¯é—®é¢˜ã€‚</li><li>è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå‡å°‘äººå·¥æ“ä½œï¼Œæé«˜è¿ç»´æ•ˆç‡ã€‚</li></ul></li></ul><h3 id=3-å…³æ³¨ç‚¹å’Œç›®æ ‡><strong>3. å…³æ³¨ç‚¹å’Œç›®æ ‡</strong>
<a class=anchor href=#3-%e5%85%b3%e6%b3%a8%e7%82%b9%e5%92%8c%e7%9b%ae%e6%a0%87>#</a></h3><ul><li><strong>ä¸šåŠ¡è¿ç»´å…³æ³¨ç‚¹</strong>ï¼š<ul><li><strong>ä¸šåŠ¡éœ€æ±‚</strong>ï¼šä¸šåŠ¡è¿ç»´å¼ºè°ƒä¸ä¸šåŠ¡éƒ¨é—¨çš„ç´§å¯†é…åˆï¼Œç¡®ä¿æŠ€æœ¯å¹³å°èƒ½å¤Ÿæ”¯æŒä¸æ–­å˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚ã€‚é€šè¿‡ä¼˜åŒ–æ¶æ„å’Œèµ„æºé…ç½®ï¼Œä¿è¯ä¸šåŠ¡ç³»ç»Ÿèƒ½å¤Ÿçµæ´»æ‰©å±•ã€‚</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé‡ç‚¹å…³æ³¨æœ€ç»ˆç”¨æˆ·ä½“éªŒï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œæ»¡è¶³é«˜å¹¶å‘ã€é«˜å¯ç”¨ç­‰éœ€æ±‚ã€‚</li><li><strong>å®¹é‡è§„åˆ’</strong>ï¼šæ ¹æ®ä¸šåŠ¡çš„å¢é•¿è¶‹åŠ¿è¿›è¡Œå®¹é‡è§„åˆ’ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½æˆ–èµ„æºæµªè´¹ã€‚</li></ul></li><li><strong>ç³»ç»Ÿè¿ç»´å…³æ³¨ç‚¹</strong>ï¼š<ul><li><strong>æŠ€æœ¯ç¨³å®šæ€§</strong>ï¼šç³»ç»Ÿè¿ç»´é‡ç‚¹æ˜¯ä¿éšœåŸºç¡€è®¾æ–½çš„ç¨³å®šè¿è¡Œï¼Œå…³æ³¨ç¡¬ä»¶èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ï¼Œæ“ä½œç³»ç»Ÿå’Œä¸­é—´ä»¶çš„ç¨³å®šæ€§ã€‚</li><li><strong>æ•…éšœæ’é™¤</strong>ï¼šå½“å‘ç”Ÿç³»ç»Ÿæ•…éšœæ—¶ï¼Œç³»ç»Ÿè¿ç»´è´Ÿè´£å¿«é€Ÿå®šä½é—®é¢˜å¹¶æ¢å¤æœåŠ¡ï¼Œé¿å…å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç³»ç»Ÿè¿ç»´ä¼šè¿›è¡Œå®šæœŸçš„å®‰å…¨æ£€æŸ¥ï¼Œç¡®ä¿ç³»ç»Ÿæ²¡æœ‰å®‰å…¨æ¼æ´ï¼Œé˜²æ­¢æ”»å‡»å’Œæ•°æ®æ³„éœ²ã€‚</li></ul></li></ul><h3 id=4-è·¨éƒ¨é—¨åä½œ><strong>4. è·¨éƒ¨é—¨åä½œ</strong>
<a class=anchor href=#4-%e8%b7%a8%e9%83%a8%e9%97%a8%e5%8d%8f%e4%bd%9c>#</a></h3><ul><li><strong>ä¸šåŠ¡è¿ç»´</strong>ï¼šé€šå¸¸éœ€è¦ä¸ <strong>ä¸šåŠ¡å›¢é˜Ÿ</strong>ã€<strong>äº§å“å›¢é˜Ÿ</strong>ã€<strong>å¼€å‘å›¢é˜Ÿ</strong> ç­‰è¿›è¡Œå¯†åˆ‡çš„æ²Ÿé€šå’Œåä½œã€‚ä¸šåŠ¡è¿ç»´äººå‘˜ä¸ä»…è¦äº†è§£æŠ€æœ¯ç»†èŠ‚ï¼Œè¿˜è¦ç†è§£ä¸šåŠ¡é€»è¾‘ï¼Œä»¥ä¾¿ä¸ºä¸šåŠ¡æä¾›æ›´ç²¾ç¡®çš„æŠ€æœ¯æ”¯æŒã€‚</li><li><strong>ç³»ç»Ÿè¿ç»´</strong>ï¼šé€šå¸¸ä¸»è¦ä¸ <strong>å¼€å‘å›¢é˜Ÿ</strong> å’Œ <strong>åŸºç¡€è®¾æ–½å›¢é˜Ÿ</strong> åä½œï¼Œå…³æ³¨åŸºç¡€è®¾æ–½çš„æ„å»ºå’Œç»´æŠ¤ã€‚ç³»ç»Ÿè¿ç»´äººå‘˜éœ€è¦ç†è§£ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿå’Œä¸­é—´ä»¶çš„å·¥ä½œåŸç†ï¼Œç¡®ä¿æŠ€æœ¯å¹³å°çš„ç¨³å®šæ€§ã€‚</li></ul><h3 id=5-è¿ç»´å·¥å…·ä¸æŠ€æœ¯><strong>5. è¿ç»´å·¥å…·ä¸æŠ€æœ¯</strong>
<a class=anchor href=#5-%e8%bf%90%e7%bb%b4%e5%b7%a5%e5%85%b7%e4%b8%8e%e6%8a%80%e6%9c%af>#</a></h3><ul><li>ä¸šåŠ¡è¿ç»´çš„å·¥å…·ä¸æŠ€æœ¯ï¼š<ul><li><strong>ç›‘æ§å·¥å…·</strong>ï¼šä½¿ç”¨ä¸šåŠ¡ç›‘æ§å·¥å…·ï¼Œå¦‚ Prometheusã€Grafana ç­‰ï¼Œæ¥ç›‘æ§ä¸ä¸šåŠ¡ç›¸å…³çš„æŒ‡æ ‡ï¼ˆå¦‚äº¤æ˜“é‡ã€å“åº”æ—¶é—´ã€ç”¨æˆ·è®¿é—®é‡ç­‰ï¼‰ã€‚</li><li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šä½¿ç”¨ ELK Stackã€Fluentd ç­‰å·¥å…·æ”¶é›†å’Œåˆ†æä¸šåŠ¡æ—¥å¿—ï¼Œå‘ç°æ½œåœ¨é—®é¢˜ã€‚</li><li><strong>è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸å‘å¸ƒ</strong>ï¼šé€šè¿‡ CI/CD å·¥å…·ï¼ˆå¦‚ Jenkinsã€GitLab CI ç­‰ï¼‰è‡ªåŠ¨åŒ–ä»£ç çš„æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²å’Œå‘å¸ƒï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚</li></ul></li><li>ç³»ç»Ÿè¿ç»´çš„å·¥å…·ä¸æŠ€æœ¯ï¼š<ul><li><strong>ç›‘æ§å·¥å…·</strong>ï¼šä½¿ç”¨ç³»ç»Ÿç›‘æ§å·¥å…·ï¼Œå¦‚ Zabbixã€Nagiosã€Prometheus ç­‰ï¼Œæ¥ç›‘æ§æœåŠ¡å™¨ã€ç½‘ç»œã€å­˜å‚¨ç­‰ç¡¬ä»¶èµ„æºçš„çŠ¶æ€ã€‚</li><li><strong>è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·</strong>ï¼šä½¿ç”¨ Ansibleã€Puppetã€Chef ç­‰è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œèµ„æºé…ç½®ã€è¡¥ä¸ç®¡ç†ã€æ•…éšœæ¢å¤ç­‰ã€‚</li><li><strong>å®¹å™¨ä¸è™šæ‹ŸåŒ–ç®¡ç†</strong>ï¼šä½¿ç”¨ Kubernetesã€Docker ç­‰å®¹å™¨åŒ–æŠ€æœ¯è¿›è¡Œåº”ç”¨çš„éƒ¨ç½²ã€ç®¡ç†å’Œè°ƒåº¦ã€‚</li></ul></li></ul><h3 id=æ€»ç»“-9><strong>æ€»ç»“</strong>
<a class=anchor href=#%e6%80%bb%e7%bb%93-9>#</a></h3><ul><li><strong>ä¸šåŠ¡è¿ç»´</strong>æ˜¯å›´ç»•ä¸šåŠ¡éœ€æ±‚å’Œä¸šåŠ¡ç³»ç»Ÿè¿›è¡Œçš„è¿ç»´å·¥ä½œï¼Œé‡ç‚¹æ˜¯ä¿éšœä¸šåŠ¡åº”ç”¨çš„ç¨³å®šè¿è¡Œå’Œé«˜æ•ˆå“åº”ã€‚</li><li><strong>ç³»ç»Ÿè¿ç»´</strong>æ˜¯å…³æ³¨åº•å±‚æŠ€æœ¯åŸºç¡€è®¾æ–½çš„è¿ç»´ï¼Œç¡®ä¿æ“ä½œç³»ç»Ÿã€ç½‘ç»œã€ç¡¬ä»¶ç­‰ç»„ä»¶çš„ç¨³å®šã€å®‰å…¨å’Œé«˜æ•ˆè¿è¡Œã€‚</li></ul><p>ä¸¤è€…çš„ç›®æ ‡è™½ç„¶ä¸åŒï¼Œä½†æœ€ç»ˆéƒ½æ˜¯ä¸ºäº†ç¡®ä¿ IT ç³»ç»Ÿèƒ½å¤Ÿç¨³å®šæ”¯æŒä¸šåŠ¡çš„è¿è¥ã€‚ä¸šåŠ¡è¿ç»´æ›´å¤šå…³æ³¨å¦‚ä½•å°†æŠ€æœ¯ä¸ä¸šåŠ¡ç›®æ ‡å¯¹æ¥ï¼Œè€Œç³»ç»Ÿè¿ç»´åˆ™æ›´å¤šå…³æ³¨å¦‚ä½•ç®¡ç†å’Œç»´æŠ¤æŠ€æœ¯èµ„æºä»¥æ”¯æŒä¸Šå±‚åº”ç”¨ã€‚</p><h1 id=è¿ç»´å›¢é˜Ÿç®¡ç†æœºå™¨å¤šå°‘å°>è¿ç»´å›¢é˜Ÿï¼Ÿç®¡ç†æœºå™¨å¤šå°‘å°ï¼Ÿ
<a class=anchor href=#%e8%bf%90%e7%bb%b4%e5%9b%a2%e9%98%9f%e7%ae%a1%e7%90%86%e6%9c%ba%e5%99%a8%e5%a4%9a%e5%b0%91%e5%8f%b0>#</a></h1><h1 id=è´Ÿè´£é“¾è·¯åˆ†å‘çš„ä¸šåŠ¡è¿ç»´-æ‰‹æœºçš„appçš„å“åº”-å‘Šè­¦-ä¸šåŠ¡éœ€æ±‚ä¸Šä¸‡å°æœºå™¨å†…å®¹åˆ†å‘å‡ åƒå°>è´Ÿè´£é“¾è·¯åˆ†å‘çš„ä¸šåŠ¡è¿ç»´ æ‰‹æœºçš„appçš„å“åº” å‘Šè­¦ ä¸šåŠ¡éœ€æ±‚ï¼Œä¸Šä¸‡å°æœºå™¨ï¼Œå†…å®¹åˆ†å‘å‡ åƒå°ï¼Ÿ
<a class=anchor href=#%e8%b4%9f%e8%b4%a3%e9%93%be%e8%b7%af%e5%88%86%e5%8f%91%e7%9a%84%e4%b8%9a%e5%8a%a1%e8%bf%90%e7%bb%b4-%e6%89%8b%e6%9c%ba%e7%9a%84app%e7%9a%84%e5%93%8d%e5%ba%94-%e5%91%8a%e8%ad%a6-%e4%b8%9a%e5%8a%a1%e9%9c%80%e6%b1%82%e4%b8%8a%e4%b8%87%e5%8f%b0%e6%9c%ba%e5%99%a8%e5%86%85%e5%ae%b9%e5%88%86%e5%8f%91%e5%87%a0%e5%8d%83%e5%8f%b0>#</a></h1><h1 id=é“¾è·¯åˆ†å‘åŒ…å«ä¸šåŠ¡-ä¸€ä¸ªäººç»´æŠ¤å¥½å‡ ä¸ªä¸šåŠ¡å·¥ä½œå¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯è¿™æ ·å¯¹æ¥å¼€å‘çš„éœ€æ±‚ä¸€çº¿ç™½å±åŒ–æ“ä½œå¸®åšä¸šåŠ¡è¾¾æˆç›®æ ‡åœ¨é¡¹ç›®é‡Œé¢ä¸€çº¿åæ‰§è¡Œè¿™å—>é“¾è·¯åˆ†å‘åŒ…å«ä¸šåŠ¡ ï¼Œä¸€ä¸ªäººç»´æŠ¤å¥½å‡ ä¸ªä¸šåŠ¡ï¼Œå·¥ä½œå¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯è¿™æ ·ï¼Œå¯¹æ¥å¼€å‘çš„éœ€æ±‚ï¼Œä¸€çº¿ç™½å±åŒ–æ“ä½œï¼Œå¸®åšä¸šåŠ¡è¾¾æˆç›®æ ‡ï¼Œåœ¨é¡¹ç›®é‡Œé¢ï¼Œä¸€çº¿åæ‰§è¡Œè¿™å—ã€‚
<a class=anchor href=#%e9%93%be%e8%b7%af%e5%88%86%e5%8f%91%e5%8c%85%e5%90%ab%e4%b8%9a%e5%8a%a1-%e4%b8%80%e4%b8%aa%e4%ba%ba%e7%bb%b4%e6%8a%a4%e5%a5%bd%e5%87%a0%e4%b8%aa%e4%b8%9a%e5%8a%a1%e5%b7%a5%e4%bd%9c%e5%be%88%e5%a4%a7%e4%b8%80%e9%83%a8%e5%88%86%e6%98%af%e8%bf%99%e6%a0%b7%e5%af%b9%e6%8e%a5%e5%bc%80%e5%8f%91%e7%9a%84%e9%9c%80%e6%b1%82%e4%b8%80%e7%ba%bf%e7%99%bd%e5%b1%8f%e5%8c%96%e6%93%8d%e4%bd%9c%e5%b8%ae%e5%81%9a%e4%b8%9a%e5%8a%a1%e8%be%be%e6%88%90%e7%9b%ae%e6%a0%87%e5%9c%a8%e9%a1%b9%e7%9b%ae%e9%87%8c%e9%9d%a2%e4%b8%80%e7%ba%bf%e5%81%8f%e6%89%a7%e8%a1%8c%e8%bf%99%e5%9d%97>#</a></h1><h1 id=å›¢é˜Ÿçš„ç®¡ç†å’Œæ–‡åŒ–æ°›å›´æ—©ä¸Š9ç‚¹-æ™šä¸Š7ç‚¹9ç‚¹åŠ-7ç‚¹åŠ ç­ä¸å¼ºåˆ¶å¼€ä¼šæœ‰éœ€è¦å°±å¼€>å›¢é˜Ÿçš„ç®¡ç†å’Œæ–‡åŒ–æ°›å›´ï¼Ÿæ—©ä¸Š9ç‚¹-æ™šä¸Š7ç‚¹ï¼Œ9ç‚¹åŠ-7ç‚¹ï¼ŒåŠ ç­ä¸å¼ºåˆ¶ï¼Œå¼€ä¼šæœ‰éœ€è¦å°±å¼€
<a class=anchor href=#%e5%9b%a2%e9%98%9f%e7%9a%84%e7%ae%a1%e7%90%86%e5%92%8c%e6%96%87%e5%8c%96%e6%b0%9b%e5%9b%b4%e6%97%a9%e4%b8%8a9%e7%82%b9-%e6%99%9a%e4%b8%8a7%e7%82%b99%e7%82%b9%e5%8d%8a-7%e7%82%b9%e5%8a%a0%e7%8f%ad%e4%b8%8d%e5%bc%ba%e5%88%b6%e5%bc%80%e4%bc%9a%e6%9c%89%e9%9c%80%e8%a6%81%e5%b0%b1%e5%bc%80>#</a></h1><h1 id=ç®¡ç†æ²¡è¿™ä¹ˆå·>ç®¡ç†æ²¡è¿™ä¹ˆå·ï¼Œ
<a class=anchor href=#%e7%ae%a1%e7%90%86%e6%b2%a1%e8%bf%99%e4%b9%88%e5%8d%b7>#</a></h1><h1 id=æ—¥å¸¸åº”ç”¨å‘å¸ƒ-å˜æ›´ä»€ä¹ˆæ—¶é—´æ“ä½œçœ‹ä¸šåŠ¡ä¸šåŠ¡ç¨³å®šå¥½å‡ å‘¨å‘ä¸€æ¬¡è¿­ä»£çš„ä¸€å‘¨2-3æ¬¡>æ—¥å¸¸åº”ç”¨å‘å¸ƒ å˜æ›´ï¼Ÿä»€ä¹ˆæ—¶é—´æ“ä½œï¼Ÿçœ‹ä¸šåŠ¡ï¼Œä¸šåŠ¡ç¨³å®šï¼Œå¥½å‡ å‘¨å‘ä¸€æ¬¡ï¼Œè¿­ä»£çš„ä¸€å‘¨2-3æ¬¡
<a class=anchor href=#%e6%97%a5%e5%b8%b8%e5%ba%94%e7%94%a8%e5%8f%91%e5%b8%83-%e5%8f%98%e6%9b%b4%e4%bb%80%e4%b9%88%e6%97%b6%e9%97%b4%e6%93%8d%e4%bd%9c%e7%9c%8b%e4%b8%9a%e5%8a%a1%e4%b8%9a%e5%8a%a1%e7%a8%b3%e5%ae%9a%e5%a5%bd%e5%87%a0%e5%91%a8%e5%8f%91%e4%b8%80%e6%ac%a1%e8%bf%ad%e4%bb%a3%e7%9a%84%e4%b8%80%e5%91%a82-3%e6%ac%a1>#</a></h1><h1 id=ç™½å¤©æ“ä½œæ™šä¸Šä¸å…è®¸å˜æ›´å‘¨ä¸€åˆ°å‘¨äº”-æ—©ä¸Š10-ä¸‹åˆ6ç‚¹>ç™½å¤©æ“ä½œï¼Œæ™šä¸Šä¸å…è®¸å˜æ›´ï¼Œå‘¨ä¸€åˆ°å‘¨äº” æ—©ä¸Š10-ä¸‹åˆ6ç‚¹ã€‚
<a class=anchor href=#%e7%99%bd%e5%a4%a9%e6%93%8d%e4%bd%9c%e6%99%9a%e4%b8%8a%e4%b8%8d%e5%85%81%e8%ae%b8%e5%8f%98%e6%9b%b4%e5%91%a8%e4%b8%80%e5%88%b0%e5%91%a8%e4%ba%94-%e6%97%a9%e4%b8%8a10-%e4%b8%8b%e5%8d%886%e7%82%b9>#</a></h1></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#1-5ä¸ª-master-èŠ‚ç‚¹æ§åˆ¶é¢>1. <strong>5ä¸ª Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰</strong></a></li><li><a href=#2-node-èŠ‚ç‚¹å·¥ä½œèŠ‚ç‚¹>2. <strong>Node èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰</strong></a></li><li><a href=#3-è”é‚¦æ¶æ„federation>3. <strong>è”é‚¦æ¶æ„ï¼ˆFederationï¼‰</strong></a></li><li><a href=#4-ad-bc-åˆ†åŒº>4. <strong>AD BC åˆ†åŒº</strong></a></li><li><a href=#5-å¤š-az-è·¨æœºæˆ¿å®¹ç¾è®¾è®¡>5. <strong>å¤š AZ è·¨æœºæˆ¿å®¹ç¾è®¾è®¡</strong></a></li><li><a href=#6-å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡>6. <strong>å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡</strong></a></li><li><a href=#7-ç¾éš¾æ¢å¤ä¸å®¹é”™>7. <strong>ç¾éš¾æ¢å¤ä¸å®¹é”™</strong></a></li><li><a href=#8-å¤‡ä»½ä¸æ¢å¤>8. <strong>å¤‡ä»½ä¸æ¢å¤</strong></a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></li></ul><ul><li><a href=#1-etcd-å®¹ç¾æ–¹æ¡ˆ><strong>1. etcd å®¹ç¾æ–¹æ¡ˆ</strong></a><ul><li><a href=#1-etcd-é«˜å¯ç”¨éƒ¨ç½²><strong>(1) etcd é«˜å¯ç”¨éƒ¨ç½²</strong></a></li><li><a href=#2-etcd-å¤‡ä»½ä¸æ¢å¤><strong>(2) etcd å¤‡ä»½ä¸æ¢å¤</strong></a></li><li><a href=#3-etcd-è‡ªåŠ¨æ•…éšœè½¬ç§»><strong>(3) etcd è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></a></li></ul></li><li><a href=#2-kubernetes-æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ><strong>2. Kubernetes æ§åˆ¶é¢ç»„ä»¶å®¹ç¾æ–¹æ¡ˆ</strong></a><ul><li><a href=#1-é«˜å¯ç”¨æ¶æ„><strong>(1) é«˜å¯ç”¨æ¶æ„</strong></a></li><li><a href=#2-ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤><strong>(2) ç›‘æ§ä¸è‡ªåŠ¨æ¢å¤</strong></a></li><li><a href=#3-å¤‡ä»½ä¸æ¢å¤><strong>(3) å¤‡ä»½ä¸æ¢å¤</strong></a></li></ul></li><li><a href=#3-æ•…éšœæ¢å¤ç­–ç•¥><strong>3. æ•…éšœæ¢å¤ç­–ç•¥</strong></a></li><li><a href=#4-ç»“è®º><strong>4. ç»“è®º</strong></a></li></ul><ul><li><a href=#kubernetes-å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡><strong>Kubernetes å®¹ç¾æ¼”ç»ƒæ–¹æ¡ˆè®¾è®¡</strong></a></li></ul><ul><li><a href=#-åœºæ™¯-1etcd-æ•…éšœ><strong>ğŸŸ¢ åœºæ™¯ 1ï¼šetcd æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-2master-èŠ‚ç‚¹æ•…éšœ><strong>ğŸŸ¡ åœºæ™¯ 2ï¼šMaster èŠ‚ç‚¹æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-3node-è®¡ç®—èŠ‚ç‚¹æ•…éšœ><strong>ğŸ”´ åœºæ™¯ 3ï¼šNode è®¡ç®—èŠ‚ç‚¹æ•…éšœ</strong></a></li><li><a href=#-åœºæ™¯-4ingressservice-è´Ÿè½½å‡è¡¡å¼‚å¸¸><strong>ğŸŸ  åœºæ™¯ 4ï¼šIngress/Service è´Ÿè½½å‡è¡¡å¼‚å¸¸</strong></a></li><li><a href=#-åœºæ™¯-5å­˜å‚¨æ•…éšœ><strong>ğŸ”µ åœºæ™¯ 5ï¼šå­˜å‚¨æ•…éšœ</strong></a></li></ul><ul><li><a href=#æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ><strong>æ¼”ç»ƒå‘ç°çš„é—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ</strong></a></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-1etcd-é€‰ä¸»æ—¶é—´è¿‡é•¿å½±å“-api-server-å“åº”><strong>ğŸ›‘ é—®é¢˜ 1ï¼šetcd é€‰ä¸»æ—¶é—´è¿‡é•¿ï¼Œå½±å“ API Server å“åº”</strong></a></li><li><a href=#-é—®é¢˜-2etcd-å¤‡ä»½æœªç”Ÿæ•ˆæ¢å¤å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 2ï¼šetcd å¤‡ä»½æœªç”Ÿæ•ˆï¼Œæ¢å¤å¤±è´¥</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-3kube-apiserver-å®•æœºè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ><strong>ğŸ›‘ é—®é¢˜ 3ï¼škube-apiserver å®•æœºï¼Œè´Ÿè½½å‡è¡¡æœªç”Ÿæ•ˆ</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-4èŠ‚ç‚¹é©±é€å-pod-è¿ç§»å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šèŠ‚ç‚¹é©±é€å Pod è¿ç§»å¤±è´¥</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-5ingress-nginx-å®•æœºåä¸šåŠ¡ä¸å¯è®¿é—®><strong>ğŸ›‘ é—®é¢˜ 5ï¼šIngress Nginx å®•æœºåï¼Œä¸šåŠ¡ä¸å¯è®¿é—®</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-é—®é¢˜-6pvc-ç»‘å®šå¤±è´¥pod-è¿›å…¥><strong>ğŸ›‘ é—®é¢˜ 6ï¼šPVC ç»‘å®šå¤±è´¥ï¼ŒPod è¿›å…¥ <code>Pending</code> çŠ¶æ€</strong></a></li></ul></li><li><a href=#æ€»ç»“-1><strong>æ€»ç»“</strong></a></li></ul><ul><li><a href=#å¤§è§„æ¨¡å¯åŠ¨-pod-å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ><strong>å¤§è§„æ¨¡å¯åŠ¨ Pod å¤±è´¥çš„æ’æŸ¥ä¸ä¼˜åŒ–æ–¹æ¡ˆ</strong></a></li><li><a href=#-1-é€šè¿‡><strong>ğŸ›  1. é€šè¿‡ <code>kubectl</code> å’Œ <code>describe</code> å‘½ä»¤æ’æŸ¥</strong></a><ul><li><a href=#-æŸ¥çœ‹-pod-çŠ¶æ€><strong>ğŸ“Œ æŸ¥çœ‹ Pod çŠ¶æ€</strong></a></li><li><a href=#-è·å–è¯¦ç»†ä¿¡æ¯><strong>ğŸ“Œ è·å–è¯¦ç»†ä¿¡æ¯</strong></a></li></ul></li><li><a href=#-2-è°ƒåº¦é—®é¢˜pod-æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹><strong>ğŸ” 2. è°ƒåº¦é—®é¢˜ï¼ˆPod æ— æ³•è¢«åˆ†é…åˆ°èŠ‚ç‚¹ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-1é›†ç¾¤èµ„æºä¸è¶³><strong>ğŸ›‘ é—®é¢˜ 1ï¼šé›†ç¾¤èµ„æºä¸è¶³</strong></a></li><li><a href=#-é—®é¢˜-2èŠ‚ç‚¹è°ƒåº¦é™åˆ¶><strong>ğŸ›‘ é—®é¢˜ 2ï¼šèŠ‚ç‚¹è°ƒåº¦é™åˆ¶</strong></a></li></ul></li><li><a href=#-3-å®¹å™¨åˆ›å»ºé—®é¢˜containercreating-å¡ä½><strong>ğŸ” 3. å®¹å™¨åˆ›å»ºé—®é¢˜ï¼ˆContainerCreating å¡ä½ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-3cni-ç½‘ç»œç»„ä»¶å¼‚å¸¸><strong>ğŸ›‘ é—®é¢˜ 3ï¼šCNI ç½‘ç»œç»„ä»¶å¼‚å¸¸</strong></a></li><li><a href=#-é—®é¢˜-4å®¹å™¨é•œåƒæ‹‰å–å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 4ï¼šå®¹å™¨é•œåƒæ‹‰å–å¤±è´¥</strong></a></li></ul></li><li><a href=#-4-å­˜å‚¨é—®é¢˜pvc-ç»‘å®šå¤±è´¥><strong>ğŸ” 4. å­˜å‚¨é—®é¢˜ï¼ˆPVC ç»‘å®šå¤±è´¥ï¼‰</strong></a><ul><li><a href=#-é—®é¢˜-5å­˜å‚¨å·æŒ‚è½½å¤±è´¥><strong>ğŸ›‘ é—®é¢˜ 5ï¼šå­˜å‚¨å·æŒ‚è½½å¤±è´¥</strong></a></li></ul></li><li><a href=#-5-master-ç»„ä»¶è´Ÿè½½è¿‡é«˜><strong>ğŸ” 5. Master ç»„ä»¶è´Ÿè½½è¿‡é«˜</strong></a><ul><li><a href=#-é—®é¢˜-6api-server-è´Ÿè½½è¿‡é«˜><strong>ğŸ›‘ é—®é¢˜ 6ï¼šAPI Server è´Ÿè½½è¿‡é«˜</strong></a></li></ul></li><li><a href=#-æ€»ç»“><strong>ğŸ¯ æ€»ç»“</strong></a></li></ul><ul><li><a href=#kubernetes-ä¸­-redis-å’Œ-kafka-å®¹å™¨åŒ–æ–¹æ¡ˆ><strong>Kubernetes ä¸­ Redis å’Œ Kafka å®¹å™¨åŒ–æ–¹æ¡ˆ</strong></a></li></ul><ul><li><ul><li><a href=#-redis-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Redis æ–¹æ¡ˆè®¾è®¡</strong></a></li><li><a href=#-æ–¹æ¡ˆ-1redis-sentinel-é«˜å¯ç”¨><strong>ğŸ“Œ æ–¹æ¡ˆ 1ï¼šRedis Sentinel é«˜å¯ç”¨</strong></a></li><li><a href=#-æ–¹æ¡ˆ-2redis-clusteråˆ†ç‰‡><strong>ğŸ“Œ æ–¹æ¡ˆ 2ï¼šRedis Clusterï¼ˆåˆ†ç‰‡ï¼‰</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#-kafka-æ–¹æ¡ˆè®¾è®¡><strong>ğŸ“Œ Kafka æ–¹æ¡ˆè®¾è®¡</strong></a></li><li><a href=#-kafka-å®¹å™¨åŒ–éƒ¨ç½²><strong>ğŸ“Œ Kafka å®¹å™¨åŒ–éƒ¨ç½²</strong></a></li></ul></li></ul><ul><li><a href=#-1-æ•°æ®æŒä¹…åŒ–><strong>ğŸ“Œ 1. æ•°æ®æŒä¹…åŒ–</strong></a></li><li><a href=#-2-é«˜å¯ç”¨><strong>ğŸ“Œ 2. é«˜å¯ç”¨</strong></a></li><li><a href=#-3-å»¶è¿Ÿä¼˜åŒ–><strong>ğŸ“Œ 3. å»¶è¿Ÿä¼˜åŒ–</strong></a></li></ul><ul><li><a href=#dragonfly-åŸç†è§£æ><strong>Dragonfly åŸç†è§£æ</strong></a><ul><li><a href=#-dragonfly-æ˜¯ä»€ä¹ˆ><strong>ğŸ“Œ Dragonfly æ˜¯ä»€ä¹ˆï¼Ÿ</strong></a></li></ul></li><li><a href=#1-dragonfly-ä¸»è¦ç»„æˆ><strong>1ï¸âƒ£ Dragonfly ä¸»è¦ç»„æˆ</strong></a></li><li><a href=#2-dragonfly-çš„å·¥ä½œåŸç†><strong>2ï¸âƒ£ Dragonfly çš„å·¥ä½œåŸç†</strong></a><ul><li><a href=#-1-é•œåƒæ–‡ä»¶ä¸‹è½½è¯·æ±‚><strong>ğŸ›  1. é•œåƒ/æ–‡ä»¶ä¸‹è½½è¯·æ±‚</strong></a></li><li><a href=#-2-è°ƒåº¦èŠ‚ç‚¹scheduler><strong>ğŸ›  2. è°ƒåº¦èŠ‚ç‚¹ï¼ˆschedulerï¼‰</strong></a></li><li><a href=#-3-p2p-ä¸‹è½½><strong>ğŸ›  3. P2P ä¸‹è½½</strong></a></li><li><a href=#-4-æœ¬åœ°ç¼“å­˜><strong>ğŸ›  4. æœ¬åœ°ç¼“å­˜</strong></a></li></ul></li><li><a href=#3-dragonfly-çš„-p2p-ä¸‹è½½æœºåˆ¶><strong>3ï¸âƒ£ Dragonfly çš„ P2P ä¸‹è½½æœºåˆ¶</strong></a><ul><li><a href=#-p2p-åˆ†å—ä¸‹è½½><strong>ğŸ”¥ P2P åˆ†å—ä¸‹è½½</strong></a></li></ul></li><li><a href=#4-dragonfly-é«˜å¯ç”¨æ¶æ„><strong>4ï¸âƒ£ Dragonfly é«˜å¯ç”¨æ¶æ„</strong></a><ul><li><a href=#-å¤šçº§ç¼“å­˜æ¶æ„><strong>ğŸŒ å¤šçº§ç¼“å­˜æ¶æ„</strong></a></li><li><a href=#-å…³é”®ç‰¹æ€§><strong>âš¡ å…³é”®ç‰¹æ€§</strong></a></li></ul></li><li><a href=#5-dragonfly-åœ¨-kubernetes-é›†ç¾¤ä¸­çš„åº”ç”¨><strong>5ï¸âƒ£ Dragonfly åœ¨ Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨</strong></a><ul><li><a href=#-åœ¨-kubernetes-ä½¿ç”¨-dragonfly><strong>ğŸ”¥ åœ¨ Kubernetes ä½¿ç”¨ Dragonfly</strong></a></li></ul></li><li><a href=#6-dragonfly-å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ><strong>6ï¸âƒ£ Dragonfly å¯¹æ¯”å…¶ä»–åŠ é€Ÿæ–¹æ¡ˆ</strong></a></li><li><a href=#-æ€»ç»“-2><strong>âœ… æ€»ç»“</strong></a></li></ul><ul><li><a href=#ç›‘æ§æ—¥æ´»åƒä¸‡çº§-app-çš„ç›‘æ§ä½“ç³»è®¾è®¡><strong>ç›‘æ§æ—¥æ´»åƒä¸‡çº§ App çš„ç›‘æ§ä½“ç³»è®¾è®¡</strong></a></li><li><a href=#1-ç›‘æ§ä½“ç³»è®¾è®¡><strong>1. ç›‘æ§ä½“ç³»è®¾è®¡</strong></a><ul><li><a href=#1ç›‘æ§æ¶æ„><strong>ï¼ˆ1ï¼‰ç›‘æ§æ¶æ„</strong></a></li></ul></li><li><a href=#2-å…³é”®ç›‘æ§æŒ‡æ ‡><strong>2. å…³é”®ç›‘æ§æŒ‡æ ‡</strong></a><ul><li><a href=#1ä¸šåŠ¡å±‚ç›‘æ§><strong>ï¼ˆ1ï¼‰ä¸šåŠ¡å±‚ç›‘æ§</strong></a></li><li><a href=#2ç³»ç»Ÿå±‚ç›‘æ§><strong>ï¼ˆ2ï¼‰ç³»ç»Ÿå±‚ç›‘æ§</strong></a></li><li><a href=#3åº”ç”¨å±‚ç›‘æ§apm><strong>ï¼ˆ3ï¼‰åº”ç”¨å±‚ç›‘æ§ï¼ˆAPMï¼‰</strong></a></li><li><a href=#4æ—¥å¿—--å¼‚å¸¸ç›‘æ§><strong>ï¼ˆ4ï¼‰æ—¥å¿— & å¼‚å¸¸ç›‘æ§</strong></a></li></ul></li><li><a href=#3-ç›‘æ§å·¥å…·é€‰å‹><strong>3. ç›‘æ§å·¥å…·é€‰å‹</strong></a></li><li><a href=#4-å‘Šè­¦ç­–ç•¥><strong>4. å‘Šè­¦ç­–ç•¥</strong></a><ul><li><a href=#1å‘Šè­¦åˆ†çº§><strong>ï¼ˆ1ï¼‰å‘Šè­¦åˆ†çº§</strong></a></li><li><a href=#2è‡ªåŠ¨åŒ–è¿ç»´><strong>ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–è¿ç»´</strong></a></li></ul></li><li><a href=#5-å…¸å‹æ•…éšœåœºæ™¯--å¤„ç†><strong>5. å…¸å‹æ•…éšœåœºæ™¯ & å¤„ç†</strong></a></li><li><a href=#æ€»ç»“-2><strong>æ€»ç»“</strong></a></li></ul><ul><li><ul><li><a href=#1-å¢åŠ -prometheus-çš„å†…å­˜é™åˆ¶>1. <strong>å¢åŠ  Prometheus çš„å†…å­˜é™åˆ¶</strong></a></li><li><a href=#2-è°ƒæ•´>2. <strong>è°ƒæ•´ <code>max-memory</code> é™åˆ¶</strong></a></li><li><a href=#3-å‡å°‘-prometheus-å­˜å‚¨æ•°æ®çš„é‡>3. <strong>å‡å°‘ Prometheus å­˜å‚¨æ•°æ®çš„é‡</strong></a></li><li><a href=#4-ä½¿ç”¨è¾ƒå°çš„>4. <strong>ä½¿ç”¨è¾ƒå°çš„ <code>scrape_interval</code></strong></a></li><li><a href=#5-ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢>5. <strong>ä¼˜åŒ–æ•°æ®æºå’ŒæŸ¥è¯¢</strong></a></li><li><a href=#6-å¯ç”¨>6. <strong>å¯ç”¨ <code>remote_write</code> å’Œå¤–éƒ¨å­˜å‚¨</strong></a></li><li><a href=#7-æé«˜-prometheus-æ€§èƒ½>7. <strong>æé«˜ Prometheus æ€§èƒ½</strong></a></li><li><a href=#8-æ‰©å±•-prometheus-é›†ç¾¤>8. <strong>æ‰©å±• Prometheus é›†ç¾¤</strong></a></li><li><a href=#æ€»ç»“-3>æ€»ç»“ï¼š</a></li><li><a href=#prometheus-è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ><strong>Prometheus è”é‚¦çš„æ ¸å¿ƒæ¦‚å¿µ</strong></a></li><li><a href=#è”é‚¦çš„å·¥ä½œåŸç†><strong>è”é‚¦çš„å·¥ä½œåŸç†</strong></a></li><li><a href=#è”é‚¦çš„å…¸å‹ç”¨é€”><strong>è”é‚¦çš„å…¸å‹ç”¨é€”</strong></a></li><li><a href=#prometheus-è”é‚¦çš„é…ç½®><strong>Prometheus è”é‚¦çš„é…ç½®</strong></a></li><li><a href=#å…³é”®å‚æ•°è§£é‡Š><strong>å…³é”®å‚æ•°è§£é‡Š</strong></a></li><li><a href=#ä¼˜åŠ¿><strong>ä¼˜åŠ¿</strong></a></li><li><a href=#é™åˆ¶å’ŒæŒ‘æˆ˜><strong>é™åˆ¶å’ŒæŒ‘æˆ˜</strong></a></li><li><a href=#æ€»ç»“-4><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤><strong>éƒ¨ç½²äºŒè¿›åˆ¶é›†ç¾¤çš„æ­¥éª¤ï¼š</strong></a></li><li><a href=#ä¿è¯-playbook-çš„å¹‚ç­‰æ€§><strong>ä¿è¯ Playbook çš„å¹‚ç­‰æ€§ï¼š</strong></a></li><li><a href=#ä¿è¯-playbook-çš„å®‰å…¨æ€§><strong>ä¿è¯ Playbook çš„å®‰å…¨æ€§ï¼š</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯><strong>ç°åº¦å‘å¸ƒæµæ°´çº¿è®¾è®¡æ€è·¯</strong></a></li><li><a href=#è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤><strong>è®¾è®¡ç°åº¦å‘å¸ƒæµæ°´çº¿çš„æ­¥éª¤ï¼š</strong></a></li><li><a href=#ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·><strong>ç°åº¦å‘å¸ƒä¸­çš„å…³é”®æŠ€æœ¯å’Œå·¥å…·ï¼š</strong></a></li><li><a href=#æ€»ç»“-5><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li></ul><ul><li><a href=#æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡-><strong>æµé‡æ´ªå³°è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆè®¾è®¡</strong> ğŸš€</a></li><li><a href=#1-æµé‡æ´ªå³°çš„ç‰¹å¾><strong>1. æµé‡æ´ªå³°çš„ç‰¹å¾</strong></a></li><li><a href=#2-è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„><strong>2. è‡ªåŠ¨æ‰©ç¼©å®¹æ¶æ„</strong></a></li><li><a href=#3-å…³é”®æ‰©ç¼©å®¹ç­–ç•¥><strong>3. å…³é”®æ‰©ç¼©å®¹ç­–ç•¥</strong></a><ul><li><a href=#1pod-æ°´å¹³æ‰©å±•hpa><strong>ï¼ˆ1ï¼‰Pod æ°´å¹³æ‰©å±•ï¼ˆHPAï¼‰</strong></a></li><li><a href=#2pod-å‚ç›´æ‰©å±•vpa><strong>ï¼ˆ2ï¼‰Pod å‚ç›´æ‰©å±•ï¼ˆVPAï¼‰</strong></a></li><li><a href=#3é›†ç¾¤èŠ‚ç‚¹æ‰©å±•cluster-autoscaler><strong>ï¼ˆ3ï¼‰é›†ç¾¤èŠ‚ç‚¹æ‰©å±•ï¼ˆCluster Autoscalerï¼‰</strong></a></li><li><a href=#4äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹keda><strong>ï¼ˆ4ï¼‰äº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹ï¼ˆKEDAï¼‰</strong></a></li></ul></li><li><a href=#4-é¢„æ¡ˆ--é«˜å¯ç”¨ç­–ç•¥><strong>4. é¢„æ¡ˆ & é«˜å¯ç”¨ç­–ç•¥</strong></a><ul><li><a href=#1æµé‡é¢„æ¡ˆ><strong>ï¼ˆ1ï¼‰æµé‡é¢„æ¡ˆ</strong></a></li><li><a href=#2æ•…éšœæ¢å¤><strong>ï¼ˆ2ï¼‰æ•…éšœæ¢å¤</strong></a></li></ul></li><li><a href=#5-æ–¹æ¡ˆæ€»ç»“><strong>5. æ–¹æ¡ˆæ€»ç»“</strong></a><ul><li><a href=#æœ€ç»ˆæ¶æ„><strong>æœ€ç»ˆæ¶æ„</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#1-ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°><strong>1. ç¡®å®šè§†é¢‘åŠ è½½ç¼“æ…¢çš„è¡¨ç°</strong></a></li><li><a href=#2-åˆ†æç½‘ç»œé“¾è·¯><strong>2. åˆ†æç½‘ç»œé“¾è·¯</strong></a></li><li><a href=#3-å­˜å‚¨å±‚æ’æŸ¥><strong>3. å­˜å‚¨å±‚æ’æŸ¥</strong></a></li><li><a href=#4-è§†é¢‘æ–‡ä»¶åˆ†æ><strong>4. è§†é¢‘æ–‡ä»¶åˆ†æ</strong></a></li><li><a href=#5-å®¢æˆ·ç«¯æ’æŸ¥><strong>5. å®¢æˆ·ç«¯æ’æŸ¥</strong></a></li><li><a href=#6-æµç¨‹ç›‘æ§ä¸æ—¥å¿—><strong>6. æµç¨‹ç›‘æ§ä¸æ—¥å¿—</strong></a></li><li><a href=#7-è¿›è¡Œå‹åŠ›æµ‹è¯•><strong>7. è¿›è¡Œå‹åŠ›æµ‹è¯•</strong></a></li><li><a href=#æ€»ç»“-6><strong>æ€»ç»“</strong>ï¼š</a></li></ul></li></ul><ul><li><ul><li><a href=#1-æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»><strong>1. æ ¹æ®æ•…éšœå½±å“èŒƒå›´åˆ†ç±»</strong></a></li><li><a href=#2-æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»><strong>2. æ ¹æ®æ•…éšœæ¢å¤éš¾æ˜“åº¦åˆ†ç±»</strong></a></li><li><a href=#3-æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»><strong>3. æ ¹æ®æ—¶é—´æ•æ„Ÿæ€§åˆ†ç±»</strong></a></li><li><a href=#4-æ•…éšœåˆ†ç±»><strong>4. æ•…éšœåˆ†ç±»</strong></a></li><li><a href=#5-ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ><strong>5. ä½¿ç”¨æ•…éšœç®¡ç†ç³»ç»Ÿ</strong></a></li><li><a href=#6-åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°><strong>6. åŸºäºä¸šåŠ¡ä»·å€¼è¯„ä¼°</strong></a></li><li><a href=#7-ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ><strong>7. ç¡®å®šæ¢å¤çš„æœ€å°å¯è¡Œæ–¹æ¡ˆ</strong></a></li><li><a href=#æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹><strong>æ’æŸ¥æ•…éšœçš„ä¼˜å…ˆçº§å¤„ç†æµç¨‹</strong>ï¼š</a></li><li><a href=#æ€»ç»“-7><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£><strong>äºŒçº¿çš„ä¸»è¦å·¥ä½œèŒè´£</strong>ï¼š</a></li><li><a href=#ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åå¦‚ä½•è§£å†³é—®é¢˜><strong>ä¸€çº¿åé¦ˆåˆ°äºŒçº¿åï¼Œå¦‚ä½•è§£å†³é—®é¢˜ï¼Ÿ</strong></a></li><li><a href=#æ€»ç»“-8><strong>æ€»ç»“</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#1-å®šä¹‰å’Œé‡ç‚¹><strong>1. å®šä¹‰å’Œé‡ç‚¹</strong></a></li><li><a href=#2-ä¸»è¦èŒè´£><strong>2. ä¸»è¦èŒè´£</strong></a></li><li><a href=#3-å…³æ³¨ç‚¹å’Œç›®æ ‡><strong>3. å…³æ³¨ç‚¹å’Œç›®æ ‡</strong></a></li><li><a href=#4-è·¨éƒ¨é—¨åä½œ><strong>4. è·¨éƒ¨é—¨åä½œ</strong></a></li><li><a href=#5-è¿ç»´å·¥å…·ä¸æŠ€æœ¯><strong>5. è¿ç»´å·¥å…·ä¸æŠ€æœ¯</strong></a></li><li><a href=#æ€»ç»“-9><strong>æ€»ç»“</strong></a></li></ul></li></ul></nav></div></aside></main></body></html>
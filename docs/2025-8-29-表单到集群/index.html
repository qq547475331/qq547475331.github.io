<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlï¼Œä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„
  #

ä½ é—®çš„è¿™ä¸ªæµç¨‹ï¼Œå…¶å®å°±æ˜¯ å‰ç«¯è¡¨å• â†’ åç«¯ç”Ÿæˆ YAML â†’ K8s API Server éƒ¨ç½² çš„é“¾è·¯ã€‚
æˆ‘ç»™ä½ è¯¦ç»†æ‹†å¼€è¯´ï¼š


  1ï¸âƒ£ å‰ç«¯è¡¨å• â†’ Deployment é…ç½®æ•°æ®
  #

å‰ç«¯çš„è¡¨å•ï¼ˆæ¯”å¦‚è¾“å…¥ åº”ç”¨åã€é•œåƒåã€å‰¯æœ¬æ•°ã€CPU/å†…å­˜é™åˆ¶ã€ç«¯å£ ç­‰ï¼‰å°±æ˜¯ Deployment çš„æ ¸å¿ƒå­—æ®µã€‚
å‰ç«¯æäº¤çš„é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š
{
  "name": "myapp",
  "namespace": "default",
  "replicas": 3,
  "image": "nginx:1.21",
  "cpu": "200m",
  "memory": "256Mi",
  "port": 80
}


  2ï¸âƒ£ åç«¯ â†’ è½¬æ¢ä¸º K8s YAML/Manifest
  #

åç«¯æ‹¿åˆ°è¿™ä¸ª JSONï¼Œå°±ä¼šç”¨æ¨¡æ¿ï¼ˆæˆ–è€…åŠ¨æ€æ‹¼æ¥ï¼‰ç”Ÿæˆ Deployment çš„ YAML æ¸…å•ï¼š
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  namespace: default
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: nginx:1.21
        resources:
          limits:
            cpu: "200m"
            memory: "256Mi"
        ports:
        - containerPort: 80
âš¡ è¿™é‡Œåç«¯å¯èƒ½ä¼šç”¨æ¨¡æ¿å¼•æ“ï¼ˆGo Templateã€Jinja2ã€Handlebars.js ç­‰ï¼‰æ¥æŠŠè¡¨å•å­—æ®µæ›¿æ¢è¿› YAMLã€‚'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-8-29-%E8%A1%A8%E5%8D%95%E5%88%B0%E9%9B%86%E7%BE%A4/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-08-28 è¡¨å•åˆ°é›†ç¾¤"><meta property="og:description" content='å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlï¼Œä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„ # ä½ é—®çš„è¿™ä¸ªæµç¨‹ï¼Œå…¶å®å°±æ˜¯ å‰ç«¯è¡¨å• â†’ åç«¯ç”Ÿæˆ YAML â†’ K8s API Server éƒ¨ç½² çš„é“¾è·¯ã€‚ æˆ‘ç»™ä½ è¯¦ç»†æ‹†å¼€è¯´ï¼š
1ï¸âƒ£ å‰ç«¯è¡¨å• â†’ Deployment é…ç½®æ•°æ® # å‰ç«¯çš„è¡¨å•ï¼ˆæ¯”å¦‚è¾“å…¥ åº”ç”¨åã€é•œåƒåã€å‰¯æœ¬æ•°ã€CPU/å†…å­˜é™åˆ¶ã€ç«¯å£ ç­‰ï¼‰å°±æ˜¯ Deployment çš„æ ¸å¿ƒå­—æ®µã€‚ å‰ç«¯æäº¤çš„é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š
{ "name": "myapp", "namespace": "default", "replicas": 3, "image": "nginx:1.21", "cpu": "200m", "memory": "256Mi", "port": 80 } 2ï¸âƒ£ åç«¯ â†’ è½¬æ¢ä¸º K8s YAML/Manifest # åç«¯æ‹¿åˆ°è¿™ä¸ª JSONï¼Œå°±ä¼šç”¨æ¨¡æ¿ï¼ˆæˆ–è€…åŠ¨æ€æ‹¼æ¥ï¼‰ç”Ÿæˆ Deployment çš„ YAML æ¸…å•ï¼š
apiVersion: apps/v1 kind: Deployment metadata: name: myapp namespace: default spec: replicas: 3 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: nginx:1.21 resources: limits: cpu: "200m" memory: "256Mi" ports: - containerPort: 80 âš¡ è¿™é‡Œåç«¯å¯èƒ½ä¼šç”¨æ¨¡æ¿å¼•æ“ï¼ˆGo Templateã€Jinja2ã€Handlebars.js ç­‰ï¼‰æ¥æŠŠè¡¨å•å­—æ®µæ›¿æ¢è¿› YAMLã€‚'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-08-28 è¡¨å•åˆ°é›†ç¾¤ | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-8-29-%E8%A1%A8%E5%8D%95%E5%88%B0%E9%9B%86%E7%BE%A4/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.353f13d5483e298dabe0b16bf9594595bc22065236cf11bd2cdb20ac013e8b9e.js integrity="sha256-NT8T1Ug+KY2r4LFr+VlFlbwiBlI2zxG9LNsgrAE+i54=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-10-27-reconciler%E6%A8%A1%E5%BC%8F/>2025-10-27 informeræ¨¡å¼3</a></li><li><a href=/docs/2025-10-23-informer3/>2025-10-23 informeræ¨¡å¼3</a></li><li><a href=/docs/2025-10-23-informer2/>2025-10-23 informeræ¨¡å¼2</a></li><li><a href=/docs/2025-10-23-informer/>2025-10-23 informeræ¨¡å¼</a></li><li><a href=/docs/2025-9-29-vercel%E5%88%9B%E5%A7%8B%E4%BA%BA%E5%AF%B9%E8%AF%9D/>2025-09-29 Vercelåˆ›å§‹äººå¯¹è¯</a></li><li><a href=/docs/2025-9-28-spec-workflow-mcp/>2025-09-28 spec-workflow-mcp</a></li><li><a href=/docs/2025-9-28-chrome-mcp-tools/>2025-09-28 chrome-devtools-mcp</a></li><li><a href=/docs/2025-9-19-%E7%90%86%E8%A7%A3/>2025-09-19 ç†è§£</a></li><li><a href=/docs/2025-9-10-%E6%8F%90%E7%A4%BA%E8%AF%8D/>2025-09-10 æç¤ºè¯</a></li><li><a href=/docs/2025-9-9-music/>2025-09-09 musicèµ„æº</a></li><li><a href=/docs/2025-8-29-%E8%A1%A8%E5%8D%95%E5%88%B0%E9%9B%86%E7%BE%A4/ class=active>2025-08-28 è¡¨å•åˆ°é›†ç¾¤</a></li><li><a href=/docs/2025-6-27-geminicli/>2025-06-27 geminicli</a></li><li><a href=/docs/2025-6-23-ingress-nginx-contrller-%E5%88%86%E6%9E%90/>2025-06-23 ingress nginx contrller å†…å­˜ä½¿ç”¨è¿‡é«˜åˆ†æ</a></li><li><a href=/docs/2025-6-20-oom/>2025-06-20 oomæ’æŸ¥æ€è·¯</a></li><li><a href=/docs/2025-6-16-fire%E8%A7%84%E5%88%99/>2025-06-16 Cursor RIPER-5è§„åˆ™</a></li><li><a href=/docs/2025-6-12-karmada/>2025-06-12 karmadaä»‹ç»</a></li><li><a href=/docs/2025-6-12-flutter%E8%A7%84%E5%88%99/>2025-06-12 flutterè§„åˆ™</a></li><li><a href=/docs/2025-6-10-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91/>2025-06-10 ç‹¬ç«‹å¼€å‘</a></li><li><a href=/docs/2025-5-21-ingress%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/>2025-05-21 ä¸»Ingresså‰¯æœ¬å˜ä¸º0åæŠ¥503é—®é¢˜åˆ†æ</a></li><li><a href=/docs/2025-5-7-%E6%8E%A5%E5%8D%95app/>2025-05-07 æ¥å•appè®¾è®¡</a></li><li><a href=/docs/2025-5-7-%E5%A5%BD%E5%BF%83%E6%80%81-app/>2025-05-07 å¥½å¿ƒæ€app</a></li><li><a href=/docs/2025-4-28-cursor-agent-%E6%8F%90%E7%A4%BA%E5%99%A8/>2025-04-28 cursor agent æç¤ºå™¨</a></li><li><a href=/docs/2025-4-20-%E6%80%A7%E5%90%8C%E6%84%8Fapp/>2025-04-20 æ€§åŒæ„App</a></li><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-04-16 è‡ªç ”k8så¹³å°</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-04-16 sleepç¡çœ åº”ç”¨</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-04-16 paaså¼€å‘è®°å½•</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-04-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-04-16 BOSSç›´è˜è‡ªåŠ¨æŠ•é€’</a></li><li><a href=/docs/2025-4-14-github%E6%8E%A8%E9%80%81/>2025-04-14 githubæ¨é€</a></li><li><a href=/docs/2025-3-30-metallb/>2025-03-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-03-24 è‡ªæˆ‘ä»‹ç»</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-03-20 victoriametricsé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-03-20 victoriametrics æ¶æ„</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-03-20 VictoriaMetrics å’Œ Thanos å¯¹æ¯”</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-03-20 thanosé«˜å¯ç”¨æ¶æ„</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-03-20 thanosæ¶æ„</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-03-18 5w podå‹æµ‹å¤ç›˜</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-03-14 ç«å±±äº‘è¿ç§»å·¥ç¨‹å¸ˆé¢è¯•è®°å½•</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-03-14 vivoé¢è¯•</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-03-13 istioæµé‡åˆ†æ</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-03-13 calicoä¸‰ç§æ¨¡å¼ä¸‹æµé‡ä¼ è¾“</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-03-12 å¡”èµé¢è¯•</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-03-12 è¿½è§…é¢è¯•</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-03-08 k8såˆ é™¤podæˆ–deploymentçš„æµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-03-08 k8såˆ›å»ºpodæµç¨‹å›¾è¯¦è§£</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-02-28 prometheusé¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-02-25 é¢è¯•0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-02-24 é«˜çº§è¿ç»´é¢è¯•é¢˜-linuxéƒ¨åˆ†</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-02-24 ä¸­çº§è¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-02-24 0224é¢è¯•</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-02-20 é¢è¯•0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-02-19 é¢è¯•0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-02-18 é¢è¯•2025-02-18</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-02-16 k8sé¢˜ç›®</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-02-12 é¢è¯•0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-02-11 é¢è¯•2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-02-07 ç¾å›½ç å†œè®¡åˆ’</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-02-07 ç¾å›½ç å†œè–ªé…¬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-02-07 k8sç»„ä»¶</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-01-16 k8så¸¸è§æ•…éšœæŒ‡å—</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-01-01 è¦ä¸è¦åˆ›ä¸š</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-01-01 æ—©æœŸæ¨¡å¼</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-01-01 å¤§å °æ²³-æˆ‘çš„ä¿å§†</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-01-01 åˆåˆ›å…¬å¸</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-01-01 åˆ›ä¸šè€…äº¤æµ</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-01-01 åˆ›ä¸šç‚¹å­</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-01-01 sealosè·æŠ•</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack sshè¿æ¥</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpasséƒ¨ç½²openstack devstackå½¢å¼</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart éƒ¨ç½²flaskåº”ç”¨</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 å—å­˜å‚¨å’Œå¯¹è±¡å‚¨å­˜åŒºåˆ«</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstackéœ€è¦å‡ å°è™šæ‹Ÿæœº</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstackå’ŒkubernetesåŒºåˆ«</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nanoæ“ä½œ</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpassæ“ä½œ</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeaszéƒ¨ç½²k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 é¡¶çº§devopså·¥å…·å¤§ç›˜ç‚¹</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 æ¸…ç†dockeré•œåƒ</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 æ„å»ºå®¹å™¨é•œåƒåˆ©å™¨buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 æ˜¯æŠ€æœ¯å¤§ç¥è¿˜æ˜¯åŸºç¡€æ¶æ„éƒ¨çš„ç¥¸å®³</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 æ­ä¸ªæ—¥å¿—æ‰‹æœºç³»ç»Ÿä¸é¦™å—</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 æˆ‘åªæƒ³åšæŠ€æœ¯ èµ°æŠ€æœ¯è·¯çº¿</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 å¸¸è§linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 å¤§å‚æ€»ç»“nginxé«˜å¹¶å‘ä¼˜åŒ–ç¬”è®°</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 å²ä¸Šæœ€ç‰›jenkins pipelineæµæ°´çº¿è¯¦è§£</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEGä¸istioé›†æˆ</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginxå¦‚ä½•è§£å†³æƒŠç¾¤æ•ˆåº”</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctlæ£€æµ‹é›†ç¾¤podé—´è¿é€šæ€§</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linuxè¿ç»´å·¥ç¨‹å¸ˆ50ä¸ªå¸¸è§é¢è¯•é¢˜</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linuxç³»ç»Ÿæ€§èƒ½ä¼˜åŒ– ä¸ƒä¸ªå®æˆ˜ç»éªŒ</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awkæ–‡æœ¬å¤„ç†å™¨ 8ä¸ªæ¡ˆä¾‹</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruiseåŸåœ°å‡çº§è§£æ</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8Sé¢è¯•é¢˜</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8sèƒŒåserviceæ˜¯å¦‚ä½•å·¥ä½œçš„</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8Sçš„æœ€åä¸€å—æ‹¼å›¾</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istioéƒ¨ç½²</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfileå®šåˆ¶ä¸“å±é•œåƒ</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33æ¬¾gitopsä¸devopsä¸»æµç³»ç»Ÿ</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linuxé¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linuxè¿ç»´é¢è¯•é¢˜</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8sé¢è¯•é¢˜</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruiseè¯¦ç»†è§£é‡Šä»¥åŠåŸåœ°å‡çº§åŠå…¨é“¾è·¯ç°åº¦å‘å¸ƒæ–¹æ¡ˆ</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8Sä¹‹ingress-nginxåŸç†åŠé…ç½®</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 ä½¿ç”¨cloudflare(CF)æ­å»ºdockerhubä»£ç†</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 å•masterå•etcdæ”¹é€ ä¸º3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 é¢è¯•æ€»ç»“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 å¦‚ä½•ä¸ºK8Sä¿é©¾æŠ¤èˆª</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8Så¦‚ä½•è·å¾— IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_status_update.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_set_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8Sæ§åˆ¶å™¨ä¹‹stateful_pod_control.goæºç è§£è¯»</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8Sè°ƒåº¦å™¨ extender.go æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹sync.go åŒæ­¥ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹rollback.go å›æ»š æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹recreate.go é‡å»º æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ scheduler.go è°ƒåº¦å™¨ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ rolling.go æ»šåŠ¨æ›´æ–° æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ progress.go è¿›åº¦ æºç è§£è¯»</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8Sæ§åˆ¶å™¨ä¹‹ deployment_controller.goæºç è§£è¯»</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S è°ƒåº¦å™¨ scheduler_one.go æºç è§£è¯»</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 å½»æ‚Ÿå®¹å™¨ç½‘ç»œ</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 é¢è¯•ç”¨ Golang æ‰‹æ’¸ LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 è‡ªåŠ¨å±è”½IPæ”»å‡»</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 ç¦»çº¿å®‰è£…kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 ç£ç›˜æ•°æ®æ¢å¤</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 æ¸…ç†æ®‹ç•™çš„calicoç½‘ç»œæ’ä»¶</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 æµé‡ä½•å¤„æ¥ä½•å¤„å»</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 æå¤§æé«˜å·¥ä½œæ•ˆç‡çš„ Linux å‘½ä»¤</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 æ–‡å­¦çš„æ•…ä¹¡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 ææ‡‚K8Sé‰´æƒ</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 å®¹å™¨ç½‘ç»œåŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ OverlayFS åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 å®¹å™¨åŸç†</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 å®¹å™¨å†…çš„ 1 å·è¿›ç¨‹</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 å®¹å™¨ä¸­åŸŸåè§£æä»¥åŠä¸åŒdnspolicyå¯¹åŸŸåè§£æçš„å½±å“</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 å¦‚ä½•è°ƒè¯• crash å®¹å™¨çš„ç½‘ç»œ</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 å¦‚ä½•ä½¿ç”¨tektonå¿«é€Ÿæ­å»ºCI/CDå¹³å°</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 å¤§è§„æ¨¡å¹¶å‘ä¸‹å¦‚ä½•åŠ å¿« Pod å¯åŠ¨é€Ÿåº¦</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 ä½¿ç”¨kubernees leases è½»æ¾å®ç°leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 äºŒè¿›åˆ¶éƒ¨ç½²K8SåŠ èŠ‚ç‚¹æ“ä½œ</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 ä¸¤å¼ å›¾å…¨é¢ç†è§£K8SåŸç†</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 sslè¯ä¹¦è‡ªç­¾å‘</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheusä¼ä¸šçº§ç›‘æ§ä½¿ç”¨æ€»ç»“</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 åŸç†</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux æ€§èƒ½ä¼˜åŒ–å¤§å…¨</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(é‰´æƒ)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes è¯ä¹¦è¯¦è§£(è®¤è¯)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes æºç ç»“æ„</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekeyæ·»åŠ æ–°èŠ‚ç‚¹</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8Sé¢è¯•å®å…¸</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8Sé¢è¯•å¤§å…¨</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8sè¿ç»´ä¹‹æ¸…ç†ç£ç›˜</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8Sè°ƒè¯•POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8Sçš„PODç±»å‹</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8såº”ç”¨çš„æœ€ä½³å®è·µ</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8Så‘½ä»¤æŒ‡å—</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8SåŸåœ°å‡çº§</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S æ¢é’ˆåŸç†</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S å¼€å‘å¯ä¸æ­¢ CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebsåŸç†</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chartå’Œrepo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanelç½‘ç»œ</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCDç¨³å®šæ€§åŠæ€§èƒ½ä¼˜åŒ–å®è·µ</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCDå¤‡ä»½</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Dockeré‡è¦çš„ç½‘ç»œçŸ¥è¯†ç‚¹</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfileçš„copyå’Œaddçš„åŒºåˆ«</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNSä¹‹å…‰</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd åŸºæœ¬æ“ä½œ</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNIæ’ä»¶é€‰å‹</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go æ¶æ„</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go å››ç§å®¢æˆ·ç«¯</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICDæ€è€ƒ</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calicoç½‘ç»œè‡ªå®šä¹‰</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acmeè‡ªåŠ¨æ›´æ–°è¯ä¹¦</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16ä¸ªæ¦‚å¿µå¸¦ä½ å…¥é—¨ Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 é¢è¯•0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600æ¡æœ€å¼ºlinuxå‘½ä»¤æ€»ç»“</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16å¼ ç¡¬æ ¸å›¾è§£k8sç½‘ç»œ</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8sä¹‹kubeletæºç è§£è¯»</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 ä¸¤å¼ å›¾å…¨é¢ç†è§£k8såŸç†</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 é¢è¯•</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8sæµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S æµé‡é“¾è·¯å‰–æ</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNIå‰–ææ¼”è¿›</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 é¢è¯•</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8sé¢è¯•å®å…¸</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8sæ¶æ„å¸ˆé¢è¯•å¤§å…¨</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 ä½¿ç”¨ OpenFunction åœ¨ä»»ä½•åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œæ— æœåŠ¡å™¨å·¥ä½œè´Ÿè½½</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 ç¦»çº¿å®‰è£…é›†ç¾¤</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 æ“ä½œç³»ç»Ÿè¯´æ˜</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 å¿«é€ŸæŒ‡å—</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 å¼€å§‹ä½¿ç”¨ cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 å¤šæ¶æ„æ”¯æŒ</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 å…¬æœ‰äº‘ä¸Šéƒ¨ç½²</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 ä¸ªæ€§åŒ–é›†ç¾¤å‚æ•°é…ç½®</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl å‘½ä»¤è¡Œä»‹ç»</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB è´Ÿè½½å‡è¡¡éƒ¨ç½²</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico é…ç½® BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-å®‰è£…é›†ç¾¤ä¸»è¦æ’ä»¶</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S é›†ç¾¤å­˜å‚¨</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…kube-ovnç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…flannelç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…ciliumç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-å®‰è£…calicoç½‘ç»œç»„ä»¶</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-å®‰è£…etcdé›†ç¾¤</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-é›†ç¾¤è§„åˆ’å’ŒåŸºç¡€å‚æ•°è®¾å®š</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-å®‰è£…kube_nodeèŠ‚ç‚¹</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-å®‰è£…kube_masterèŠ‚ç‚¹</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-åˆ›å»ºè¯ä¹¦å’Œç¯å¢ƒå‡†å¤‡</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 æ€è€ƒ</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 ä½¿ç”¨ Keepalived å’Œ HAproxy åˆ›å»ºé«˜å¯ç”¨ Kubernetes é›†ç¾¤</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-08-28 è¡¨å•åˆ°é›†ç¾¤</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„>å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlï¼Œä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„</a></li><li><a href=#1-å‰ç«¯è¡¨å•--deployment-é…ç½®æ•°æ®>1ï¸âƒ£ å‰ç«¯è¡¨å• â†’ Deployment é…ç½®æ•°æ®</a></li><li><a href=#2-åç«¯--è½¬æ¢ä¸º-k8s-yamlmanifest>2ï¸âƒ£ åç«¯ â†’ è½¬æ¢ä¸º K8s YAML/Manifest</a></li><li><a href=#3-åç«¯--éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>3ï¸âƒ£ åç«¯ â†’ éƒ¨ç½²åˆ° K8s é›†ç¾¤</a><ul><li><a href=#æ–¹å¼-aè°ƒç”¨-kubectl-apply>æ–¹å¼ Aï¼šè°ƒç”¨ <code>kubectl apply</code></a></li><li><a href=#æ–¹å¼-bç›´æ¥è°ƒç”¨-kubernetes-api>æ–¹å¼ Bï¼šç›´æ¥è°ƒç”¨ Kubernetes API</a></li><li><a href=#æ–¹å¼-cç”¨å®˜æ–¹-sdk>æ–¹å¼ Cï¼šç”¨å®˜æ–¹ SDK</a></li></ul></li><li><a href=#4-æ•´ä½“æµç¨‹æ€»ç»“>4ï¸âƒ£ æ•´ä½“æµç¨‹æ€»ç»“</a><ul><li><a href=#1-å‰ç«¯è¡¨å•è½¬-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•è½¬ deployment çš„ YAML</a></li><li><a href=#2-yaml-è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. YAML è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a></li></ul></li><li><a href=#1-æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ>1ï¸âƒ£ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ</a></li><li><a href=#2-å‰ç«¯è¡¨å•---yaml-çš„è½¬æ¢>2ï¸âƒ£ å‰ç«¯è¡¨å• -> YAML çš„è½¬æ¢</a></li><li><a href=#3-ç”¨æˆ·ç‚¹å‡»åº”ç”¨éƒ¨ç½²æŒ‰é’®çš„æµç¨‹>3ï¸âƒ£ ç”¨æˆ·ç‚¹å‡»â€œåº”ç”¨éƒ¨ç½²â€æŒ‰é’®çš„æµç¨‹</a></li><li><a href=#4-submitsuccess---è°ƒç”¨åç«¯-api>4ï¸âƒ£ <code>submitSuccess</code> -> è°ƒç”¨åç«¯ API</a></li><li><a href=#5-è°ƒç”¨é“¾æ€»ç»“è¡¨å•åˆ°-yaml-åˆ°éƒ¨ç½²>5ï¸âƒ£ è°ƒç”¨é“¾æ€»ç»“ï¼ˆè¡¨å•åˆ° YAML åˆ°éƒ¨ç½²ï¼‰</a></li><li><a href=#1-k8scontext-æ¥å£><strong>1ï¸âƒ£ K8sContext æ¥å£</strong></a></li><li><a href=#2-è¡¨å•--yaml--åˆ›å»ºåº”ç”¨><strong>2ï¸âƒ£ è¡¨å• â†’ YAML â†’ åˆ›å»ºåº”ç”¨</strong></a></li><li><a href=#3-è·å–åº”ç”¨èµ„æºä¿¡æ¯><strong>3ï¸âƒ£ è·å–åº”ç”¨èµ„æºä¿¡æ¯</strong></a></li><li><a href=#4-pause--start-åº”ç”¨><strong>4ï¸âƒ£ Pause / Start åº”ç”¨</strong></a></li><li><a href=#5-æ›´æ–°åº”ç”¨èµ„æº><strong>5ï¸âƒ£ æ›´æ–°åº”ç”¨èµ„æº</strong></a></li><li><a href=#6-åˆ é™¤åº”ç”¨><strong>6ï¸âƒ£ åˆ é™¤åº”ç”¨</strong></a></li><li><a href=#7-æ€»ç»“è¡¨å•åˆ°-yaml-è°ƒç”¨é“¾><strong>7ï¸âƒ£ æ€»ç»“è¡¨å•åˆ° YAML è°ƒç”¨é“¾</strong></a><ul><li><a href=#-è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†>âœ… è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†</a></li><li><a href=#-ç‰¹ç‚¹>ğŸ”¹ ç‰¹ç‚¹</a></li></ul></li><li><a href=#-æ•´ä½“æ€è·¯>ğŸ”‘ æ•´ä½“æ€è·¯</a></li><li><a href=#-æ ¸å¿ƒå‡½æ•°è§£æ>ğŸ“Œ æ ¸å¿ƒå‡½æ•°è§£æ</a><ul><li><a href=#1-json2deploycr>1. <code>json2DeployCr</code></a></li><li><a href=#2-json2service>2. <code>json2Service</code></a></li><li><a href=#3-json2ingress>3. <code>json2Ingress</code></a></li><li><a href=#4-json2configmap>4. <code>json2ConfigMap</code></a></li><li><a href=#5-json2secret>5. <code>json2Secret</code></a></li><li><a href=#6-json2hpa>6. <code>json2HPA</code></a></li><li><a href=#7-yamlstring2objects>7. <code>yamlString2Objects</code></a></li></ul></li><li><a href=#-æ•´ä½“æµç¨‹å›¾>ğŸ“Š æ•´ä½“æµç¨‹å›¾</a></li><li><a href=#-æ€»ç»“ä¸€å¥è¯>âœ… æ€»ç»“ä¸€å¥è¯</a></li><li><a href=#1-kubernetes-å®¢æˆ·ç«¯åˆå§‹åŒ–>1. <strong>Kubernetes å®¢æˆ·ç«¯åˆå§‹åŒ–</strong></a></li><li><a href=#2-åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ>2. <strong>åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ</strong></a></li><li><a href=#3-åŠ è½½-kubeconfig>3. <strong>åŠ è½½ kubeconfig</strong></a></li><li><a href=#4-åˆ›å»º-yaml-åˆ°-k8s>4. <strong>åˆ›å»º YAML åˆ° K8s</strong></a></li><li><a href=#5-æ›´æ–°æ›¿æ¢-yaml-åˆ°-k8s>5. <strong>æ›´æ–°/æ›¿æ¢ YAML åˆ° K8s</strong></a></li><li><a href=#6-è·å–ç”¨æˆ·é…é¢>6. <strong>è·å–ç”¨æˆ·é…é¢</strong></a></li><li><a href=#7-è·å–ç”¨æˆ·ä½™é¢>7. <strong>è·å–ç”¨æˆ·ä½™é¢</strong></a></li><li><a href=#8-å°è£…ç»Ÿä¸€çš„-k8s-æ“ä½œå…¥å£>8. <strong>å°è£…ç»Ÿä¸€çš„ K8s æ“ä½œå…¥å£</strong></a></li><li><a href=#-å‰åç«¯æµç¨‹ä¸²èµ·æ¥>ğŸ”— å‰åç«¯æµç¨‹ä¸²èµ·æ¥</a></li><li><a href=#æ€»ç»“ä¸€å¥è¯>æ€»ç»“ä¸€å¥è¯</a></li><li><a href=#kubesphere-çš„å‰ç«¯å¡«å†™-deployment-è¡¨å•åæ ¸å¿ƒæµç¨‹å¦‚ä¸‹>KubeSphere çš„å‰ç«¯å¡«å†™ Deployment è¡¨å•åï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</a></li><li><a href=#1-å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º Deployment çš„ YAML</a></li><li><a href=#2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a><ul><li><a href=#21-æ¥æ”¶å¹¶-apply-èµ„æºå¯¹è±¡>2.1 æ¥æ”¶å¹¶ apply èµ„æºå¯¹è±¡</a></li><li><a href=#22-å…¸å‹è°ƒç”¨é“¾>2.2 å…¸å‹è°ƒç”¨é“¾</a></li></ul></li><li><a href=#ç›¸å…³ä»£ç å‚è€ƒ>ç›¸å…³ä»£ç å‚è€ƒ</a></li><li><a href=#1-æ ¸å¿ƒç»“æ„>1ï¸âƒ£ æ ¸å¿ƒç»“æ„</a></li><li><a href=#2-æ ¸å¿ƒæ–¹æ³•addmemberclusterresource>2ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼š<code>addMemberClusterResource</code></a><ul><li><a href=#-åšäº†ä»€ä¹ˆ>ğŸ”¹ åšäº†ä»€ä¹ˆ</a></li></ul></li><li><a href=#3-validatememberclusterconfiguration>3ï¸âƒ£ <code>validateMemberClusterConfiguration</code></a></li><li><a href=#4-æ€»ç»“è¡¨å•å­—æ®µåˆ°-deployment-æ˜ å°„>4ï¸âƒ£ æ€»ç»“ï¼šè¡¨å•å­—æ®µåˆ° Deployment æ˜ å°„</a></li><li><a href=#1-æ ¸å¿ƒç»“æ„-1>1ï¸âƒ£ æ ¸å¿ƒç»“æ„</a></li><li><a href=#2-install--upgrade--uninstall>2ï¸âƒ£ Install / Upgrade / Uninstall</a><ul><li><a href=#install>Install</a></li><li><a href=#upgrade>Upgrade</a></li><li><a href=#uninstall>Uninstall</a></li></ul></li><li><a href=#3-æ ¸å¿ƒæ–¹æ³•forapply>3ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼šForApply</a><ul><li><a href=#æ ¸å¿ƒæ­¥éª¤>æ ¸å¿ƒæ­¥éª¤ï¼š</a></li></ul></li><li><a href=#4-æ€»ç»“é€»è¾‘å‰ç«¯è¡¨å•åˆ°-k8s-èµ„æº>4ï¸âƒ£ æ€»ç»“é€»è¾‘ï¼ˆå‰ç«¯è¡¨å•åˆ° K8s èµ„æºï¼‰</a></li><li><a href=#1-å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º-deployment-çš„-yaml>1. å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º Deployment çš„ YAML</a></li><li><a href=#2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤-1>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a></li><li><a href=#3-æœåŠ¡ç«¯goä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹>3. æœåŠ¡ç«¯ï¼ˆGoï¼‰ä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹</a></li><li><a href=#4-æ–‡æ¡£ä¸­çš„å…¸å‹-yaml-ç¤ºä¾‹>4. æ–‡æ¡£ä¸­çš„å…¸å‹ YAML ç¤ºä¾‹</a></li><li><a href=#æ€»ç»“æµç¨‹>æ€»ç»“æµç¨‹</a></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„>å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlï¼Œä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„
<a class=anchor href=#%e5%89%8d%e7%ab%af%e5%a1%ab%e5%86%99%e7%9a%84deployment%e7%9a%84%e8%a1%a8%e5%8d%95%e6%80%8e%e4%b9%88%e5%8f%98%e4%b8%ba%e5%90%8e%e7%ab%afdeployment%e7%9a%84yaml%e4%bb%a5%e5%8f%8a%e5%a6%82%e4%bd%95%e8%a2%ab%e9%83%a8%e7%bd%b2%e5%88%b0k8s%e9%9b%86%e7%be%a4%e7%9a%84>#</a></h2><p>ä½ é—®çš„è¿™ä¸ªæµç¨‹ï¼Œå…¶å®å°±æ˜¯ <strong>å‰ç«¯è¡¨å• â†’ åç«¯ç”Ÿæˆ YAML â†’ K8s API Server éƒ¨ç½²</strong> çš„é“¾è·¯ã€‚
æˆ‘ç»™ä½ è¯¦ç»†æ‹†å¼€è¯´ï¼š</p><hr><h2 id=1-å‰ç«¯è¡¨å•--deployment-é…ç½®æ•°æ®>1ï¸âƒ£ å‰ç«¯è¡¨å• â†’ Deployment é…ç½®æ•°æ®
<a class=anchor href=#1-%e5%89%8d%e7%ab%af%e8%a1%a8%e5%8d%95--deployment-%e9%85%8d%e7%bd%ae%e6%95%b0%e6%8d%ae>#</a></h2><p>å‰ç«¯çš„è¡¨å•ï¼ˆæ¯”å¦‚è¾“å…¥ <strong>åº”ç”¨åã€é•œåƒåã€å‰¯æœ¬æ•°ã€CPU/å†…å­˜é™åˆ¶ã€ç«¯å£</strong> ç­‰ï¼‰å°±æ˜¯ <strong>Deployment çš„æ ¸å¿ƒå­—æ®µ</strong>ã€‚
å‰ç«¯æäº¤çš„é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;myapp&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;replicas&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;image&#34;</span>: <span style=color:#e6db74>&#34;nginx:1.21&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;cpu&#34;</span>: <span style=color:#e6db74>&#34;200m&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;memory&#34;</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=2-åç«¯--è½¬æ¢ä¸º-k8s-yamlmanifest>2ï¸âƒ£ åç«¯ â†’ è½¬æ¢ä¸º K8s YAML/Manifest
<a class=anchor href=#2-%e5%90%8e%e7%ab%af--%e8%bd%ac%e6%8d%a2%e4%b8%ba-k8s-yamlmanifest>#</a></h2><p>åç«¯æ‹¿åˆ°è¿™ä¸ª JSONï¼Œå°±ä¼šç”¨æ¨¡æ¿ï¼ˆæˆ–è€…åŠ¨æ€æ‹¼æ¥ï¼‰ç”Ÿæˆ <strong>Deployment çš„ YAML æ¸…å•</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.21</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;200m&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p>âš¡ è¿™é‡Œåç«¯å¯èƒ½ä¼šç”¨æ¨¡æ¿å¼•æ“ï¼ˆGo Templateã€Jinja2ã€Handlebars.js ç­‰ï¼‰æ¥æŠŠè¡¨å•å­—æ®µæ›¿æ¢è¿› YAMLã€‚</p><hr><h2 id=3-åç«¯--éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>3ï¸âƒ£ åç«¯ â†’ éƒ¨ç½²åˆ° K8s é›†ç¾¤
<a class=anchor href=#3-%e5%90%8e%e7%ab%af--%e9%83%a8%e7%bd%b2%e5%88%b0-k8s-%e9%9b%86%e7%be%a4>#</a></h2><p>åç«¯æœ‰å‡ ç§æ–¹å¼æŠŠ YAML éƒ¨ç½²åˆ° K8sï¼š</p><h3 id=æ–¹å¼-aè°ƒç”¨-kubectl-apply>æ–¹å¼ Aï¼šè°ƒç”¨ <code>kubectl apply</code>
<a class=anchor href=#%e6%96%b9%e5%bc%8f-a%e8%b0%83%e7%94%a8-kubectl-apply>#</a></h3><ul><li><p>åç«¯æœåŠ¡å™¨ä¸Šå®‰è£… <code>kubectl</code>ï¼Œ</p></li><li><p>æŠŠ YAML å†™åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå†æ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f deployment.yaml
</span></span></code></pre></div></li></ul><h3 id=æ–¹å¼-bç›´æ¥è°ƒç”¨-kubernetes-api>æ–¹å¼ Bï¼šç›´æ¥è°ƒç”¨ Kubernetes API
<a class=anchor href=#%e6%96%b9%e5%bc%8f-b%e7%9b%b4%e6%8e%a5%e8%b0%83%e7%94%a8-kubernetes-api>#</a></h3><ul><li><p>Kubernetes æä¾›äº† RESTful APIï¼ˆ<code>/apis/apps/v1/namespaces/{namespace}/deployments</code>ï¼‰ã€‚</p></li><li><p>åç«¯å¯ä»¥æŠŠ YAML è½¬ JSONï¼Œç„¶åè°ƒç”¨ APIã€‚</p></li><li><p>ä¾‹å¦‚ POST è¯·æ±‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>POST /apis/apps/v1/namespaces/default/deployments
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Content-Type: application/json
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Authorization: Bearer &lt;k8s-token&gt;
</span></span></span></code></pre></div></li></ul><h3 id=æ–¹å¼-cç”¨å®˜æ–¹-sdk>æ–¹å¼ Cï¼šç”¨å®˜æ–¹ SDK
<a class=anchor href=#%e6%96%b9%e5%bc%8f-c%e7%94%a8%e5%ae%98%e6%96%b9-sdk>#</a></h3><p>ä¸åŒè¯­è¨€éƒ½æœ‰ Kubernetes SDKï¼š</p><ul><li>Go: <code>client-go</code></li><li>Python: <code>kubernetes</code></li><li>JavaScript/Node.js: <code>@kubernetes/client-node</code></li></ul><p>è¿™äº› SDK å¯ä»¥ç›´æ¥ç”¨å¯¹è±¡æ–¹å¼å®šä¹‰ Deploymentï¼Œå†è°ƒç”¨ <code>createNamespacedDeployment()</code> æ–¹æ³•ã€‚</p><hr><h2 id=4-æ•´ä½“æµç¨‹æ€»ç»“>4ï¸âƒ£ æ•´ä½“æµç¨‹æ€»ç»“
<a class=anchor href=#4-%e6%95%b4%e4%bd%93%e6%b5%81%e7%a8%8b%e6%80%bb%e7%bb%93>#</a></h2><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
A[å‰ç«¯è¡¨å•å¡«å†™å‚æ•°] --&gt; B[æäº¤ JSON åˆ°åç«¯]
B --&gt; C[åç«¯ç”Ÿæˆ YAML/JSON Manifest]
C --&gt; D{éƒ¨ç½²åˆ°K8s?}
D --&gt;|kubectl apply| E[K8s API Server]
D --&gt;|REST API| E
D --&gt;|SDK è°ƒç”¨| E
E --&gt; F[etcd å­˜å‚¨èµ„æºå¯¹è±¡]
F --&gt; G[Scheduler è°ƒåº¦ Pod]
G --&gt; H[Kubelet åœ¨èŠ‚ç‚¹ä¸Šæ‹‰å–é•œåƒå¹¶è¿è¡Œå®¹å™¨]
</code></pre><hr><p>âœ… <strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š
å‰ç«¯è¡¨å•å°±æ˜¯æŠŠ Deployment çš„å­—æ®µå‚æ•°åŒ–ï¼Œåç«¯æŠŠè¿™äº›å‚æ•°æ¸²æŸ“æˆ K8s YAML/JSONï¼Œç„¶åé€šè¿‡ <code>kubectl</code> æˆ– API æäº¤ç»™ <strong>K8s API Server</strong>ï¼Œç”± K8s å®Œæˆè°ƒåº¦å’Œå®¹å™¨åˆ›å»ºã€‚</p><hr><p>è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª <strong>Node.js åç«¯ç¤ºä¾‹</strong>ï¼Œä»è¡¨å• JSON è‡ªåŠ¨ç”Ÿæˆ Deployment å¹¶è°ƒç”¨ Kubernetes API åˆ›å»ºï¼Ÿ</p><p>æ ¹æ®æºç ï¼Œsealoså‰ç«¯è¡¨å•åˆ°åç«¯ YAML åŠéƒ¨ç½²æµç¨‹ä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼š</p><h3 id=1-å‰ç«¯è¡¨å•è½¬-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•è½¬ deployment çš„ YAML
<a class=anchor href=#1-%e5%89%8d%e7%ab%af%e8%a1%a8%e5%8d%95%e8%bd%ac-deployment-%e7%9a%84-yaml>#</a></h3><ul><li>å‰ç«¯è¡¨å•æ•°æ®ä¼šè¢«ä¸“é—¨çš„å‡½æ•°ï¼ˆå¦‚ <code>json2DeployCr</code>ï¼‰è½¬æ¢ä¸º Kubernetes çš„ YAML æ ¼å¼ã€‚</li><li>ä»¥ <code>frontend/providers/applaunchpad/src/utils/deployYaml2Json.ts</code> ä¸ºä¾‹ï¼Œæ ¸å¿ƒå‡½æ•°å¦‚ä¸‹ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>json2DeployCr</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>AppEditType</span>, <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;deployment&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;statefulset&#39;</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// æ„å»º metadataã€spec ç­‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>metadata</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>data.appName</span>, ... };
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commonSpec</span> <span style=color:#f92672>=</span> { ... };
</span></span><span style=display:flex><span>  <span style=color:#75715e>// æœ€ç»ˆè¿”å› deployment/statefulset å¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// è½¬ä¸º YAML å­—ç¬¦ä¸²ä½¿ç”¨ yaml.dump
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>dump</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>apiVersion</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;apps/v1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kind</span>: <span style=color:#66d9ef>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;deployment&#39;</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Deployment&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;StatefulSet&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metadata</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>spec</span>: <span style=color:#66d9ef>commonSpec</span>
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>åœ¨é¡µé¢é‡Œï¼Œé€šå¸¸ä¼šæŠŠè¡¨å•æ•°æ®æ”¶é›†åï¼Œè°ƒç”¨å¦‚ä¸Šæ–¹æ³•æˆ–ç±»ä¼¼çš„ <code>generateYamlList</code> æ–¹æ³•ï¼Œå°†æ•°æ®è½¬ä¸º YAMLï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;deployment.yaml&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2DeployCr</span>(<span style=color:#a6e22e>data</span>, <span style=color:#e6db74>&#39;deployment&#39;</span>)
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å…¶å®ƒèµ„æºï¼ˆserviceã€configmapç­‰ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>]
</span></span></code></pre></div><h3 id=2-yaml-è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. YAML è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤
<a class=anchor href=#2-yaml-%e8%a2%ab%e9%83%a8%e7%bd%b2%e5%88%b0-k8s-%e9%9b%86%e7%be%a4>#</a></h3><ul><li>å‰ç«¯ç”Ÿæˆ YAML åï¼Œè°ƒç”¨åç«¯æ¥å£ï¼ˆå¦‚ <code>applyYamlList</code>ï¼‰ï¼Œåç«¯ä¼šç”¨ K8s å®¢æˆ·ç«¯ SDK è¿›è¡Œéƒ¨ç½²ã€‚</li><li>ä»¥ <code>frontend/providers/applaunchpad/src/services/backend/kubernetes.ts</code> ä¸ºä¾‹ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getK8s</span>({ <span style=color:#a6e22e>kubeconfig</span> }<span style=color:#f92672>:</span> { <span style=color:#a6e22e>kubeconfig</span>: <span style=color:#66d9ef>string</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>formatYaml</span>: <span style=color:#66d9ef>k8s.KubernetesObject</span>[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>yamlList</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>item</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>loadAll</span>(<span style=color:#a6e22e>item</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>flat</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>item</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>metadata</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>metadata</span>.<span style=color:#66d9ef>namespace</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>namespace</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>item</span>;
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;create&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CreateYaml</span>(<span style=color:#a6e22e>kc</span>, <span style=color:#a6e22e>formatYaml</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;replace&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>replaceYaml</span>(<span style=color:#a6e22e>kc</span>, <span style=color:#a6e22e>formatYaml</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CreateYaml</span>(<span style=color:#a6e22e>kc</span>, <span style=color:#a6e22e>formatYaml</span>);
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><ul><li><code>CreateYaml</code> å’Œ <code>replaceYaml</code> ç­‰æ–¹æ³•ä¼šè°ƒç”¨ K8s APIï¼ŒæŠŠ YAML åº”ç”¨åˆ°é›†ç¾¤ã€‚</li></ul><hr><h4 id=å…³é”®æµç¨‹æ¢³ç†>å…³é”®æµç¨‹æ¢³ç†
<a class=anchor href=#%e5%85%b3%e9%94%ae%e6%b5%81%e7%a8%8b%e6%a2%b3%e7%90%86>#</a></h4><ol><li><strong>è¡¨å•æ•°æ®æ”¶é›†</strong> â†’ é€šè¿‡å¦‚ <code>json2DeployCr</code> ç­‰æ–¹æ³•è½¬ä¸º YAML å­—ç¬¦ä¸²ã€‚</li><li><strong>YAML åˆ—è¡¨ç”Ÿæˆ</strong> â†’ ç»„ç»‡æˆå¦‚ <code>[ { filename: 'deployment.yaml', value: &lt;yamlå­—ç¬¦ä¸²> } ]</code></li><li><strong>å‰ç«¯è°ƒç”¨åç«¯æ¥å£</strong>ï¼ˆå¦‚ <code>applyYamlList</code>ï¼‰â†’ åç«¯è§£æ YAML å¹¶ç”¨ K8s SDK apply åˆ°é›†ç¾¤ã€‚</li></ol><hr><h4 id=ç›¸å…³å…³é”®ä»£ç æ±‡æ€»>ç›¸å…³å…³é”®ä»£ç æ±‡æ€»
<a class=anchor href=#%e7%9b%b8%e5%85%b3%e5%85%b3%e9%94%ae%e4%bb%a3%e7%a0%81%e6%b1%87%e6%80%bb>#</a></h4><ul><li>YAML ç”Ÿæˆï¼š<code>frontend/providers/applaunchpad/src/utils/deployYaml2Json.ts</code> (<code>json2DeployCr</code>)</li><li>YAML åº”ç”¨ï¼š<code>frontend/providers/applaunchpad/src/services/backend/kubernetes.ts</code> (<code>CreateYaml</code>, <code>replaceYaml</code>)</li><li>è¡¨å•åˆ° YAML è°ƒç”¨é“¾ï¼š<code>frontend/providers/applaunchpad/src/pages/app/edit/index.tsx</code>ã€<code>frontend/providers/applaunchpad/src/services/backend/appService.ts</code></li></ul><hr><p>å¦‚éœ€å…·ä½“æŸä¸€éƒ¨åˆ†çš„å®Œæ•´å‡½æ•°/å®ç°å¯è¿›ä¸€æ­¥æŒ‡å®šã€‚</p><p>å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ æ¢³ç†ä¸€ä¸‹è¿™æ®µ <code>EditApp</code> ç»„ä»¶çš„é€»è¾‘ï¼Œä»¥åŠ<strong>å‰ç«¯è¡¨å•åˆ° YAMLï¼Œå†åˆ°è°ƒç”¨åç«¯ API éƒ¨ç½² Kubernetes çš„æ•´ä¸ªé“¾è·¯</strong>ã€‚æˆ‘ä¼šåˆ†æ­¥éª¤è§£é‡Šå¹¶ç”¨ä¸€ä¸ªè°ƒç”¨é“¾çš„æ–¹å¼å¸®ä½ ç†æ¸…æ€è·¯ã€‚</p><hr><h2 id=1-æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ>1ï¸âƒ£ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ
<a class=anchor href=#1-%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd%e6%a6%82%e8%a7%88>#</a></h2><p><code>EditApp</code> æ˜¯ä¸€ä¸ª <strong>åº”ç”¨éƒ¨ç½²ç¼–è¾‘é¡µé¢</strong>ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>å‰ç«¯è¡¨å•å¡«å†™åº”ç”¨å‚æ•°ï¼ˆé•œåƒã€ç«¯å£ã€CPU/å†…å­˜ã€å­˜å‚¨ã€GPU ç­‰ï¼‰</li><li>å®æ—¶ç”Ÿæˆå¯¹åº”çš„ Kubernetes YAMLï¼ˆDeploymentã€StatefulSetã€Serviceã€Ingressã€HPAã€ConfigMapã€Secretï¼‰</li><li>æ”¯æŒâ€œè¡¨å•æ¨¡å¼â€å’Œâ€œYAMLæ¨¡å¼â€ç¼–è¾‘</li><li>æ ¡éªŒèµ„æºé…é¢ã€GPUã€ç«¯å£å†²çª</li><li>è°ƒç”¨åç«¯æ¥å£éƒ¨ç½²æˆ–æ›´æ–°åº”ç”¨</li><li>éƒ¨ç½²æˆåŠŸæˆ–å¤±è´¥åé¦ˆç»™ç”¨æˆ·</li></ul><hr><h2 id=2-å‰ç«¯è¡¨å•---yaml-çš„è½¬æ¢>2ï¸âƒ£ å‰ç«¯è¡¨å• -> YAML çš„è½¬æ¢
<a class=anchor href=#2-%e5%89%8d%e7%ab%af%e8%a1%a8%e5%8d%95---yaml-%e7%9a%84%e8%bd%ac%e6%8d%a2>#</a></h2><p>æ ¸å¿ƒå‡½æ•°æ˜¯ <code>formData2Yamls</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>formData2Yamls</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>AppEditType</span>) <span style=color:#f92672>=&gt;</span> [
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;service.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2Service</span>(<span style=color:#a6e22e>data</span>) },
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;deployment.yaml&#39;</span> <span style=color:#a6e22e>or</span> <span style=color:#e6db74>&#39;statefulset.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2DeployCr</span>(<span style=color:#a6e22e>data</span>) },
</span></span><span style=display:flex><span>  ...(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>configMapList</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> [{ <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;configmap.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2ConfigMap</span>(<span style=color:#a6e22e>data</span>) }] <span style=color:#f92672>:</span> []),
</span></span><span style=display:flex><span>  ...(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>networks</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>item</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>openPublicDomain</span>) <span style=color:#f92672>?</span> [{ <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ingress.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2Ingress</span>(<span style=color:#a6e22e>data</span>) }] <span style=color:#f92672>:</span> []),
</span></span><span style=display:flex><span>  ...(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>hpa</span>.<span style=color:#a6e22e>use</span> <span style=color:#f92672>?</span> [{ <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;hpa.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2HPA</span>(<span style=color:#a6e22e>data</span>) }] <span style=color:#f92672>:</span> []),
</span></span><span style=display:flex><span>  ...(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>secret</span>.<span style=color:#a6e22e>use</span> <span style=color:#f92672>?</span> [{ <span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;secret.yaml&#39;</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>json2Secret</span>(<span style=color:#a6e22e>data</span>) }] <span style=color:#f92672>:</span> [])
</span></span><span style=display:flex><span>];
</span></span></code></pre></div><p>ğŸ”¹ <strong>ä½œç”¨</strong>ï¼šå°†ç”¨æˆ·åœ¨è¡¨å•ä¸­å¡«å†™çš„æ•°æ®ï¼Œè½¬æ¢æˆ Kubernetes å¯ä»¥ç†è§£çš„ YAML å¯¹è±¡ã€‚</p><ul><li><code>json2Service</code> â†’ ç”Ÿæˆ Service YAML</li><li><code>json2DeployCr</code> â†’ Deployment / StatefulSet YAML</li><li><code>json2Ingress</code> â†’ Ingress YAMLï¼ˆå¦‚æœå¼€å¯å…¬ç½‘åŸŸåï¼‰</li><li><code>json2HPA</code> â†’ HPA YAMLï¼ˆå¦‚æœå¼€å¯å¼¹æ€§ä¼¸ç¼©ï¼‰</li><li><code>json2ConfigMap</code> / <code>json2Secret</code> â†’ å¯¹åº”èµ„æº</li></ul><hr><h2 id=3-ç”¨æˆ·ç‚¹å‡»åº”ç”¨éƒ¨ç½²æŒ‰é’®çš„æµç¨‹>3ï¸âƒ£ ç”¨æˆ·ç‚¹å‡»â€œåº”ç”¨éƒ¨ç½²â€æŒ‰é’®çš„æµç¨‹
<a class=anchor href=#3-%e7%94%a8%e6%88%b7%e7%82%b9%e5%87%bb%e5%ba%94%e7%94%a8%e9%83%a8%e7%bd%b2%e6%8c%89%e9%92%ae%e7%9a%84%e6%b5%81%e7%a8%8b>#</a></h2><p>åœ¨ <code>Header</code> ç»„ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå›è°ƒ <code>applyCb</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>applyCb</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>formHook</span>.<span style=color:#a6e22e>handleSubmit</span>(<span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>data</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parseYamls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData2Yamls</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setYamlList</span>(<span style=color:#a6e22e>parseYamls</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GPUåº“å­˜æ ¡éªŒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>gpu</span><span style=color:#f92672>?</span>.<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>inventory</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countGpuInventory</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>gpu</span><span style=color:#f92672>?</span>.<span style=color:#66d9ef>type</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>gpu</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>amount</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>inventory</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>toast</span>(...);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç½‘ç»œç«¯å£å†²çªæ ¡éªŒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>checkNetworkPorts</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>networks</span>)) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>toast</span>(...);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æƒé™æ£€æŸ¥ï¼ˆç¼–è¾‘å·²æœ‰åº”ç”¨ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>appName</span>) <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>checkPermission</span>(...);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¼¹å‡ºç¡®è®¤æ¡†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>openConfirm</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>submitSuccess</span>(<span style=color:#a6e22e>parseYamls</span>))();
</span></span><span style=display:flex><span>  }, <span style=color:#a6e22e>submitError</span>)();
</span></span><span style=display:flex><span>}}
</span></span></code></pre></div><p><strong>æ­¥éª¤è§£é‡Š</strong>ï¼š</p><ol><li><code>handleSubmit</code> è·å–è¡¨å•æ•°æ® <code>data</code></li><li>è°ƒç”¨ <code>formData2Yamls(data)</code> ç”Ÿæˆ YAML åˆ—è¡¨</li><li>æ£€æŸ¥ GPU é…é¢</li><li>æ£€æŸ¥ç½‘ç»œç«¯å£å†²çª</li><li>æƒé™æ£€æŸ¥</li><li>å¼¹å‡ºç¡®è®¤æ¡† <code>openConfirm</code></li><li>ç¡®è®¤åè°ƒç”¨ <code>submitSuccess(parseYamls)</code></li></ol><hr><h2 id=4-submitsuccess---è°ƒç”¨åç«¯-api>4ï¸âƒ£ <code>submitSuccess</code> -> è°ƒç”¨åç«¯ API
<a class=anchor href=#4-submitsuccess---%e8%b0%83%e7%94%a8%e5%90%8e%e7%ab%af-api>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submitSuccess</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useCallback</span>(<span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>yamlList</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setIsLoading</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parsedNewYamlList</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>yamlList</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>item</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>appName</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>patch</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>patchYamlList</span>({ <span style=color:#a6e22e>parsedOldYamlList</span>: <span style=color:#66d9ef>formOldYamls.current.map</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>value</span>), <span style=color:#a6e22e>parsedNewYamlList</span>, <span style=color:#a6e22e>originalYamlList</span>: <span style=color:#66d9ef>crOldYamls.current</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>putApp</span>({ <span style=color:#a6e22e>patch</span>, <span style=color:#a6e22e>appName</span>, <span style=color:#a6e22e>stateFulSetYaml</span>: <span style=color:#66d9ef>yamlList.find</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>filename</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;statefulset.yaml&#39;</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>value</span> });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>postDeployApp</span>(<span style=color:#a6e22e>parsedNewYamlList</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>`/app/detail?name=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>formHook</span>.<span style=color:#a6e22e>getValues</span>(<span style=color:#e6db74>&#39;appName&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toast</span>({ <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>t</span>(<span style=color:#a6e22e>applySuccess</span>), <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;success&#39;</span> });
</span></span><span style=display:flex><span>}, [...])
</span></span></code></pre></div><p>ğŸ”¹ <strong>ä½œç”¨</strong>ï¼šæŠŠ YAML åˆ—è¡¨å‘é€ç»™åç«¯æ¥å£ï¼š</p><ul><li><code>postDeployApp(parsedNewYamlList)</code> â†’ æ–°å»ºåº”ç”¨</li><li><code>putApp({...})</code> â†’ ç¼–è¾‘å·²æœ‰åº”ç”¨ï¼ˆpatch å·®å¼‚åŒ–æ›´æ–°ï¼‰</li></ul><p>åç«¯æ¥æ”¶åˆ° YAML åï¼Œä¼šè°ƒç”¨ K8s API Server éƒ¨ç½²èµ„æºï¼ˆå¯¹åº”ä½ ä¹‹å‰è´´çš„ <code>K8sApi</code> + <code>CreateYaml/replaceYaml</code> é€»è¾‘ï¼‰ã€‚</p><hr><h2 id=5-è°ƒç”¨é“¾æ€»ç»“è¡¨å•åˆ°-yaml-åˆ°éƒ¨ç½²>5ï¸âƒ£ è°ƒç”¨é“¾æ€»ç»“ï¼ˆè¡¨å•åˆ° YAML åˆ°éƒ¨ç½²ï¼‰
<a class=anchor href=#5-%e8%b0%83%e7%94%a8%e9%93%be%e6%80%bb%e7%bb%93%e8%a1%a8%e5%8d%95%e5%88%b0-yaml-%e5%88%b0%e9%83%a8%e7%bd%b2>#</a></h2><p>ç”¨æ–‡å­—æè¿°è°ƒç”¨é“¾ï¼š</p><pre tabindex=0><code>å‰ç«¯ç”¨æˆ·å¡«è¡¨å•
        â”‚
        â–¼
formHook.handleSubmit
        â”‚
        â–¼
formData2Yamls() â†’ YAML åˆ—è¡¨
        â”‚
        â–¼
æ ¡éªŒ GPU / ç½‘ç»œç«¯å£ / æƒé™
        â”‚
        â–¼
openConfirm() ç¡®è®¤
        â”‚
        â–¼
submitSuccess(yamlList)
        â”‚
        â–¼
postDeployApp / putApp (è°ƒç”¨åç«¯ API)
        â”‚
        â–¼
åç«¯æ¥æ”¶ YAML
        â”‚
        â–¼
è°ƒç”¨ K8sApi + CreateYaml/replaceYaml
        â”‚
        â–¼
K8s API Server
        â”‚
        â–¼
Pod / Deployment / Service ç­‰èµ„æºåˆ›å»ºå®Œæˆ
        â”‚
        â–¼
è¿”å›çŠ¶æ€ â†’ å‰ç«¯ toast æç¤ºæˆåŠŸ
</code></pre><hr><p>å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€ä¸ª <strong>Mermaid æ—¶åºå›¾</strong>ï¼ŒæŠŠè¿™ä¸ªè¡¨å•åˆ° YAML å†åˆ° K8s API Server çš„å®Œæ•´è°ƒç”¨é“¾å¯è§†åŒ–å‡ºæ¥ï¼Œçœ‹èµ·æ¥æ›´ç›´è§‚ã€‚</p><p>ä½ æƒ³è®©æˆ‘ç”»å—ï¼Ÿ</p><p>å¥½çš„ï¼Œæˆ‘å¸®ä½ ç”»ä¸€ä¸ª Mermaid æ—¶åºå›¾ï¼ŒæŠŠ <strong>å‰ç«¯è¡¨å• â†’ YAML â†’ åç«¯ API â†’ K8s API Server â†’ Pod/Service</strong> çš„å®Œæ•´è°ƒç”¨é“¾ç›´è§‚è¡¨ç°å‡ºæ¥ï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant User as ç”¨æˆ·
    participant Frontend as å‰ç«¯é¡µé¢(Form / EditApp)
    participant Backend as åç«¯ API(postDeployApp / putApp)
    participant K8sApi as K8s API å±‚(K8sApi + CreateYaml/replaceYaml)
    participant K8sServer as K8s API Server

    User-&gt;&gt;Frontend: å¡«å†™è¡¨å•ï¼ˆé•œåƒã€CPUã€å†…å­˜ã€ç«¯å£ã€å­˜å‚¨ç­‰ï¼‰
    Frontend-&gt;&gt;Frontend: formHook.handleSubmit()
    Frontend-&gt;&gt;Frontend: formData2Yamls() ç”Ÿæˆ YAML åˆ—è¡¨
    Frontend-&gt;&gt;Frontend: æ ¡éªŒ GPU / ç½‘ç»œç«¯å£ / æƒé™
    Frontend-&gt;&gt;User: å¼¹å‡ºç¡®è®¤æ¡† openConfirm()
    User-&gt;&gt;Frontend: ç‚¹å‡»ç¡®è®¤
    Frontend-&gt;&gt;Frontend: submitSuccess(yamlList)
    Frontend-&gt;&gt;Backend: postDeployApp / putApp(yamlList)
    Backend-&gt;&gt;K8sApi: è§£æ YAML è°ƒç”¨ CreateYaml / replaceYaml
    K8sApi-&gt;&gt;K8sServer: è°ƒç”¨ K8s API Server åˆ›å»º Deployment/Service/Ingress/ConfigMap/Secret ç­‰
    K8sServer--&gt;&gt;K8sApi: è¿”å›èµ„æºåˆ›å»ºç»“æœ
    K8sApi--&gt;&gt;Backend: è¿”å›éƒ¨ç½²ç»“æœ
    Backend--&gt;&gt;Frontend: è¿”å›æˆåŠŸ/å¤±è´¥çŠ¶æ€
    Frontend-&gt;&gt;User: toast æç¤ºéƒ¨ç½²æˆåŠŸæˆ–å¤±è´¥
</code></pre><p>âœ… <strong>è¯´æ˜</strong>ï¼š</p><ul><li>å‰ç«¯è´Ÿè´£æ”¶é›†è¡¨å•æ•°æ®ã€ç”Ÿæˆ YAMLã€æ ¡éªŒèµ„æºå’Œæƒé™</li><li>åç«¯è´Ÿè´£æ¥æ”¶ YAMLã€è°ƒç”¨ K8s API éƒ¨ç½²</li><li>K8sApi å±‚å°è£…äº† <code>KubernetesObjectApi</code> çš„æ“ä½œï¼ˆcreate/replaceï¼‰</li><li>æœ€ç»ˆ Kubernetes API Server åˆ›å»º Podã€Deploymentã€Service ç­‰èµ„æº</li></ul><hr><p>æˆ‘å¯ä»¥å†å¸®ä½ ç”»ä¸€ä¸ª <strong>å¸¦ HPAã€StatefulSetã€Ingress ç­‰èµ„æºç»†åˆ†çš„æ—¶åºå›¾</strong>ï¼Œæ›´è¯¦ç»†åœ°è¡¨ç° YAML å¯¹åº”ä¸åŒèµ„æºçš„éƒ¨ç½²æµç¨‹ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªæ›´è¯¦ç»†ç‰ˆæœ¬å—ï¼Ÿ</p><p>å¥½ï¼Œæˆ‘ä»¬æŠŠå‰ç«¯è¡¨å•æäº¤åˆ° YAMLã€å†åˆ°ä¸åŒ Kubernetes èµ„æºçš„å®Œæ•´æµç¨‹ç”»å‡ºæ¥ï¼ŒåŒ…æ‹¬ <strong>Deployment/StatefulSetã€Serviceã€Ingressã€ConfigMapã€Secretã€HPA</strong> ç­‰ã€‚</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant User as ç”¨æˆ·
    participant Frontend as å‰ç«¯é¡µé¢(Form / EditApp)
    participant Backend as åç«¯ API(postDeployApp / putApp)
    participant K8sApi as K8s API å±‚(CreateYaml / replaceYaml)
    participant K8sServer as K8s API Server
    participant Pod as Pod / StatefulSet
    participant HPA as HPA Controller
    participant Ingress as Ingress Controller

    User-&gt;&gt;Frontend: å¡«å†™è¡¨å•ï¼ˆé•œåƒã€CPUã€å†…å­˜ã€ç«¯å£ã€å­˜å‚¨ç­‰ï¼‰
    Frontend-&gt;&gt;Frontend: formHook.handleSubmit()
    Frontend-&gt;&gt;Frontend: formData2Yamls() ç”Ÿæˆ YAML åˆ—è¡¨
    Frontend-&gt;&gt;Frontend: æ ¡éªŒ GPU / ç½‘ç»œç«¯å£ / æƒé™
    Frontend-&gt;&gt;User: å¼¹å‡ºç¡®è®¤æ¡† openConfirm()
    User-&gt;&gt;Frontend: ç‚¹å‡»ç¡®è®¤
    Frontend-&gt;&gt;Frontend: submitSuccess(yamlList)
    Frontend-&gt;&gt;Backend: postDeployApp / putApp(yamlList)
    Backend-&gt;&gt;K8sApi: è§£æ YAMLï¼ŒæŒ‰èµ„æºç±»å‹è°ƒç”¨ CreateYaml / replaceYaml

    alt Service YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º Service
        K8sServer--&gt;&gt;K8sApi: è¿”å› Service çŠ¶æ€
    end

    alt Deployment / StatefulSet YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º Deployment / StatefulSet
        K8sServer--&gt;&gt;Pod: è°ƒåº¦ Pod
        Pod--&gt;&gt;K8sServer: Pod å°±ç»ª
        K8sServer--&gt;&gt;K8sApi: è¿”å› Deployment/StatefulSet çŠ¶æ€
    end

    alt ConfigMap YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º ConfigMap
        K8sServer--&gt;&gt;K8sApi: è¿”å›çŠ¶æ€
    end

    alt Secret YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º Secret
        K8sServer--&gt;&gt;K8sApi: è¿”å›çŠ¶æ€
    end

    alt Ingress YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º Ingress
        K8sServer--&gt;&gt;Ingress: é…ç½®è´Ÿè½½å‡è¡¡ / åŸŸåè·¯ç”±
        Ingress--&gt;&gt;K8sServer: çŠ¶æ€æ›´æ–°
        K8sServer--&gt;&gt;K8sApi: è¿”å›çŠ¶æ€
    end

    alt HPA YAML
        K8sApi-&gt;&gt;K8sServer: åˆ›å»º HPA
        K8sServer--&gt;&gt;HPA: HPA ç›‘æ§ Deployment / StatefulSet
        HPA--&gt;&gt;Pod: è°ƒæ•´å‰¯æœ¬æ•°
        HPA--&gt;&gt;K8sServer: è¿”å›çŠ¶æ€
        K8sServer--&gt;&gt;K8sApi: è¿”å› HPA çŠ¶æ€
    end

    K8sApi--&gt;&gt;Backend: è¿”å›éƒ¨ç½²ç»“æœ
    Backend--&gt;&gt;Frontend: è¿”å›æˆåŠŸ/å¤±è´¥çŠ¶æ€
    Frontend-&gt;&gt;User: toast æç¤ºéƒ¨ç½²æˆåŠŸæˆ–å¤±è´¥
</code></pre><p>âœ… <strong>ç‰¹ç‚¹è¯´æ˜</strong>ï¼š</p><ol><li><strong>å‰ç«¯</strong>ç”Ÿæˆ YAML æ—¶ä¼šæ ¹æ®è¡¨å•å†³å®šèµ„æºç±»å‹ï¼ˆDeployment / StatefulSet / Service / Ingress / ConfigMap / Secret / HPAï¼‰</li><li><strong>åç«¯</strong>åªè´Ÿè´£æŠŠ YAML è°ƒç”¨ K8sApi å±‚éƒ¨ç½²</li><li><strong>K8sApi</strong>æŠŠæ¯ä¸ª YAML è½¬åŒ–æˆ Kubernetes API è°ƒç”¨</li><li><strong>Kubernetes Server</strong>è´Ÿè´£è°ƒåº¦ Podã€æ›´æ–° HPAã€Ingress Controller é…ç½®ç­‰</li></ol><hr><p>å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†ç”»ä¸€ä¸ª <strong>äº¤äº’æµç¨‹+èµ„æºä¾èµ–å›¾</strong>ï¼Œæ˜¾ç¤ºå“ªä¸ª YAML ä¾èµ–å“ªä¸ªèµ„æºï¼ˆæ¯”å¦‚ Deployment ä¾èµ– ConfigMap/Secretï¼ŒIngress ä¾èµ– Serviceï¼‰ï¼Œæ›´åƒ <strong>éƒ¨ç½²æ‹“æ‰‘å›¾</strong>ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªå—ï¼Ÿ</p><p>å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ æ¢³ç†è¿™æ®µä»£ç çš„é€»è¾‘ï¼Œé‡ç‚¹æ˜¯<strong>è¡¨å•æäº¤ â†’ YAML ç”Ÿæˆ â†’ Kubernetes èµ„æºåˆ›å»º/æ“ä½œ</strong>çš„è°ƒç”¨é“¾ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä¼šæŒ‰æµç¨‹å’Œæ¨¡å—æ‹†è§£ã€‚</p><hr><h2 id=1-k8scontext-æ¥å£><strong>1ï¸âƒ£ K8sContext æ¥å£</strong>
<a class=anchor href=#1-k8scontext-%e6%8e%a5%e5%8f%a3>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>K8sContext</span> { 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kc</span>: <span style=color:#66d9ef>KubeConfig</span>;             <span style=color:#75715e>// kubeconfig
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>apiClient</span>: <span style=color:#66d9ef>KubernetesObjectApi</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sCore</span>: <span style=color:#66d9ef>CoreV1Api</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sApp</span>: <span style=color:#66d9ef>AppsV1Api</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sAutoscaling</span>: <span style=color:#66d9ef>AutoscalingV2Api</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sNetworkingApp</span>: <span style=color:#66d9ef>NetworkingV1Api</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sCustomObjects</span>: <span style=color:#66d9ef>CustomObjectsApi</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>metricsClient</span>: <span style=color:#66d9ef>Metrics</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>k8sExec</span>: <span style=color:#66d9ef>Exec</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kube_user</span>: <span style=color:#66d9ef>User</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>; 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>namespace</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span>; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>applyYamlList</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>yamlList</span>: <span style=color:#66d9ef>string</span>[], <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;create&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;replace&#39;</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>KubernetesObject</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getDeployApp</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>appName</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>V1Deployment</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>V1StatefulSet</span>&gt;; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getUserQuota</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>UserQuotaItemType</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;; 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getUserBalance</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>number</span>&gt;; 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>è¿™æ˜¯æ•´ä¸ª Kubernetes æ“ä½œä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå°è£…äº†å¯¹å„ç§ API çš„å®¢æˆ·ç«¯ï¼ˆCoreã€Appsã€Autoscalingã€Networkingã€CustomObjectsï¼‰ã€‚</li><li><code>applyYamlList</code>ï¼šæ ¸å¿ƒæ–¹æ³•ï¼Œå°† YAML åˆ—è¡¨åº”ç”¨åˆ°é›†ç¾¤ï¼Œå¯é€‰æ‹© <code>create</code> æˆ– <code>replace</code>ã€‚</li><li><code>getDeployApp</code>ï¼šè·å– Deployment æˆ– StatefulSetï¼Œç”¨äº pause/start/update æ“ä½œã€‚</li></ul><hr><h2 id=2-è¡¨å•--yaml--åˆ›å»ºåº”ç”¨><strong>2ï¸âƒ£ è¡¨å• â†’ YAML â†’ åˆ›å»ºåº”ç”¨</strong>
<a class=anchor href=#2-%e8%a1%a8%e5%8d%95--yaml--%e5%88%9b%e5%bb%ba%e5%ba%94%e7%94%a8>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createApp</span>(<span style=color:#a6e22e>appForm</span>: <span style=color:#66d9ef>AppEditType</span>, <span style=color:#a6e22e>k8s</span>: <span style=color:#66d9ef>K8sContext</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>serverLoadInitData</span>(); <span style=color:#75715e>// åˆå§‹åŒ–å‰ç«¯æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>applyYamlList</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>k8s</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ç»™ç½‘ç»œé…ç½®åŠ ä¸ŠåŸŸå
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>appForm</span>.<span style=color:#a6e22e>networks</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>appForm</span>.<span style=color:#a6e22e>networks</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>network</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> ({
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>network</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>domain</span>: <span style=color:#66d9ef>global.AppConfig.cloud.domain</span>
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// æ ¸å¿ƒï¼šè¡¨å•æ•°æ®è½¬ YAML
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parseYamls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData2Yamls</span>(<span style=color:#a6e22e>appForm</span>); 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>yamls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>parseYamls</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>item</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// è°ƒç”¨ applyYamlList åˆ›å»ºæ‰€æœ‰èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>applyYamlList</span>(<span style=color:#a6e22e>yamls</span>, <span style=color:#e6db74>&#39;create&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>è°ƒç”¨é“¾ï¼š</strong></p><ol><li>ç”¨æˆ·åœ¨å‰ç«¯è¡¨å•å¡«å…¥åº”ç”¨é…ç½®ï¼ˆé•œåƒã€CPUã€å†…å­˜ã€ç«¯å£ã€å­˜å‚¨ã€ç½‘ç»œç­‰ï¼‰</li><li><code>formData2Yamls(appForm)</code> å°†è¡¨å•æ•°æ®è½¬æ¢ä¸º Kubernetes YAML åˆ—è¡¨ï¼Œå¯èƒ½åŒ…å«ï¼š<ul><li>Deployment / StatefulSet</li><li>Service</li><li>Ingress</li><li>ConfigMap</li><li>Secret</li><li>HPA</li></ul></li><li><code>applyYamlList(yamls, 'create')</code> å°† YAML åº”ç”¨åˆ° Kubernetes é›†ç¾¤<ul><li>å†…éƒ¨é€šè¿‡ <code>KubernetesObjectApi</code> è°ƒç”¨ <code>create</code> æˆ– <code>replace</code></li><li>ç”Ÿæˆå¯¹åº”çš„ Kubernetes å¯¹è±¡</li></ul></li></ol><blockquote><p>æ‰€ä»¥ <strong>è¡¨å• â†’ formData2Yamls â†’ YAML åˆ—è¡¨ â†’ applyYamlList â†’ Kubernetes API â†’ é›†ç¾¤å¯¹è±¡</strong> æ˜¯åˆ›å»ºåº”ç”¨çš„æ ¸å¿ƒé“¾è·¯ã€‚</p></blockquote><hr><h2 id=3-è·å–åº”ç”¨èµ„æºä¿¡æ¯><strong>3ï¸âƒ£ è·å–åº”ç”¨èµ„æºä¿¡æ¯</strong>
<a class=anchor href=#3-%e8%8e%b7%e5%8f%96%e5%ba%94%e7%94%a8%e8%b5%84%e6%ba%90%e4%bf%a1%e6%81%af>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAppByName</span>(<span style=color:#a6e22e>appName</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>k8s</span>: <span style=color:#66d9ef>K8sContext</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>k8sApp</span>, <span style=color:#a6e22e>k8sCore</span>, <span style=color:#a6e22e>k8sNetworkingApp</span>, <span style=color:#a6e22e>k8sAutoscaling</span>, <span style=color:#66d9ef>namespace</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>k8s</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>Promise</span>.<span style=color:#a6e22e>allSettled</span>([
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sApp</span>.<span style=color:#a6e22e>readNamespacedDeployment</span>(<span style=color:#a6e22e>appName</span>, <span style=color:#66d9ef>namespace</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sApp</span>.<span style=color:#a6e22e>readNamespacedStatefulSet</span>(<span style=color:#a6e22e>appName</span>, <span style=color:#66d9ef>namespace</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sCore</span>.<span style=color:#a6e22e>readNamespacedConfigMap</span>(<span style=color:#a6e22e>appName</span>, <span style=color:#66d9ef>namespace</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sCore</span>.<span style=color:#a6e22e>listNamespacedService</span>(<span style=color:#66d9ef>namespace</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>appDeployKey</span><span style=color:#e6db74>}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>appName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sNetworkingApp</span>.<span style=color:#a6e22e>listNamespacedIngress</span>(<span style=color:#66d9ef>namespace</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>appDeployKey</span><span style=color:#e6db74>}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>appName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sCore</span>.<span style=color:#a6e22e>readNamespacedSecret</span>(<span style=color:#a6e22e>appName</span>, <span style=color:#66d9ef>namespace</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sAutoscaling</span>.<span style=color:#a6e22e>readNamespacedHorizontalPodAutoscaler</span>(<span style=color:#a6e22e>appName</span>, <span style=color:#66d9ef>namespace</span>)
</span></span><span style=display:flex><span>  ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>å¹¶è¡Œè·å–ä¸€ä¸ªåº”ç”¨ç›¸å…³çš„å…¨éƒ¨èµ„æºï¼ˆDeploymentã€StatefulSetã€ConfigMapã€Serviceã€Ingressã€Secretã€HPAï¼‰ã€‚</li><li><code>Promise.allSettled</code> ç¡®ä¿å³ä¾¿æŸäº›èµ„æºä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>æœ€ç»ˆè¿”å›ä¸€ä¸ªç»“æœåˆ—è¡¨ï¼Œç”¨äºå‰ç«¯å±•ç¤ºæˆ–è¿›ä¸€æ­¥å¤„ç†ã€‚</li></ul><hr><h2 id=4-pause--start-åº”ç”¨><strong>4ï¸âƒ£ Pause / Start åº”ç”¨</strong>
<a class=anchor href=#4-pause--start-%e5%ba%94%e7%94%a8>#</a></h2><ul><li><strong>pauseApp</strong>ï¼š<ul><li>å°† <code>replicas=0</code> æš‚åœåº”ç”¨</li><li>ä¿å­˜ HPA é…ç½®åˆ° annotationï¼ˆ<code>pauseKey</code>ï¼‰</li><li>ä¿®æ”¹ Ingress çš„ <code>ingress.class</code> ä¸º <code>pause</code></li><li>åˆ é™¤ HPA</li></ul></li><li><strong>startApp</strong>ï¼š<ul><li>æ¢å¤å‰¯æœ¬æ•°</li><li>æ ¹æ® <code>pauseKey</code> annotation é‡æ–°åˆ›å»º HPA</li><li>ä¿®æ”¹ Ingress æ¢å¤ <code>ingress.class</code></li><li>åˆ é™¤ <code>pauseKey</code> annotation</li></ul></li></ul><p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šåº”ç”¨çš„æš‚åœ/å¯åŠ¨é€šè¿‡ä¿®æ”¹ Deployment/StatefulSet çš„ <code>replicas</code> å’Œ HPAï¼ŒåŒæ—¶è°ƒæ•´ Ingress é…ç½®æ¥å®ç°ã€‚</p><hr><h2 id=5-æ›´æ–°åº”ç”¨èµ„æº><strong>5ï¸âƒ£ æ›´æ–°åº”ç”¨èµ„æº</strong>
<a class=anchor href=#5-%e6%9b%b4%e6%96%b0%e5%ba%94%e7%94%a8%e8%b5%84%e6%ba%90>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateAppResources</span>(<span style=color:#a6e22e>appName</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>updateData</span>, <span style=color:#a6e22e>k8s</span>: <span style=color:#66d9ef>K8sContext</span>)
</span></span></code></pre></div><ul><li>æ›´æ–° CPUã€å†…å­˜ã€é•œåƒã€å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€replicas</li><li>å¦‚æœ <code>replicas=0</code> â†’ pause é€»è¾‘</li><li>å¦‚æœ <code>replicas>0</code> â†’ start é€»è¾‘ + æ¢å¤ HPA</li><li>é€šè¿‡ JSON Patch ç²¾ç¡®ä¿®æ”¹ Deployment/StatefulSet èµ„æº</li></ul><p><strong>æµç¨‹ï¼š</strong></p><ol><li>è·å–å½“å‰ Deployment/StatefulSet (<code>getDeployApp</code>)</li><li>è®¡ç®— JSONPatchï¼ˆCPU/Memory/Command/Args/Image/Envï¼‰</li><li>è°ƒç”¨ <code>patchNamespacedDeployment</code> / <code>patchNamespacedStatefulSet</code> åº”ç”¨ä¿®æ”¹</li><li>å¦‚æœæ¶‰åŠ replicasï¼Œåˆ™ç»“åˆ pause/start é€»è¾‘æ“ä½œ HPA</li></ol><hr><h2 id=6-åˆ é™¤åº”ç”¨><strong>6ï¸âƒ£ åˆ é™¤åº”ç”¨</strong>
<a class=anchor href=#6-%e5%88%a0%e9%99%a4%e5%ba%94%e7%94%a8>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteAppByName</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>k8s</span>: <span style=color:#66d9ef>K8sContext</span>)
</span></span></code></pre></div><ul><li>åˆ é™¤åº”ç”¨ç›¸å…³çš„æ‰€æœ‰èµ„æºï¼š<ul><li>Deployment / StatefulSet</li><li>Service / ConfigMap / Secret</li><li>Ingress</li><li>PersistentVolumeClaim</li><li>HorizontalPodAutoscaler</li><li>cert-manager çš„ Certificate / Issuer</li></ul></li><li>ä½¿ç”¨ <code>Promise.allSettled</code> å¹¶è¿‡æ»¤ 404 é”™è¯¯ï¼Œä¿è¯åˆ é™¤æµç¨‹å¥å£®ã€‚</li></ul><hr><h2 id=7-æ€»ç»“è¡¨å•åˆ°-yaml-è°ƒç”¨é“¾><strong>7ï¸âƒ£ æ€»ç»“è¡¨å•åˆ° YAML è°ƒç”¨é“¾</strong>
<a class=anchor href=#7-%e6%80%bb%e7%bb%93%e8%a1%a8%e5%8d%95%e5%88%b0-yaml-%e8%b0%83%e7%94%a8%e9%93%be>#</a></h2><ul><li>Pause/Start/Update æ“ä½œæ˜¯åŸºäº Deployment/StatefulSet å’Œ HPA çš„ annotation + JSON Patch æœºåˆ¶</li><li>åˆ é™¤åº”ç”¨æ˜¯æŠŠæ‰€æœ‰ç›¸å…³èµ„æºå…¨éƒ¨æ¸…ç†</li><li><code>getAppByName</code> ç”¨äºæŠŠé›†ç¾¤çŠ¶æ€åŒæ­¥å›å‰ç«¯ï¼Œç”¨äºå±•ç¤ºå’Œç¼–è¾‘</li></ul><hr><p>å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼ æ›´å®Œæ•´çš„ <strong>è¡¨å•å­—æ®µ â†’ YAML èµ„æºç±»å‹ â†’ API è°ƒç”¨ â†’ é›†ç¾¤å¯¹è±¡</strong> çš„å›¾ï¼ŒæŠŠæ¯ç§èµ„æºçš„ä¾èµ–å…³ç³»å’Œ pause/start HPA é€»è¾‘éƒ½å±•ç¤ºå‡ºæ¥ï¼Œçœ‹èµ·æ¥åƒä¸€ä¸ªå®Œæ•´çš„åº”ç”¨éƒ¨ç½²æ‹“æ‰‘ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»å—ï¼Ÿ</p><p>å¥½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ª <strong>è¡¨å• â†’ YAML â†’ é›†ç¾¤èµ„æº</strong> çš„æµç¨‹ç”»æˆä¸€å¼ å®Œæ•´çš„æ‹“æ‰‘å›¾ï¼ŒåŒ…æ‹¬ Pause/Start/HPA é€»è¾‘ã€‚</p><p>ä¸‹é¢æ˜¯ç”¨ <strong>Mermaid</strong> è¡¨ç¤ºçš„å›¾ï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    A[&#34;å‰ç«¯è¡¨å•&#34;] --&gt; B[&#34;è°ƒç”¨ formData2Yamls&#34;]
    B --&gt; C[&#34;ç”Ÿæˆ YAML åˆ—è¡¨&#34;]
    C --&gt; D[&#34;è°ƒç”¨ applyYamlList åˆ›å»ºæˆ–æ›¿æ¢èµ„æº&#34;]
    D --&gt; E[&#34;Kubernetes API Server&#34;]

    E --&gt; F[&#34;åˆ›å»º Deployment / StatefulSet&#34;]
    E --&gt; G[&#34;åˆ›å»º Service / ConfigMap / Secret&#34;]
    E --&gt; H[&#34;åˆ›å»º Ingress&#34;]
    E --&gt; I[&#34;åˆ›å»º HorizontalPodAutoscaler&#34;]

    subgraph Pause_Start[&#34;æš‚åœ/å¯åŠ¨æµç¨‹&#34;]
        J[&#34;æš‚åœåº”ç”¨: replicas=0, ä¿å­˜ HPA é…ç½®&#34;] --&gt; K[&#34;åˆ é™¤ HPA&#34;]
        L[&#34;å¯åŠ¨åº”ç”¨: æ¢å¤ replicas, é‡æ–°åˆ›å»º HPA&#34;] 
    end

    F --&gt; Pause_Start
    I --&gt; Pause_Start

    subgraph Delete_App[&#34;åˆ é™¤åº”ç”¨æµç¨‹&#34;]
        M[&#34;åˆ é™¤ Deployment / StatefulSet&#34;] 
        N[&#34;åˆ é™¤ Service / ConfigMap / Secret / PVC&#34;] 
        O[&#34;åˆ é™¤ Ingress&#34;] 
        P[&#34;åˆ é™¤ HPA&#34;] 
    end

    F --&gt; Delete_App
    G --&gt; Delete_App
    H --&gt; Delete_App
    I --&gt; Delete_App
</code></pre><h3 id=-è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†>âœ… è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†
<a class=anchor href=#-%e8%a7%a3%e9%87%8a%e5%9b%be%e4%b8%ad%e5%90%84%e9%83%a8%e5%88%86>#</a></h3><ol><li><strong>è¡¨å• â†’ YAML â†’ é›†ç¾¤</strong><ul><li>å‰ç«¯è¡¨å• <code>AppEditType</code> â†’ <code>formData2Yamls</code> â†’ YAML åˆ—è¡¨ â†’ <code>applyYamlList</code> â†’ Kubernetes API â†’ é›†ç¾¤å¯¹è±¡ã€‚</li></ul></li><li><strong>Pause/Start</strong><ul><li>Pauseï¼šreplicas ç½® 0 + HPA ä¿å­˜åˆ° annotation + åˆ é™¤ HPA + Ingress ä¿®æ”¹ä¸º <code>pause</code></li><li>Startï¼šreplicas æ¢å¤ + æ ¹æ® pauseKey annotation é‡å»º HPA + Ingress æ¢å¤</li></ul></li><li><strong>èµ„æºæ›´æ–°</strong><ul><li>é€šè¿‡ JSON Patch ç²¾ç¡®æ›´æ–° Deployment/StatefulSet ä¸­å®¹å™¨çš„ CPU/Memory/Image/Command/Args/Env</li><li>å¦‚æœæ¶‰åŠ replicasï¼Œåˆ™èµ° Pause/Start é€»è¾‘</li></ul></li><li><strong>åˆ é™¤åº”ç”¨</strong><ul><li>åˆ é™¤å…¨éƒ¨ç›¸å…³èµ„æºï¼ŒåŒ…æ‹¬ Deployment/StatefulSetã€Serviceã€Ingressã€ConfigMapã€Secretã€PVCã€HPAã€Certificateã€Issuer</li></ul></li><li><strong>è·å–åº”ç”¨çŠ¶æ€</strong><ul><li><code>getAppByName</code> è·å–é›†ç¾¤èµ„æº â†’ <code>adaptAppDetail</code> + <code>transformFromLegacySchema</code> â†’ å‰ç«¯æ ‡å‡†åŒ–å¯¹è±¡ç”¨äºå±•ç¤º/ç¼–è¾‘</li></ul></li></ol><hr><p>å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€ä¸ª <strong>æ›´ç»†ç²’åº¦çš„å›¾</strong>ï¼Œæ ‡å‡ºæ¯ç§è¡¨å•å­—æ®µå¯¹åº”ç”Ÿæˆçš„ Kubernetes YAML èµ„æºå’Œå­—æ®µè·¯å¾„ï¼Œè¿™æ ·èƒ½ç›´è§‚çœ‹åˆ°è¡¨å•å­—æ®µåˆ° Deployment/Service/HPA çš„æ˜ å°„å…³ç³»ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªæ›´ç»†ç²’åº¦çš„å›¾å—ï¼Ÿ</p><p>æ˜ç™½äº†ï¼Œä½ å¸Œæœ›æŠŠ <strong>å‰ç«¯è¡¨å•å­—æ®µ â†’ YAML â†’ Kubernetes èµ„æº â†’ å­—æ®µè·¯å¾„</strong> ç”»æˆä¸€ä¸ªæ¸…æ™°çš„ Mermaid æµç¨‹å›¾ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹æ€è·¯ç»†åŒ–ï¼š</p><ul><li>æ¯ä¸ªè¡¨å•å­—æ®µå¯¹åº”çš„ YAML ç‰‡æ®µ</li><li>æ¯ä¸ª YAML å¯¹åº”çš„ Kubernetes èµ„æºç±»å‹</li><li>å…³é”®å­—æ®µè·¯å¾„ï¼ˆå¦‚ <code>spec.template.spec.containers[0].resources</code>ï¼‰</li></ul><p>æˆ‘ç»™ä½ ç”»ä¸€ä¸ªç¤ºæ„ Mermaid å›¾ï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    subgraph Form[&#34;å‰ç«¯è¡¨å•&#34;]
        CPU[&#34;CPU&#34;]
        Memory[&#34;Memory&#34;]
        Replicas[&#34;å‰¯æœ¬æ•°&#34;]
        Image[&#34;é•œåƒ&#34;]
        Command[&#34;å¯åŠ¨å‘½ä»¤&#34;]
        Args[&#34;å‘½ä»¤å‚æ•°&#34;]
        Env[&#34;ç¯å¢ƒå˜é‡&#34;]
        Network[&#34;ç½‘ç»œé…ç½®&#34;]
    end

    subgraph formData2Yamls[&#34;formData2Yamls(appForm)&#34;]
        CPU_YAML[&#34;resources.requests/limits.cpu&#34;]
        Memory_YAML[&#34;resources.requests/limits.memory&#34;]
        Replicas_YAML[&#34;spec.replicas&#34;]
        Image_YAML[&#34;spec.template.spec.containers[0].image&#34;]
        Command_YAML[&#34;spec.template.spec.containers[0].command&#34;]
        Args_YAML[&#34;spec.template.spec.containers[0].args&#34;]
        Env_YAML[&#34;spec.template.spec.containers[0].env&#34;]
        Network_YAML[&#34;Service/Ingress domain annotations&#34;]
    end

    subgraph ApplyYAML[&#34;applyYamlList -&gt; Kubernetes API&#34;]
        Deployment[&#34;Deployment / StatefulSet&#34;]
        Service[&#34;Service / ConfigMap / Secret&#34;]
        Ingress[&#34;Ingress&#34;]
        HPA[&#34;HorizontalPodAutoscaler&#34;]
    end

    %% è¡¨å•å­—æ®µåˆ° YAML æ˜ å°„
    CPU --&gt; CPU_YAML
    Memory --&gt; Memory_YAML
    Replicas --&gt; Replicas_YAML
    Image --&gt; Image_YAML
    Command --&gt; Command_YAML
    Args --&gt; Args_YAML
    Env --&gt; Env_YAML
    Network --&gt; Network_YAML

    %% YAML åˆ° Kubernetes èµ„æºæ˜ å°„
    CPU_YAML --&gt; Deployment
    Memory_YAML --&gt; Deployment
    Replicas_YAML --&gt; Deployment
    Image_YAML --&gt; Deployment
    Command_YAML --&gt; Deployment
    Args_YAML --&gt; Deployment
    Env_YAML --&gt; Deployment
    Replicas_YAML --&gt; HPA
    CPU_YAML --&gt; HPA
    Memory_YAML --&gt; HPA
    Network_YAML --&gt; Service
    Network_YAML --&gt; Ingress
</code></pre><p>ğŸ’¡ è¯´æ˜ï¼š</p><ol><li><strong>è¡¨å•å­—æ®µ</strong>ï¼šå‰ç«¯ AppEditType çš„å­—æ®µ</li><li><strong>YAML ç‰‡æ®µ</strong>ï¼š<code>formData2Yamls</code> ç”Ÿæˆçš„ YAML å¯¹åº”å­—æ®µè·¯å¾„</li><li><strong>Kubernetes èµ„æº</strong>ï¼šæœ€ç»ˆåˆ›å»ºçš„ Deploymentã€Serviceã€Ingressã€HPA</li></ol><p>è¿™ä¸ªå›¾èƒ½ç›´è§‚çœ‹åˆ° <strong>å­—æ®µ â†’ YAML â†’ K8s èµ„æº â†’ å­—æ®µè·¯å¾„</strong> çš„å¯¹åº”å…³ç³»ã€‚</p><hr><p>æˆ‘å¯ä»¥å¸®ä½ ç”» <strong>æ›´è¯¦ç»†ç‰ˆæœ¬</strong>ï¼ŒæŠŠæ¯ä¸ªå­—æ®µå¯¹åº”çš„ <strong>å®Œæ•´ YAML è·¯å¾„</strong> éƒ½åˆ—å‡ºæ¥ï¼ŒåŒ…æ‹¬ HPA çš„ min/max replicasã€target CPUã€Service çš„ selector ç­‰ï¼Œè¿™æ ·å°±åƒä¸€å¼ å®Œæ•´æ˜ å°„è¡¨ä¸€æ ·ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªå®Œæ•´è¯¦ç»†ç‰ˆæœ¬å—ï¼Ÿ</p><p>å¥½çš„ï¼Œæˆ‘å¸®ä½ ç”»ä¸€ä¸ª<strong>å®Œæ•´ã€ç»†ç²’åº¦ç‰ˆæœ¬</strong>ï¼ŒæŠŠè¡¨å•å­—æ®µå¯¹åº”åˆ°å…·ä½“ Kubernetes YAML è·¯å¾„å’Œèµ„æºç±»å‹ï¼Œæ¶µç›– Deploymentã€StatefulSetã€Serviceã€Ingressã€HPAã€‚ä¸‹é¢æ˜¯ Mermaid æµç¨‹å›¾ç¤ºä¾‹ï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    %% å‰ç«¯è¡¨å•å­—æ®µ
    subgraph Form[&#34;å‰ç«¯è¡¨å•&#34;]
        CPU[&#34;CPU (resource.cpu)&#34;]
        Memory[&#34;å†…å­˜ (resource.memory)&#34;]
        Replicas[&#34;å‰¯æœ¬æ•° (resource.replicas)&#34;]
        Image[&#34;é•œåƒ (image)&#34;]
        Command[&#34;å¯åŠ¨å‘½ä»¤ (command)&#34;]
        Args[&#34;å‘½ä»¤å‚æ•° (args)&#34;]
        Env[&#34;ç¯å¢ƒå˜é‡ (env)&#34;]
        NetworkDomain[&#34;ç½‘ç»œåŸŸå (networks.domain)&#34;]
        NetworkPort[&#34;ç½‘ç»œç«¯å£ (networks.port)&#34;]
    end

    %% formData2Yamls ç”Ÿæˆ YAML æ˜ å°„
    subgraph YAML[&#34;formData2Yamls(appForm)ç”Ÿæˆ YAML&#34;]
        CPU_YAML[&#34;Deployment.spec.template.spec.containers[0].resources.requests/limits.cpu&#34;]
        Memory_YAML[&#34;Deployment.spec.template.spec.containers[0].resources.requests/limits.memory&#34;]
        Replicas_YAML[&#34;Deployment.spec.replicas&#34;]
        Image_YAML[&#34;Deployment.spec.template.spec.containers[0].image&#34;]
        Command_YAML[&#34;Deployment.spec.template.spec.containers[0].command&#34;]
        Args_YAML[&#34;Deployment.spec.template.spec.containers[0].args&#34;]
        Env_YAML[&#34;Deployment.spec.template.spec.containers[0].env&#34;]
        ServiceSelector[&#34;Service.spec.selector.app&#34;]
        ServicePort[&#34;Service.spec.ports&#34;]
        IngressHost[&#34;Ingress.spec.rules.host&#34;]
        IngressClass[&#34;Ingress.spec.ingressClassName / annotations&#34;]
        HPA_MinReplicas[&#34;HPA.spec.minReplicas&#34;]
        HPA_MaxReplicas[&#34;HPA.spec.maxReplicas&#34;]
        HPA_TargetCPU[&#34;HPA.spec.metrics[0].resource.target.averageUtilization&#34;]
    end

    %% YAML åˆ° Kubernetes èµ„æºæ˜ å°„
    subgraph K8s[&#34;Kubernetes èµ„æº&#34;]
        Deployment[&#34;Deployment / StatefulSet&#34;]
        Service[&#34;Service / ConfigMap / Secret&#34;]
        Ingress[&#34;Ingress&#34;]
        HPA[&#34;HorizontalPodAutoscaler&#34;]
    end

    %% è¡¨å•å­—æ®µåˆ° YAML æ˜ å°„
    CPU --&gt; CPU_YAML
    Memory --&gt; Memory_YAML
    Replicas --&gt; Replicas_YAML
    Image --&gt; Image_YAML
    Command --&gt; Command_YAML
    Args --&gt; Args_YAML
    Env --&gt; Env_YAML
    NetworkDomain --&gt; IngressHost
    NetworkDomain --&gt; ServiceSelector
    NetworkPort --&gt; ServicePort

    %% YAML åˆ°èµ„æºæ˜ å°„
    CPU_YAML --&gt; Deployment
    Memory_YAML --&gt; Deployment
    Replicas_YAML --&gt; Deployment
    Image_YAML --&gt; Deployment
    Command_YAML --&gt; Deployment
    Args_YAML --&gt; Deployment
    Env_YAML --&gt; Deployment
    ServiceSelector --&gt; Service
    ServicePort --&gt; Service
    IngressHost --&gt; Ingress
    IngressClass --&gt; Ingress

    %% HPA æ˜ å°„
    Replicas --&gt; HPA_MinReplicas
    Replicas --&gt; HPA_MaxReplicas
    CPU --&gt; HPA_TargetCPU
    Memory --&gt; HPA_TargetCPU
    HPA_MinReplicas --&gt; HPA
    HPA_MaxReplicas --&gt; HPA
    HPA_TargetCPU --&gt; HPA
</code></pre><h3 id=-ç‰¹ç‚¹>ğŸ”¹ ç‰¹ç‚¹
<a class=anchor href=#-%e7%89%b9%e7%82%b9>#</a></h3><ol><li><strong>è¡¨å•å­—æ®µ</strong>ï¼šå·¦ä¾§æ˜¾ç¤ºå‰ç«¯ AppEditType å­—æ®µ</li><li><strong>ç”Ÿæˆçš„ YAML</strong>ï¼šä¸­é—´æ˜¾ç¤º formData2Yamls ç”Ÿæˆçš„å¯¹åº”å­—æ®µè·¯å¾„</li><li><strong>Kubernetes èµ„æº</strong>ï¼šå³ä¾§æ˜¾ç¤º Deployment / StatefulSet / Service / Ingress / HPA</li><li><strong>HPA å…³è”</strong>ï¼šreplicasã€CPUã€memory ä¼šæ˜ å°„åˆ° HPA çš„ min/max replicas å’Œ target utilization</li></ol><hr><p>å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†ç”»ä¸€ä¸ª <strong>åŠ ä¸Šæ¯ä¸ª YAML å­—æ®µç”Ÿæˆé€»è¾‘çš„â€œæ³¨é‡Šç‰ˆâ€å›¾</strong>ï¼Œæ¯”å¦‚ï¼š<code>CPU â†’ requests: cpu = floor(cpu*0.1)m, limits: cpu = cpu m</code>ï¼Œè¿™æ ·å°±èƒ½å®Œæ•´çœ‹åˆ° <strong>è¡¨å• â†’ æ•°å€¼å¤„ç† â†’ YAML â†’ K8s</strong> çš„æ•´ä¸ªé“¾è·¯ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªæ³¨é‡Šç‰ˆå—ï¼Ÿ</p><p>å¤ªå¥½äº†ï¼Œä½ æŠŠå®Œæ•´ä»£ç è´´å‡ºæ¥äº† ğŸ™Œã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ä½ ä¹‹å‰é—®çš„â€œå‰ç«¯è¡¨å•æ€ä¹ˆå˜æˆåç«¯ deployment çš„ YAMLâ€çš„å…³é”®é€»è¾‘ã€‚
æˆ‘ç»™ä½ åˆ†å—è§£é‡Šä¸€ä¸‹ï¼Œè®©ä½ èƒ½ä¸€çœ¼çœ‹æ¸…æ¥š <strong>ä»å‰ç«¯ JSON â†’ Kubernetes YAML æ¸…å•</strong> çš„å…¨è¿‡ç¨‹ã€‚</p><hr><h2 id=-æ•´ä½“æ€è·¯>ğŸ”‘ æ•´ä½“æ€è·¯
<a class=anchor href=#-%e6%95%b4%e4%bd%93%e6%80%9d%e8%b7%af>#</a></h2><ol><li><strong>å‰ç«¯è¡¨å•æ•°æ®</strong>ï¼ˆ<code>AppEditType</code>ï¼‰é€šè¿‡ API æäº¤åˆ°åç«¯ã€‚</li><li>åç«¯ç”¨è¿™äº›æ•°æ®ç”Ÿæˆå¯¹åº”çš„ <strong>K8s YAML/Manifest</strong>ï¼šDeploymentã€Serviceã€Ingressã€ConfigMapã€Secretã€HPA ç­‰ã€‚</li><li>YAML æœ€ç»ˆè¢«æäº¤ç»™ Kubernetes API Serverï¼Œéƒ¨ç½²åº”ç”¨ã€‚</li></ol><hr><h2 id=-æ ¸å¿ƒå‡½æ•°è§£æ>ğŸ“Œ æ ¸å¿ƒå‡½æ•°è§£æ
<a class=anchor href=#-%e6%a0%b8%e5%bf%83%e5%87%bd%e6%95%b0%e8%a7%a3%e6%9e%90>#</a></h2><h3 id=1-json2deploycr>1. <code>json2DeployCr</code>
<a class=anchor href=#1-json2deploycr>#</a></h3><p>ä½œç”¨ï¼šæŠŠè¡¨å•æ•°æ®è½¬æˆ <strong>Deployment</strong> æˆ– <strong>StatefulSet</strong> çš„ YAMLã€‚</p><p>æµç¨‹ï¼š</p><ul><li><strong>metadata</strong>ï¼šç”¨åº”ç”¨åã€æ ‡ç­¾ã€æ³¨è§£æè¿°å¯¹è±¡ã€‚</li><li><strong>spec.replicas</strong>ï¼šå‰¯æœ¬æ•°ï¼ˆä»è¡¨å•é‡Œçš„ <code>hpa.minReplicas</code> æˆ– <code>replicas</code> æ‹¿ï¼‰ã€‚</li><li><strong>containers</strong>ï¼šå®¹å™¨é…ç½®ï¼ŒåŒ…æ‹¬é•œåƒã€å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€CPU/å†…å­˜/GPU èµ„æºã€ç«¯å£ã€‚</li><li><strong>volumes/volumeMounts</strong>ï¼šé…ç½®å­˜å‚¨å·ï¼ˆPVC/ConfigMapï¼‰ã€‚</li><li><strong>gpuMap</strong>ï¼šå¦‚æœæœ‰ GPUï¼Œç»™ Pod æŒ‡å®š <code>nodeSelector</code> å’Œ <code>runtimeClassName</code>ã€‚</li><li><strong>StatefulSet ç‰¹æ®Šé€»è¾‘</strong>ï¼šç”Ÿæˆ <code>volumeClaimTemplates</code>ï¼ŒæŒ‚è½½æ•°æ®å·ã€‚</li></ul><p>è¾“å‡ºï¼šä¸€ä¸ª <strong>Deployment æˆ– StatefulSet çš„ YAML å­—ç¬¦ä¸²</strong>ã€‚</p><hr><h3 id=2-json2service>2. <code>json2Service</code>
<a class=anchor href=#2-json2service>#</a></h3><p>ä½œç”¨ï¼šæ ¹æ®è¡¨å•é‡Œç½‘ç»œé…ç½®ï¼Œç”Ÿæˆ <strong>Service YAML</strong>ã€‚</p><p>æµç¨‹ï¼š</p><ul><li>éå† <code>data.networks</code>ï¼šåŒºåˆ† NodePort å’Œ ClusterIPã€‚</li><li>ç»™æ¯ä¸ªç«¯å£ç”Ÿæˆå¯¹åº”çš„ <code>Service</code> é…ç½®ã€‚</li><li>å¦‚æœæœ‰ NodePortï¼Œå°±ç”Ÿæˆä¸€ä¸ª <code>type: NodePort</code> çš„ Serviceï¼›å¦åˆ™ç”Ÿæˆé»˜è®¤çš„ ClusterIPã€‚</li></ul><p>è¾“å‡ºï¼šä¸€ä¸ªæˆ–å¤šä¸ª <strong>Service YAML</strong>ï¼ˆç”¨ <code>---</code> åˆ†éš”ï¼‰ã€‚</p><hr><h3 id=3-json2ingress>3. <code>json2Ingress</code>
<a class=anchor href=#3-json2ingress>#</a></h3><p>ä½œç”¨ï¼šç”Ÿæˆ <strong>Ingress YAML</strong>ï¼Œå¤„ç†åŸŸåå’Œ TLSã€‚</p><p>æµç¨‹ï¼š</p><ul><li>éå† <code>data.networks</code>ï¼Œæ‰¾å‡ºéœ€è¦å¯¹å¤–æš´éœ²çš„æœåŠ¡ï¼ˆ<code>openPublicDomain</code> = trueï¼‰ã€‚</li><li>ç”Ÿæˆ Ingress é…ç½®ï¼ˆ<code>rules</code>ã€<code>tls</code>ã€nginx annotationsï¼‰ã€‚</li><li>å¦‚æœæ˜¯è‡ªå®šä¹‰åŸŸåï¼Œè¿˜ä¼šé¢å¤–ç”Ÿæˆ <strong>Issuer</strong> å’Œ <strong>Certificate</strong>ï¼ˆç”± cert-manager ç®¡ç†ï¼‰ã€‚</li></ul><p>è¾“å‡ºï¼šIngress + TLS è¯ä¹¦çš„ YAMLã€‚</p><hr><h3 id=4-json2configmap>4. <code>json2ConfigMap</code>
<a class=anchor href=#4-json2configmap>#</a></h3><p>ä½œç”¨ï¼šç”Ÿæˆ <strong>ConfigMap YAML</strong>ï¼ŒæŠŠç”¨æˆ·è¾“å…¥çš„é…ç½®æ–‡ä»¶/ç¯å¢ƒå†™è¿›å»ã€‚</p><hr><h3 id=5-json2secret>5. <code>json2Secret</code>
<a class=anchor href=#5-json2secret>#</a></h3><p>ä½œç”¨ï¼šç”Ÿæˆ <strong>Secret YAML</strong>ï¼Œä¸»è¦ç”¨äºå­˜å‚¨é•œåƒä»“åº“è®¤è¯ä¿¡æ¯ï¼ˆ<code>dockerconfigjson</code>ï¼‰ã€‚</p><hr><h3 id=6-json2hpa>6. <code>json2HPA</code>
<a class=anchor href=#6-json2hpa>#</a></h3><p>ä½œç”¨ï¼šç”Ÿæˆ <strong>HPA (HorizontalPodAutoscaler) YAML</strong>ã€‚</p><ul><li>æ ¹æ®è¡¨å•é‡Œçš„ <code>hpa.target</code>ï¼ˆcpu/memory/gpuï¼‰ç”Ÿæˆå¯¹åº”çš„æŒ‡æ ‡é…ç½®ã€‚</li><li>é…ç½® <code>minReplicas</code>ã€<code>maxReplicas</code>ã€ä¼¸ç¼©ç­–ç•¥ã€‚</li></ul><hr><h3 id=7-yamlstring2objects>7. <code>yamlString2Objects</code>
<a class=anchor href=#7-yamlstring2objects>#</a></h3><p>è¾…åŠ©æ–¹æ³•ï¼šæŠŠ YAML å­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªå¯¹è±¡ï¼Œä¾¿äºåç»­å¤„ç†ã€‚</p><hr><h2 id=-æ•´ä½“æµç¨‹å›¾>ğŸ“Š æ•´ä½“æµç¨‹å›¾
<a class=anchor href=#-%e6%95%b4%e4%bd%93%e6%b5%81%e7%a8%8b%e5%9b%be>#</a></h2><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
A[å‰ç«¯è¡¨å• AppEditType JSON] --&gt; B[åç«¯å‡½æ•° json2DeployCr/json2Service/json2Ingress...]
B --&gt; C[ç”Ÿæˆ YAML å­—ç¬¦ä¸²]
C --&gt; D[æäº¤åˆ° K8s API Server]
D --&gt; E[etcd å­˜å‚¨å¯¹è±¡]
E --&gt; F[Scheduler è°ƒåº¦ Pod]
F --&gt; G[Kubelet æ‹‰å–é•œåƒå¹¶è¿è¡Œå®¹å™¨]
</code></pre><hr><h2 id=-æ€»ç»“ä¸€å¥è¯>âœ… æ€»ç»“ä¸€å¥è¯
<a class=anchor href=#-%e6%80%bb%e7%bb%93%e4%b8%80%e5%8f%a5%e8%af%9d>#</a></h2><p>è¿™ä»½ä»£ç å°±æ˜¯ä¸€ä¸ª <strong>â€œè¡¨å•æ•°æ® â†’ Kubernetes YAML å·¥å‚â€</strong>ï¼š</p><ul><li>æŠŠå‰ç«¯ç”¨æˆ·å¡«å†™çš„å‚æ•°ï¼ˆé•œåƒã€å‰¯æœ¬æ•°ã€ç«¯å£ã€å­˜å‚¨ã€åŸŸåã€ç¯å¢ƒå˜é‡ã€HPA â€¦ï¼‰</li><li>è½¬æ¢æˆæ ‡å‡†çš„ <strong>Deployment / StatefulSet / Service / Ingress / ConfigMap / Secret / HPA YAML</strong></li><li>ç„¶åå†ç”±åç«¯å»è°ƒç”¨ Kubernetes API éƒ¨ç½²åˆ°é›†ç¾¤ã€‚</li></ul><hr><p>è¦ä¸è¦æˆ‘å¸®ä½ ç”»ä¸€ä¸ª <strong>è¡¨å•å­—æ®µ â†’ YAML å­—æ®µæ˜ å°„è¡¨</strong>ï¼Œè®©ä½ å¿«é€ŸæŸ¥åˆ°ã€Œå‰ç«¯å¡«çš„æŸä¸ªå‚æ•°æœ€åå‡ºç°åœ¨ YAML çš„å“ªä¸€è¡Œã€ï¼Ÿ</p><p>éå¸¸å¥½çš„é—®é¢˜ ğŸ‘
ä½ å‰é¢è´´çš„ä»£ç ï¼ˆå‰ç«¯è¡¨å•è½¬ YAMLï¼‰æ˜¯ <strong>ç”Ÿæˆ YAML æ¸…å•</strong>ï¼Œè€Œè¿™ä¸€æ®µä»£ç å°±æ˜¯ <strong>æŠŠ YAML çœŸæ­£éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤</strong> çš„é€»è¾‘ã€‚
æˆ‘æ¥å¸®ä½ é€æ­¥æ‹†è§£ï¼š</p><hr><h2 id=1-kubernetes-å®¢æˆ·ç«¯åˆå§‹åŒ–>1. <strong>Kubernetes å®¢æˆ·ç«¯åˆå§‹åŒ–</strong>
<a class=anchor href=#1-kubernetes-%e5%ae%a2%e6%88%b7%e7%ab%af%e5%88%9d%e5%a7%8b%e5%8c%96>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>k8s</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@kubernetes/client-node&#39;</span>;
</span></span></code></pre></div><p>è¿™é‡Œç”¨çš„æ˜¯ <a href=https://github.com/kubernetes-client/javascript>å®˜æ–¹ Node.js Kubernetes Client</a>ï¼Œç”¨æ¥è¿æ¥å¹¶æ“ä½œ K8s é›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>K8sApiDefault</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>KubeConfig</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>kc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>KubeConfig</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kc</span>.<span style=color:#a6e22e>loadFromDefault</span>(); <span style=color:#75715e>// é»˜è®¤è¯»å– ~/.kube/config
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>kc</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœæ˜¯æœ¬åœ°è°ƒè¯•ï¼Œå°±ç›´æ¥åŠ è½½ <code>~/.kube/config</code> é‡Œçš„ kubeconfig æ–‡ä»¶ã€‚</p><hr><h2 id=2-åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ>2. <strong>åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ</strong>
<a class=anchor href=#2-%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e5%9c%a8%e9%9b%86%e7%be%a4%e5%86%85%e9%83%a8%e8%bf%90%e8%a1%8c>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>CheckIsInCluster</span>()<span style=color:#f92672>:</span> [<span style=color:#66d9ef>boolean</span>, <span style=color:#66d9ef>string</span>] {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>KUBERNETES_SERVICE_HOST</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>KUBERNETES_SERVICE_PORT</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [<span style=color:#66d9ef>true</span>, <span style=color:#e6db74>`https://</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>KUBERNETES_SERVICE_HOST</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>KUBERNETES_SERVICE_PORT</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [<span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#39;&#39;</span>];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœä»£ç è¿è¡Œåœ¨ <strong>K8s Pod å†…éƒ¨</strong>ï¼ŒKubernetes ä¼šæ³¨å…¥ <code>KUBERNETES_SERVICE_HOST</code> å’Œ <code>KUBERNETES_SERVICE_PORT</code> ç¯å¢ƒå˜é‡ã€‚
è¿™æ ·å¯ä»¥ç›´æ¥è¿ <strong>é›†ç¾¤å†…çš„ API Server</strong>ï¼Œè€Œä¸ç”¨ kubeconfig æ–‡ä»¶ã€‚</p><hr><h2 id=3-åŠ è½½-kubeconfig>3. <strong>åŠ è½½ kubeconfig</strong>
<a class=anchor href=#3-%e5%8a%a0%e8%bd%bd-kubeconfig>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>K8sApi</span>(<span style=color:#a6e22e>config</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>KubeConfig</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>kc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>KubeConfig</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kc</span>.<span style=color:#a6e22e>loadFromString</span>(<span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>kc</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™é‡Œä¼šä¼˜å…ˆç”¨ä¼ å…¥çš„ <strong>kubeconfig å­—ç¬¦ä¸²</strong>ï¼Œå¹¶ä¸”å¦‚æœä»£ç è¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨ï¼Œä¼šæŠŠ server åœ°å€æ”¹ä¸ºé›†ç¾¤å†…çš„ API åœ°å€ã€‚</p><hr><h2 id=4-åˆ›å»º-yaml-åˆ°-k8s>4. <strong>åˆ›å»º YAML åˆ° K8s</strong>
<a class=anchor href=#4-%e5%88%9b%e5%bb%ba-yaml-%e5%88%b0-k8s>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>CreateYaml</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kc</span>: <span style=color:#66d9ef>k8s.KubeConfig</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>specs</span>: <span style=color:#66d9ef>k8s.KubernetesObject</span>[]
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ul><li><code>specs</code> å°±æ˜¯å‰ç«¯è½¬å‡ºæ¥çš„ YAML è§£ææˆçš„ JSON å¯¹è±¡ï¼ˆDeployment, Service, Ingress ç­‰ç­‰ï¼‰ã€‚</li><li>å®ƒç”¨ <code>KubernetesObjectApi</code> æ¥ <code>client.create(spec)</code>ã€‚</li><li>åˆ›å»ºæˆåŠŸçš„å¯¹è±¡ä¼š push åˆ° <code>created</code> æ•°ç»„é‡Œã€‚</li><li>å¦‚æœä¸­é€”å¤±è´¥ï¼Œä¼šå›æ»šï¼šæŠŠä¹‹å‰æˆåŠŸåˆ›å»ºçš„å¯¹è±¡éƒ½åˆ é™¤æ‰ã€‚</li></ul><p>ğŸ‘‰ è¿™å°±æ˜¯ <strong>æŠŠ YAML apply åˆ°é›†ç¾¤</strong>ã€‚</p><hr><h2 id=5-æ›´æ–°æ›¿æ¢-yaml-åˆ°-k8s>5. <strong>æ›´æ–°/æ›¿æ¢ YAML åˆ° K8s</strong>
<a class=anchor href=#5-%e6%9b%b4%e6%96%b0%e6%9b%bf%e6%8d%a2-yaml-%e5%88%b0-k8s>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>replaceYaml</span>(<span style=color:#a6e22e>kc</span>, <span style=color:#a6e22e>specs</span>)
</span></span></code></pre></div><p>é€»è¾‘ï¼š</p><ol><li>å…ˆç”¨ <code>client.read(spec)</code> çœ‹èµ„æºæ˜¯å¦å­˜åœ¨ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œå°± <code>client.replace(spec)</code> æ›´æ–°ï¼ˆéœ€è¦å¸¦ä¸Š <code>resourceVersion</code> æ‰èƒ½æ›¿æ¢ï¼‰ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œå°± <code>client.create(spec)</code> æ–°å»ºã€‚</li></ol><p>ğŸ‘‰ è¿™å°±æ˜¯ <strong>kubectl apply çš„æ•ˆæœ</strong>ã€‚</p><hr><h2 id=6-è·å–ç”¨æˆ·é…é¢>6. <strong>è·å–ç”¨æˆ·é…é¢</strong>
<a class=anchor href=#6-%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e9%85%8d%e9%a2%9d>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUserQuota</span>(<span style=color:#a6e22e>kc</span>, <span style=color:#66d9ef>namespace</span>)
</span></span></code></pre></div><p>è°ƒç”¨ <code>CoreV1Api.readNamespacedResourceQuota</code>ï¼ŒæŸ¥è¯¢å‘½åç©ºé—´çš„ <strong>ResourceQuota</strong>ï¼Œè¿”å›ç”¨æˆ·çš„ CPUã€å†…å­˜ã€å­˜å‚¨ã€NodePortã€GPU ä½¿ç”¨æƒ…å†µã€‚
ç›¸å½“äº <code>kubectl describe quota</code>ã€‚</p><hr><h2 id=7-è·å–ç”¨æˆ·ä½™é¢>7. <strong>è·å–ç”¨æˆ·ä½™é¢</strong>
<a class=anchor href=#7-%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e4%bd%99%e9%a2%9d>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUserBalance</span>(<span style=color:#a6e22e>kc</span>)
</span></span></code></pre></div><p>è¿™é‡Œè°ƒç”¨çš„æ˜¯ <strong>Sealos è‡ªå®šä¹‰ CRD</strong> <code>account.sealos.io/v1/accounts</code>ï¼Œä»é‡Œé¢å–ä½™é¢ã€‚
è¯´æ˜è¿™ä¸ªå¹³å°åœ¨ Kubernetes ä¸Šåšäº† <strong>å¤šç§Ÿæˆ·å’Œè®¡è´¹</strong>ã€‚</p><hr><h2 id=8-å°è£…ç»Ÿä¸€çš„-k8s-æ“ä½œå…¥å£>8. <strong>å°è£…ç»Ÿä¸€çš„ K8s æ“ä½œå…¥å£</strong>
<a class=anchor href=#8-%e5%b0%81%e8%a3%85%e7%bb%9f%e4%b8%80%e7%9a%84-k8s-%e6%93%8d%e4%bd%9c%e5%85%a5%e5%8f%a3>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getK8s</span>({ <span style=color:#a6e22e>kubeconfig</span> }<span style=color:#f92672>:</span> { <span style=color:#a6e22e>kubeconfig</span>: <span style=color:#66d9ef>string</span> })
</span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«ï¼š</p><ul><li><code>applyYamlList</code> â†’ è´Ÿè´£éƒ¨ç½² YAMLï¼ˆcreate æˆ– replaceï¼‰</li><li><code>getDeployApp</code> â†’ è·å–æŸä¸ª app çš„ Deployment/StatefulSet</li><li><code>getUserQuota</code> â†’ æŸ¥è¯¢ç”¨æˆ·é…é¢</li><li><code>getUserBalance</code> â†’ æŸ¥è¯¢ç”¨æˆ·ä½™é¢</li><li>è¿˜æœ‰ä¸€äº› client (<code>k8sCore</code>, <code>k8sApp</code>, <code>k8sAutoscaling</code>, <code>k8sNetworkingApp</code> ç­‰) ç”¨äºä¸åŒçš„èµ„æºæ“ä½œã€‚</li></ul><hr><h2 id=-å‰åç«¯æµç¨‹ä¸²èµ·æ¥>ğŸ”— å‰åç«¯æµç¨‹ä¸²èµ·æ¥
<a class=anchor href=#-%e5%89%8d%e5%90%8e%e7%ab%af%e6%b5%81%e7%a8%8b%e4%b8%b2%e8%b5%b7%e6%9d%a5>#</a></h2><ol><li><strong>å‰ç«¯è¡¨å•</strong>ï¼ˆç”¨æˆ·å¡« app åç§°ã€é•œåƒã€ç«¯å£ã€å­˜å‚¨ç­‰ï¼‰ã€‚</li><li><strong>å‰ç«¯è½¬ YAML</strong>ï¼ˆç”¨ä½ ä¹‹å‰è´´çš„ <code>json2DeployCr</code>ã€<code>json2Service</code> ç­‰å‡½æ•° â†’ ç”Ÿæˆ Deployment/Service/Ingress YAML å­—ç¬¦ä¸²ï¼‰ã€‚</li><li><strong>åç«¯è§£æ YAML</strong>ï¼ˆç”¨ <code>yaml.loadAll</code> è§£ææˆ JSON å¯¹è±¡ï¼‰ã€‚</li><li><strong>åç«¯è°ƒç”¨ CreateYaml/replaceYaml</strong> â†’ é€šè¿‡ API Server æŠŠå¯¹è±¡éƒ¨ç½²åˆ°é›†ç¾¤ã€‚</li><li>Kubernetes è°ƒåº¦å™¨è´Ÿè´£æ‹‰é•œåƒã€åˆ›å»º Podã€‚</li></ol><hr><h2 id=æ€»ç»“ä¸€å¥è¯>æ€»ç»“ä¸€å¥è¯
<a class=anchor href=#%e6%80%bb%e7%bb%93%e4%b8%80%e5%8f%a5%e8%af%9d>#</a></h2><p>ğŸ‘‰ å‰ç«¯åªæ˜¯ <strong>è¡¨å•è½¬ YAML</strong>ï¼Œ
ğŸ‘‰ åç«¯è¿™æ®µä»£ç æ‰æ˜¯ <strong>æŠŠ YAML apply åˆ° Kubernetes é›†ç¾¤</strong>ï¼Œå®ç°è·Ÿ <code>kubectl apply -f xxx.yaml</code> ä¸€æ ·çš„åŠŸèƒ½ã€‚</p><hr><p>è¦ä¸è¦æˆ‘å¸®ä½ ç”»ä¸€ä¸ª <strong>å‰ç«¯è¡¨å• â†’ YAML â†’ API Server â†’ é›†ç¾¤éƒ¨ç½²</strong> çš„ <strong>æµç¨‹å›¾ï¼ˆMermaidï¼‰</strong>ï¼Œç›´è§‚ä¸€ç‚¹ï¼Ÿ</p><p>å¥½çš„ ğŸ‘ æˆ‘ç»™ä½ ç”»ä¸€ä¸ª <strong>å‰ç«¯è¡¨å• â†’ YAML â†’ K8s é›†ç¾¤éƒ¨ç½²</strong> çš„æµç¨‹å›¾ï¼Œç”¨ Mermaid è¡¨ç¤ºï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    A[ç”¨æˆ·åœ¨å‰ç«¯è¡¨å•å¡«å†™å‚æ•°: é•œåƒ/ç«¯å£/å­˜å‚¨/CPUç­‰] --&gt; B[å‰ç«¯å°†è¡¨å•æ•°æ®è½¬æ¢ä¸º YAML]

    B --&gt; C[åç«¯ API æ¥æ”¶ YAML]
    C --&gt; D[åç«¯è§£æ YAML ä¸º JSON å¯¹è±¡]

    D --&gt; E[è°ƒç”¨ CreateYaml / replaceYaml æ–¹æ³•]
    E --&gt; F[è¯·æ±‚å‘é€åˆ° Kubernetes API Server]

    F --&gt; G[API Server æ ¡éªŒå¹¶å­˜å‚¨åˆ° etcd]
    G --&gt; H[è°ƒåº¦å™¨åˆ†é…èŠ‚ç‚¹]
    H --&gt; I[Kubelet æ‹‰å–é•œåƒå¹¶å¯åŠ¨ Pod]
    I --&gt; J[åº”ç”¨æˆåŠŸè¿è¡Œåœ¨ Kubernetes é›†ç¾¤]
</code></pre><hr><p>è¿™ä¸ªå›¾èµ°çš„æµç¨‹å…¶å®å°±æ˜¯ï¼š</p><ol><li><strong>å‰ç«¯</strong>ï¼šç”¨æˆ·è¾“å…¥å‚æ•°ï¼Œè½¬ YAMLã€‚</li><li><strong>åç«¯</strong>ï¼šæ¥æ”¶ YAML â†’ è½¬ JSON â†’ è°ƒç”¨ K8s APIã€‚</li><li><strong>API Server</strong>ï¼šå­˜åˆ° etcd â†’ è°ƒåº¦ â†’ åˆ›å»º Podã€‚</li><li><strong>æœ€ç»ˆåº”ç”¨éƒ¨ç½²æˆåŠŸ</strong>ã€‚</li></ol><hr><p>è¦ä¸è¦æˆ‘å†ç»™ä½ ç”»ä¸€ä¸ª <strong>æ—¶åºå›¾ï¼ˆsequence diagramï¼‰</strong>ï¼Œè¡¨ç°å‰ç«¯ã€åç«¯ã€K8s ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹ï¼Ÿ</p><p>å¥½å˜ ğŸ‘ ç”¨ Mermaid çš„ <code>sequenceDiagram</code> æ¥ç”»ä¼šæ›´ç›´è§‚ï¼Œè¡¨ç° <strong>å‰ç«¯ã€åç«¯ã€K8s API Server</strong> çš„äº¤äº’æµç¨‹ï¼š</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    participant FE as å‰ç«¯(è¡¨å•é¡µé¢)
    participant BE as åç«¯(Node.jsæœåŠ¡)
    participant K8S as Kubernetes API Server
    participant ETCD as etcd
    participant Kubelet as èŠ‚ç‚¹Kubelet

    FE-&gt;&gt;BE: æäº¤è¡¨å•æ•°æ® (é•œåƒ/ç«¯å£/CPU/å­˜å‚¨ç­‰)
    BE-&gt;&gt;BE: è½¬æ¢ä¸º YAML (Deployment/Service/Ingress...)
    BE-&gt;&gt;K8S: è°ƒç”¨ CreateYaml/replaceYaml&lt;br&gt;æäº¤èµ„æºå¯¹è±¡
    K8S-&gt;&gt;ETCD: æ ¡éªŒå¹¶å†™å…¥èµ„æºå¯¹è±¡
    K8S-&gt;&gt;BE: è¿”å›æˆåŠŸ(èµ„æºå·²åˆ›å»º)

    K8S-&gt;&gt;Kubelet: è°ƒåº¦ Pod åˆ°èŠ‚ç‚¹
    Kubelet-&gt;&gt;Kubelet: æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨
    Kubelet--&gt;&gt;K8S: ä¸ŠæŠ¥ Pod çŠ¶æ€ Running
    K8S--&gt;&gt;BE: åº”ç”¨çŠ¶æ€å¯æŸ¥è¯¢
    BE--&gt;&gt;FE: è¿”å›éƒ¨ç½²æˆåŠŸ/çŠ¶æ€ä¿¡æ¯
</code></pre><hr><p>è¿™æ ·ä½ èƒ½æ¸…æ¥šçœ‹åˆ°ï¼š</p><ol><li><strong>å‰ç«¯</strong> åªç®¡æäº¤è¡¨å•ï¼›</li><li><strong>åç«¯</strong> è´Ÿè´£è½¬æˆ YAML å¹¶è°ƒç”¨ K8s APIï¼›</li><li><strong>API Server</strong> æ ¡éªŒ+å­˜å‚¨åˆ° <strong>etcd</strong>ï¼›</li><li><strong>è°ƒåº¦å™¨ & Kubelet</strong> å®Œæˆå®é™…çš„ Pod åˆ›å»ºï¼›</li><li>æœ€ç»ˆçŠ¶æ€å†å±‚å±‚è¿”å›åˆ°å‰ç«¯ã€‚</li></ol><p>è¦ä¸è¦æˆ‘å†ç»™ä½ åŠ ä¸€ç‰ˆ <strong>å¤±è´¥åœºæ™¯çš„æ—¶åºå›¾</strong>ï¼ˆæ¯”å¦‚ YAML æ ¡éªŒå¤±è´¥ / èµ„æºé…é¢ä¸è¶³ï¼‰ï¼Ÿ</p><h2 id=kubesphere-çš„å‰ç«¯å¡«å†™-deployment-è¡¨å•åæ ¸å¿ƒæµç¨‹å¦‚ä¸‹>KubeSphere çš„å‰ç«¯å¡«å†™ Deployment è¡¨å•åï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š
<a class=anchor href=#kubesphere-%e7%9a%84%e5%89%8d%e7%ab%af%e5%a1%ab%e5%86%99-deployment-%e8%a1%a8%e5%8d%95%e5%90%8e%e6%a0%b8%e5%bf%83%e6%b5%81%e7%a8%8b%e5%a6%82%e4%b8%8b>#</a></h2><hr><h2 id=1-å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º Deployment çš„ YAML
<a class=anchor href=#1-%e5%89%8d%e7%ab%af%e8%a1%a8%e5%8d%95%e5%a6%82%e4%bd%95%e8%bd%ac%e4%b8%ba-deployment-%e7%9a%84-yaml>#</a></h2><p>KubeSphere çš„å‰ç«¯ï¼ˆå¦‚æ§åˆ¶å°ï¼‰å¡«å†™çš„ Deployment è¡¨å•æ•°æ®ï¼Œé€šå¸¸ä¼šè¢«è½¬æ¢ä¸º Kubernetes Deployment èµ„æºå¯¹è±¡çš„ JSON/YAMLã€‚</p><ul><li>å‰ç«¯ä¼šæ”¶é›†è¡¨å•æ•°æ®ï¼Œæ¯”å¦‚åç§°ã€é•œåƒã€labelsã€replicasã€å®¹å™¨é…ç½®ç­‰ã€‚</li><li>è¿™äº›æ•°æ®ä¼šè¢«ç»„è£…æˆæ ‡å‡†çš„ K8s Deployment èµ„æºè§„èŒƒï¼ˆJSONï¼‰ï¼Œå¦‚ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;apps/v1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;kind&#34;</span>: <span style=color:#e6db74>&#34;Deployment&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;example-deployment&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;namespace&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;labels&#34;</span>: { <span style=color:#960050;background-color:#1e0010>...</span> }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;spec&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;replicas&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;selector&#34;</span>: { <span style=color:#960050;background-color:#1e0010>...</span> },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;template&#34;</span>: { <span style=color:#960050;background-color:#1e0010>...</span> }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨ KubeSphere çš„ä»£ç ä¾‹å­å‚è€ƒï¼ˆæµ‹è¯•æ•°æ®ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ksApiserverDeploy</span> = <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;apiVersion&#34;: &#34;apps/v1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;kind&#34;: &#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;metadata&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;labels&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;app&#34;: &#34;ks-apiserver&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;tier&#34;: &#34;backend&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;name&#34;: &#34;ks-apiserver&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;namespace&#34;: &#34;kubesphere-system&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;spec&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       ...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>
</span></span></code></pre></div><h2 id=2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤
<a class=anchor href=#2-%e5%a6%82%e4%bd%95%e8%a2%ab%e9%83%a8%e7%bd%b2%e5%88%b0-k8s-%e9%9b%86%e7%be%a4>#</a></h2><ul><li>å‰ç«¯ä¼šå°† YAML/JSON é€šè¿‡ API è¯·æ±‚å‘é€åˆ° KubeSphere åç«¯ï¼ˆé€šå¸¸æ˜¯ RESTful æ¥å£ï¼‰ã€‚</li><li>åç«¯è´Ÿè´£å°†è¿™äº› Deployment å¯¹è±¡ apply åˆ° Kubernetes é›†ç¾¤ã€‚</li></ul><p>åç«¯å…³é”®å®ç°å¦‚ä¸‹ï¼š</p><h3 id=21-æ¥æ”¶å¹¶-apply-èµ„æºå¯¹è±¡>2.1 æ¥æ”¶å¹¶ apply èµ„æºå¯¹è±¡
<a class=anchor href=#21-%e6%8e%a5%e6%94%b6%e5%b9%b6-apply-%e8%b5%84%e6%ba%90%e5%af%b9%e8%b1%a1>#</a></h3><p>åç«¯ä¼šè§£æå‰ç«¯ä¼ æ¥çš„ JSON/YAMLï¼Œé€šè¿‡ K8s Dynamic Client è¿›è¡Œ applyï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>YamlInstaller</span>) <span style=color:#a6e22e>ForApply</span>(<span style=color:#a6e22e>tasks</span> []<span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>RawMessage</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>idx</span>, <span style=color:#a6e22e>js</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tasks</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>gvr</span>, <span style=color:#a6e22e>utd</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>GetInfoFromBytes</span>(<span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Mapper</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>PatchOptions</span>{<span style=color:#a6e22e>FieldManager</span>: <span style=color:#e6db74>&#34;v1.FieldManager&#34;</span>}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>DynamicCli</span>.<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>gvr</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetNamespace</span>()).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Patch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ApplyPatchType</span>, <span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>opt</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;[%d/%d] %s/%s applied&#34;</span>, <span style=color:#a6e22e>idx</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>tasks</span>), <span style=color:#a6e22e>gvr</span>.<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>å‰ç«¯ JSON æ•°æ®é€šè¿‡ API ä¼ åˆ°åç«¯ï¼Œåç«¯è°ƒç”¨ K8s APIï¼Œåˆ›å»ºæˆ–æ›´æ–° Deployment èµ„æºã€‚</li></ul><h3 id=22-å…¸å‹è°ƒç”¨é“¾>2.2 å…¸å‹è°ƒç”¨é“¾
<a class=anchor href=#22-%e5%85%b8%e5%9e%8b%e8%b0%83%e7%94%a8%e9%93%be>#</a></h3><ol><li>å‰ç«¯è¡¨å• -> ç»„è£…æ ‡å‡† Deployment JSON</li><li>å‰ç«¯é€šè¿‡ API å‘é€åˆ°åç«¯ï¼ˆå¦‚ <code>/apis/apps/v1/namespaces/{namespace}/deployments</code>ï¼‰</li><li>åç«¯ç”¨ DynamicClientã€RestMapper è§£æ JSON å¹¶ apply åˆ°é›†ç¾¤</li><li>èµ„æºè¢«æˆåŠŸåˆ›å»ºæˆ–æ›´æ–°</li></ol><hr><h2 id=ç›¸å…³ä»£ç å‚è€ƒ>ç›¸å…³ä»£ç å‚è€ƒ
<a class=anchor href=#%e7%9b%b8%e5%85%b3%e4%bb%a3%e7%a0%81%e5%8f%82%e8%80%83>#</a></h2><ul><li>å‰ç«¯è¡¨å•ç»„è£… Deployment æ•°æ®ï¼ˆå¯å‚è€ƒæµ‹è¯•æ•°æ®ï¼‰:<br><code>pkg/kapis/cluster/v1alpha1/handler_test.go:ksApiserverDeploy</code></li><li>åç«¯åº”ç”¨ YAML/JSON åˆ° K8s é›†ç¾¤:<br><code>pkg/simple/client/application/yaml.go:YamlInstaller.ForApply</code></li></ul><hr><p>å¦‚éœ€æ›´è¯¦ç»†çš„å‰ç«¯/åç«¯æºç å…¥å£æˆ– API è·¯å¾„ï¼Œè¯·è¡¥å……éœ€æ±‚ï¼</p><p>å¥½çš„ï¼Œè¿™æ®µ Go ä»£ç ä¸»è¦æ˜¯ <strong>KubeSphere é‡Œå¯¹ Kubernetes é›†ç¾¤é…ç½®çš„æµ‹è¯•ä»£ç </strong>ï¼Œè™½ç„¶å®ƒæœ¬èº«æ˜¯æµ‹è¯•ï¼ˆ<code>_test.go</code> æ–‡ä»¶ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‹†è§£æ¥çœ‹ï¼Œå°¤å…¶èšç„¦ <strong>å‰ç«¯è¡¨å•å¦‚ä½•æ˜ å°„åˆ° Deployment/YAML èµ„æº</strong> çš„é€»è¾‘ã€‚</p><p>æˆ‘ç»™ä½ æŒ‰å±‚æ¬¡è§£é‡Šï¼š</p><hr><h2 id=1-æ ¸å¿ƒç»“æ„>1ï¸âƒ£ æ ¸å¿ƒç»“æ„
<a class=anchor href=#1-%e6%a0%b8%e5%bf%83%e7%bb%93%e6%9e%84>#</a></h2><ol><li><strong>Cluster å¯¹è±¡</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>cluster</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v1alpha1</span>.<span style=color:#a6e22e>Cluster</span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ObjectMeta</span>: <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;gondor&#34;</span>},
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Spec</span>: <span style=color:#a6e22e>v1alpha1</span>.<span style=color:#a6e22e>ClusterSpec</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Connection</span>: <span style=color:#a6e22e>v1alpha1</span>.<span style=color:#a6e22e>Connection</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Type</span>:  <span style=color:#a6e22e>v1alpha1</span>.<span style=color:#a6e22e>ConnectionTypeProxy</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Token</span>: <span style=color:#e6db74>&#34;randomtoken&#34;</span>,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ª <strong>KubeSphere é›†ç¾¤å¯¹è±¡</strong>ã€‚</li><li>å‰ç«¯è¡¨å•å¦‚æœåˆ›å»ºé›†ç¾¤ï¼Œé€šå¸¸ä¼šå¡«å†™ï¼š<ul><li><code>cluster.name</code></li><li><code>cluster.connection.type</code>ï¼ˆç›´æ¥/ä»£ç†ï¼‰</li><li><code>cluster.connection.token</code></li></ul></li></ul><p>è¿™äº›å­—æ®µæœ€ç»ˆæ˜ å°„åˆ° Cluster CRDã€‚</p><hr><ol><li><strong>ConfigMap æ•°æ®</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hostMap</span> = <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;kubesphere.yaml&#34;</span>: <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>monitoring:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  endpoint: http://prometheus-operated.kubesphere-monitoring-system.svc:9090
</span></span></span><span style=display:flex><span><span style=color:#e6db74>authentication:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  jwtSecret: ...
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  oauthOptions:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    accessTokenMaxAge: 0s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    accessTokenInactivityTimeout: 0s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>æ¨¡æ‹Ÿäº†é›†ç¾¤çš„ <strong>é…ç½®æ•°æ®</strong>ã€‚</li><li>åœ¨å‰ç«¯è¡¨å•ä¸­ï¼Œå¯èƒ½æœ‰ <strong>ç›‘æ§åœ°å€ã€JWT Secretã€OAuth é…ç½®</strong>ã€‚</li><li>åç«¯ä¼šæŠŠè¿™äº›å­—æ®µç»„è£…æˆ ConfigMap å¹¶å†™å…¥ <code>kubesphere-system</code> å‘½åç©ºé—´ã€‚</li></ul><hr><ol><li><strong>Deployment æ¨¡æ¿ï¼ˆJSONï¼‰</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ksApiserverDeploy</span> = <span style=color:#e6db74>`{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;apiVersion&#34;: &#34;apps/v1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;kind&#34;: &#34;Deployment&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;metadata&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;name&#34;: &#34;ks-apiserver&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;namespace&#34;: &#34;kubesphere-system&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;labels&#34;: {...}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;spec&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;replicas&#34;: 1,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;template&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;spec&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;containers&#34;: [{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;name&#34;: &#34;ks-apiserver&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;image&#34;: &#34;kubesphere/ks-apiserver:v3.0.0&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;command&#34;: [&#34;ks-apiserver&#34;,&#34;--logtostderr=true&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}`</span>
</span></span></code></pre></div><ul><li><p>è¿™é‡Œæ˜¯ <strong>KubeSphere Apiserver çš„ Deployment æ¨¡æ¿</strong>ã€‚</p></li><li><p><strong>å‰ç«¯è¡¨å•å¯¹åº”å­—æ®µæ˜ å°„</strong>ï¼š</p><table><thead><tr><th>è¡¨å•å­—æ®µ</th><th>Deployment å­—æ®µ</th></tr></thead><tbody><tr><td>é•œåƒ</td><td><code>containers[0].image</code></td></tr><tr><td>å‘½ä»¤</td><td><code>containers[0].command</code></td></tr><tr><td>å‰¯æœ¬æ•°</td><td><code>spec.replicas</code></td></tr><tr><td>ç¯å¢ƒå˜é‡/é…ç½®</td><td><code>containers[0].env</code> æˆ– ConfigMap æŒ‚è½½</td></tr></tbody></table></li><li><p>åç«¯é€šè¿‡ JSON/Struct è§£æåå†å†™å…¥ Kubernetesã€‚</p></li></ul><hr><h2 id=2-æ ¸å¿ƒæ–¹æ³•addmemberclusterresource>2ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼š<code>addMemberClusterResource</code>
<a class=anchor href=#2-%e6%a0%b8%e5%bf%83%e6%96%b9%e6%b3%95addmemberclusterresource>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addMemberClusterResource</span>(<span style=color:#a6e22e>targetCm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>ConfigMap</span>, <span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æ„é€  clientSet</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>con</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientcmd</span>.<span style=color:#a6e22e>NewClientConfigFromBytes</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>con</span>.<span style=color:#a6e22e>ClientConfig</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>NewForConfig</span>(<span style=color:#a6e22e>cli</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åˆ›å»ºå‘½åç©ºé—´</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Namespaces</span>().<span style=color:#a6e22e>Create</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åˆ›å»º ConfigMap</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>ConfigMaps</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>targetCm</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åˆ›å»º Deployment</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>deploy</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>appsv1</span>.<span style=color:#a6e22e>Deployment</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>ksApiserverDeploy</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>deploy</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Create</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>deploy</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=-åšäº†ä»€ä¹ˆ>ğŸ”¹ åšäº†ä»€ä¹ˆ
<a class=anchor href=#-%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88>#</a></h3><ol><li>è¯»å–å‰ç«¯è¡¨å•ç”Ÿæˆçš„ <strong>KubeConfig</strong></li><li>åˆå§‹åŒ– Kubernetes client</li><li>åˆ›å»º <strong>å‘½åç©ºé—´</strong>ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</li><li>åˆ›å»ºæˆ–æ›´æ–° <strong>ConfigMap</strong>ï¼ˆå‰ç«¯è¡¨å•å­—æ®µï¼šç›‘æ§ã€JWTã€OAuthï¼‰</li><li>åˆ›å»º <strong>Deployment</strong>ï¼ˆå‰ç«¯è¡¨å•å­—æ®µï¼šé•œåƒã€å‘½ä»¤ã€replicasï¼‰</li></ol><hr><h2 id=3-validatememberclusterconfiguration>3ï¸âƒ£ <code>validateMemberClusterConfiguration</code>
<a class=anchor href=#3-validatememberclusterconfiguration>#</a></h2><ul><li>æ¨¡æ‹Ÿäº†<strong>éªŒè¯æˆå‘˜é›†ç¾¤é…ç½®æ˜¯å¦æœ‰æ•ˆ</strong>ã€‚</li><li>æµç¨‹ï¼š<ol><li>å…ˆå†™å…¥ <strong>hostCm</strong></li><li>è°ƒç”¨ <code>validateMemberClusterConfiguration</code> æ ¡éªŒ</li><li>å†å†™å…¥ <strong>memberCm</strong></li><li>æ ¡éªŒå¤±è´¥ï¼ˆç¡®ä¿æ£€æµ‹åˆ°é‡å¤æˆ–é”™è¯¯çš„é…ç½®ï¼‰</li></ol></li></ul><blockquote><p>è¿™é‡Œå¯ä»¥ç†è§£ä¸ºï¼šå‰ç«¯è¡¨å•ç”Ÿæˆçš„ ConfigMap/YAML ç»è¿‡åç«¯ç»„è£… Deployment åï¼Œæœ€ç»ˆè¦éªŒè¯ <strong>é›†ç¾¤æ˜¯å¦å¯ç”¨ã€é…ç½®æ˜¯å¦åˆç†</strong>ã€‚</p></blockquote><hr><h2 id=4-æ€»ç»“è¡¨å•å­—æ®µåˆ°-deployment-æ˜ å°„>4ï¸âƒ£ æ€»ç»“ï¼šè¡¨å•å­—æ®µåˆ° Deployment æ˜ å°„
<a class=anchor href=#4-%e6%80%bb%e7%bb%93%e8%a1%a8%e5%8d%95%e5%ad%97%e6%ae%b5%e5%88%b0-deployment-%e6%98%a0%e5%b0%84>#</a></h2><table><thead><tr><th>å‰ç«¯è¡¨å•å­—æ®µ</th><th>Kubernetes èµ„æº & YAML è·¯å¾„</th></tr></thead><tbody><tr><td>é•œåƒ</td><td>Deployment.spec.template.spec.containers[0].image</td></tr><tr><td>å‘½ä»¤</td><td>Deployment.spec.template.spec.containers[0].command</td></tr><tr><td>å‘½ä»¤å‚æ•°</td><td>Deployment.spec.template.spec.containers[0].args</td></tr><tr><td>å‰¯æœ¬æ•°</td><td>Deployment.spec.replicas</td></tr><tr><td>ç¯å¢ƒå˜é‡/é…ç½®</td><td>Deployment.spec.template.spec.containers[0].env / ConfigMap</td></tr><tr><td>JWT Secret / OAuth / Monitoring</td><td>ConfigMap.data[&ldquo;kubesphere.yaml&rdquo;]</td></tr></tbody></table><ul><li><strong>é€»è¾‘å…³ç³»</strong>ï¼š<ul><li>è¡¨å• â†’ å†…å­˜å¯¹è±¡ï¼ˆCluster / ConfigMap / Deployment Structï¼‰ â†’ Kubernetes API â†’ çœŸå®èµ„æº</li></ul></li><li><strong>æµ‹è¯•æ„å›¾</strong>ï¼š<ul><li>éªŒè¯è¡¨å•ç”Ÿæˆ Deployment æ˜¯å¦æ­£ç¡®</li><li>æ ¡éªŒæˆå‘˜é›†ç¾¤é…ç½®æ˜¯å¦åˆç†</li></ul></li></ul><hr><p>å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼  <strong>â€œå‰ç«¯è¡¨å•å­—æ®µ â†’ YAML â†’ Deployment/ConfigMap æ˜ å°„å›¾â€</strong>ï¼ŒæŠŠä¸Šè¡¨å¯è§†åŒ–æˆ Mermaid å›¾ï¼Œæ›´ç›´è§‚åœ°å±•ç¤ºå‰ç«¯å¦‚ä½•ç»„è£… Deployment æ•°æ®ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªå›¾å—ï¼Ÿ</p><p>å¥½çš„ï¼Œè¿™æ®µä»£ç å®ç°çš„æ˜¯ <strong>KubeSphere åç«¯ç”¨æ¥å°† YAML/JSON åº”ç”¨åˆ° Kubernetes é›†ç¾¤çš„ä¸€ä¸ª â€œå®‰è£…å™¨â€</strong>ï¼Œç”¨çš„æ˜¯åŠ¨æ€å®¢æˆ·ç«¯ï¼ˆ<code>dynamic.DynamicClient</code>ï¼‰ï¼Œæ¨¡ä»¿ Helm çš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥é€æ­¥è§£æå®ƒçš„é€»è¾‘ï¼Œå°¤å…¶æ˜¯ <strong>å‰ç«¯æäº¤çš„ YAML/JSON â†’ K8s èµ„æº</strong> çš„è¿‡ç¨‹ã€‚</p><hr><h2 id=1-æ ¸å¿ƒç»“æ„-1>1ï¸âƒ£ æ ¸å¿ƒç»“æ„
<a class=anchor href=#1-%e6%a0%b8%e5%bf%83%e7%bb%93%e6%9e%84-1>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>YamlInstaller</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Mapper</span>      <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>RESTMapper</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DynamicCli</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>dynamic</span>.<span style=color:#a6e22e>DynamicClient</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GvrListInfo</span> []<span style=color:#a6e22e>InsInfo</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Namespace</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>InsInfo</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>GroupVersionResource</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>      <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Namespace</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>Mapper</strong>ï¼šRESTMapperï¼Œç”¨äºæŠŠ GroupVersionKindï¼ˆGVKï¼‰æ˜ å°„åˆ° GroupVersionResourceï¼ˆGVRï¼‰ã€‚</li><li><strong>DynamicCli</strong>ï¼šåŠ¨æ€å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ“ä½œä»»æ„ç±»å‹çš„ Kubernetes èµ„æºï¼ˆDeployment/Service/ConfigMap/CRD ç­‰ï¼‰ã€‚</li><li><strong>GvrListInfo</strong>ï¼šè®°å½•å·²ç»å®‰è£…çš„èµ„æºä¿¡æ¯ï¼ˆç”¨äºå¸è½½ï¼‰ã€‚</li><li><strong>Namespace</strong>ï¼šèµ„æºé»˜è®¤å‘½åç©ºé—´ã€‚</li></ul><blockquote><p>æ€»ç»“ï¼šè¿™ä¸ªç»“æ„ä½“å°±æ˜¯ä¸€ä¸ª <strong>å¯å¯¹ä»»æ„ YAML/JSON åº”ç”¨ã€å‡çº§ã€åˆ é™¤çš„åŠ¨æ€ Helm å®‰è£…å™¨</strong>ã€‚</p></blockquote><hr><h2 id=2-install--upgrade--uninstall>2ï¸âƒ£ Install / Upgrade / Uninstall
<a class=anchor href=#2-install--upgrade--uninstall>#</a></h2><h3 id=install>Install
<a class=anchor href=#install>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>YamlInstaller</span>) <span style=color:#a6e22e>Install</span>(<span style=color:#f92672>...</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>è¿™é‡Œæš‚æœªå®ç°ï¼Œå®é™…ä¸Šå¯ä»¥è°ƒç”¨ Upgrade æ¥å®ç°â€œå®‰è£…â€çš„é€»è¾‘ã€‚</li></ul><hr><h3 id=upgrade>Upgrade
<a class=anchor href=#upgrade>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>YamlInstaller</span>) <span style=color:#a6e22e>Upgrade</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>release</span>, <span style=color:#a6e22e>chart</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>values</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>helm</span>.<span style=color:#a6e22e>HelmOption</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>yamlList</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ReadYaml</span>(<span style=color:#a6e22e>values</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;attempting to apply %d yaml files&#34;</span>, len(<span style=color:#a6e22e>yamlList</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>ForApply</span>(<span style=color:#a6e22e>yamlList</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>values</strong>ï¼šå‰ç«¯ä¼ æ¥çš„ YAML/JSON å†…å®¹ï¼ˆ[]byteï¼‰ã€‚</li><li><strong>ReadYaml</strong>ï¼šæŠŠ YAML/JSON è½¬æˆ <code>[]json.RawMessage</code>ï¼ˆæ¯ä¸ªå¯¹è±¡ä¸€ä¸ª json.RawMessageï¼‰ã€‚</li><li><strong>ForApply</strong>ï¼šæ ¸å¿ƒæ–¹æ³•ï¼Œå°†æ¯ä¸ªå¯¹è±¡åº”ç”¨åˆ° Kubernetesã€‚</li></ul><blockquote><p>è¯´æ˜ï¼šè¿™é‡Œ Upgrade å°±æ˜¯â€œæŠŠ YAML/JSON åº”ç”¨åˆ°é›†ç¾¤â€ï¼Œå‰ç«¯è¡¨å•çš„æ•°æ®æœ€ç»ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•è½åœ°ã€‚</p></blockquote><hr><h3 id=uninstall>Uninstall
<a class=anchor href=#uninstall>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>YamlInstaller</span>) <span style=color:#a6e22e>Uninstall</span>(<span style=color:#f92672>...</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>GvrListInfo</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>DynamicCli</span>.<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>GroupVersionResource</span>).<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Namespace</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>DeleteOptions</span>{})
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>apierrors</span>.<span style=color:#a6e22e>IsNotFound</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>æ ¹æ® <code>GvrListInfo</code> å¸è½½æ‰€æœ‰èµ„æºã€‚</li><li>ä½¿ç”¨ Dynamic Client çš„ <code>Delete</code> æ–¹æ³•ã€‚</li></ul><hr><h2 id=3-æ ¸å¿ƒæ–¹æ³•forapply>3ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼šForApply
<a class=anchor href=#3-%e6%a0%b8%e5%bf%83%e6%96%b9%e6%b3%95forapply>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>YamlInstaller</span>) <span style=color:#a6e22e>ForApply</span>(<span style=color:#a6e22e>tasks</span> []<span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>RawMessage</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>idx</span>, <span style=color:#a6e22e>js</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tasks</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>gvr</span>, <span style=color:#a6e22e>utd</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>GetInfoFromBytes</span>(<span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Mapper</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>PatchOptions</span>{<span style=color:#a6e22e>FieldManager</span>: <span style=color:#e6db74>&#34;v1.FieldManager&#34;</span>}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>DynamicCli</span>.<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>gvr</span>).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetNamespace</span>()).
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Patch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ApplyPatchType</span>, <span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>opt</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;[%d/%d] %s/%s applied&#34;</span>, <span style=color:#a6e22e>idx</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>tasks</span>), <span style=color:#a6e22e>gvr</span>.<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=æ ¸å¿ƒæ­¥éª¤>æ ¸å¿ƒæ­¥éª¤ï¼š
<a class=anchor href=#%e6%a0%b8%e5%bf%83%e6%ad%a5%e9%aa%a4>#</a></h3><ol><li><strong>è§£æ YAML/JSON â†’ GVR + Unstructured</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>gvr</span>, <span style=color:#a6e22e>utd</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>GetInfoFromBytes</span>(<span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Mapper</span>)
</span></span></code></pre></div><ul><li><code>GetInfoFromBytes</code>ï¼š<ul><li>è§£ææ¯ä¸ªå¯¹è±¡çš„ <strong>apiVersion/kind/name/namespace</strong>ã€‚</li><li>è¿”å› <code>GroupVersionResource</code>ï¼ˆGVRï¼‰å’Œ <code>Unstructured</code> å¯¹è±¡ã€‚</li></ul></li><li><strong>å‰ç«¯è¡¨å•æ˜ å°„</strong>ï¼š<ul><li>Deploymentã€Serviceã€ConfigMap ç­‰èµ„æºçš„å­—æ®µéƒ½åœ¨è¿™é‡Œè¢«è§£æã€‚</li></ul></li></ul><ol><li><strong>Apply åˆ°é›†ç¾¤</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>DynamicCli</span>.<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>gvr</span>).
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Namespace</span>(<span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetNamespace</span>()).
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Patch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ApplyPatchType</span>, <span style=color:#a6e22e>js</span>, <span style=color:#a6e22e>opt</span>)
</span></span></code></pre></div><ul><li>ä½¿ç”¨ <strong>Server-Side Apply</strong>ï¼ˆ<code>ApplyPatchType</code>ï¼‰ï¼Œç±»ä¼¼ <code>kubectl apply -f</code>ï¼š<ul><li>å¦‚æœèµ„æºä¸å­˜åœ¨ â†’ åˆ›å»º</li><li>å¦‚æœèµ„æºå­˜åœ¨ â†’ æ›´æ–°</li></ul></li><li>FieldManager ç”¨äºæ ‡è®°è¿™ä¸ª patch çš„æ¥æºã€‚</li></ul><ol><li><strong>æ—¥å¿—è®°å½•</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>klog</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;[%d/%d] %s/%s applied&#34;</span>, <span style=color:#a6e22e>idx</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>tasks</span>), <span style=color:#a6e22e>gvr</span>.<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>utd</span>.<span style=color:#a6e22e>GetName</span>())
</span></span></code></pre></div><ul><li>æ‰“å°åº”ç”¨è¿›åº¦ã€‚</li></ul><hr><h2 id=4-æ€»ç»“é€»è¾‘å‰ç«¯è¡¨å•åˆ°-k8s-èµ„æº>4ï¸âƒ£ æ€»ç»“é€»è¾‘ï¼ˆå‰ç«¯è¡¨å•åˆ° K8s èµ„æºï¼‰
<a class=anchor href=#4-%e6%80%bb%e7%bb%93%e9%80%bb%e8%be%91%e5%89%8d%e7%ab%af%e8%a1%a8%e5%8d%95%e5%88%b0-k8s-%e8%b5%84%e6%ba%90>#</a></h2><ol><li>å‰ç«¯è¡¨å• â†’ YAML/JSON æ•°æ®<ul><li>ä¾‹å¦‚ï¼š<ul><li>Deploymentï¼šé•œåƒã€replicasã€èµ„æºé™åˆ¶</li><li>Serviceï¼šç«¯å£ã€ç±»å‹</li><li>ConfigMap/Secretï¼šé…ç½®å†…å®¹</li></ul></li></ul></li><li>åç«¯è°ƒç”¨ <code>YamlInstaller.Upgrade</code></li><li><code>ReadYaml(values)</code> â†’ åˆ‡æˆå¤šä¸ª <code>json.RawMessage</code></li><li><code>ForApply</code>ï¼š<ul><li><code>GetInfoFromBytes</code> â†’ è·å– GVR + Unstructured</li><li><code>DynamicClient.Patch(ApplyPatchType)</code> â†’ åº”ç”¨åˆ° Kubernetes</li></ul></li><li>èµ„æºåº”ç”¨å®Œæˆï¼Œ<code>GvrListInfo</code> ä¿å­˜ï¼Œæ–¹ä¾¿å¸è½½</li></ol><blockquote><p>âš¡ æ ¸å¿ƒç‚¹ï¼š<strong>å‰ç«¯è¡¨å•å­—æ®µå¹¶ä¸ç›´æ¥å†™ Deployment å¯¹è±¡ï¼Œè€Œæ˜¯è¢«åºåˆ—åŒ–æˆ YAML/JSONï¼Œé€šè¿‡ DynamicClient Apply åˆ°é›†ç¾¤</strong>ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼šå‰ç«¯å­—æ®µ â†’ YAML â†’ Unstructured â†’ Kubernetes APIã€‚</p></blockquote><hr><p>å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€ä¸ª <strong>å‰ç«¯è¡¨å•å­—æ®µ â†’ JSON/YAML â†’ DynamicClient â†’ Deployment/Service/ConfigMap çš„æµç¨‹å›¾</strong>ï¼ŒæŠŠæ•´ä¸ªæµç¨‹å¯è§†åŒ–ï¼Œæ›´ç›´è§‚ã€‚</p><p>ä½ å¸Œæœ›æˆ‘ç”»è¿™ä¸ªå›¾å—ï¼Ÿ</p><p>æ ¹æ® TKE æºç å’Œæ–‡æ¡£ï¼Œå‰ç«¯è¡¨å•åˆ°åç«¯ YAML åŠéƒ¨ç½²åˆ° K8s çš„æµç¨‹å¦‚ä¸‹ï¼š</p><hr><h2 id=1-å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º-deployment-çš„-yaml>1. å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º Deployment çš„ YAML
<a class=anchor href=#1-%e5%89%8d%e7%ab%af%e5%a6%82%e4%bd%95%e5%b0%86%e8%a1%a8%e5%8d%95%e5%8f%98%e4%b8%ba-deployment-%e7%9a%84-yaml>#</a></h2><ul><li>å‰ç«¯é¡µé¢ï¼ˆå¦‚å·¥ä½œè´Ÿè½½åˆ›å»ºé¡µé¢ï¼‰æ”¶é›†ç”¨æˆ·å¡«å†™çš„ Deployment ä¿¡æ¯ï¼ˆå¦‚åç§°ã€é•œåƒã€æ ‡ç­¾ã€å‰¯æœ¬æ•°ç­‰ï¼‰ã€‚</li><li>å‰ç«¯ä¼šå°†è¿™äº›è¡¨å•è½¬æ¢ä¸ºæ ‡å‡†çš„ Deployment YAML/JSON å¯¹è±¡ã€‚</li></ul><p><strong>ç›¸å…³é…ç½®ä¸è½¬æ¢é€»è¾‘å‚è€ƒï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>/** deploymentçš„é…ç½® */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deployment</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>k8sVersion</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>generateResourceInfo</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>k8sVersion</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resourceName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;deployment&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestType</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>list</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;deployments&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isRelevantToNamespace</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>displayField</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>actionField</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>detailField</span>
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>å‰ç«¯é¡µé¢é€šè¿‡é…ç½®å’Œè¡¨å•æ•°æ®ï¼Œç”Ÿæˆ deployment çš„ YAML å†…å®¹ã€‚</p><p>è¡¨å•æäº¤å‰é€šå¸¸ä¼šç”¨ YAML è§£æåº“è¿›è¡Œæ ¼å¼æ ¡éªŒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>appCreation</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>values</span>.<span style=color:#a6e22e>rawValuesType</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;yaml&#39;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JsYAML</span>.<span style=color:#a6e22e>safeLoad</span>(<span style=color:#a6e22e>appCreation</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>values</span>.<span style=color:#a6e22e>rawValues</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>yamlValidator</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span> }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>yamlValidator</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>result</span>: <span style=color:#66d9ef>2</span>, <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>t</span>(<span style=color:#e6db74>&#39;Yamlæ ¼å¼é”™è¯¯&#39;</span>) }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤-1>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤
<a class=anchor href=#2-%e5%a6%82%e4%bd%95%e8%a2%ab%e9%83%a8%e7%bd%b2%e5%88%b0-k8s-%e9%9b%86%e7%be%a4-1>#</a></h2><ul><li>å‰ç«¯æœ€ç»ˆæäº¤ YAML/JSON èµ„æºï¼Œä¼šè°ƒç”¨ WebAPIï¼ˆé€šè¿‡ RESTful APIï¼‰å°†èµ„æºå‘é€åˆ°åç«¯ã€‚</li><li>åç«¯æ¥æ”¶åˆ° JSON/YAML åï¼Œä½¿ç”¨ K8s API åˆ›å»ºæˆ–æ›´æ–°èµ„æºã€‚</li></ul><p><strong>å…³é”® API ä»£ç ç‰‡æ®µï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateResourceIns</span>(<span style=color:#a6e22e>resource</span>: <span style=color:#66d9ef>CreateResource</span>[], <span style=color:#a6e22e>regionId</span>: <span style=color:#66d9ef>number</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>resourceIns</span>, <span style=color:#a6e22e>clusterId</span>, <span style=color:#a6e22e>resourceInfo</span>, <span style=color:#66d9ef>namespace</span>, <span style=color:#a6e22e>jsonData</span>, <span style=color:#a6e22e>isStrategic</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>resource</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>reduceK8sRestfulPath</span>({ <span style=color:#a6e22e>resourceInfo</span>, <span style=color:#66d9ef>namespace</span>, <span style=color:#a6e22e>specificName</span>: <span style=color:#66d9ef>resourceIns</span>, <span style=color:#a6e22e>clusterId</span> });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>params</span>: <span style=color:#66d9ef>RequestParams</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span>: <span style=color:#66d9ef>Method.patch</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userDefinedHeader</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>isStrategic</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;application/strategic-merge-patch+json&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/merge-patch+json&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>jsonData</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>apiParams</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>module</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;tke&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>interfaceName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;ForwardRequest&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>regionId</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>restParams</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Method</span>: <span style=color:#66d9ef>Method.patch</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Path</span>: <span style=color:#66d9ef>url</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å‘èµ· HTTP è¯·æ±‚ï¼ˆpatch æˆ– postï¼‰ï¼Œåç«¯ä»£ç†ç»™ K8s API Server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><ul><li>åç«¯ä¼šå°†è¿™äº›æ•°æ®ä»£ç†åˆ° K8s API Server åˆ›å»º/æ›´æ–° Deployment èµ„æºã€‚</li></ul><hr><h2 id=3-æœåŠ¡ç«¯goä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹>3. æœåŠ¡ç«¯ï¼ˆGoï¼‰ä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹
<a class=anchor href=#3-%e6%9c%8d%e5%8a%a1%e7%ab%afgo%e4%be%a7%e5%ae%9e%e9%99%85%e9%83%a8%e7%bd%b2%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b>#</a></h2><p>å¦‚æœæ¶‰åŠä¸šåŠ¡é€»è¾‘è§¦å‘ K8s éƒ¨ç½²ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Controller</span>) <span style=color:#a6e22e>installDeployment</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>MeshManager</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>MeshManager</span>, <span style=color:#a6e22e>kubeClient</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Interface</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deploy</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>genDeployment</span>(<span style=color:#a6e22e>MeshManager</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deploymentClient</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kubeClient</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oldDeploy</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>deploymentClient</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>deploy</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>GetOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>k8serrors</span>.<span style=color:#a6e22e>IsNotFound</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>deploymentClient</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>deploy</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>CreateOptions</span>{})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;get deployment failed: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>newDeploy</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>oldDeploy</span>.<span style=color:#a6e22e>DeepCopy</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>newDeploy</span>.<span style=color:#a6e22e>Labels</span> = <span style=color:#a6e22e>deploy</span>.<span style=color:#a6e22e>Labels</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>newDeploy</span>.<span style=color:#a6e22e>Spec</span> = <span style=color:#a6e22e>deploy</span>.<span style=color:#a6e22e>Spec</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¿ç•™éƒ¨åˆ†åŸæœ‰å±æ€§</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>oldDeploy</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Template</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newDeploy</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Template</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>Resources</span> = <span style=color:#a6e22e>oldDeploy</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Template</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>Resources</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>deploymentClient</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>newDeploy</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>UpdateOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=4-æ–‡æ¡£ä¸­çš„å…¸å‹-yaml-ç¤ºä¾‹>4. æ–‡æ¡£ä¸­çš„å…¸å‹ YAML ç¤ºä¾‹
<a class=anchor href=#4-%e6%96%87%e6%a1%a3%e4%b8%ad%e7%9a%84%e5%85%b8%e5%9e%8b-yaml-%e7%a4%ba%e4%be%8b>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1beta2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><hr><h2 id=æ€»ç»“æµç¨‹>æ€»ç»“æµç¨‹
<a class=anchor href=#%e6%80%bb%e7%bb%93%e6%b5%81%e7%a8%8b>#</a></h2><ol><li><strong>è¡¨å•å¡«å†™</strong>ï¼ˆå‰ç«¯æ”¶é›†æ•°æ®å¹¶ç”Ÿæˆ Deployment YAML/JSONï¼‰ã€‚</li><li><strong>å‰ç«¯æ ¡éªŒå¹¶æäº¤</strong>ï¼ˆå¦‚ YAML æ ¡éªŒã€è°ƒç”¨ RESTful APIï¼‰ã€‚</li><li><strong>åç«¯å¤„ç†</strong>ï¼ˆä»£ç†è¯·æ±‚åˆ° K8s API Serverï¼Œåˆ›å»º/æ›´æ–° Deploymentï¼‰ã€‚</li><li><strong>K8s é›†ç¾¤ä¸­å®Œæˆéƒ¨ç½²</strong>ã€‚</li></ol><p>å¦‚éœ€æŸä¸€éƒ¨åˆ†çš„è¯¦ç»†æºç å®ç°å¯ç»§ç»­è¿½é—®ã€‚</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„>å‰ç«¯å¡«å†™çš„deploymentçš„è¡¨å•æ€ä¹ˆå˜ä¸ºåç«¯deploymentçš„yamlï¼Œä»¥åŠå¦‚ä½•è¢«éƒ¨ç½²åˆ°k8sé›†ç¾¤çš„</a></li><li><a href=#1-å‰ç«¯è¡¨å•--deployment-é…ç½®æ•°æ®>1ï¸âƒ£ å‰ç«¯è¡¨å• â†’ Deployment é…ç½®æ•°æ®</a></li><li><a href=#2-åç«¯--è½¬æ¢ä¸º-k8s-yamlmanifest>2ï¸âƒ£ åç«¯ â†’ è½¬æ¢ä¸º K8s YAML/Manifest</a></li><li><a href=#3-åç«¯--éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>3ï¸âƒ£ åç«¯ â†’ éƒ¨ç½²åˆ° K8s é›†ç¾¤</a><ul><li><a href=#æ–¹å¼-aè°ƒç”¨-kubectl-apply>æ–¹å¼ Aï¼šè°ƒç”¨ <code>kubectl apply</code></a></li><li><a href=#æ–¹å¼-bç›´æ¥è°ƒç”¨-kubernetes-api>æ–¹å¼ Bï¼šç›´æ¥è°ƒç”¨ Kubernetes API</a></li><li><a href=#æ–¹å¼-cç”¨å®˜æ–¹-sdk>æ–¹å¼ Cï¼šç”¨å®˜æ–¹ SDK</a></li></ul></li><li><a href=#4-æ•´ä½“æµç¨‹æ€»ç»“>4ï¸âƒ£ æ•´ä½“æµç¨‹æ€»ç»“</a><ul><li><a href=#1-å‰ç«¯è¡¨å•è½¬-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•è½¬ deployment çš„ YAML</a></li><li><a href=#2-yaml-è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. YAML è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a></li></ul></li><li><a href=#1-æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ>1ï¸âƒ£ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ</a></li><li><a href=#2-å‰ç«¯è¡¨å•---yaml-çš„è½¬æ¢>2ï¸âƒ£ å‰ç«¯è¡¨å• -> YAML çš„è½¬æ¢</a></li><li><a href=#3-ç”¨æˆ·ç‚¹å‡»åº”ç”¨éƒ¨ç½²æŒ‰é’®çš„æµç¨‹>3ï¸âƒ£ ç”¨æˆ·ç‚¹å‡»â€œåº”ç”¨éƒ¨ç½²â€æŒ‰é’®çš„æµç¨‹</a></li><li><a href=#4-submitsuccess---è°ƒç”¨åç«¯-api>4ï¸âƒ£ <code>submitSuccess</code> -> è°ƒç”¨åç«¯ API</a></li><li><a href=#5-è°ƒç”¨é“¾æ€»ç»“è¡¨å•åˆ°-yaml-åˆ°éƒ¨ç½²>5ï¸âƒ£ è°ƒç”¨é“¾æ€»ç»“ï¼ˆè¡¨å•åˆ° YAML åˆ°éƒ¨ç½²ï¼‰</a></li><li><a href=#1-k8scontext-æ¥å£><strong>1ï¸âƒ£ K8sContext æ¥å£</strong></a></li><li><a href=#2-è¡¨å•--yaml--åˆ›å»ºåº”ç”¨><strong>2ï¸âƒ£ è¡¨å• â†’ YAML â†’ åˆ›å»ºåº”ç”¨</strong></a></li><li><a href=#3-è·å–åº”ç”¨èµ„æºä¿¡æ¯><strong>3ï¸âƒ£ è·å–åº”ç”¨èµ„æºä¿¡æ¯</strong></a></li><li><a href=#4-pause--start-åº”ç”¨><strong>4ï¸âƒ£ Pause / Start åº”ç”¨</strong></a></li><li><a href=#5-æ›´æ–°åº”ç”¨èµ„æº><strong>5ï¸âƒ£ æ›´æ–°åº”ç”¨èµ„æº</strong></a></li><li><a href=#6-åˆ é™¤åº”ç”¨><strong>6ï¸âƒ£ åˆ é™¤åº”ç”¨</strong></a></li><li><a href=#7-æ€»ç»“è¡¨å•åˆ°-yaml-è°ƒç”¨é“¾><strong>7ï¸âƒ£ æ€»ç»“è¡¨å•åˆ° YAML è°ƒç”¨é“¾</strong></a><ul><li><a href=#-è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†>âœ… è§£é‡Šå›¾ä¸­å„éƒ¨åˆ†</a></li><li><a href=#-ç‰¹ç‚¹>ğŸ”¹ ç‰¹ç‚¹</a></li></ul></li><li><a href=#-æ•´ä½“æ€è·¯>ğŸ”‘ æ•´ä½“æ€è·¯</a></li><li><a href=#-æ ¸å¿ƒå‡½æ•°è§£æ>ğŸ“Œ æ ¸å¿ƒå‡½æ•°è§£æ</a><ul><li><a href=#1-json2deploycr>1. <code>json2DeployCr</code></a></li><li><a href=#2-json2service>2. <code>json2Service</code></a></li><li><a href=#3-json2ingress>3. <code>json2Ingress</code></a></li><li><a href=#4-json2configmap>4. <code>json2ConfigMap</code></a></li><li><a href=#5-json2secret>5. <code>json2Secret</code></a></li><li><a href=#6-json2hpa>6. <code>json2HPA</code></a></li><li><a href=#7-yamlstring2objects>7. <code>yamlString2Objects</code></a></li></ul></li><li><a href=#-æ•´ä½“æµç¨‹å›¾>ğŸ“Š æ•´ä½“æµç¨‹å›¾</a></li><li><a href=#-æ€»ç»“ä¸€å¥è¯>âœ… æ€»ç»“ä¸€å¥è¯</a></li><li><a href=#1-kubernetes-å®¢æˆ·ç«¯åˆå§‹åŒ–>1. <strong>Kubernetes å®¢æˆ·ç«¯åˆå§‹åŒ–</strong></a></li><li><a href=#2-åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ>2. <strong>åˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œ</strong></a></li><li><a href=#3-åŠ è½½-kubeconfig>3. <strong>åŠ è½½ kubeconfig</strong></a></li><li><a href=#4-åˆ›å»º-yaml-åˆ°-k8s>4. <strong>åˆ›å»º YAML åˆ° K8s</strong></a></li><li><a href=#5-æ›´æ–°æ›¿æ¢-yaml-åˆ°-k8s>5. <strong>æ›´æ–°/æ›¿æ¢ YAML åˆ° K8s</strong></a></li><li><a href=#6-è·å–ç”¨æˆ·é…é¢>6. <strong>è·å–ç”¨æˆ·é…é¢</strong></a></li><li><a href=#7-è·å–ç”¨æˆ·ä½™é¢>7. <strong>è·å–ç”¨æˆ·ä½™é¢</strong></a></li><li><a href=#8-å°è£…ç»Ÿä¸€çš„-k8s-æ“ä½œå…¥å£>8. <strong>å°è£…ç»Ÿä¸€çš„ K8s æ“ä½œå…¥å£</strong></a></li><li><a href=#-å‰åç«¯æµç¨‹ä¸²èµ·æ¥>ğŸ”— å‰åç«¯æµç¨‹ä¸²èµ·æ¥</a></li><li><a href=#æ€»ç»“ä¸€å¥è¯>æ€»ç»“ä¸€å¥è¯</a></li><li><a href=#kubesphere-çš„å‰ç«¯å¡«å†™-deployment-è¡¨å•åæ ¸å¿ƒæµç¨‹å¦‚ä¸‹>KubeSphere çš„å‰ç«¯å¡«å†™ Deployment è¡¨å•åï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</a></li><li><a href=#1-å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º-deployment-çš„-yaml>1. å‰ç«¯è¡¨å•å¦‚ä½•è½¬ä¸º Deployment çš„ YAML</a></li><li><a href=#2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a><ul><li><a href=#21-æ¥æ”¶å¹¶-apply-èµ„æºå¯¹è±¡>2.1 æ¥æ”¶å¹¶ apply èµ„æºå¯¹è±¡</a></li><li><a href=#22-å…¸å‹è°ƒç”¨é“¾>2.2 å…¸å‹è°ƒç”¨é“¾</a></li></ul></li><li><a href=#ç›¸å…³ä»£ç å‚è€ƒ>ç›¸å…³ä»£ç å‚è€ƒ</a></li><li><a href=#1-æ ¸å¿ƒç»“æ„>1ï¸âƒ£ æ ¸å¿ƒç»“æ„</a></li><li><a href=#2-æ ¸å¿ƒæ–¹æ³•addmemberclusterresource>2ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼š<code>addMemberClusterResource</code></a><ul><li><a href=#-åšäº†ä»€ä¹ˆ>ğŸ”¹ åšäº†ä»€ä¹ˆ</a></li></ul></li><li><a href=#3-validatememberclusterconfiguration>3ï¸âƒ£ <code>validateMemberClusterConfiguration</code></a></li><li><a href=#4-æ€»ç»“è¡¨å•å­—æ®µåˆ°-deployment-æ˜ å°„>4ï¸âƒ£ æ€»ç»“ï¼šè¡¨å•å­—æ®µåˆ° Deployment æ˜ å°„</a></li><li><a href=#1-æ ¸å¿ƒç»“æ„-1>1ï¸âƒ£ æ ¸å¿ƒç»“æ„</a></li><li><a href=#2-install--upgrade--uninstall>2ï¸âƒ£ Install / Upgrade / Uninstall</a><ul><li><a href=#install>Install</a></li><li><a href=#upgrade>Upgrade</a></li><li><a href=#uninstall>Uninstall</a></li></ul></li><li><a href=#3-æ ¸å¿ƒæ–¹æ³•forapply>3ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•ï¼šForApply</a><ul><li><a href=#æ ¸å¿ƒæ­¥éª¤>æ ¸å¿ƒæ­¥éª¤ï¼š</a></li></ul></li><li><a href=#4-æ€»ç»“é€»è¾‘å‰ç«¯è¡¨å•åˆ°-k8s-èµ„æº>4ï¸âƒ£ æ€»ç»“é€»è¾‘ï¼ˆå‰ç«¯è¡¨å•åˆ° K8s èµ„æºï¼‰</a></li><li><a href=#1-å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º-deployment-çš„-yaml>1. å‰ç«¯å¦‚ä½•å°†è¡¨å•å˜ä¸º Deployment çš„ YAML</a></li><li><a href=#2-å¦‚ä½•è¢«éƒ¨ç½²åˆ°-k8s-é›†ç¾¤-1>2. å¦‚ä½•è¢«éƒ¨ç½²åˆ° K8s é›†ç¾¤</a></li><li><a href=#3-æœåŠ¡ç«¯goä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹>3. æœåŠ¡ç«¯ï¼ˆGoï¼‰ä¾§å®é™…éƒ¨ç½²ä»£ç ç¤ºä¾‹</a></li><li><a href=#4-æ–‡æ¡£ä¸­çš„å…¸å‹-yaml-ç¤ºä¾‹>4. æ–‡æ¡£ä¸­çš„å…¸å‹ YAML ç¤ºä¾‹</a></li><li><a href=#æ€»ç»“æµç¨‹>æ€»ç»“æµç¨‹</a></li></ul></nav></div></aside></main></body></html>
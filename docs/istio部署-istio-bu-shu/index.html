<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="[root@master1 istio-1.22.3]# istioctl install --set profile=demo -y

The Kubernetes version v1.23.6 is not supported by Istio 1.22.3. The minimum supported Kubernetes version is 1.26.
Proceeding with the installation, but you might experience problems. See https://istio.io/latest/docs/releases/supported-releases/ for a list of supported versions.

2024-07-30T09:29:52.253698Z     error   klog    an error occurred forwarding 40586 -> 15014: error forwarding port 15014 to pod 8835fe7129746ef5df21abaf44c2d302f16012ae2c6e03c1103c5b8d8aff680c, uid : unable to do port forwarding: socat not found
2024-07-30T09:29:52.254140Z     error   port forward failed: lost connection to pod
The default revision has been updated to point to this installation.
✔ Istio core installed
✔ Istiod installed
✔ Egress gateways installed
✔ Ingress gateways installed
✔ Installation complete                                                                                                                                                       Made this installation the default for injection and validation.
[root@master1 istio-1.22.3]#
quay.io/kiali/kiali:v1.63
jimmidyson/configmap-reload:v0.5.0
#原镜像
quay.io/kiali/kiali:v1.63

#转换后镜像
anjia0532/quay.kiali.kiali:v1.63


#下载并重命名镜像
docker pull anjia0532/quay.kiali.kiali:v1.63 

docker tag  anjia0532/quay.kiali.kiali:v1.63 quay.io/kiali/kiali:v1.63

docker images | grep $(echo quay.io/kiali/kiali:v1.63 |awk -F':' '{print $1}')


docker tag  cloudsx.top/anjia0532/quay.kiali.kiali:v1.63  192.168.0.140:881//kiali/kiali:v1.63

  Istio快速入门
  #

"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2024-08-02 istio部署"><meta property="og:description" content="[root@master1 istio-1.22.3]# istioctl install --set profile=demo -y The Kubernetes version v1.23.6 is not supported by Istio 1.22.3. The minimum supported Kubernetes version is 1.26. Proceeding with the installation, but you might experience problems. See https://istio.io/latest/docs/releases/supported-releases/ for a list of supported versions. 2024-07-30T09:29:52.253698Z error klog an error occurred forwarding 40586 -> 15014: error forwarding port 15014 to pod 8835fe7129746ef5df21abaf44c2d302f16012ae2c6e03c1103c5b8d8aff680c, uid : unable to do port forwarding: socat not found 2024-07-30T09:29:52.254140Z error port forward failed: lost connection to pod The default revision has been updated to point to this installation. ✔ Istio core installed ✔ Istiod installed ✔ Egress gateways installed ✔ Ingress gateways installed ✔ Installation complete Made this installation the default for injection and validation. [root@master1 istio-1.22.3]# quay.io/kiali/kiali:v1.63 jimmidyson/configmap-reload:v0.5.0 #原镜像 quay.io/kiali/kiali:v1.63 #转换后镜像 anjia0532/quay.kiali.kiali:v1.63 #下载并重命名镜像 docker pull anjia0532/quay.kiali.kiali:v1.63 docker tag anjia0532/quay.kiali.kiali:v1.63 quay.io/kiali/kiali:v1.63 docker images | grep $(echo quay.io/kiali/kiali:v1.63 |awk -F':' '{print $1}') docker tag cloudsx.top/anjia0532/quay.kiali.kiali:v1.63 192.168.0.140:881//kiali/kiali:v1.63 Istio快速入门 #"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2024-08-02 istio部署 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.5ca1226ca4bc0dd491aaddf630a81bb0a439286466552751289bc0088fe6ae58.js integrity="sha256-XKEibKS8DdSRqt32MKgbsKQ5KGRmVSdRKJvACI/mrlg=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-5-7-%E6%8E%A5%E5%8D%95app/>2025-5-7 接单app设计</a></li><li><a href=/docs/2025-5-7-%E5%A5%BD%E5%BF%83%E6%80%81-app/>2025-5-7 好心态 app</a></li><li><a href=/docs/2025-5-29-%E9%94%99%E9%A2%98%E5%88%86%E6%9E%902/>2025-5-29 错题分析2</a></li><li><a href=/docs/2025-5-29-%E9%94%99%E9%A2%98%E5%88%86%E6%9E%901/>2025-5-29 错题分析1</a></li><li><a href=/docs/2025-5-21-ingress%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/>2025-5-29 主Ingress副本变为0后报503问题分析</a></li><li><a href=/docs/2025-4-28-cursor-agent-%E6%8F%90%E7%A4%BA%E5%99%A8/>2025-4-28 cursor agent 提示器</a></li><li><a href=/docs/2025-4-16-%E8%87%AA%E7%A0%94k8s%E5%B9%B3%E5%8F%B0/>2025-4-16 自研k8s平台</a></li><li><a href=/docs/2025-4-16-sleep%E7%9D%A1%E7%9C%A0%E5%BA%94%E7%94%A8/>2025-4-16 sleep睡眠应用</a></li><li><a href=/docs/2025-4-16-paas%E8%AE%BE%E8%AE%A1/>2025-4-16 paas开发记录</a></li><li><a href=/docs/2025-4-16-cursoe-free-vip/>2025-4-16 Cursor Free VIP</a></li><li><a href=/docs/2025-4-16-boss%E7%9B%B4%E8%81%98%E8%87%AA%E5%8A%A8%E6%8A%95%E9%80%92/>2025-4-16 BOSS直聘自动投递</a></li><li><a href=/docs/2025-4-14-github%E6%8E%A8%E9%80%81/>2025-4-14 github推送</a></li><li><a href=/docs/2025-3-30-metallb/>2025-3-30 metallb</a></li><li><a href=/docs/2025-3-24-%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/>2025-3-24 自我介绍</a></li><li><a href=/docs/2025-3-20-victoriametrics-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics高可用架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E6%9E%B6%E6%9E%84/>2025-3-20 victoriametrics 架构</a></li><li><a href=/docs/2025-3-20-victoriametrics%E5%92%8Cthanos%E5%AF%B9%E6%AF%94/>2025-3-20 VictoriaMetrics 和 Thanos 对比</a></li><li><a href=/docs/2025-3-20-thanos%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/>2025-3-20 thanos高可用架构</a></li><li><a href=/docs/2025-3-20-thanos%E6%9E%B6%E6%9E%84/>2025-3-20 thanos架构</a></li><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w pod压测复盘</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 火山云迁移工程师面试记录</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2025-3-14 vivo面试</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s删除pod或deployment的流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s创建pod流程图详解</a></li><li><a href=/docs/2025-2-28-prometheus%E9%A2%98%E7%9B%AE/>2025-2-28 prometheus面试题</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 面试0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 高级运维面试题-linux部分</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 中级运维面试题</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224面试</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 面试0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 面试0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 面试2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8s题目</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 面试0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>2025-2-11 面试2025-02-11</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-07 美国码农计划</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-07 美国码农薪酬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-07 k8s组件</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeasz部署k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 顶级devops工具大盘点</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 清理docker镜像</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 构建容器镜像利器buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 是技术大神还是基础架构部的祸害</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 搭个日志手机系统不香吗</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 我只想做技术 走技术路线</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 常见linux运维面试题</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 大厂总结nginx高并发优化笔记</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 史上最牛jenkins pipeline流水线详解</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEG与istio集成</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginx如何解决惊群效应</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctl检测集群pod间连通性</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linux运维工程师50个常见面试题</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linux系统性能优化 七个实战经验</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awk文本处理器 8个案例</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruise原地升级解析</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8S面试题</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8s背后service是如何工作的</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8S的最后一块拼图</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/ class=active>2024-08-02 istio部署</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfile定制专属镜像</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33款gitops与devops主流系统</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 linux面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-08-01 linux运维面试题</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-08-01 k8s面试题</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruise详细解释以及原地升级及全链路灰度发布方案</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8S之ingress-nginx原理及配置</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 使用cloudflare(CF)搭建dockerhub代理</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-05-01 单master单etcd改造为3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-04-17 面试总结</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 如何为K8S保驾护航</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8S如何获得 IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_status_update.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_control.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_pod_control.go源码解读</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8S调度器 extender.go 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8S控制器之sync.go 同步 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8S控制器之rollback.go 回滚 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8S控制器之recreate.go 重建 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8S控制器之 scheduler.go 调度器 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8S控制器之 rolling.go 滚动更新 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8S控制器之 progress.go 进度 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8S控制器之 deployment_controller.go源码解读</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S 调度器 scheduler_one.go 源码解读</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 彻悟容器网络</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 面试用 Golang 手撸 LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 自动屏蔽IP攻击</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 离线安装kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 磁盘数据恢复</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 清理残留的calico网络插件</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 流量何处来何处去</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 极大提高工作效率的 Linux 命令</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 文学的故乡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 搞懂K8S鉴权</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 容器网络原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 容器的文件系统 OverlayFS 原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 容器原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 容器内的 1 号进程</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 容器中域名解析以及不同dnspolicy对域名解析的影响</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 如何调试 crash 容器的网络</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 如何使用tekton快速搭建CI/CD平台</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 大规模并发下如何加快 Pod 启动速度</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 使用kubernees leases 轻松实现leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 二进制部署K8S加节点操作</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 两张图全面理解K8S原理</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 ssl证书自签发</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheus企业级监控使用总结</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 原理</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux 性能优化大全</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes 证书详解(鉴权)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes 证书详解(认证)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes 源码结构</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekey添加新节点</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8S面试宝典</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8S面试大全</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8s运维之清理磁盘</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8S调试POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8S的POD类型</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8s应用的最佳实践</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8S命令指南</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8S原地升级</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S 探针原理</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S 开发可不止 CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebs原理</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chart和repo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanel网络</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCD稳定性及性能优化实践</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCD备份</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Docker重要的网络知识点</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfile的copy和add的区别</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNS之光</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd 基本操作</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNI插件选型</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go 架构</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go 四种客户端</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICD思考</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calico网络自定义</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acme自动更新证书</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16个概念带你入门 Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 面试0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600条最强linux命令总结</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16张硬核图解k8s网络</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8s之kubelet源码解读</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-03-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-03-08 面试</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2024-03-04 k8s流量链路剖析</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S 流量链路剖析</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSI剖析演进</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNI剖析演进</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2024-03-04 CSI剖析演进</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-03-04 CNI剖析演进</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-02-26 面试</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-02-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-02-22 k8s架构师面试大全</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 使用 OpenFunction 在任何基础设施上运行无服务器工作负载</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 离线安装集群</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 操作系统说明</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 快速指南</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 开始使用 cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 多架构支持</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 公有云上部署</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 个性化集群参数配置</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router 网络组件</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl 命令行介绍</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB 负载均衡部署</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico 配置 BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-安装集群主要插件</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S 集群存储</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-安装网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-安装kube-ovn网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-安装flannel网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-安装cilium网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-安装calico网络组件</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-安装etcd集群</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-集群规划和基础参数设定</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-安装kube_node节点</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-安装kube_master节点</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-安装容器运行时</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-创建证书和环境准备</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 思考</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/2025-4-20-%E6%80%A7%E5%90%8C%E6%84%8Fapp/>2025 4 20 性同意app</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2024-08-02 istio部署</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#istio快速入门>Istio快速入门</a></li><li><a href=#目录>目录</a></li><li><a href=#本节实战>本节实战</a></li><li><a href=#前言>前言</a></li><li><a href=#1安装>1、安装</a></li><li><a href=#安装方式>安装方式</a></li><li><a href=#1使用-istioctl-install>1.使用 istioctl install</a></li><li><a href=#2使用-istioctl-manifest-generate-安装>2.使用 istioctl manifest generate 安装</a></li><li><a href=#3使用-helm-安装>3.使用 Helm 安装</a></li><li><a href=#4使用-istio-operator-安装>4.使用 Istio Operator 安装</a></li><li><a href=#安装-istio>安装 Istio</a></li><li><a href=#-实战istioctl-方式安装istio-2023113测试成功>== 实战：<code>istioctl</code> 方式安装istio-2023.11.3(测试成功)==</a></li><li><a href=#2注入-envoy-sidecar>2、注入 Envoy Sidecar</a></li><li><a href=#1手动注入-sidecar>1.手动注入 Sidecar</a></li><li><a href=#-实战手动注入-envoy-sidecar-2023113测试成功>== 实战：手动注入 Envoy Sidecar-2023.11.3(测试成功)==</a></li><li><a href=#2自定义注入>2.自定义注入</a></li><li><a href=#3自动注入-sidecar>3.自动注入 Sidecar</a></li><li><a href=#-实战自动注入-envoy-sidecar-2023113测试失败>== 实战：自动注入 Envoy Sidecar-2023.11.3(<strong>测试失败</strong>)==</a></li><li><a href=#3bookinfo-示例应用>3、BookInfo 示例应用</a></li><li><a href=#-实战bookinfo-示例应用-2023115测试成功>== 实战：BookInfo 示例应用-2023.11.5(测试成功)==</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><pre tabindex=0><code>[root@master1 istio-1.22.3]# istioctl install --set profile=demo -y

The Kubernetes version v1.23.6 is not supported by Istio 1.22.3. The minimum supported Kubernetes version is 1.26.
Proceeding with the installation, but you might experience problems. See https://istio.io/latest/docs/releases/supported-releases/ for a list of supported versions.

2024-07-30T09:29:52.253698Z     error   klog    an error occurred forwarding 40586 -&gt; 15014: error forwarding port 15014 to pod 8835fe7129746ef5df21abaf44c2d302f16012ae2c6e03c1103c5b8d8aff680c, uid : unable to do port forwarding: socat not found
2024-07-30T09:29:52.254140Z     error   port forward failed: lost connection to pod
The default revision has been updated to point to this installation.
✔ Istio core installed
✔ Istiod installed
✔ Egress gateways installed
✔ Ingress gateways installed
✔ Installation complete                                                                                                                                                       Made this installation the default for injection and validation.
[root@master1 istio-1.22.3]#
</code></pre><pre tabindex=0><code>quay.io/kiali/kiali:v1.63
jimmidyson/configmap-reload:v0.5.0
</code></pre><pre tabindex=0><code>#原镜像
quay.io/kiali/kiali:v1.63

#转换后镜像
anjia0532/quay.kiali.kiali:v1.63


#下载并重命名镜像
docker pull anjia0532/quay.kiali.kiali:v1.63 

docker tag  anjia0532/quay.kiali.kiali:v1.63 quay.io/kiali/kiali:v1.63

docker images | grep $(echo quay.io/kiali/kiali:v1.63 |awk -F&#39;:&#39; &#39;{print $1}&#39;)


docker tag  cloudsx.top/anjia0532/quay.kiali.kiali:v1.63  192.168.0.140:881//kiali/kiali:v1.63
</code></pre><h3 id=istio快速入门>Istio快速入门
<a class=anchor href=#istio%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8>#</a></h3><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311104774.png alt=image-20240731110412591></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311104524.png alt=image-20240731110441432></p><h3 id=目录>目录
<a class=anchor href=#%e7%9b%ae%e5%bd%95>#</a></h3><p>[toc]</p><h3 id=本节实战>本节实战
<a class=anchor href=#%e6%9c%ac%e8%8a%82%e5%ae%9e%e6%88%98>#</a></h3><table><thead><tr><th>实战名称</th></tr></thead><tbody><tr><td>实战：istioctl 方式安装istio-2023.11.3(测试成功)</td></tr><tr><td>实战：手动注入 Envoy Sidecar-2023.11.3(测试成功)</td></tr><tr><td>实战：自动注入 Envoy Sidecar-2023.11.3(测试失败)</td></tr><tr><td>实战：BookInfo 示例应用-2023.11.5(测试成功)</td></tr></tbody></table><h3 id=前言>前言
<a class=anchor href=#%e5%89%8d%e8%a8%80>#</a></h3><p>前面在服务网格基础章节我们和大家已经了解了 Istio 的基本概念以及架构，本章节我们将来快速了解 Istio 的基本使用方法，对 Istio 有一个最基本的认识。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311105754.png alt=image-20240731110511645></p><h3 id=1安装>1、安装
<a class=anchor href=#1%e5%ae%89%e8%a3%85>#</a></h3><p>安装 Istio 之前，需要准备一个 Kubernetes 集群，我们可以使用任何支持的平台，例如 Minikube、Kind、Kubeadm 等，但是需要注意的是目前的 Istio 最新版本为 v1.19.3 版本，不同的版本支持的 Kubernetes 版本不同，可以参考下表进行对照：</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311105504.png alt=image-20240731110529418></p><p>我们这里选择最新的版本为 v1.19.3，Kubernetes 版本为 v1.27.6：</p><h3 id=安装方式>安装方式
<a class=anchor href=#%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f>#</a></h3><p>在 Kubernetes 集群上安装 Istio 的方法有很多方式，可以根据自己的需求选择不同的安装方式，我们可以先对比下每种方式的优缺点。</p><h3 id=1使用-istioctl-install>1.使用 istioctl install
<a class=anchor href=#1%e4%bd%bf%e7%94%a8-istioctl-install>#</a></h3><p>具有高安全性、简单的安装和管理方法，<strong>这也是社区推荐的安装方法。</strong></p><ul><li>优点:</li><li>完整的配置和运行状态的验证。</li><li>使用提供了扩展的配置、自定义选项的 <code>IstioOperator</code> API。</li><li>不需要集群内的高权限 Pod，通过执行 <code>istioctl</code> 命令修改。</li><li>缺点:</li><li>需要维护多个 Istio 版本的二进制文件。</li><li><code>istioctl</code> 命令可能根据你的运行环境设置诸如 <code>JWT_POLICY</code> 之类的值，从而在不同的 Kubernetes 环境中产生不同的安装结果。</li></ul><blockquote><p>整体来说，这里的缺点对我们可能影响不大。</p></blockquote><h3 id=2使用-istioctl-manifest-generate-安装>2.使用 istioctl manifest generate 安装
<a class=anchor href=#2%e4%bd%bf%e7%94%a8-istioctl-manifest-generate-%e5%ae%89%e8%a3%85>#</a></h3><p>生成 Kubernetes 的配置清单，并通过 <code>kubectl apply --prune</code> 命令应用到集群中。该方法适用于需要严格审查或者增加配置清单的情况。</p><ul><li>优点:</li><li>Chart 是由与 <code>istioctl install</code> 和 Operator 里使用的相同的 <code>IstioOperator</code> API 生成的。</li><li>使用提供了扩展的配置、自定义选项的 <code>IstioOperator</code> API。</li><li>缺点:</li><li>一些在 <code>istioctl install</code> 和 Operator 中会进行的检查将不会执行。</li><li>与 <code>istioctl install</code> 相比，UX 不够简洁。</li><li>错误反馈没有 <code>istioctl install</code> 的详细、全面。</li></ul><h3 id=3使用-helm-安装>3.使用 Helm 安装
<a class=anchor href=#3%e4%bd%bf%e7%94%a8-helm-%e5%ae%89%e8%a3%85>#</a></h3><p>使用 Helm 的 Chart 可以通过 Helm 的工作流轻松的完成，并在升级的过程中自动清理资源。</p><ul><li>优点:</li><li>使用熟悉、常用的行业标准工具。</li><li>Helm 原生的版本、升级管理。</li><li>缺点:</li><li>相比于 <code>istioctl install</code> 和 Operator 相比，检查较少。</li><li>一些管理任务需要更多步骤，具有更高的复杂性。</li></ul><h3 id=4使用-istio-operator-安装>4.使用 Istio Operator 安装
<a class=anchor href=#4%e4%bd%bf%e7%94%a8-istio-operator-%e5%ae%89%e8%a3%85>#</a></h3><p>不建议在新安装时使用 Operator，虽然 Operator 将继续得到支持，但新的功能特性不会被优先考虑。</p><p>Istio Operator 提供了一种安装路径，无需使用 <code>istioctl</code> 二进制文件。这可以用于简化升级工作流程，不必担心在集群中运行特权控制器的问题。此方法适用于不需要严格审计或增加输出清单的情况。</p><ul><li>优点:</li><li>与 <code>istioctl install</code> 相同的 API，但通过集群中的控制器 Pod 进行操作，实现了完全声明式操作。</li><li><code>IstioOperator API</code> 提供了广泛的配置/定制选项。</li><li>不需要管理多个 <code>istioctl</code> 二进制文件。</li><li>缺点:</li><li>集群中运行的高权限控制器存在安全风险。</li></ul><h3 id=安装-istio>安装 Istio
<a class=anchor href=#%e5%ae%89%e8%a3%85-istio>#</a></h3><h3 id=-实战istioctl-方式安装istio-2023113测试成功>== 实战：<code>istioctl</code> 方式安装istio-2023.11.3(测试成功)==
<a class=anchor href=#-%e5%ae%9e%e6%88%98istioctl-%e6%96%b9%e5%bc%8f%e5%ae%89%e8%a3%85istio-2023113%e6%b5%8b%e8%af%95%e6%88%90%e5%8a%9f>#</a></h3><p>实验环境：</p><pre tabindex=0><code>k8s v1.25.4（containerd://1.6.10）

[root@master1 ~]#istioctl version
client version: 1.19.3
control plane version: 1.19.3
data plane version: 1.19.3 (8 proxies)
</code></pre><p>实验软件：</p><p>链接：<a href="https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA%3Fpwd%3D7yqb">https://pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA?pwd=7yqb</a> 提取码：7yqb <code>2023.11.5-实战：BookInfo 示例应用-2023.11.5(测试成功)</code> （使用的是同一个软件包）</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311106624.png alt=image-20240731110615554></p><p>上面我们对几种方式做了简单的对比，具体选择哪种方式安装需要结合自己的情况来决定。我们这里就选择社区推荐的 <code>istioctl</code> 方式进行安装。</p><p>首先前往 <a href="https://link.zhihu.com/?target=https%3A//github.com/istio/istio/releases/tag/1.19.3">Istio Release</a> 页面下载适合你操作系统的安装文件，或使用下面的命令自动下载并解压最新版本（Linux 或 macOS）：</p><pre tabindex=0><code>curl -L https://istio.io/downloadIstio | sh -
#!/bin/sh

# Copyright Istio Authors
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#
# This file will be fetched as: curl -L https://git.io/getLatestIstio | sh -
# so it should be pure bourne shell, not bash (and not reference other scripts)
#
# The script fetches the latest Istio release candidate and untars it.
# You can pass variables on the command line to download a specific version
# or to override the processor architecture. For example, to download
# Istio 1.6.8 for the x86_64 architecture and linux OS,
# run curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.6.8 TARGET_ARCH=x86_64 TARGET_OS=Linux sh -.

set -e

# Determines the operating system.
OS=&#34;${TARGET_OS:-$(uname)}&#34;
if [ &#34;${OS}&#34; = &#34;Darwin&#34; ] ; then
  OSEXT=&#34;osx&#34;
else
  OSEXT=&#34;linux&#34;
fi

# Determine the latest Istio version by version number ignoring alpha, beta, and rc versions.
if [ &#34;${ISTIO_VERSION}&#34; = &#34;&#34; ] ; then
  ISTIO_VERSION=&#34;$(curl -sL https://github.com/istio/istio/releases | \
                  grep -o &#39;releases/[0-9]*.[0-9]*.[0-9]*/&#39; | sort -V | \
                  tail -1 | awk -F&#39;/&#39; &#39;{ print $2}&#39;)&#34;
  ISTIO_VERSION=&#34;${ISTIO_VERSION##*/}&#34;
fi

LOCAL_ARCH=$(uname -m)
if [ &#34;${TARGET_ARCH}&#34; ]; then
    LOCAL_ARCH=${TARGET_ARCH}
fi

case &#34;${LOCAL_ARCH}&#34; in
  x86_64|amd64)
    ISTIO_ARCH=amd64
    ;;
  armv8*|aarch64*|arm64)
    ISTIO_ARCH=arm64
    ;;
  armv*)
    ISTIO_ARCH=armv7
    ;;
  *)
    echo &#34;This system&#39;s architecture, ${LOCAL_ARCH}, isn&#39;t supported&#34;
    exit 1
    ;;
esac

if [ &#34;${ISTIO_VERSION}&#34; = &#34;&#34; ] ; then
  printf &#34;Unable to get latest Istio version. Set ISTIO_VERSION env var and re-run. For example: export ISTIO_VERSION=1.0.4&#34;
  exit 1;
fi

NAME=&#34;istio-$ISTIO_VERSION&#34;
URL=&#34;https://github.com/istio/istio/releases/download/${ISTIO_VERSION}/istio-${ISTIO_VERSION}-${OSEXT}.tar.gz&#34;
ARCH_URL=&#34;https://github.com/istio/istio/releases/download/${ISTIO_VERSION}/istio-${ISTIO_VERSION}-${OSEXT}-${ISTIO_ARCH}.tar.gz&#34;

with_arch() {
  printf &#34;\nDownloading %s from %s ...\n&#34; &#34;$NAME&#34; &#34;$ARCH_URL&#34;
  if ! curl -o /dev/null -sIf &#34;$ARCH_URL&#34;; then
    printf &#34;\n%s is not found, please specify a valid ISTIO_VERSION and TARGET_ARCH\n&#34; &#34;$ARCH_URL&#34;
    exit 1
  fi
  curl -fsLO &#34;$ARCH_URL&#34;
  filename=&#34;istio-${ISTIO_VERSION}-${OSEXT}-${ISTIO_ARCH}.tar.gz&#34;
  tar -xzf &#34;${filename}&#34;
  rm &#34;${filename}&#34;
}

without_arch() {
  printf &#34;\nDownloading %s from %s ...&#34; &#34;$NAME&#34; &#34;$URL&#34;
  if ! curl -o /dev/null -sIf &#34;$URL&#34;; then
    printf &#34;\n%s is not found, please specify a valid ISTIO_VERSION\n&#34; &#34;$URL&#34;
    exit 1
  fi
  curl -fsLO &#34;$URL&#34;
  filename=&#34;istio-${ISTIO_VERSION}-${OSEXT}.tar.gz&#34;
  tar -xzf &#34;${filename}&#34;
  rm &#34;${filename}&#34;
}

# Istio 1.6 and above support arch
# Istio 1.5 and below do not have arch support
ARCH_SUPPORTED=&#34;1.6&#34;
# Istio 1.10 and above support arch for osx arm64
ARCH_SUPPORTED_OSX=&#34;1.10&#34;

if [ &#34;${OS}&#34; = &#34;Linux&#34; ] ; then
  # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED (version-sort&#39;s before it)
  if [ &#34;$(printf &#39;%s\n%s&#39; &#34;${ARCH_SUPPORTED}&#34; &#34;${ISTIO_VERSION}&#34; | sort -V | head -n 1)&#34; = &#34;${ISTIO_VERSION}&#34; ]; then
    without_arch
  else
    with_arch
  fi
elif [ &#34;${OS}&#34; = &#34;Darwin&#34; ] ; then
  # This checks if ISTIO_VERSION is less than ARCH_SUPPORTED_OSX (version-sort&#39;s before it) or ISTIO_ARCH not equal to arm64
  if [ &#34;$(printf &#39;%s\n%s&#39; &#34;${ARCH_SUPPORTED_OSX}&#34; &#34;${ISTIO_VERSION}&#34; | sort -V | head -n 1)&#34; = &#34;${ISTIO_VERSION}&#34; ] || [ &#34;${ISTIO_ARCH}&#34; != &#34;arm64&#34; ]; then
    without_arch
  else
    with_arch
  fi
else
  printf &#34;\n\n&#34;
  printf &#34;Unable to download Istio %s at this moment!\n&#34; &#34;$ISTIO_VERSION&#34;
  printf &#34;Please verify the version you are trying to download.\n\n&#34;
  exit 1
fi

printf &#34;&#34;
printf &#34;\nIstio %s Download Complete!\n&#34; &#34;$ISTIO_VERSION&#34;
printf &#34;\n&#34;
printf &#34;Istio has been successfully downloaded into the %s folder on your system.\n&#34; &#34;$NAME&#34;
printf &#34;\n&#34;
BINDIR=&#34;$(cd &#34;$NAME/bin&#34; &amp;&amp; pwd)&#34;
printf &#34;Next Steps:\n&#34;
printf &#34;See https://istio.io/latest/docs/setup/install/ to add Istio to your Kubernetes cluster.\n&#34;
printf &#34;\n&#34;
printf &#34;To configure the istioctl client tool for your workstation,\n&#34;
printf &#34;add the %s directory to your environment path variable with:\n&#34; &#34;$BINDIR&#34;
printf &#34;\t export PATH=\&#34;\$PATH:%s\&#34;\n&#34; &#34;$BINDIR&#34;
printf &#34;\n&#34;
printf &#34;Begin the Istio pre-installation check by running:\n&#34;
printf &#34;\t istioctl x precheck \n&#34;
printf &#34;\n&#34;
printf &#34;Need more information? Visit https://istio.io/latest/docs/setup/install/ \n&#34;
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311106270.png alt=image-20240731110639175></p><p>但是上面方式默认也是走 github 下载，国内访问 github 速度比较慢（也可能根本下载不了），所有我们可以自己去下载安装文件包，下载完成后解压，将解压后的 <code>istioctl</code> 文件移动到 <code>/usr/local/bin</code> 目录下：</p><pre tabindex=0><code># wget https://ghps.cc/https://github.com/istio/istio/releases/download/1.19.3/istio-1.19.3-linux-amd64.tar.gz
$ wget https://github.com/istio/istio/releases/download/1.19.3/istio-1.19.3-linux-amd64.tar.gz
$ tar -xvf istio-1.19.3-linux-amd64.tar.gz
$ mv istio-1.19.3/bin/istioctl /usr/local/bin/
$ istioctl version
no ready Istio pods in &#34;istio-system&#34;
1.19.3
</code></pre><p>能执行 <code>istioctl</code> 命令说明安装成功，但是提示 <code>no ready Istio pods in "istio-system"</code>，这是因为我们还没有安装 Istio，接下来我们就来安装 Istio。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311107564.png alt=image-20240731110744484></p><p><code>istioctl</code> 工具中内置了一些安装配置文件，这些配置文件提供了对 Istio 控制平面和 Istio 数据平面 Sidecar 的定制内容。我们可以通过 <code>istioctl profile list</code> 命令查看：</p><pre tabindex=0><code>$ istioctl profile list
Istio configuration profiles:
    ambient
    default
    demo
    empty
    external
    minimal
    openshift
    preview
    remote
</code></pre><p>我们可以从其中一个 Istio 内置配置文件开始入手， 然后根据特定需求进一步自定义配置文件。</p><ul><li><code>default</code>：根据 <code>IstioOperator API</code> 的默认配置启动组件。建议将此配置文件用于生产部署和多集群网格中的主集群，我们可以运行 <code>istioctl profile dump</code> 命令来查看默认设置，如下所示其实就是一个 <code>IstioOperator</code> 的配置文件：</li></ul><blockquote><p>注意：这里的IstioOperator和我们之前k8s里Operator不一样，这里没有直接的控制器，它是通过istioctl命令来做的一些解析。
istioctl 能够识别的一个安装配置文件，只是这个配置文件采用了类似于K8s CRD的方式来声明而已，并没有对应的控制器Pod。</p></blockquote><pre tabindex=0><code>#istioctl profile dump default
$ istioctl profile dump
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    base:
      enabled: true
    cni:
      enabled: false
    egressGateways:
    - enabled: false
      name: istio-egressgateway
    ingressGateways:
    - enabled: true
      name: istio-ingressgateway
    istiodRemote:
      enabled: false
    pilot:
      enabled: true
  hub: docker.io/istio
  meshConfig:
    defaultConfig:
      proxyMetadata: {}
    enablePrometheusMerge: true
  profile: default
  tag: 1.19.3
  values:
    base:
      enableCRDTemplates: false
      validationURL: &#34;&#34;
    defaultRevision: &#34;&#34;
    gateways:
      istio-egressgateway:
        autoscaleEnabled: true
        env: {}
        name: istio-egressgateway
        secretVolumes:
        - mountPath: /etc/istio/egressgateway-certs
          name: egressgateway-certs
          secretName: istio-egressgateway-certs
        - mountPath: /etc/istio/egressgateway-ca-certs
          name: egressgateway-ca-certs
          secretName: istio-egressgateway-ca-certs
        type: ClusterIP
      istio-ingressgateway:
        autoscaleEnabled: true
        env: {}
        name: istio-ingressgateway
        secretVolumes:
        - mountPath: /etc/istio/ingressgateway-certs
          name: ingressgateway-certs
          secretName: istio-ingressgateway-certs
        - mountPath: /etc/istio/ingressgateway-ca-certs
          name: ingressgateway-ca-certs
          secretName: istio-ingressgateway-ca-certs
        type: LoadBalancer
    global:
      configValidation: true
      defaultNodeSelector: {}
      defaultPodDisruptionBudget:
        enabled: true
      defaultResources:
        requests:
          cpu: 10m
      imagePullPolicy: &#34;&#34;
      imagePullSecrets: []
      istioNamespace: istio-system
      istiod:
        enableAnalysis: false
      jwtPolicy: third-party-jwt
      logAsJson: false
      logging:
        level: default:info
      meshNetworks: {}
      mountMtlsCerts: false
      multiCluster:
        clusterName: &#34;&#34;
        enabled: false
      network: &#34;&#34;
      omitSidecarInjectorConfigMap: false
      oneNamespace: false
      operatorManageWebhooks: false
      pilotCertProvider: istiod
      priorityClassName: &#34;&#34;
      proxy:
        autoInject: enabled
        clusterDomain: cluster.local
        componentLogLevel: misc:error
        enableCoreDump: false
        excludeIPRanges: &#34;&#34;
        excludeInboundPorts: &#34;&#34;
        excludeOutboundPorts: &#34;&#34;
        image: proxyv2
        includeIPRanges: &#39;*&#39;
        logLevel: warning
        privileged: false
        readinessFailureThreshold: 30
        readinessInitialDelaySeconds: 1
        readinessPeriodSeconds: 2
        resources:
          limits:
            cpu: 2000m
            memory: 1024Mi
          requests:
            cpu: 100m
            memory: 128Mi
        statusPort: 15020
        tracer: zipkin
      proxy_init:
        image: proxyv2
      sds:
        token:
          aud: istio-ca
      sts:
        servicePort: 0
      tracer:
        datadog: {}
        lightstep: {}
        stackdriver: {}
        zipkin: {}
      useMCP: false
    istiodRemote:
      injectionURL: &#34;&#34;
    pilot:
      autoscaleEnabled: true
      autoscaleMax: 5
      autoscaleMin: 1
      configMap: true
      cpu:
        targetAverageUtilization: 80
      env: {}
      image: pilot
      keepaliveMaxServerConnectionAge: 30m
      nodeSelector: {}
      podLabels: {}
      replicaCount: 1
      traceSampling: 1
    telemetry:
      enabled: true
      v2:
        enabled: true
        metadataExchange:
          wasmEnabled: false
        prometheus:
          enabled: true
          wasmEnabled: false
        stackdriver:
          configOverride: {}
          enabled: false
          logging: false
          monitoring: false
          topology: false
</code></pre><ul><li><code>demo</code>：这个配置旨在展示 Istio 功能，具有适度的资源要求。它适合运行官方的 Bookinfo 示例应用和相关任务，比较适合用于快速入门的安装配置，比如我们这里就可以使用该配置。此配置文件启用了高级别的追踪和访问日志，因此不适合进行性能测试。我们也可以使用 <code>istioctl profile dump demo</code> 命令来查看该配置文件的具体配置资源对象。</li><li><code>minimal</code>：与默认配置文件相同，但只安装了控制平面组件。这样我们就可以使用单独的配置文件来配置控制平面和数据平面组件（例如网关）。</li><li><code>remote</code>：用于配置一个远程集群， 这个从集群由外部控制平面管理， 或者由多集群网格的主集群中的控制平面管理。</li><li><code>empty</code>：不部署任何内容，可以作为自定义配置的基本配置文件。</li><li><code>preview</code>：预览文件包含的功能都属于实验性阶段。该配置文件是为了探索 Istio 的新功能。确保稳定性、安全性和性能（使用风险需自负）。</li><li><code>ambient</code>：Ambient 配置文件用于帮助开始使用 <code>Ambient Mesh</code>。需要注意的是 Ambient 目前处于 Alpha 状态。请勿在生产环境中使用 Ambient 模式。</li><li><code>openshift</code>：用于在 OpenShift 上安装 Istio。</li></ul><p>标注 <code>✔</code> 的组件安装在每个配置文件中：</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311108095.png alt=image-20240731110820945></p><p>除了安装 Istio 内置的配置之外，<code>istioctl install</code> 还提供了一套完整的用于定制配置的 API - <a href="https://link.zhihu.com/?target=https%3A//istio.io/latest/zh/docs/reference/config/istio.operator.v1alpha1/">IstioOperator API</a>。</p><p>此 API 中的配置参数可以使用命令行选项 <code>--set</code> 进行独立设置，比如要在 <code>default</code> 配置中启动 <code>debug</code> 的日志特性，我们可以使用下面的命令：</p><pre tabindex=0><code>$ istioctl install --set values.global.logging.level=debug
</code></pre><p>或者，可以在 YAML 文件中指定 <code>IstioOperator</code> 的配置，然后用 <code>-f</code> 选项传递给 <code>istioctl</code> 即可：</p><pre tabindex=0><code>$ istioctl install -f samples/operator/pilot-k8s.yaml
</code></pre><p><code>IstioOperator API</code> 定义主要包括如下几个组件：</p><ul><li><code>base</code></li><li><code>pilot</code></li><li><code>ingressGateways</code></li><li><code>egressGateways</code></li><li><code>cni</code></li><li><code>istiodRemote</code></li></ul><p>针对每一个组件的配置内容通过 <code>components.&lt;component name></code> 下的 API 中提供。例如，要用 API 更改 <code>pilot</code> 组件的 <code>enabled</code> 设置， 可以使用 <code>--set components.pilot.enabled=false</code> 命令，或在 <code>IstioOperator</code> 资源中设置：</p><pre tabindex=0><code>apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    pilot:
      enabled: false
</code></pre><p>这样安装后就不会启动 <code>pilot</code> 组件了。</p><p>所有的组件共享一个通用 API，用来修改 Kubernetes 特定的设置，它在 <code>components.&lt;component name>.k8s</code> 路径下，它允许修改如下设置：</p><ul><li>Resources</li><li>Readiness probes</li><li>Replica count</li><li>HorizontalPodAutoscaler</li><li>PodDisruptionBudget</li><li>Pod annotations</li><li>Service annotations</li><li>ImagePullPolicy</li><li>Priority class name</li><li>Node selector</li><li>Affinity and anti-affinity</li><li>Service</li><li>Toleration</li><li>Strategy</li><li>Env</li><li>Pod security context</li></ul><p>所有这些 Kubernetes 设置也就是平时我们使用的 Kubernetes API 定义，配置方式完全一样。比如我们要调整 Pilot 组件的资源限制和 Pod 水平伸缩，可以用如下所示的配置：</p><pre tabindex=0><code>apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    pilot:
      k8s:
        resources:
          requests:
            cpu: 1000m # 覆盖默认的 500m
            memory: 4096Mi # ... 默认 2048Mi
        hpaSpec:
          maxReplicas: 10 # ... 默认 5
          minReplicas: 2 # ... 默认 1
</code></pre><p>然后我们就可以直接使用 <code>istioctl install</code> 把改变的设置应用到集群：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ istioctl install -f samples/operator/pilot-k8s.yaml
</span></span></code></pre></div><p>了解了 Istio 安装的基本概念之后，我们就可以开始安装 Istio 了，我们这里选择 <code>demo</code> 配置文件进行安装，选择它是因为它包含了一组专为测试准备的功能集合，另外还有用于生产或性能测试的配置组合。</p><p>执行下面的命令即可：</p><pre tabindex=0><code>$ istioctl install --set profile=demo -y
✔ Istio core installed
✔ Istiod installed
✔ Egress gateways installed
✔ Ingress gateways installed
✔ Installation complete
Made this installation the default for injection and validation.
</code></pre><p>可以看到上面的 <code>demo</code> 配置应用后，启用了 <code>Istio core</code>、<code>Istiod</code>、<code>Egress gateways</code>、<code>Ingress gateways</code> 几个组件，这些组件都是通过 <code>IstioOperator</code> API 进行配置的。</p><p>安装完成后会自动创建一个 <code>istio-system</code> 命名空间，包含如下几个 Pod，分别对应上面的几个组件：</p><pre tabindex=0><code>[root@master1 ~]#kubectl get po -nistio-system
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311111062.png alt=image-20240731111118930></p><p>这其实也和 Istio 架构中的组件是一一对应的，我们可以再看下 Istio 架构图：</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311111036.png alt=image-20240731111130812></p><ul><li><code>istio-egressgateway</code>：出口网关，用于处理出站流量。</li><li><code>istio-ingressgateway</code>：入口网关，用于处理入站流量，接收传入的 HTTP/TCP 连接。</li><li><code>istiod</code>：Istio 控制平面，用于管理和配置数据平面，提供服务网格的核心功能。</li></ul><blockquote><p>当然安装后并没有出现架构图上面的数据平面相关组件，这是因为数据平面的 Envoy Sidecar 代理是伴随应用 Pod 一起的，所以需要部署应用后才会出现。</p></blockquote><p>安装成功。</p><h3 id=2注入-envoy-sidecar>2、注入 Envoy Sidecar
<a class=anchor href=#2%e6%b3%a8%e5%85%a5-envoy-sidecar>#</a></h3><p>要为应用注入 Envoy Sidecar 代理有几种方法：</p><h3 id=1手动注入-sidecar>1.手动注入 Sidecar
<a class=anchor href=#1%e6%89%8b%e5%8a%a8%e6%b3%a8%e5%85%a5-sidecar>#</a></h3><h3 id=-实战手动注入-envoy-sidecar-2023113测试成功>== 实战：手动注入 Envoy Sidecar-2023.11.3(测试成功)==
<a class=anchor href=#-%e5%ae%9e%e6%88%98%e6%89%8b%e5%8a%a8%e6%b3%a8%e5%85%a5-envoy-sidecar-2023113%e6%b5%8b%e8%af%95%e6%88%90%e5%8a%9f>#</a></h3><p>实验环境：</p><pre tabindex=0><code>k8s v1.25.4（containerd://1.6.10）

[root@master1 ~]#istioctl version
client version: 1.19.3
control plane version: 1.19.3
data plane version: 1.19.3 (8 proxies)
</code></pre><p>实验软件：</p><p>链接：<a href="https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA%3Fpwd%3D7yqb">https://pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA?pwd=7yqb</a> 提取码：7yqb <code>2023.11.5-实战：BookInfo 示例应用-2023.11.5(测试成功)</code> （使用的是同一个软件包）</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311111688.png alt=image-20240731111150597></p><p>默认的测试demo如下位置：</p><pre tabindex=0><code>[root@master1 ~]#cat istio-1.19.3/samples/sleep/sleep.yaml
# Copyright Istio Authors
#
#   Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

##################################################################################################
# Sleep service
##################################################################################################
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sleep
---
apiVersion: v1
kind: Service
metadata:
  name: sleep
  labels:
    app: sleep
    service: sleep
spec:
  ports:
  - port: 80
    name: http
  selector:
    app: sleep
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sleep
spec:
  replicas: 1
  selector:
    matchLabels:
      app: sleep
  template:
    metadata:
      labels:
        app: sleep
    spec:
      terminationGracePeriodSeconds: 0
      serviceAccountName: sleep
      containers:
      - name: sleep
        image: curlimages/curl
        command: [&#34;/bin/sleep&#34;, &#34;infinity&#34;]
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - mountPath: /etc/sleep/tls
          name: secret-volume
      volumes:
      - name: secret-volume
        secret:
          secretName: sleep-secret
          optional: true
---
[root@master1 ~]#
</code></pre><p>先来部署这个应用</p><pre tabindex=0><code>[root@master1 ~]#kubectl  apply -f istio-1.19.3/samples/sleep/sleep.yaml
serviceaccount/sleep created
service/sleep created
deployment.apps/sleep created

[root@master1 ~]#kubectl get po -l app=sleep
NAME                     READY   STATUS    RESTARTS   AGE
sleep-78ff5975c6-ftlzx   1/1     Running   0          46s
</code></pre><p>这是一个正常应用的状态。</p><p>比如我们为一个 Deployment 手动注入 Sidecar，可以使用下面的方法：</p><pre tabindex=0><code># istio-1.19.3 目录下
$ istioctl kube-inject -f samples/sleep/sleep.yaml | kubectl apply -f -
serviceaccount/sleep created
service/sleep created
deployment.apps/sleep created
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311112290.png alt=image-20240731111228155></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311112257.png alt=image-20240731111237103></p><p>默认情况下 Pod 的注入是基于 <strong>Sidecar 注入模板</strong>，在 <code>istio-sidecar-injector</code> Configmap 中配置，我们可以将配置导出到本地，然后手动指定注入也可以：</p><pre tabindex=0><code>$ kubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath=&#39;{.data.config}&#39; &gt; inject-config.yaml
$ kubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath=&#39;{.data.values}&#39; &gt; inject-values.yaml
$ kubectl -n istio-system get configmap istio -o=jsonpath=&#39;{.data.mesh}&#39; &gt; mesh-config.yaml
</code></pre><p>然后指定输入文件，运行 kube-inject 并部署应用即可：</p><pre tabindex=0><code>$ istioctl kube-inject \
    --injectConfigFile inject-config.yaml \
    --meshConfigFile mesh-config.yaml \
    --valuesFile inject-values.yaml \
    --filename samples/sleep/sleep.yaml \
    | kubectl apply -f -
</code></pre><p>正常部署后我们的应用 Pod 中会多出一个 Sidecar 容器：</p><pre tabindex=0><code>[root@master1 istio-1.19.3]#kubectl get po -l app=sleep
NAME                     READY   STATUS    RESTARTS   AGE
sleep-7cbcd885cf-6j4bt   2/2     Running   0          2m8s
[root@master1 istio-1.19.3]#
</code></pre><p><strong>这个容器就是 Envoy Sidecar 代理。</strong></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311113215.png alt=image-20240731111329086></p><p>这个 Envoy Sidecar 代理，它会和应用 Pod 一起运行，用来代理整个应用的流量，当然整体控制都是由 Istio 控制平面来决定的。而 Istio 控制平面实现了 Envoy 的控制平面接口，可以动态下发修改 Envoy 的配置，这样我们就可以去操控这些 Envoy Sidecar 了，这是不是和我们前面讲解的 Envoy 基于 API 的动态配置部分就关联起来了，所以我们说需要先熟悉 Envoy，然后再来学习 Istio 效果会更好。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311113940.png alt=image-20240731111348816></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311114902.png alt=image-20240731111402796></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311114649.png alt=image-20240731111421496></p><p>测试完成。</p><h3 id=2自定义注入>2.自定义注入
<a class=anchor href=#2%e8%87%aa%e5%ae%9a%e4%b9%89%e6%b3%a8%e5%85%a5>#</a></h3><p>上面我们了解到 Pod 的注入是基于 <code>istio-sidecar-injector</code> 这个 Configmap 模板的，同样的我们也可以自行定义注入 Sidecar 代理。我们可以通过在 Pod 中手动添加一个 <code>istio-proxy</code> 容器来完成，Sidecar 注入将会把自定义的任何配置视为默认注入模板的覆盖。</p><p>自定义这些设置时，需格外小心，因为允许完全自定义生成的 Pod，包括进行一些更改而导致 Sidecar 容器无法正常运行。</p><p>例如，以下配置可自定义各种设置，包括降低 CPU 请求，添加 Volume 挂载，和添加 preStop Hook：</p><pre tabindex=0><code>apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: hello
      image: alpine
    - name: istio-proxy # 这个容器名需要叫 istio-proxy
      image: auto # 设置为 auto，自动选择要使用的 Image
      resources:
        requests:
          cpu: &#34;100m&#34;
      volumeMounts:
        - mountPath: /etc/certs
          name: certs
      lifecycle:
        preStop:
          exec:
            command: [&#34;sleep&#34;, &#34;10&#34;]
  volumes:
    - name: certs
      secret:
        secretName: istio-certs
</code></pre><p>一般来说 Pod 中的任何字段我们都可以配置，但是必须注意某些字段：</p><ul><li>Kubernetes 要求在注入运行之前配置 image，虽然可以可以设置一个指定的 Image 来覆盖默认的 image 配置，但建议将 image 设置为 <code>auto</code>，可使 Sidecar 注入自动选择要使用的 Image。</li><li>Pod 中一些字段取决于相关设置。例如，CPU 请求必须小于 CPU 限制。</li></ul><h3 id=3自动注入-sidecar>3.自动注入 Sidecar
<a class=anchor href=#3%e8%87%aa%e5%8a%a8%e6%b3%a8%e5%85%a5-sidecar>#</a></h3><h3 id=-实战自动注入-envoy-sidecar-2023113测试失败>== 实战：自动注入 Envoy Sidecar-2023.11.3(<strong>测试失败</strong>)==
<a class=anchor href=#-%e5%ae%9e%e6%88%98%e8%87%aa%e5%8a%a8%e6%b3%a8%e5%85%a5-envoy-sidecar-2023113%e6%b5%8b%e8%af%95%e5%a4%b1%e8%b4%a5>#</a></h3><blockquote><p>自己在测试时，出现了问题，这里后续搭建v1.27.6k8s集群来测试。</p></blockquote><p>上面我们介绍了手动注入和自定义注入两种方式，这些都是需要我们手动去操作的，此外我们也可以通过配置实现自动注入，这样我们就不需要手动去注入了，Istio 提供了一个 Kubernetes 准入控制器，它可以自动注入 Sidecar 代理，我们只需要为命名空间设置 <code>istio-injection=enabled</code> 标签即可启用自动注入。</p><p>比如我们先在集群中部署 sleep 应用：（测试之前记得先删除先前的测试demo）</p><pre tabindex=0><code>#在目录istio-1.19.3下
[root@master1 istio-1.19.3]#kubectl apply -f samples/sleep/sleep.yaml
serviceaccount/sleep unchanged
service/sleep unchanged
deployment.apps/sleep created
[root@master1 istio-1.19.3]#kubectl get deploy
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
sleep   1/1     1            1           22s
web     1/1     1            1           6d4h
[root@master1 istio-1.19.3]#kubectl get pod -l app=sleep
NAME                     READY   STATUS    RESTARTS   AGE
sleep-78ff5975c6-v62sv   1/1     Running   0          31s
</code></pre><p>目前我们的 sleep 应用是没有注入 Sidecar 的，只有 1 个容器。</p><p>现在我们可以为 <code>default</code> 命名空间打上 <code>istio-injection=enabled</code> 标签：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@master1 istio-1.19.3<span style=color:#f92672>]</span><span style=color:#75715e>#kubectl label namespace default istio-injection=enabled --overwrite</span>
</span></span><span style=display:flex><span>namespace/default labeled
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@master1 istio-1.19.3<span style=color:#f92672>]</span><span style=color:#75715e>#kubectl get namespace -L istio-injection</span>
</span></span><span style=display:flex><span>NAME                   STATUS   AGE    ISTIO-INJECTION
</span></span><span style=display:flex><span>default                Active   6d4h   enabled
</span></span><span style=display:flex><span>istio-system           Active   8h     
</span></span><span style=display:flex><span>kube-flannel           Active   6d4h   
</span></span><span style=display:flex><span>kube-node-lease        Active   6d4h   
</span></span><span style=display:flex><span>kube-public            Active   6d4h   
</span></span><span style=display:flex><span>kube-system            Active   6d4h   
</span></span><span style=display:flex><span>kubernetes-dashboard   Active   6d4h   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@master1 istio-1.19.3<span style=color:#f92672>]</span><span style=color:#75715e>#kubectl get pod -l app=sleep</span>
</span></span><span style=display:flex><span>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>sleep-78ff5975c6-v62sv   1/1     Running   <span style=color:#ae81ff>0</span>          108s
</span></span></code></pre></div><p>现在我们为命名空间打上了自动注入标签，<strong>但是已经部署了的应用并不会主动注入，这是因为注入的动作发生着 Pod 创建时</strong>。我们可以杀掉正在运行的 Pod 来验证新创建的 Pod 是否注入 Sidecar。</p><pre tabindex=0><code>$ kubectl delete pod -l app=sleep
$ kubectl get pod -l app=sleep
NAME                    READY   STATUS    RESTARTS   AGE
sleep-9454cc476-kmbzz   2/2     Running   0          5s
</code></pre><p>可以看到现在我们的应用有 2 个容器了。查看已注入 Pod 的详细状态，应该可以看到被注入的 <code>istio-proxy</code> 容器：</p><pre tabindex=0><code>$ kubectl describe pod -l app=sleep
...
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  91s   default-scheduler  Successfully assigned default/sleep-9454cc476-kmbzz to node2
  Normal  Pulled     90s   kubelet            Container image &#34;docker.io/istio/proxyv2:1.19.3&#34; already present on machine
  Normal  Created    90s   kubelet            Created container istio-init
  Normal  Started    90s   kubelet            Started container istio-init
  Normal  Pulled     90s   kubelet            Container image &#34;curlimages/curl&#34; already present on machine
  Normal  Created    90s   kubelet            Created container sleep
  Normal  Started    90s   kubelet            Started container sleep
  Normal  Pulled     90s   kubelet            Container image &#34;docker.io/istio/proxyv2:1.19.3&#34; already present on machine
  Normal  Created    89s   kubelet            Created container istio-proxy
  Normal  Started    89s   kubelet            Started container istio-proxy
</code></pre><p>这样我们就实现了 Pod 应用自动注入 Envoy Sidecar 代理，以后 <code>default</code> 命名空间中的应用部署后都会自动注入了。当然要取消自动注入功能，只需要将 <code>istio-injection</code> 标签去掉即可：</p><pre tabindex=0><code>$ kubectl label namespace default istio-injection-
</code></pre><p>当然除了在命名空间级别启用和禁用注入功能之外，注入也可以通过配置 Pod 上的 <code>sidecar.istio.io/inject: "true"</code> 标签，在每个 Pod 的基础上进行控制。</p><p>自动注入 Envoy Sidecar 的原理其实很简单，如果你对 Kubernetes 比较熟悉的话，肯定听过准入控制器的，其中就有两个对象 <code>validatingwebhookconfigurations</code>、<code>mutatingwebhookconfigurations</code>，前面是用来校验资源是否合法的，后面是用来修改资源对象的，那么要实现自动注入功能，也就相当于去为 Pod 自动添加一个容器，所以就需要用到 mutate 功能了，我们可以查看下系统中是否包含一个 <code>istio-sidecar-injector</code> 的准入控制器：</p><pre tabindex=0><code>$ kubectl get mutatingwebhookconfigurations
NAME                                             WEBHOOKS   AGE
istio-sidecar-injector                           4          63m
</code></pre><p>而实现准入控制器逻辑的也正是 <code>istiod</code> 这个组件了。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311118295.png alt=image-20240731111833185></p><h3 id=3bookinfo-示例应用>3、BookInfo 示例应用
<a class=anchor href=#3bookinfo-%e7%a4%ba%e4%be%8b%e5%ba%94%e7%94%a8>#</a></h3><p><a href="https://link.zhihu.com/?target=https%3A//github.com/istio/istio/tree/master/samples/bookinfo">Bookinfo</a> 是一个非常经典的微服务示例项目，它由四个独立的微服务组成，每个微服务都是用不同的语言编写的，可以用于演示多种 Istio 特性的应用。这个应用模仿在线书店的一个分类，显示一本书的信息，页面上会显示一本书的描述，书籍的细节（ISBN、页数等），以及关于这本书的一些评论。</p><p>Bookinfo 应用分为以下四个单独的微服务：</p><ul><li><code>productpage</code>：这个微服务会调用 <code>details</code> 和 <code>reviews</code> 两个微服务，用来生成页面。</li><li><code>details</code>：这个微服务中包含了书籍的信息。</li><li><code>reviews</code>：这个微服务中包含了书籍相关的评论，它还会调用 <code>ratings</code> 微服务。</li><li><code>ratings</code>：这个微服务中包含了由书籍评价组成的评级信息。</li></ul><p><code>reviews</code> 微服务有 3 个版本：</p><ul><li><code>v1</code> 版本不会调用 <code>ratings</code> 服务。</li><li><code>v2</code> 版本会调用 <code>ratings</code> 服务，并使用 1 到 5 个黑色星形图标来显示评分信息。</li><li><code>v3</code> 版本会调用 <code>ratings</code> 服务，并使用 1 到 5 个红色星形图标来显示评分信息。</li></ul><p>下图展示了这个应用的端到端架构。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311118317.png alt=image-20240731111847198></p><p>现在我们来为 Bookinfo 应用提供 Istio 支持，无需对应用自身做出任何改变。只要简单的在 Istio 环境中对服务进行配置和运行即可，其实就是把 Envoy Sidecar 注入到每个服务之中。最终的部署结果将如下图所示：</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311118720.png alt=image-20240731111859575></p><p>所有的微服务都和 Envoy Sidecar 集成在一起，服务所有的出入流量都被 Sidecar 所劫持，然后我们就可以利用 Istio 控制平面为应用提供服务路由、遥测数据收集以及策略实施等服务治理功能了。</p><h3 id=-实战bookinfo-示例应用-2023115测试成功>== 实战：BookInfo 示例应用-2023.11.5(测试成功)==
<a class=anchor href=#-%e5%ae%9e%e6%88%98bookinfo-%e7%a4%ba%e4%be%8b%e5%ba%94%e7%94%a8-2023115%e6%b5%8b%e8%af%95%e6%88%90%e5%8a%9f>#</a></h3><p>实验环境：</p><pre tabindex=0><code>k8s v1.25.4（containerd://1.6.10）

[root@master1 ~]#istioctl version
client version: 1.19.3
control plane version: 1.19.3
data plane version: 1.19.3 (8 proxies)
</code></pre><p>实验软件：</p><p>链接：<a href="https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA%3Fpwd%3D7yqb">https://pan.baidu.com/s/1pMnJxgL63oTlGFlhrfnXsA?pwd=7yqb</a> 提取码：7yqb <code>2023.11.5-实战：BookInfo 示例应用-2023.11.5(测试成功)</code></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311120271.png alt=image-20240731112042145></p><p>实验步骤：</p><pre tabindex=0><code>graph LR
    A[实战步骤] --&gt;B(1️⃣ 部署示例应用)
    A[实战步骤] --&gt;C(2️⃣ 对外暴露应用)
    A[实战步骤] --&gt;D(3️⃣ 查看 Dashboard)
</code></pre><p>==1.部署示例应用==</p><p>我们首先进入 Istio 安装目录，该目录中的 <code>samples</code> 目录中就包含了 Bookinfo 部署到 Kubernetes 集群中的配置文件，我们只需要为这些资源注入 Sidecar。这里我们为 default 命名空间打上标签 <code>istio-injection=enabled</code>，开启自动注入功能即可：</p><pre tabindex=0><code>$ kubectl label namespace default istio-injection=enabled --overwrite
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311121269.png alt=image-20240731112106157></p><p>然后只需要使用 kubectl 正常部署应用即可：</p><pre tabindex=0><code>$ kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
service/details created
serviceaccount/bookinfo-details created
deployment.apps/details-v1 created
service/ratings created
serviceaccount/bookinfo-ratings created
deployment.apps/ratings-v1 created
service/reviews created
serviceaccount/bookinfo-reviews created
deployment.apps/reviews-v1 created
deployment.apps/reviews-v2 created
deployment.apps/reviews-v3 created
service/productpage created
serviceaccount/bookinfo-productpage created
deployment.apps/productpage-v1 created
</code></pre><p>注意：</p><p>如果在安装过程中禁用了 Sidecar 自动注入功能而选择手动注入 Sidecar，可以使用 <code>istioctl kube-inject</code> 命令来手动注入：</p><pre tabindex=0><code>$ kubectl apply -f &lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml)
</code></pre><p>自己本次手动注入：（我的自动注入有点问题，这里使用手动注入方式）</p><pre tabindex=0><code>[root@master1 istio-1.19.3]#kubectl apply -f &lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml)
service/details created
serviceaccount/bookinfo-details created
deployment.apps/details-v1 created
service/ratings created
serviceaccount/bookinfo-ratings created
deployment.apps/ratings-v1 created
service/reviews created
serviceaccount/bookinfo-reviews created
deployment.apps/reviews-v1 created
deployment.apps/reviews-v2 created
deployment.apps/reviews-v3 created
service/productpage created
serviceaccount/bookinfo-productpage created
deployment.apps/productpage-v1 created
</code></pre><p>上面的命令会启动全部的四个服务，其中也包括了 <code>reviews</code> 服务的三个版本（v1、v2 以及 v3）。</p><p>隔一会儿，我们可以查看下 Pod 的状态：</p><pre tabindex=0><code>$ kubectl get pods
NAME                                     READY   STATUS    RESTARTS         AGE
details-v1-5f4d584748-97stc              2/2     Running   0                12m
productpage-v1-564d4686f-z7fwn           2/2     Running   0                12m
ratings-v1-686ccfb5d8-cvlcq              2/2     Running   0                12m
reviews-v1-86896b7648-rrjxv              2/2     Running   0                12m
reviews-v2-b7dcd98fb-kk8fv               2/2     Running   0                12m
reviews-v3-5c5cc7b6d-c4wf5               2/2     Running   0                12m
$ kubectl get svc
NAME                           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
details                        ClusterIP   10.98.49.69      &lt;none&gt;        9080/TCP            13m
kubernetes                     ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP             44d
productpage                    ClusterIP   10.101.255.202   &lt;none&gt;        9080/TCP            13m
ratings                        ClusterIP   10.101.210.142   &lt;none&gt;        9080/TCP            13m
reviews                        ClusterIP   10.106.93.80     &lt;none&gt;        9080/TCP            13m
[root@master1 istio-1.19.3]#kubectl get po
NAME                            READY   STATUS    RESTARTS   AGE
details-v1-76bdcd6b59-9p5gh     2/2     Running   0          18m
productpage-v1-d594c998-x8s6k   2/2     Running   0          18m
ratings-v1-64694b479f-qcbcm     2/2     Running   0          18m
reviews-v1-68f98444cd-szhrv     2/2     Running   0          18m
reviews-v2-6c9b87bd47-t4l9c     2/2     Running   0          18m
reviews-v3-9569b895b-jr29m      2/2     Running   0          18m
[root@master1 istio-1.19.3]#kubectl get svc
NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
details       ClusterIP   10.107.100.41    &lt;none&gt;        9080/TCP   19m
kubernetes    ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP    7d17h
productpage   ClusterIP   10.110.115.123   &lt;none&gt;        9080/TCP   19m
ratings       ClusterIP   10.101.72.27     &lt;none&gt;        9080/TCP   19m
reviews       ClusterIP   10.111.206.146   &lt;none&gt;        9080/TCP   19m
</code></pre><p>当每个 Pod 准备就绪时，Istio Sidecar 将伴随应用一起部署。</p><p>要确认 Bookinfo 应用是否正在运行，我们可以在某个 Pod 中用 <code>curl</code> 命令对应用发送请求来验证，例如 <code>ratings</code>：</p><pre tabindex=0><code>$ kubectl exec &#34;$(kubectl get pod -l app=ratings -o jsonpath=&#39;{.items[0].metadata.name}&#39;)&#34; -c ratings -- curl -sS productpage:9080/productpage | grep -o &#34;&lt;title&gt;.*&lt;/title&gt;&#34;
&lt;title&gt;Simple Bookstore App&lt;/title&gt;
</code></pre><p>如果能够正常数据，说明应用已经部署成功了，而且已经被 Istio 管控起来了。</p><p>==2.对外暴露应用==</p><p>上面我们已经将 Bookinfo 应用部署成功了，但是还不能被外界访问，如果没有 Istio 的情况下我们可以直接通过 NodePort 或者 Ingress 的方式来对外进行暴露，但是现在我们使用了 Istio，需要创建 ==Istio 入站网关（Ingress Gateway）==来对外暴露应用了。</p><p>在 <code>samples</code> 目录下面有一个 Bookinfo 对外暴露的配置文件 <code>bookinfo-gateway.yaml</code>，这个配置文件中定义了一个 <code>Gateway</code> 和一个 <code>VirtualService</code> 对象，<code>Gateway</code> 定义了入站流量的端口和协议，<code>VirtualService</code> 定义了流量的路由规则，内容如下所示：</p><pre tabindex=0><code># samples/bookinfo/networking/bookinfo-gateway.yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: bookinfo-gateway
spec:
  selector: # 如果使用的是 Helm 方式安装，则默认应该是 istio=ingress 标签
    istio: ingressgateway # 匹配 ingress gateway pod 的标签（kubectl get pods -l istio=ingressgateway -n istio-system）
  servers:
    - port:
        number: 8080
        name: http
        protocol: HTTP
      hosts:
        - &#34;*&#34;
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo
spec:
  hosts:
    - &#34;*&#34;
  gateways:
    - bookinfo-gateway
  http:
    - match:
        - uri:
            exact: /productpage
        - uri:
            prefix: /static
        - uri:
            exact: /login
        - uri:
            exact: /logout
        - uri:
            prefix: /api/v1/products
      route:
        - destination:
            host: productpage
            port:
              number: 9080
</code></pre><p>这两个资源对象我们后面还会详细讲解的，现在我们只需要知道这两个资源对象是用来定义入站流量的端口和协议以及流量的路由规则的即可。如果你联想到前面我们讲解的 Envoy 配置，那么你就会发现这两个资源对象其实分别对应着 Envoy 配置中的 Listener 和 VirtualHosts（包括 Cluster），只不过这里是用我们更熟悉的 Kubernetes CRD 的方式来进行配置的，当我们创建了这两个资源对象后，Istio 控制平面会自动把这些配置下发到 Envoy Sidecar 中，然后 Envoy Sidecar 就会根据这些配置来进行流量的路由了。</p><p>接下来我们执行下面的命令来把应用关联到 Istio 网关：</p><pre tabindex=0><code>$ kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
gateway.networking.istio.io/bookinfo-gateway created
virtualservice.networking.istio.io/bookinfo created
</code></pre><p>然后我们就可以通过 <code>istio-ingressgateway</code> 这个统一的入口来访问应用了，我们可以通过 <code>kubectl get svc -n istio-system</code> 命令来查看下 <code>istio-ingressgateway</code> 的地址：</p><pre tabindex=0><code>$ kubectl get svc istio-ingressgateway -n istio-system
NAME                   TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                                      AGE
istio-ingressgateway   LoadBalancer   10.103.227.57   &lt;pending&gt;     15021:32459/TCP,80:31896/TCP,443:30808/TCP,31400:31535/TCP,15443:30761/TCP   155m
[root@master1 istio-1.19.3]#kubectl get svc istio-ingressgateway -n istio-system
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                                      AGE
istio-ingressgateway   LoadBalancer   10.104.174.171   &lt;pending&gt;     15021:32479/TCP,80:31814/TCP,443:31263/TCP,31400:32543/TCP,15443:30806/TCP   13h
</code></pre><p>由于我们这里没有负载均衡器，所以 <code>EXTERNAL-IP</code> 的值一直是 <code>&lt;pending></code> 状态，这种情况下我们可以用 NodePort 来访问网关。可以通过如下命令获取 HTTP 和 HTTPS 的访问端口：</p><pre tabindex=0><code>$ export INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].nodePort}&#39;)
$ export SECURE_INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath=&#39;{.spec.ports[?(@.name==&#34;https&#34;)].nodePort}&#39;)
</code></pre><p>然后获取集群中任意一个节点的 IP 地址：</p><pre tabindex=0><code>$ export INGRESS_HOST=$(kubectl get po -l istio=ingressgateway -n istio-system -o jsonpath=&#39;{.items[0].status.hostIP}&#39;)
</code></pre><p>设置环境变量 GATEWAY_URL</p><pre tabindex=0><code>$ export GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT
</code></pre><p>确保 IP 地址和端口均成功地赋值给了环境变量：</p><pre tabindex=0><code>$ echo &#34;$GATEWAY_URL&#34;
192.168.0.20:31896

[root@master1 istio-1.19.3]#echo &#34;$GATEWAY_URL&#34;
172.29.9.62:31814
</code></pre><p>这样我们就得到了 Istio 入口网关的访问地址，然后我们只需要在浏览器中通过 <code>http://$GATEWAY_URL/productpage</code> 即可访问到 Bookinfo 应用了。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311126325.png alt=image-20240731112637192></p><p>注意：</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311126830.png alt=image-20240731112650711></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311126800.png alt=image-20240731112658631></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127003.png alt=image-20240731112705899></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127272.png alt=image-20240731112715033></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127474.png alt=image-20240731112723362></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127302.png alt=image-20240731112733177></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127693.png alt=image-20240731112740543></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311127547.png alt=image-20240731112747430></p><p>==3.查看 Dashboard==</p><p>Istio 和几个<strong>遥测应用</strong>做了集成。遥测能帮我们了解服务网格的结构、展示网络的拓扑结构、分析网格的健康状态。</p><p>我们可以使用下面的方式来安装 Kiali，包括 Prometheus、Grafana 以及 jaeger。</p><pre tabindex=0><code>$ kubectl apply -f samples/addons
$ kubectl rollout status deployment/kiali -n istio-system
Waiting for deployment &#34;kiali&#34; rollout to finish: 0 of 1 updated replicas are available...
deployment &#34;kiali&#34; successfully rolled out
$ kubectl get pods -n istio-system
NAME                                   READY   STATUS    RESTARTS   AGE
grafana-5f9b8c6c5d-jv65v               1/1     Running   0          6m23s
istio-egressgateway-556f6f58f4-hkzdd   1/1     Running   0          177m
istio-ingressgateway-9c8b9b586-s6s48   1/1     Running   0          177m
istiod-644f5d55fc-zz2zh                1/1     Running   0          179m
jaeger-db6bdfcb4-qpmmv                 1/1     Running   0          6m23s
kiali-7c9d5f9f96-cp4mb                 1/1     Running   0          6m23s
prometheus-5d5d6d6fc-2gtxm             2/2     Running   0          6m22s
</code></pre><p>如果在安装插件时出错，再运行一次命令。有一些和时间相关的问题，再次运行就能解决。</p><p>安装完成后我们可以使用 <code>istioctl dashboard</code> 命令来开启访问 Kiali 面板。</p><pre tabindex=0><code>$ istioctl dashboard kiali --address 0.0.0.0
http://0.0.0.0:20001/kiali

# http://172.29.9.61:20001/kiali/
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311128962.png alt=image-20240731112814874></p><p>在左侧的导航菜单，选择 Graph ，然后在 Namespace 下拉列表中，选择 <code>default</code>。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311128333.png alt=image-20240731112826181></p><p>要查看链路追踪数据，必须向服务发送请求。请求的数量取决于 Istio 的采样率，采样率在安装 Istio 时设置，默认采样速率为 <code>1%</code>。也就是说在第一个 tracing 可见之前，需要发送至少 100 个请求：</p><pre tabindex=0><code>$ for i in $(seq 1 100); do curl -s -o /dev/null &#34;http://$GATEWAY_URL/productpage&#34;; done
</code></pre><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311128266.png alt=image-20240731112851106></p><p>Kiali 的仪表板展示了网格的概览以及 Bookinfo 示例应用的各个服务之间的关系。 它还提供过滤器来可视化流量的流动。</p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311129129.png alt=image-20240731112903919></p><p>到这里我们就完成了 Bookinfo 示例应用的部署，以及对外暴露应用的配置，接下来我们就可以开始学习 Istio 的核心功能了。</p><p>:warning: 注意：这里的pod要依赖pvc</p><blockquote><p>本次这里就暂不安装nfs了，记录下即可。</p></blockquote><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311129255.png alt=image-20240731112914124></p><p><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202407311129004.png alt=image-20240731112922625></p><pre tabindex=0><code>docker run --restart=always --name moments -e NUXT_JWT_KEY=ZAkzv09rdrQTVXUk -d -v /docker/data/moments:/app/data -p 3000:3000 kingwrcy/moments:0.2
</code></pre><pre tabindex=0><code>basepath=$(cd `dirname $0`; pwd)
mkdir -p ${basepath}/moments
docker run --name moments -d -v ${basepath}/moments:/app/data -p 3001:3000 192.168.0.140:881/kingwrcy/moments:latest
</code></pre><pre tabindex=0><code>docker run --name moments -e NUXT_JWT_KEY=ZAkzv09rdrQTVXUk -d -v /root/moments:/app/data -p 3001:3000 192.168.0.140:881/kingwrcy/moments:latest
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#istio快速入门>Istio快速入门</a></li><li><a href=#目录>目录</a></li><li><a href=#本节实战>本节实战</a></li><li><a href=#前言>前言</a></li><li><a href=#1安装>1、安装</a></li><li><a href=#安装方式>安装方式</a></li><li><a href=#1使用-istioctl-install>1.使用 istioctl install</a></li><li><a href=#2使用-istioctl-manifest-generate-安装>2.使用 istioctl manifest generate 安装</a></li><li><a href=#3使用-helm-安装>3.使用 Helm 安装</a></li><li><a href=#4使用-istio-operator-安装>4.使用 Istio Operator 安装</a></li><li><a href=#安装-istio>安装 Istio</a></li><li><a href=#-实战istioctl-方式安装istio-2023113测试成功>== 实战：<code>istioctl</code> 方式安装istio-2023.11.3(测试成功)==</a></li><li><a href=#2注入-envoy-sidecar>2、注入 Envoy Sidecar</a></li><li><a href=#1手动注入-sidecar>1.手动注入 Sidecar</a></li><li><a href=#-实战手动注入-envoy-sidecar-2023113测试成功>== 实战：手动注入 Envoy Sidecar-2023.11.3(测试成功)==</a></li><li><a href=#2自定义注入>2.自定义注入</a></li><li><a href=#3自动注入-sidecar>3.自动注入 Sidecar</a></li><li><a href=#-实战自动注入-envoy-sidecar-2023113测试失败>== 实战：自动注入 Envoy Sidecar-2023.11.3(<strong>测试失败</strong>)==</a></li><li><a href=#3bookinfo-示例应用>3、BookInfo 示例应用</a></li><li><a href=#-实战bookinfo-示例应用-2023115测试成功>== 实战：BookInfo 示例应用-2023.11.5(测试成功)==</a></li></ul></li></ul></nav></div></aside></main></body></html>
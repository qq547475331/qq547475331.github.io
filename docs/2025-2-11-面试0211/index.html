<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  504错误是啥
  #

504 错误（Gateway Timeout）是一个 HTTP 状态码，表示网关或代理服务器超时。让我详细解释一下：

  主要原因：
  #



服务器响应超时

上游服务器（如应用服务器）没有在预定时间内响应网关/代理服务器
可能是因为服务器负载过高或处理请求时间过长



网络问题

网关与上游服务器之间的网络连接存在问题
网络拥堵或延迟过高




  常见场景：
  #


使用 Nginx 作为反向代理时，后端服务响应太慢
数据库查询操作耗时过长
服务器资源不足（CPU、内存等）
网络带宽不足


  解决方案：
  #



服务器端

增加超时设置时间
优化后端代码性能
增加服务器资源
使用缓存减少处理时间



配置示例
如果使用 Nginx，可以调整超时设置：


http {
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
}

客户端

实现请求重试机制
添加适当的错误处理
考虑使用断路器模式



504 错误通常是临时性的，如果持续发生，建议检查服务器日志并进行相应优化。

  常见的状态码
  #

让我为你介绍最常见的 HTTP 状态码：

  2XX - 成功响应
  #



200 OK

最常见的成功状态码
请求成功且正常返回结果



201 Created

创建资源成功
通常在 POST 请求后返回



204 No Content"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="2025-2-11 面试2025-02-11"><meta property="og:description" content="504错误是啥 # 504 错误（Gateway Timeout）是一个 HTTP 状态码，表示网关或代理服务器超时。让我详细解释一下：
主要原因： # 服务器响应超时
上游服务器（如应用服务器）没有在预定时间内响应网关/代理服务器 可能是因为服务器负载过高或处理请求时间过长 网络问题
网关与上游服务器之间的网络连接存在问题 网络拥堵或延迟过高 常见场景： # 使用 Nginx 作为反向代理时，后端服务响应太慢 数据库查询操作耗时过长 服务器资源不足（CPU、内存等） 网络带宽不足 解决方案： # 服务器端
增加超时设置时间 优化后端代码性能 增加服务器资源 使用缓存减少处理时间 配置示例 如果使用 Nginx，可以调整超时设置：
http { proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } 客户端 实现请求重试机制 添加适当的错误处理 考虑使用断路器模式 504 错误通常是临时性的，如果持续发生，建议检查服务器日志并进行相应优化。
常见的状态码 # 让我为你介绍最常见的 HTTP 状态码：
2XX - 成功响应 # 200 OK
最常见的成功状态码 请求成功且正常返回结果 201 Created
创建资源成功 通常在 POST 请求后返回 204 No Content"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>2025-2-11 面试2025-02-11 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.3c324ac138affce4ebf1b0fba2b35185d375d1ba7cc73b75b89a68941a98ebad.js integrity="sha256-PDJKwTiv/OTr8bD7orNRhdN10bp8xzt1uJpolBqY660=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/2025-3-18-5w-pod%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%9B%98/>2025-3-18 5w pod压测复盘</a></li><li><a href=/docs/2025-3-14-%E7%81%AB%E5%B1%B1%E4%BA%91%E8%BF%81%E7%A7%BB%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/>2025-3-14 火山云迁移工程师面试记录</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s删除pod或deployment的流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-08 k8s创建pod流程图详解</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>2025-2-7 美国码农计划</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>2025-2-7 美国码农薪酬</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>2025-2-7 k8s组件</a></li><li><a href=/docs/2025-2-28-prometheus/>2025-2-28 prometheus 面试题</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>2025-2-25 面试0225</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>2025-2-24 高级运维面试题-linux部分</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>2025-2-24 中级运维面试题</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>2025-2-24 0224面试</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>2025-2-20 面试0220</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>2025-2-19 面试0219</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>2025-2-18 面试2025-0218</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>2025-2-16 k8s题目</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>2025-2-12 面试0212</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/ class=active>2025-2-11 面试2025-02-11</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2025-1-16 k8s流量链路剖析</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2025-1-16 CSI剖析演进</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-8-1 linux面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-8-1 linux运维面试题</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-8-1 k8s面试题</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>2024-5-1 单master单etcd改造为3master3etcd</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-4-17 面试总结</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-3-8 面试</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-3-4 CNI剖析演进</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-3-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2025-3-14-vivo%E9%9D%A2%E8%AF%95/>2024-3-14 vivo面试</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-2-26 面试</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-2-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-2-22 k8s架构师面试大全</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>2024-12-05 kubeasz部署k8s</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>2024-10-20 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>2024-08-02 顶级devops工具大盘点</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>2024-08-02 清理docker镜像</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>2024-08-02 构建容器镜像利器buildkit</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>2024-08-02 是技术大神还是基础架构部的祸害</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>2024-08-02 搭个日志手机系统不香吗</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>2024-08-02 我只想做技术 走技术路线</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>2024-08-02 常见linux运维面试题</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>2024-08-02 大厂总结nginx高并发优化笔记</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>2024-08-02 史上最牛jenkins pipeline流水线详解</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>2024-08-02 TEG与istio集成</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>2024-08-02 prometheus-stack</a></li><li><a href=/docs/pixie-pixie/>2024-08-02 pixie</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>2024-08-02 nginx如何解决惊群效应</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>2024-08-02 netctl检测集群pod间连通性</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>2024-08-02 linux运维工程师50个常见面试题</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>2024-08-02 linux系统性能优化 七个实战经验</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>2024-08-02 linux awk文本处理器 8个案例</a></li><li><a href=/docs/kubewharf-kubewharf/>2024-08-02 kubewharf</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>2024-08-02 kruise原地升级解析</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>2024-08-02 K8S面试题</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>2024-08-02 k8s背后service是如何工作的</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>2024-08-02 K8S的最后一块拼图</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>2024-08-02 istio部署</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>2024-08-02 istio-ingress-gateway</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>2024-08-02 godel-scheduler</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>2024-08-02 dockerfile定制专属镜像</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>2024-08-02 33款gitops与devops主流系统</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>2024-07-22 OpenKruise详细解释以及原地升级及全链路灰度发布方案</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>2024-07-05 K8S之ingress-nginx原理及配置</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>2024-06-28 使用cloudflare(CF)搭建dockerhub代理</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>2024-04-16 如何为K8S保驾护航</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>2024-04-16 K8S如何获得 IP</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_status_update.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_set_control.go源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>2024-04-10 K8S控制器之stateful_pod_control.go源码解读</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>2024-04-09 K8S调度器 extender.go 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>2024-04-09 K8S控制器之sync.go 同步 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>2024-04-09 K8S控制器之rollback.go 回滚 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>2024-04-09 K8S控制器之recreate.go 重建 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>2024-04-09 K8S控制器之 scheduler.go 调度器 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>2024-04-09 K8S控制器之 rolling.go 滚动更新 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>2024-04-09 K8S控制器之 progress.go 进度 源码解读</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>2024-04-09 K8S控制器之 deployment_controller.go源码解读</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>2024-04-09 K8S 调度器 scheduler_one.go 源码解读</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/>2024-04-07 彻悟容器网络</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>2024-04-03 面试用 Golang 手撸 LRU</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>2024-04-03 自动屏蔽IP攻击</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>2024-04-03 离线安装kubephere</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>2024-04-03 磁盘数据恢复</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>2024-04-03 清理残留的calico网络插件</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>2024-04-03 流量何处来何处去</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>2024-04-03 极大提高工作效率的 Linux 命令</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>2024-04-03 文学的故乡</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>2024-04-03 搞懂K8S鉴权</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>2024-04-03 容器网络原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>2024-04-03 容器的文件系统 OverlayFS 原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>2024-04-03 容器原理</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>2024-04-03 容器内的 1 号进程</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>2024-04-03 容器中域名解析以及不同dnspolicy对域名解析的影响</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>2024-04-03 如何调试 crash 容器的网络</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>2024-04-03 如何使用tekton快速搭建CI/CD平台</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>2024-04-03 大规模并发下如何加快 Pod 启动速度</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>2024-04-03 使用kubernees leases 轻松实现leader election</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>2024-04-03 二进制部署K8S加节点操作</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>2024-04-03 两张图全面理解K8S原理</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>2024-04-03 ssl证书自签发</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>2024-04-03 prometheus企业级监控使用总结</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>2024-04-03 MetalLB L2 原理</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>2024-04-03 Linux 性能优化大全</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>2024-04-03 Kubernetes 证书详解(鉴权)</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>2024-04-03 Kubernetes 证书详解(认证)</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>2024-04-03 Kubernetes 源码结构</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>2024-04-03 Kubernetes API</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>2024-04-03 kubekey添加新节点</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>2024-04-03 K8S面试宝典</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>2024-04-03 K8S面试大全</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>2024-04-03 k8s运维之清理磁盘</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>2024-04-03 K8S调试POD</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>2024-04-03 K8S的POD类型</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>2024-04-03 k8s应用的最佳实践</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>2024-04-03 K8S命令指南</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>2024-04-03 K8S原地升级</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>2024-04-03 K8S 探针原理</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>2024-04-03 K8S 开发可不止 CRUD</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>2024-04-03 K8S GPT</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>2024-04-03 K8S csi openebs原理</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>2024-04-03 helm chart和repo</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>2024-04-03 flanel网络</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>2024-04-03 ETCD稳定性及性能优化实践</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>2024-04-03 ETCD备份</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>2024-04-03 Docker重要的网络知识点</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>2024-04-03 dockerfile的copy和add的区别</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>2024-04-03 COREDNS之光</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>2024-04-03 Containerd 基本操作</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>2024-04-03 CNI插件选型</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>2024-04-03 Client-go 架构</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>2024-04-03 Client-go 四种客户端</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>2024-04-03 CICD思考</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>2024-04-03 Calico网络自定义</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>2024-04-03 acme自动更新证书</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>2024-04-03 16个概念带你入门 Kubernetes</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>2024-04-03 面试0308</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>2024-04-03 600条最强linux命令总结</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>2024-04-03 16张硬核图解k8s网络</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>2024-03-28 k8s之kubelet源码解读</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>2024-03-04 K8S 流量链路剖析</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>2024-03-04 K8S CSI剖析演进</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>2024-03-04 K8S CNI剖析演进</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>2024-01-21 使用 OpenFunction 在任何基础设施上运行无服务器工作负载</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>2023-09-28 离线安装集群</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>2023-09-28 操作系统说明</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>2023-09-28 快速指南</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>2023-09-28 开始使用 cilium</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>2023-09-28 多架构支持</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>2023-09-28 公有云上部署</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>2023-09-28 个性化集群参数配置</a></li><li><a href=/docs/network-check-network-check/>2023-09-28 network-check</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>2023-09-28 kube-router 网络组件</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>2023-09-28 ezctl 命令行介绍</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>2023-09-28 EX-LB 负载均衡部署</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>2023-09-28 calico 配置 BGP Route Reflectors</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>2023-09-28 15:26:42.651 07-安装集群主要插件</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>2023-09-28 08-K8S 集群存储</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>2023-09-28 06-安装网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>2023-09-28 06-安装kube-ovn网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>2023-09-28 06-安装flannel网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>2023-09-28 06-安装cilium网络组件</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>2023-09-28 06-安装calico网络组件</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>2023-09-28 02-安装etcd集群</a></li><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>2023-09-28 00-集群规划和基础参数设定</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>2023-09-28 05-安装kube_node节点</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>2023-09-28 04-安装kube_master节点</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>2023-09-28 03-安装容器运行时</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>2023-09-28 01-创建证书和环境准备</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>2023-09-21 思考</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>2023-04-12 使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>2025-2-11 面试2025-02-11</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#504错误是啥>504错误是啥</a><ul><li><a href=#主要原因>主要原因：</a></li><li><a href=#常见场景>常见场景：</a></li><li><a href=#解决方案>解决方案：</a></li></ul></li><li><a href=#常见的状态码>常见的状态码</a><ul><li><a href=#2xx---成功响应>2XX - 成功响应</a></li><li><a href=#3xx---重定向>3XX - 重定向</a></li><li><a href=#4xx---客户端错误>4XX - 客户端错误</a></li><li><a href=#5xx---服务器错误>5XX - 服务器错误</a></li><li><a href=#使用建议>使用建议</a></li></ul></li><li><a href=#k8s创建pod的过程>k8s创建pod的过程</a><ul><li><a href=#1-提交请求阶段>1. 提交请求阶段</a></li><li><a href=#2-调度阶段>2. 调度阶段</a></li><li><a href=#3-创建阶段>3. 创建阶段</a></li><li><a href=#4-运行阶段>4. 运行阶段</a></li><li><a href=#示例-pod-配置>示例 Pod 配置：</a></li><li><a href=#可能的问题和解决方案>可能的问题和解决方案：</a></li><li><a href=#1-基础配置优化>1. 基础配置优化</a></li><li><a href=#2-静态文件优化>2. 静态文件优化</a></li><li><a href=#3-负载均衡优化>3. 负载均衡优化</a></li><li><a href=#4-ssl-优化>4. SSL 优化</a></li><li><a href=#5-安全优化>5. 安全优化</a></li><li><a href=#6-日志优化>6. 日志优化</a></li><li><a href=#7-监控指标>7. 监控指标</a></li><li><a href=#优化建议>优化建议：</a></li></ul></li><li><a href=#gitlab的runner-干嘛的>gitlab的runner 干嘛的</a><ul><li><a href=#1-runner-的主要功能>1. Runner 的主要功能</a></li><li><a href=#2-runner-类型>2. Runner 类型</a></li><li><a href=#3-配置示例>3. 配置示例</a></li><li><a href=#4-runner-在-kubernetes-中的配置>4. Runner 在 Kubernetes 中的配置</a></li><li><a href=#5-runner-注册配置>5. Runner 注册配置</a></li><li><a href=#6-常见使用场景>6. 常见使用场景</a></li><li><a href=#7-最佳实践>7. 最佳实践</a></li></ul></li><li><a href=#jenkins常用插件>jenkins常用插件</a><ul><li><a href=#1-基础功能插件>1. 基础功能插件</a></li><li><a href=#2-构建相关插件>2. 构建相关插件</a></li><li><a href=#3-容器相关插件>3. 容器相关插件</a></li><li><a href=#4-代码质量插件>4. 代码质量插件</a></li><li><a href=#5-通知类插件>5. 通知类插件</a></li><li><a href=#6-其他实用插件>6. 其他实用插件</a></li><li><a href=#安装建议>安装建议</a></li></ul></li><li><a href=#声明式和脚本式的jenkins的写法举例>声明式和脚本式的jenkins的写法举例</a><ul><li><a href=#1-并行执行-parallel>1. 并行执行 (Parallel)</a></li><li><a href=#2-矩阵构建-matrix>2. 矩阵构建 (Matrix)</a></li><li><a href=#3-多分支流水线>3. 多分支流水线</a></li><li><a href=#4-上游下游任务-upstreamdownstream>4. 上游/下游任务 (Upstream/Downstream)</a></li><li><a href=#5-参数化构建矩阵>5. 参数化构建矩阵</a></li><li><a href=#6-资源分配和限制>6. 资源分配和限制</a></li><li><a href=#最佳实践建议>最佳实践建议：</a></li></ul></li><li><a href=#怎么确保密码-这些不会明文写到流水线里面>怎么确保密码 这些不会明文写到流水线里面</a><ul><li><a href=#1-默认行为>1. 默认行为</a></li><li><a href=#2-安全处理示例>2. 安全处理示例</a></li><li><a href=#3-最佳实践>3. 最佳实践</a></li><li><a href=#4-安全检查清单>4. 安全检查清单</a></li></ul></li><li><a href=#说下你对容器和k8s的理解>说下你对容器和k8s的理解</a><ul><li><a href=#1-容器的本质>1. 容器的本质</a></li><li><a href=#2-k8s-的核心功能>2. K8s 的核心功能</a></li><li><a href=#3-架构设计理念>3. 架构设计理念</a></li><li><a href=#4-实际应用场景>4. 实际应用场景</a></li><li><a href=#5-生产环境考虑>5. 生产环境考虑</a></li><li><a href=#6-最佳实践>6. 最佳实践</a></li><li><a href=#1-资源管理>1. 资源管理</a></li><li><a href=#2-健康检查>2. 健康检查</a></li><li><a href=#3-配置管理>3. 配置管理</a></li><li><a href=#4-节点选择>4. 节点选择</a></li></ul></li><li><a href=#你用过go或者python写东西吗-有关运维的-devops的>你用过go或者python写东西吗 有关运维的 devops的</a><ul><li><a href=#1-python-自动化运维示例>1. Python 自动化运维示例</a></li><li><a href=#2-go-运维工具示例>2. Go 运维工具示例</a></li><li><a href=#3-实用的-devops-脚本>3. 实用的 DevOps 脚本</a></li></ul></li><li><a href=#减少docker镜像的体积大小>减少docker镜像的体积大小</a><ul><li><a href=#1-多阶段构建-multi-stage-build>1. 多阶段构建 (Multi-stage Build)</a></li><li><a href=#2-使用轻量级基础镜像>2. 使用轻量级基础镜像</a></li><li><a href=#3-优化-run-指令和清理>3. 优化 RUN 指令和清理</a></li><li><a href=#4-使用-dockerignore>4. 使用 .dockerignore</a></li><li><a href=#5-生产环境优化示例>5. 生产环境优化示例</a></li><li><a href=#6-分离开发和生产依赖>6. 分离开发和生产依赖</a></li><li><a href=#7-最佳实践总结>7. 最佳实践总结</a></li><li><a href=#8-实际示例基于你的-podyaml>8. 实际示例（基于你的 pod.yaml）</a></li></ul></li><li><a href=#多阶段构建啥意思>多阶段构建啥意思</a><ul><li><a href=#1-传统构建方式单阶段>1. 传统构建方式（单阶段）</a></li><li><a href=#2-多阶段构建方式>2. 多阶段构建方式</a></li><li><a href=#3-更复杂的多阶段构建示例>3. 更复杂的多阶段构建示例</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=504错误是啥>504错误是啥
<a class=anchor href=#504%e9%94%99%e8%af%af%e6%98%af%e5%95%a5>#</a></h2><p>504 错误（Gateway Timeout）是一个 HTTP 状态码，表示网关或代理服务器超时。让我详细解释一下：</p><h3 id=主要原因>主要原因：
<a class=anchor href=#%e4%b8%bb%e8%a6%81%e5%8e%9f%e5%9b%a0>#</a></h3><ol><li><p><strong>服务器响应超时</strong></p><ul><li>上游服务器（如应用服务器）没有在预定时间内响应网关/代理服务器</li><li>可能是因为服务器负载过高或处理请求时间过长</li></ul></li><li><p><strong>网络问题</strong></p><ul><li>网关与上游服务器之间的网络连接存在问题</li><li>网络拥堵或延迟过高</li></ul></li></ol><h3 id=常见场景>常见场景：
<a class=anchor href=#%e5%b8%b8%e8%a7%81%e5%9c%ba%e6%99%af>#</a></h3><ul><li>使用 Nginx 作为反向代理时，后端服务响应太慢</li><li>数据库查询操作耗时过长</li><li>服务器资源不足（CPU、内存等）</li><li>网络带宽不足</li></ul><h3 id=解决方案>解决方案：
<a class=anchor href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88>#</a></h3><ol><li><p><strong>服务器端</strong></p><ul><li>增加超时设置时间</li><li>优化后端代码性能</li><li>增加服务器资源</li><li>使用缓存减少处理时间</li></ul></li><li><p><strong>配置示例</strong>
如果使用 Nginx，可以调整超时设置：</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_connect_timeout</span> <span style=color:#e6db74>300s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_send_timeout</span> <span style=color:#e6db74>300s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_read_timeout</span> <span style=color:#e6db74>300s</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li><strong>客户端</strong><ul><li>实现请求重试机制</li><li>添加适当的错误处理</li><li>考虑使用断路器模式</li></ul></li></ol><p>504 错误通常是临时性的，如果持续发生，建议检查服务器日志并进行相应优化。</p><h2 id=常见的状态码>常见的状态码
<a class=anchor href=#%e5%b8%b8%e8%a7%81%e7%9a%84%e7%8a%b6%e6%80%81%e7%a0%81>#</a></h2><p>让我为你介绍最常见的 HTTP 状态码：</p><h3 id=2xx---成功响应>2XX - 成功响应
<a class=anchor href=#2xx---%e6%88%90%e5%8a%9f%e5%93%8d%e5%ba%94>#</a></h3><ul><li><p><strong>200 OK</strong></p><ul><li>最常见的成功状态码</li><li>请求成功且正常返回结果</li></ul></li><li><p><strong>201 Created</strong></p><ul><li>创建资源成功</li><li>通常在 POST 请求后返回</li></ul></li><li><p><strong>204 No Content</strong></p><ul><li>请求成功但无返回内容</li><li>常用于删除操作</li></ul></li></ul><h3 id=3xx---重定向>3XX - 重定向
<a class=anchor href=#3xx---%e9%87%8d%e5%ae%9a%e5%90%91>#</a></h3><ul><li><p><strong>301 Moved Permanently</strong></p><ul><li>永久重定向</li><li>资源已永久移动到新位置</li></ul></li><li><p><strong>302 Found</strong></p><ul><li>临时重定向</li><li>资源临时移动到新位置</li></ul></li><li><p><strong>304 Not Modified</strong></p><ul><li>资源未修改</li><li>可使用缓存版本</li></ul></li></ul><h3 id=4xx---客户端错误>4XX - 客户端错误
<a class=anchor href=#4xx---%e5%ae%a2%e6%88%b7%e7%ab%af%e9%94%99%e8%af%af>#</a></h3><ul><li><p><strong>400 Bad Request</strong></p><ul><li>请求语法错误</li><li>服务器无法理解请求</li></ul></li><li><p><strong>401 Unauthorized</strong></p><ul><li>未授权</li><li>需要身份认证</li></ul></li><li><p><strong>403 Forbidden</strong></p><ul><li>禁止访问</li><li>服务器拒绝请求</li></ul></li><li><p><strong>404 Not Found</strong></p><ul><li>资源未找到</li><li>请求的资源不存在</li></ul></li><li><p><strong>429 Too Many Requests</strong></p><ul><li>请求过多</li><li>超出频率限制</li></ul></li></ul><h3 id=5xx---服务器错误>5XX - 服务器错误
<a class=anchor href=#5xx---%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%94%99%e8%af%af>#</a></h3><ul><li><p><strong>500 Internal Server Error</strong></p><ul><li>服务器内部错误</li><li>通常是代码异常</li></ul></li><li><p><strong>502 Bad Gateway</strong></p><ul><li>网关错误</li><li>上游服务器返回无效响应</li></ul></li><li><p><strong>503 Service Unavailable</strong></p><ul><li>服务不可用</li><li>服务器暂时无法处理请求</li></ul></li><li><p><strong>504 Gateway Timeout</strong></p><ul><li>网关超时</li><li>上游服务器响应超时</li></ul></li></ul><h3 id=使用建议>使用建议
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li>在开发 API 时应合理使用状态码</li><li>确保错误响应包含有用的错误信息</li><li>在前端要对不同状态码进行适当处理</li></ol><p>示例代码（前端处理）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;api/data&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>200</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>401</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 跳转到登录页
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/login&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>403</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;没有权限访问&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>404</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;资源不存在&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;服务器错误&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;请求失败:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><p>这些是最基本和常见的 HTTP 状态码，良好地使用它们可以帮助客户端更好地理解请求的处理结果。</p><h2 id=k8s创建pod的过程>k8s创建pod的过程
<a class=anchor href=#k8s%e5%88%9b%e5%bb%bapod%e7%9a%84%e8%bf%87%e7%a8%8b>#</a></h2><p>让我为你详细解释一下 Kubernetes 创建 Pod 的完整过程：</p><h3 id=1-提交请求阶段>1. 提交请求阶段
<a class=anchor href=#1-%e6%8f%90%e4%ba%a4%e8%af%b7%e6%b1%82%e9%98%b6%e6%ae%b5>#</a></h3><ol><li><p><strong>用户提交请求</strong></p><ul><li>通过 kubectl 或 API 提交 Pod 创建请求</li><li>API Server 接收请求并进行认证和授权</li></ul></li><li><p><strong>API Server 处理</strong></p><ul><li>验证 Pod 配置的合法性</li><li>将 Pod 信息持久化到 etcd</li><li>生成 Pod 的唯一标识符</li></ul></li></ol><h3 id=2-调度阶段>2. 调度阶段
<a class=anchor href=#2-%e8%b0%83%e5%ba%a6%e9%98%b6%e6%ae%b5>#</a></h3><ol><li><p><strong>Scheduler 监听</strong></p><ul><li>Scheduler 通过 Watch 机制发现新的未调度 Pod</li></ul></li><li><p><strong>调度算法执行</strong></p><ul><li><p><strong>预选（Predicate）</strong></p><ul><li>筛选符合基本条件的节点</li><li>检查资源是否满足</li><li>检查节点亲和性/污点容忍</li></ul></li><li><p><strong>优选（Priority）</strong></p><ul><li>对预选节点进行打分</li><li>考虑负载均衡</li><li>选择最优节点</li></ul></li></ul></li><li><p><strong>更新调度结果</strong></p><ul><li>将选中节点信息更新到 Pod 对象</li><li>API Server 将更新后的 Pod 信息存储到 etcd</li></ul></li></ol><h3 id=3-创建阶段>3. 创建阶段
<a class=anchor href=#3-%e5%88%9b%e5%bb%ba%e9%98%b6%e6%ae%b5>#</a></h3><ol><li><p><strong>Kubelet 监听</strong></p><ul><li>节点上的 Kubelet 发现被调度到本节点的 Pod</li></ul></li><li><p><strong>容器运行时准备</strong></p><ul><li>准备容器运行环境</li><li>下载容器镜像</li><li>配置容器网络</li></ul></li><li><p><strong>创建容器</strong></p><ul><li>按顺序创建 Init 容器</li><li>创建业务容器</li><li>配置健康检查</li></ul></li></ol><h3 id=4-运行阶段>4. 运行阶段
<a class=anchor href=#4-%e8%bf%90%e8%a1%8c%e9%98%b6%e6%ae%b5>#</a></h3><ol><li><p><strong>状态监控</strong></p><ul><li>Kubelet 持续监控 Pod 状态</li><li>执行配置的探针检查</li><li>更新 Pod 状态到 API Server</li></ul></li><li><p><strong>生命周期管理</strong></p><ul><li>处理容器重启</li><li>执行生命周期钩子</li><li>资源清理</li></ul></li></ol><h3 id=示例-pod-配置>示例 Pod 配置：
<a class=anchor href=#%e7%a4%ba%e4%be%8b-pod-%e9%85%8d%e7%bd%ae>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:pod.yaml data-lang=yaml:pod.yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example-pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>example</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>main-container</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;64Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;250m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;128Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubernetes.io/os</span>: <span style=color:#ae81ff>linux</span>
</span></span></code></pre></div><h3 id=可能的问题和解决方案>可能的问题和解决方案：
<a class=anchor href=#%e5%8f%af%e8%83%bd%e7%9a%84%e9%97%ae%e9%a2%98%e5%92%8c%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88>#</a></h3><ol><li><p><strong>镜像拉取失败</strong></p><ul><li>检查镜像名称是否正确</li><li>确认镜像仓库访问权限</li><li>配置 imagePullSecrets</li></ul></li><li><p><strong>资源不足</strong></p><ul><li>调整资源请求和限制</li><li>增加节点资源</li><li>优化节点调度</li></ul></li><li><p><strong>网络问题</strong></p><ul><li>检查网络插件状态</li><li>验证网络策略配置</li><li>排查 DNS 解析问题</li></ul></li></ol><p>理解这个过程对于排查 Pod 创建问题和优化部署策略非常重要。每个阶段都可能出现问题，了解创建流程有助于快速定位和解决问题。</p><pre tabindex=0><code></code></pre><p>nginx 优化的措施</p><p>让我为你介绍 Nginx 的主要优化措施：</p><h3 id=1-基础配置优化>1. 基础配置优化
<a class=anchor href=#1-%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae%e4%bc%98%e5%8c%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># nginx.conf 主要优化配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>worker_processes</span> <span style=color:#e6db74>auto</span>;                <span style=color:#75715e># 根据 CPU 核心数自动设置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>worker_rlimit_nofile</span> <span style=color:#ae81ff>65535</span>;          <span style=color:#75715e># 增加工作进程文件描述符限制
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>use</span> <span style=color:#e6db74>epoll</span>;                       <span style=color:#75715e># 使用 epoll 事件模型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>worker_connections</span> <span style=color:#ae81ff>65535</span>;        <span style=color:#75715e># 增加每个工作进程的最大连接数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>multi_accept</span> <span style=color:#66d9ef>on</span>;                 <span style=color:#75715e># 开启一次接受多个连接
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 开启 gzip 压缩
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>gzip</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_comp_level</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_min_length</span> <span style=color:#ae81ff>1k</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>application/json</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 缓存相关
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>open_file_cache</span> <span style=color:#e6db74>max=1000</span> <span style=color:#e6db74>inactive=20s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>open_file_cache_valid</span> <span style=color:#e6db74>30s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>open_file_cache_min_uses</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>open_file_cache_errors</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 客户端优化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>client_max_body_size</span> <span style=color:#ae81ff>20m</span>;        <span style=color:#75715e># 上传文件大小限制
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>keepalive_timeout</span> <span style=color:#ae81ff>65</span>;            <span style=color:#75715e># 保持连接超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>client_body_buffer_size</span> <span style=color:#ae81ff>128k</span>;    <span style=color:#75715e># 请求体缓冲区大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=2-静态文件优化>2. 静态文件优化
<a class=anchor href=#2-%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6%e4%bc%98%e5%8c%96>#</a></h3><ol><li><strong>启用缓存控制</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> ~<span style=color:#e6db74>*</span> <span style=color:#e6db74>\.(jpg|jpeg|png|gif|ico|css|js)</span>$ {
</span></span><span style=display:flex><span>    <span style=color:#f92672>expires</span> <span style=color:#e6db74>30d</span>;                     <span style=color:#75715e># 设置缓存过期时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>public</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span> <span style=color:#66d9ef>off</span>;                  <span style=color:#75715e># 关闭访问日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><ol start=2><li><strong>启用 sendfile</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>sendfile</span> <span style=color:#66d9ef>on</span>;                     <span style=color:#75715e># 启用零拷贝
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>tcp_nopush</span> <span style=color:#66d9ef>on</span>;                   <span style=color:#75715e># 优化数据包传输
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>tcp_nodelay</span> <span style=color:#66d9ef>on</span>;                  <span style=color:#75715e># 禁用 Nagle 算法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=3-负载均衡优化>3. 负载均衡优化
<a class=anchor href=#3-%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1%e4%bc%98%e5%8c%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>least_conn</span>;                      <span style=color:#75715e># 最少连接数算法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span> <span style=color:#e6db74>max_fails=3</span> <span style=color:#e6db74>fail_timeout=30s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span> <span style=color:#e6db74>max_fails=3</span> <span style=color:#e6db74>fail_timeout=30s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>keepalive</span> <span style=color:#ae81ff>32</span>;                    <span style=color:#75715e># 保持后端连接数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_next_upstream</span> <span style=color:#e6db74>error</span> <span style=color:#e6db74>timeout</span> <span style=color:#e6db74>http_500</span>;  <span style=color:#75715e># 故障转移
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-ssl-优化>4. SSL 优化
<a class=anchor href=#4-ssl-%e4%bc%98%e5%8c%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span> <span style=color:#e6db74>shared:SSL:10m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span> <span style=color:#ae81ff>10m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># OCSP Stapling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_stapling</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_stapling_verify</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>resolver</span> <span style=color:#ae81ff>8</span><span style=color:#e6db74>.8.8.8</span> <span style=color:#ae81ff>8</span><span style=color:#e6db74>.8.4.4</span> <span style=color:#e6db74>valid=300s</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=5-安全优化>5. 安全优化
<a class=anchor href=#5-%e5%ae%89%e5%85%a8%e4%bc%98%e5%8c%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 隐藏版本号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>server_tokens</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># XSS 防护
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-XSS-Protection</span> <span style=color:#e6db74>&#34;1</span>; <span style=color:#f92672>mode=block&#34;</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 点击劫持防护
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Frame-Options</span> <span style=color:#e6db74>&#34;SAMEORIGIN&#34;</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 限制请求频率
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>limit_req_zone</span> $binary_remote_addr <span style=color:#e6db74>zone=one:10m</span> <span style=color:#e6db74>rate=1r/s</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/login/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>limit_req</span> <span style=color:#e6db74>zone=one</span> <span style=color:#e6db74>burst=5</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=6-日志优化>6. 日志优化
<a class=anchor href=#6-%e6%97%a5%e5%bf%97%e4%bc%98%e5%8c%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 自定义日志格式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>log_format</span> <span style=color:#e6db74>main</span> <span style=color:#e6db74>&#39;</span>$remote_addr <span style=color:#e6db74>-</span> $remote_user <span style=color:#e6db74>[</span>$time_local] <span style=color:#e6db74>&#34;</span>$request&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;</span>$status $body_bytes_sent <span style=color:#e6db74>&#34;</span>$http_referer&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;&#34;</span>$http_user_agent&#34; <span style=color:#e6db74>&#34;</span>$http_x_forwarded_for&#34;&#39;;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 缓冲日志写入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span> <span style=color:#e6db74>main</span> <span style=color:#e6db74>buffer=32k</span> <span style=color:#e6db74>flush=1m</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 对特定资源关闭日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/static/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>access_log</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=7-监控指标>7. 监控指标
<a class=anchor href=#7-%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87>#</a></h3><ul><li>配置 stub_status 模块监控 Nginx 状态：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/nginx_status</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>stub_status</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>allow</span> <span style=color:#ae81ff>127</span><span style=color:#e6db74>.0.0.1</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>deny</span> <span style=color:#e6db74>all</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=优化建议>优化建议：
<a class=anchor href=#%e4%bc%98%e5%8c%96%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>定期监控</strong></p><ul><li>监控连接数</li><li>监控请求延迟</li><li>监控错误率</li><li>监控资源使用</li></ul></li><li><p><strong>性能测试</strong></p><ul><li>使用 ab、wrk 等工具进行压力测试</li><li>根据测试结果调整配置</li></ul></li><li><p><strong>定期维护</strong></p><ul><li>清理日志文件</li><li>更新 SSL 证书</li><li>检查配置是否最优</li></ul></li></ol><p>这些优化措施需要根据实际情况选择性使用，不是所有的优化都适用于所有场景。建议在测试环境验证后再应用到生产环境。</p><h2 id=gitlab的runner-干嘛的>gitlab的runner 干嘛的
<a class=anchor href=#gitlab%e7%9a%84runner-%e5%b9%b2%e5%98%9b%e7%9a%84>#</a></h2><p>GitLab Runner 是 GitLab CI/CD 的执行器，主要负责运行 CI/CD 流水线中定义的作业（Jobs）。让我详细解释一下：</p><h3 id=1-runner-的主要功能>1. Runner 的主要功能
<a class=anchor href=#1-runner-%e7%9a%84%e4%b8%bb%e8%a6%81%e5%8a%9f%e8%83%bd>#</a></h3><ol><li><p><strong>执行 CI/CD 作业</strong></p><ul><li>运行测试</li><li>构建应用</li><li>部署服务</li><li>自动化任务</li></ul></li><li><p><strong>支持多种执行方式</strong></p><ul><li>Shell 执行器</li><li>Docker 执行器</li><li>Kubernetes 执行器</li><li>虚拟机执行器</li></ul></li></ol><h3 id=2-runner-类型>2. Runner 类型
<a class=anchor href=#2-runner-%e7%b1%bb%e5%9e%8b>#</a></h3><ol><li><p><strong>共享 Runner</strong></p><ul><li>所有项目可用</li><li>由 GitLab 管理员配置</li><li>适合通用构建任务</li></ul></li><li><p><strong>特定 Runner</strong></p><ul><li>专门为特定项目服务</li><li>由项目维护者配置</li><li>适合特殊需求的项目</li></ul></li></ol><h3 id=3-配置示例>3. 配置示例
<a class=anchor href=#3-%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b>#</a></h3><p>以下是一个典型的 <code>.gitlab-ci.yml</code> 配置文件示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:.gitlab-ci.yml data-lang=yaml:.gitlab-ci.yml><span style=display:flex><span><span style=color:#f92672>stages</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>build-job</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>echo &#34;编译代码...&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn package</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>artifacts</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>target/*.jar</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>test-job</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>echo &#34;运行测试...&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>deploy-job</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>echo &#34;部署应用...&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>kubectl apply -f pod.yaml</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>only</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>master</span>
</span></span></code></pre></div><h3 id=4-runner-在-kubernetes-中的配置>4. Runner 在 Kubernetes 中的配置
<a class=anchor href=#4-runner-%e5%9c%a8-kubernetes-%e4%b8%ad%e7%9a%84%e9%85%8d%e7%bd%ae>#</a></h3><p>如果使用 Kubernetes 执行器，需要配置类似这样的 Runner：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml:gitlab-runner-k8s.yaml data-lang=yaml:gitlab-runner-k8s.yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab-runner</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>gitlab</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>gitlab-runner</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>gitlab-runner</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab-runner</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>gitlab/gitlab-runner:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>run</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/gitlab-runner</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>docker-sock</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/run/docker.sock</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab-runner-config</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>docker-sock</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>hostPath</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/var/run/docker.sock</span>
</span></span></code></pre></div><h3 id=5-runner-注册配置>5. Runner 注册配置
<a class=anchor href=#5-runner-%e6%b3%a8%e5%86%8c%e9%85%8d%e7%bd%ae>#</a></h3><p>Runner 需要注册到 GitLab 才能使用，配置示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gitlab-runner register <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --non-interactive <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --url <span style=color:#e6db74>&#34;https://gitlab.example.com/&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --registration-token <span style=color:#e6db74>&#34;PROJECT_REGISTRATION_TOKEN&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --executor <span style=color:#e6db74>&#34;docker&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --docker-image alpine:latest <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --description <span style=color:#e6db74>&#34;docker-runner&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --tag-list <span style=color:#e6db74>&#34;docker,aws&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --run-untagged<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --locked<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;false&#34;</span>
</span></span></code></pre></div><h3 id=6-常见使用场景>6. 常见使用场景
<a class=anchor href=#6-%e5%b8%b8%e8%a7%81%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><ol><li><p><strong>自动化测试</strong></p><ul><li>单元测试</li><li>集成测试</li><li>代码质量检查</li></ul></li><li><p><strong>自动化构建</strong></p><ul><li>编译代码</li><li>构建 Docker 镜像</li><li>生成制品</li></ul></li><li><p><strong>自动化部署</strong></p><ul><li>部署到测试环境</li><li>部署到生产环境</li><li>更新 K8s 配置</li></ul></li></ol><h3 id=7-最佳实践>7. 最佳实践
<a class=anchor href=#7-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><p><strong>资源管理</strong></p><ul><li>合理设置并发数</li><li>配置作业超时时间</li><li>清理构建缓存</li></ul></li><li><p><strong>安全考虑</strong></p><ul><li>使用安全的执行器</li><li>限制 Runner 权限</li><li>保护敏感信息</li></ul></li><li><p><strong>性能优化</strong></p><ul><li>使用缓存加速构建</li><li>选择合适的执行器</li><li>优化构建脚本</li></ul></li></ol><p>GitLab Runner 是 CI/CD 流程中的重要组件，合理配置和使用可以大大提高开发团队的效率。</p><h2 id=jenkins常用插件>jenkins常用插件
<a class=anchor href=#jenkins%e5%b8%b8%e7%94%a8%e6%8f%92%e4%bb%b6>#</a></h2><p>让我介绍一下 Jenkins 最常用和最实用的插件：</p><h3 id=1-基础功能插件>1. 基础功能插件
<a class=anchor href=#1-%e5%9f%ba%e7%a1%80%e5%8a%9f%e8%83%bd%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><p><strong>Credentials Plugin</strong></p><ul><li>凭证管理</li><li>存储密码、密钥、Token 等</li><li>支持多种凭证类型</li></ul></li><li><p><strong>Git Plugin</strong></p><ul><li>Git 代码仓库集成</li><li>支持分支、标签管理</li><li>代码检出配置</li></ul></li><li><p><strong>Pipeline</strong></p><ul><li>流水线支持</li><li>支持 Jenkinsfile</li><li>可视化流水线编辑器</li></ul></li></ol><h3 id=2-构建相关插件>2. 构建相关插件
<a class=anchor href=#2-%e6%9e%84%e5%bb%ba%e7%9b%b8%e5%85%b3%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><strong>Maven Integration</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    tools <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        maven <span style=color:#e6db74>&#39;Maven 3.8.1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Build&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                sh <span style=color:#e6db74>&#39;mvn clean package&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Gradle Plugin</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Build&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                gradle <span style=color:#e6db74>&#39;clean build&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=3-容器相关插件>3. 容器相关插件
<a class=anchor href=#3-%e5%ae%b9%e5%99%a8%e7%9b%b8%e5%85%b3%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><strong>Docker Plugin</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        docker <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            image <span style=color:#e6db74>&#39;maven:3.8.1-jdk-8&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Build&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                sh <span style=color:#e6db74>&#39;mvn package&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Kubernetes Plugin</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        kubernetes <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            yaml <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  - name: maven
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    image: maven:3.8.1-jdk-8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    command:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - cat
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    tty: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Build&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;mvn package&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=4-代码质量插件>4. 代码质量插件
<a class=anchor href=#4-%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><strong>SonarQube Scanner</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;SonarQube Analysis&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                withSonarQubeEnv<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;SonarQube&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;mvn sonar:sonar&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Checkstyle</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Code Analysis&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                sh <span style=color:#e6db74>&#39;mvn checkstyle:checkstyle&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            post <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                always <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    recordIssues<span style=color:#f92672>(</span>tools: <span style=color:#f92672>[</span>checkStyle<span style=color:#f92672>()])</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=5-通知类插件>5. 通知类插件
<a class=anchor href=#5-%e9%80%9a%e7%9f%a5%e7%b1%bb%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><strong>Email Extension Plugin</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    post <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        failure <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            emailext <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                subject: <span style=color:#e6db74>&#34;构建失败: ${env.JOB_NAME} [${env.BUILD_NUMBER}]&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                body: <span style=color:#e6db74>&#34;&#34;&#34;&lt;p&gt;构建失败:&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;p&gt;查看: &lt;a href=&#39;${env.BUILD_URL}&#39;&gt;${env.JOB_NAME} [${env.BUILD_NUMBER}]&lt;/a&gt;&lt;/p&gt;&#34;&#34;&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                to: <span style=color:#e6db74>&#34;team@example.com&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li><strong>钉钉通知插件</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    post <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        always <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            dingtalk <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                robot: <span style=color:#e6db74>&#39;钉钉机器人TOKEN&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                type: <span style=color:#e6db74>&#39;MARKDOWN&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                title: <span style=color:#e6db74>&#39;构建通知&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                text: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;### 构建结果: ${currentBuild.result}&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;- 项目: ${env.JOB_NAME}&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;- 构建号: ${env.BUILD_NUMBER}&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;- 详情: [查看](${env.BUILD_URL})&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=6-其他实用插件>6. 其他实用插件
<a class=anchor href=#6-%e5%85%b6%e4%bb%96%e5%ae%9e%e7%94%a8%e6%8f%92%e4%bb%b6>#</a></h3><ol><li><p><strong>Timestamper</strong></p><ul><li>为控制台输出添加时间戳</li><li>方便调试和日志分析</li></ul></li><li><p><strong>AnsiColor</strong></p><ul><li>支持控制台彩色输出</li><li>提高日志可读性</li></ul></li><li><p><strong>Build Timeout</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// Jenkinsfile 示例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        timeout<span style=color:#f92672>(</span>time: <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> unit: <span style=color:#e6db74>&#39;HOURS&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Build&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                sh <span style=color:#e6db74>&#39;mvn package&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=安装建议>安装建议
<a class=anchor href=#%e5%ae%89%e8%a3%85%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>按需安装</strong></p><ul><li>避免安装过多不必要的插件</li><li>定期清理未使用的插件</li></ul></li><li><p><strong>版本兼容</strong></p><ul><li>注意插件之间的版本兼容性</li><li>定期更新插件到最新稳定版</li></ul></li><li><p><strong>性能考虑</strong></p><ul><li>插件过多会影响 Jenkins 性能</li><li>建议只保留必要的插件</li></ul></li></ol><p>这些插件能够显著提升 Jenkins 的功能和使用体验，但建议根据实际需求选择安装。</p><h2 id=声明式和脚本式的jenkins的写法举例>声明式和脚本式的jenkins的写法举例
<a class=anchor href=#%e5%a3%b0%e6%98%8e%e5%bc%8f%e5%92%8c%e8%84%9a%e6%9c%ac%e5%bc%8f%e7%9a%84jenkins%e7%9a%84%e5%86%99%e6%b3%95%e4%b8%be%e4%be%8b>#</a></h2><p>让我介绍几种 Jenkins 运行多个任务的方案：</p><h3 id=1-并行执行-parallel>1. 并行执行 (Parallel)
<a class=anchor href=#1-%e5%b9%b6%e8%a1%8c%e6%89%a7%e8%a1%8c-parallel>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    stages {
        stage(&#39;并行任务&#39;) {
            parallel {
                stage(&#39;任务A&#39;) {
                    steps {
                        sh &#39;mvn test -Dtest=TestA&#39;
                    }
                }
                stage(&#39;任务B&#39;) {
                    steps {
                        sh &#39;mvn test -Dtest=TestB&#39;
                    }
                }
                stage(&#39;任务C&#39;) {
                    steps {
                        sh &#39;docker build -t imageA .&#39;
                    }
                }
            }
        }
    }
}
</code></pre><h3 id=2-矩阵构建-matrix>2. 矩阵构建 (Matrix)
<a class=anchor href=#2-%e7%9f%a9%e9%98%b5%e6%9e%84%e5%bb%ba-matrix>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    matrix {
        axes {
            axis {
                name &#39;PLATFORM&#39;
                values &#39;linux&#39;, &#39;windows&#39;, &#39;mac&#39;
            }
            axis {
                name &#39;BROWSER&#39;
                values &#39;chrome&#39;, &#39;firefox&#39;, &#39;safari&#39;
            }
        }
        
        stages {
            stage(&#39;测试&#39;) {
                steps {
                    sh &#34;run-tests.sh ${PLATFORM} ${BROWSER}&#34;
                }
            }
        }
    }
}
</code></pre><h3 id=3-多分支流水线>3. 多分支流水线
<a class=anchor href=#3-%e5%a4%9a%e5%88%86%e6%94%af%e6%b5%81%e6%b0%b4%e7%ba%bf>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    stages {
        stage(&#39;构建&#39;) {
            when {
                anyOf {
                    branch &#39;main&#39;
                    branch &#39;develop&#39;
                    branch &#39;feature/*&#39;
                }
            }
            steps {
                sh &#39;mvn clean package&#39;
            }
        }
        
        stage(&#39;部署开发环境&#39;) {
            when { branch &#39;develop&#39; }
            steps {
                sh &#39;deploy-to-dev.sh&#39;
            }
        }
        
        stage(&#39;部署生产环境&#39;) {
            when { branch &#39;main&#39; }
            steps {
                sh &#39;deploy-to-prod.sh&#39;
            }
        }
    }
}
</code></pre><h3 id=4-上游下游任务-upstreamdownstream>4. 上游/下游任务 (Upstream/Downstream)
<a class=anchor href=#4-%e4%b8%8a%e6%b8%b8%e4%b8%8b%e6%b8%b8%e4%bb%bb%e5%8a%a1-upstreamdownstream>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    stages {
        stage(&#39;触发下游任务&#39;) {
            steps {
                build job: &#39;downstream-job-1&#39;, wait: false
                build job: &#39;downstream-job-2&#39;, wait: false
                
                parallel (
                    &#34;任务1&#34;: {
                        build job: &#39;parallel-job-1&#39;
                    },
                    &#34;任务2&#34;: {
                        build job: &#39;parallel-job-2&#39;
                    }
                )
            }
        }
    }
    
    post {
        success {
            build job: &#39;notification-job&#39;, 
                  parameters: [string(name: &#39;STATUS&#39;, value: &#39;SUCCESS&#39;)]
        }
    }
}
</code></pre><h3 id=5-参数化构建矩阵>5. 参数化构建矩阵
<a class=anchor href=#5-%e5%8f%82%e6%95%b0%e5%8c%96%e6%9e%84%e5%bb%ba%e7%9f%a9%e9%98%b5>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    parameters {
        choice(
            name: &#39;ENVIRONMENT&#39;,
            choices: [&#39;dev&#39;, &#39;test&#39;, &#39;prod&#39;],
            description: &#39;选择部署环境&#39;
        )
        booleanParam(
            name: &#39;RUN_TESTS&#39;,
            defaultValue: true,
            description: &#39;是否运行测试&#39;
        )
    }
    
    stages {
        stage(&#39;并行任务&#39;) {
            parallel {
                stage(&#39;部署&#39;) {
                    steps {
                        sh &#34;deploy-to-${params.ENVIRONMENT}.sh&#34;
                    }
                }
                stage(&#39;测试&#39;) {
                    when { expression { params.RUN_TESTS } }
                    steps {
                        sh &#39;run-tests.sh&#39;
                    }
                }
            }
        }
    }
}
</code></pre><h3 id=6-资源分配和限制>6. 资源分配和限制
<a class=anchor href=#6-%e8%b5%84%e6%ba%90%e5%88%86%e9%85%8d%e5%92%8c%e9%99%90%e5%88%b6>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent none
    
    stages {
        stage(&#39;并行构建&#39;) {
            parallel {
                stage(&#39;Java构建&#39;) {
                    agent {
                        label &#39;java-builder&#39;
                    }
                    steps {
                        sh &#39;mvn clean package&#39;
                    }
                }
                stage(&#39;Node构建&#39;) {
                    agent {
                        label &#39;node-builder&#39;
                    }
                    steps {
                        sh &#39;npm install &amp;&amp; npm run build&#39;
                    }
                }
            }
        }
    }
    
    options {
        parallelsAlwaysFailFast()
    }
}
</code></pre><h3 id=最佳实践建议>最佳实践建议：
<a class=anchor href=#%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e5%bb%ba%e8%ae%ae>#</a></h3><ol><li><p><strong>资源管理</strong></p><ul><li>合理设置并发数</li><li>注意资源使用限制</li><li>避免资源竞争</li></ul></li><li><p><strong>错误处理</strong></p><ul><li>设置超时限制</li><li>合理处理任务失败</li><li>配置重试机制</li></ul></li><li><p><strong>性能优化</strong></p><ul><li>合理使用并行执行</li><li>避免不必要的等待</li><li>优化构建顺序</li></ul></li><li><p><strong>监控和通知</strong></p><ul><li>配置构建状态通知</li><li>监控资源使用情况</li><li>记录构建历史</li></ul></li></ol><p>通过这些方式，你可以根据具体需求选择合适的多任务执行方案，提高构建效率和资源利用率。</p><h2 id=怎么确保密码-这些不会明文写到流水线里面>怎么确保密码 这些不会明文写到流水线里面
<a class=anchor href=#%e6%80%8e%e4%b9%88%e7%a1%ae%e4%bf%9d%e5%af%86%e7%a0%81-%e8%bf%99%e4%ba%9b%e4%b8%8d%e4%bc%9a%e6%98%8e%e6%96%87%e5%86%99%e5%88%b0%e6%b5%81%e6%b0%b4%e7%ba%bf%e9%87%8c%e9%9d%a2>#</a></h2><p>在 Jenkins 中，有几个关于敏感信息输出的重要注意点：</p><h3 id=1-默认行为>1. 默认行为
<a class=anchor href=#1-%e9%bb%98%e8%ae%a4%e8%a1%8c%e4%b8%ba>#</a></h3><ol><li><strong>凭据变量</strong></li></ol><ul><li>通过 <code>credentials()</code> 绑定的变量默认是被 Jenkins 保护的</li><li>即使使用 <code>echo $PASSWORD</code> 也会显示为 <code>****</code></li></ul><ol start=2><li><strong>环境变量</strong></li></ol><ul><li>普通环境变量不会自动被掩码</li><li>需要特别注意不要直接打印</li></ul><h3 id=2-安全处理示例>2. 安全处理示例
<a class=anchor href=#2-%e5%ae%89%e5%85%a8%e5%a4%84%e7%90%86%e7%a4%ba%e4%be%8b>#</a></h3><pre tabindex=0><code class=language-groovy:Jenkinsfile data-lang=groovy:Jenkinsfile>pipeline {
    agent any
    
    environment {
        // 这样定义的凭据会自动被保护
        DB_CREDS = credentials(&#39;db-credentials&#39;)
        // 普通环境变量需要注意保护
        API_KEY = &#39;sensitive-value&#39;
    }
    
    stages {
        stage(&#39;安全示例&#39;) {
            steps {
                script {
                    // 错误示例 - 不要这样做
                    // sh &#34;echo $API_KEY&#34;  // 会暴露敏感信息
                    
                    // 正确示例
                    wrap([$class: &#39;MaskPasswordsBuildWrapper&#39;, 
                          varPasswordPairs: [[var: &#39;API_KEY&#39;, password: env.API_KEY]]]) {
                        // 现在 API_KEY 会被自动掩码
                        sh &#39;curl -H &#34;Authorization: Bearer $API_KEY&#34; https://api.example.com&#39;
                    }
                }
                
                // credentials() 绑定的变量会自动被保护
                withCredentials([
                    usernamePassword(
                        credentialsId: &#39;my-credentials&#39;,
                        usernameVariable: &#39;USER&#39;,
                        passwordVariable: &#39;PASS&#39;
                    )
                ]) {
                    // 即使echo，也会显示为 ****
                    sh &#39;echo $PASS&#39;
                }
            }
        }
    }
}
</code></pre><h3 id=3-最佳实践>3. 最佳实践
<a class=anchor href=#3-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><strong>使用凭据插件</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>withCredentials<span style=color:#f92672>([</span>string<span style=color:#f92672>(</span>credentialsId: <span style=color:#e6db74>&#39;my-secret&#39;</span><span style=color:#f92672>,</span> variable: <span style=color:#e6db74>&#39;SECRET&#39;</span><span style=color:#f92672>)])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// SECRET 变量会自动被掩码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    sh <span style=color:#e6db74>&#39;./deploy.sh&#39;</span>  <span style=color:#75715e>// 在脚本中使用 $SECRET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li><strong>使用掩码包装器</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>wrap<span style=color:#f92672>([</span>$class<span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;MaskPasswordsBuildWrapper&#39;</span><span style=color:#f92672>,</span> varPasswordPairs: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[</span><span style=color:#66d9ef>var</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;PASSWORD&#39;</span><span style=color:#f92672>,</span> password: <span style=color:#e6db74>&#39;sensitive-value&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 所有输出中的 &#39;sensitive-value&#39; 都会被替换为 ****
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    sh <span style=color:#e6db74>&#39;your-command&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=3><li><strong>避免直接输出</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#75715e>// 不要这样做
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>sh <span style=color:#e6db74>&#34;echo &#39;Using password: $PASSWORD&#39;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 而是这样
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>sh <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if [ -n &#34;$PASSWORD&#34; ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34;Password is configured&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        echo &#34;Password is missing&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>
</span></span></code></pre></div><ol start=4><li><strong>日志处理</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置构建日志保留策略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    buildDiscarder<span style=color:#f92672>(</span>logRotator<span style=color:#f92672>(</span>numToKeepStr: <span style=color:#e6db74>&#39;10&#39;</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=4-安全检查清单>4. 安全检查清单
<a class=anchor href=#4-%e5%ae%89%e5%85%a8%e6%a3%80%e6%9f%a5%e6%b8%85%e5%8d%95>#</a></h3><ol><li><strong>避免</strong></li></ol><ul><li>直接 echo 敏感变量</li><li>在命令参数中显示密码</li><li>在构建日志中保留敏感信息</li></ul><ol start=2><li><strong>应该</strong></li></ol><ul><li>使用凭据插件管理敏感信息</li><li>使用掩码包装器保护变量</li><li>定期审查构建日志</li><li>限制日志访问权限</li></ul><ol start=3><li><strong>配置建议</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 禁用并发构建
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        disableConcurrentBuilds<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置超时
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        timeout<span style=color:#f92672>(</span>time: <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> unit: <span style=color:#e6db74>&#39;HOURS&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    environment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用凭据绑定
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        DEPLOY_KEY <span style=color:#f92672>=</span> credentials<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;deploy-key&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;部署&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 使用安全的方式处理敏感信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                withCredentials<span style=color:#f92672>([</span>
</span></span><span style=display:flex><span>                    file<span style=color:#f92672>(</span>credentialsId: <span style=color:#e6db74>&#39;kubeconfig&#39;</span><span style=color:#f92672>,</span> variable: <span style=color:#e6db74>&#39;KUBECONFIG&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;kubectl apply -f deployment.yaml&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>通过这些措施，可以有效防止敏感信息在构建过程中被泄露。</p><h2 id=说下你对容器和k8s的理解>说下你对容器和k8s的理解
<a class=anchor href=#%e8%af%b4%e4%b8%8b%e4%bd%a0%e5%af%b9%e5%ae%b9%e5%99%a8%e5%92%8ck8s%e7%9a%84%e7%90%86%e8%a7%a3>#</a></h2><p>让我分享下对容器和 Kubernetes 的理解：</p><h3 id=1-容器的本质>1. 容器的本质
<a class=anchor href=#1-%e5%ae%b9%e5%99%a8%e7%9a%84%e6%9c%ac%e8%b4%a8>#</a></h3><ol><li><p><strong>隔离性</strong></p><ul><li>使用 Linux 的 Namespace 技术实现资源隔离</li><li>每个容器有自己的进程空间、网络空间、挂载空间等</li><li>容器间互不影响</li></ul></li><li><p><strong>资源限制</strong></p><ul><li>使用 Linux 的 Cgroups 技术限制资源使用</li><li>可以限制 CPU、内存、IO 等资源</li><li>防止单个容器占用过多资源</li></ul></li><li><p><strong>轻量级</strong></p><ul><li>共享主机内核</li><li>秒级启动</li><li>资源利用率高</li></ul></li></ol><h3 id=2-k8s-的核心功能>2. K8s 的核心功能
<a class=anchor href=#2-k8s-%e7%9a%84%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd>#</a></h3><ol><li><strong>自动化管理</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Deployment 自动管理 Pod 的生命周期</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>  <span style=color:#75715e># 自动维护3个副本</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:alpine</span>
</span></span></code></pre></div><ol start=2><li><p><strong>自愈能力</strong></p><ul><li>节点故障自动迁移</li><li>容器崩溃自动重启</li><li>健康检查和恢复</li></ul></li><li><p><strong>负载均衡</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Service 提供负载均衡</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=3-架构设计理念>3. 架构设计理念
<a class=anchor href=#3-%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5>#</a></h3><ol><li><p><strong>声明式 API</strong></p><ul><li>描述期望状态</li><li>系统自动调整实际状态</li><li>易于维护和自动化</li></ul></li><li><p><strong>控制器模式</strong></p><ul><li>每个控制器负责特定资源</li><li>持续监控和调整状态</li><li>松耦合设计</li></ul></li><li><p><strong>水平扩展</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># HPA 自动扩缩容</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>autoscaling/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HorizontalPodAutoscaler</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-hpa</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scaleTargetRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>metrics</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resource</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cpu</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Utilization</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>averageUtilization</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=4-实际应用场景>4. 实际应用场景
<a class=anchor href=#4-%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af>#</a></h3><ol><li><p><strong>微服务架构</strong></p><ul><li>服务独立部署</li><li>快速迭代</li><li>弹性伸缩</li></ul></li><li><p><strong>DevOps 实践</strong></p><ul><li>持续集成/部署</li><li>自动化运维</li><li>环境一致性</li></ul></li><li><p><strong>高可用设计</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Pod 反亲和性确保高可用</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>webapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                - <span style=color:#ae81ff>webapp</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>topologyKey</span>: <span style=color:#e6db74>&#34;kubernetes.io/hostname&#34;</span>
</span></span></code></pre></div><h3 id=5-生产环境考虑>5. 生产环境考虑
<a class=anchor href=#5-%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e8%80%83%e8%99%91>#</a></h3><ol><li><p><strong>资源管理</strong></p><ul><li>合理设置请求和限制</li><li>资源预留和超卖</li><li>成本优化</li></ul></li><li><p><strong>安全性</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 网络策略隔离</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>NetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>api-allow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>api</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>from</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>app</span>: <span style=color:#ae81ff>frontend</span>
</span></span></code></pre></div><ol start=3><li><strong>可观测性</strong><ul><li>监控指标</li><li>日志收集</li><li>链路追踪</li></ul></li></ol><h3 id=6-最佳实践>6. 最佳实践
<a class=anchor href=#6-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5>#</a></h3><ol><li><p><strong>容器设计</strong></p><ul><li>单一职责</li><li>无状态设计</li><li>合理的资源限制</li><li>健康检查</li></ul></li><li><p><strong>K8s 配置</strong></p><ul><li>使用命名空间隔离</li><li>实施资源配额</li><li>RBAC 权限控制</li><li>备份和恢复策略</li></ul></li><li><p><strong>运维管理</strong></p><ul><li>监控告警</li><li>日志管理</li><li>灾备方案</li><li>升级策略</li></ul></li></ol><p>容器和 Kubernetes 的结合极大地改变了应用部署和运维的方式，提供了一个强大的平台来运行和管理现代应用。理解它们的核心概念和最佳实践对于构建可靠的生产系统至关重要。</p><p>我看到你有一个 pod.yaml 文件，让我基于这个实际的配置文件来进一步解释一些重要概念。</p><p>从你的 pod.yaml 文件中可以看到几个关键的最佳实践：</p><h3 id=1-资源管理>1. 资源管理
<a class=anchor href=#1-%e8%b5%84%e6%ba%90%e7%ae%a1%e7%90%86>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;64Mi&#34;</span>    <span style=color:#75715e># 保证最小内存</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;250m&#34;</span>       <span style=color:#75715e># 0.25 CPU</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;256Mi&#34;</span>   <span style=color:#75715e># 内存上限</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>       <span style=color:#75715e># 0.5 CPU</span>
</span></span></code></pre></div><p>这里展示了合理的资源控制：</p><ul><li>requests: 保证 Pod 运行的最小资源</li><li>limits: 限制资源使用的上限</li><li>设置合适的比例（limits/requests）避免资源浪费</li></ul><h3 id=2-健康检查>2. 健康检查
<a class=anchor href=#2-%e5%81%a5%e5%ba%b7%e6%a3%80%e6%9f%a5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>20</span>
</span></span></code></pre></div><p>两种探针的使用：</p><ul><li>readinessProbe: 确定 Pod 是否准备好接收流量</li><li>livenessProbe: 确定 Pod 是否需要重启</li></ul><h3 id=3-配置管理>3. 配置管理
<a class=anchor href=#3-%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/app/config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app-config</span>
</span></span></code></pre></div><p>使用 ConfigMap 管理配置：</p><ul><li>配置与代码分离</li><li>可以动态更新</li><li>便于环境管理</li></ul><h3 id=4-节点选择>4. 节点选择
<a class=anchor href=#4-%e8%8a%82%e7%82%b9%e9%80%89%e6%8b%a9>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kubernetes.io/os</span>: <span style=color:#ae81ff>linux</span>
</span></span></code></pre></div><p>通过标签选择合适的节点：</p><ul><li>确保 Pod 调度到正确的节点</li><li>可以基于操作系统、硬件特性等选择</li></ul><p>这些配置反映了在生产环境中运行容器的几个重要考虑点：</p><ol><li>资源控制</li><li>可靠性保证</li><li>配置管理</li><li>调度策略</li></ol><p>这是一个比较完善的 Pod 配置，体现了 K8s 的核心价值：自动化管理、高可用性和可维护性。</p><h2 id=你用过go或者python写东西吗-有关运维的-devops的>你用过go或者python写东西吗 有关运维的 devops的
<a class=anchor href=#%e4%bd%a0%e7%94%a8%e8%bf%87go%e6%88%96%e8%80%85python%e5%86%99%e4%b8%9c%e8%a5%bf%e5%90%97-%e6%9c%89%e5%85%b3%e8%bf%90%e7%bb%b4%e7%9a%84-devops%e7%9a%84>#</a></h2><p>是的，我经常使用 Python 和 Go 来编写运维和 DevOps 相关的工具。让我分享一些常见的场景和示例：</p><h3 id=1-python-自动化运维示例>1. Python 自动化运维示例
<a class=anchor href=#1-python-%e8%87%aa%e5%8a%a8%e5%8c%96%e8%bf%90%e7%bb%b4%e7%a4%ba%e4%be%8b>#</a></h3><ol><li><strong>K8s 资源监控</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> kubernetes <span style=color:#f92672>import</span> client, config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>monitor_pods</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># 加载 k8s 配置</span>
</span></span><span style=display:flex><span>    config<span style=color:#f92672>.</span>load_kube_config()
</span></span><span style=display:flex><span>    v1 <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>CoreV1Api()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 获取所有 namespace 的 pods</span>
</span></span><span style=display:flex><span>        pods <span style=color:#f92672>=</span> v1<span style=color:#f92672>.</span>list_pod_for_all_namespaces(watch<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> pod <span style=color:#f92672>in</span> pods<span style=color:#f92672>.</span>items:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Pod: </span><span style=color:#e6db74>{</span>pod<span style=color:#f92672>.</span>metadata<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Namespace: </span><span style=color:#e6db74>{</span>pod<span style=color:#f92672>.</span>metadata<span style=color:#f92672>.</span>namespace<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Status: </span><span style=color:#e6db74>{</span>pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>phase<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># 检查资源使用</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>container_statuses:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> container <span style=color:#f92672>in</span> pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>container_statuses:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Container: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Ready: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>ready<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Restart Count: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>restart_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    monitor_pods()
</span></span></code></pre></div><ol start=2><li><strong>日志分析工具</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>analyze_nginx_logs</span>(log_file):
</span></span><span style=display:flex><span>    <span style=color:#75715e># 定义日志格式正则</span>
</span></span><span style=display:flex><span>    pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;(?P&lt;ip&gt;.*?) - - \[(?P&lt;time&gt;.*?)\] &#34;(?P&lt;request&gt;.*?)&#34; (?P&lt;status&gt;\d+) (?P&lt;size&gt;\d+)&#39;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    logs <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(log_file, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> f:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>match</span> <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(pattern, line)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>match</span>:
</span></span><span style=display:flex><span>                data <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span><span style=color:#f92672>.</span>groupdict()
</span></span><span style=display:flex><span>                data[<span style=color:#e6db74>&#39;time&#39;</span>] <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>strptime(data[<span style=color:#e6db74>&#39;time&#39;</span>], <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>/%b/%Y:%H:%M:%S %z&#39;</span>)
</span></span><span style=display:flex><span>                logs<span style=color:#f92672>.</span>append(data)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># 转换为 DataFrame 分析</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(logs)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;total_requests&#39;</span>: len(df),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;status_codes&#39;</span>: df[<span style=color:#e6db74>&#39;status&#39;</span>]<span style=color:#f92672>.</span>value_counts()<span style=color:#f92672>.</span>to_dict(),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;top_ips&#39;</span>: df[<span style=color:#e6db74>&#39;ip&#39;</span>]<span style=color:#f92672>.</span>value_counts()<span style=color:#f92672>.</span>head(<span style=color:#ae81ff>10</span>)<span style=color:#f92672>.</span>to_dict()
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=2-go-运维工具示例>2. Go 运维工具示例
<a class=anchor href=#2-go-%e8%bf%90%e7%bb%b4%e5%b7%a5%e5%85%b7%e7%a4%ba%e4%be%8b>#</a></h3><ol><li><strong>Docker 容器监控</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/api/types&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/client&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>monitorContainers</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cli</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>NewClientWithOpts</span>(<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>FromEnv</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>containers</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>ContainerList</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ContainerListOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>containers</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stats</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cli</span>.<span style=color:#a6e22e>ContainerStats</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>ID</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error getting stats for %s: %v\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>ID</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Container: %s\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Names</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Status: %s\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Status</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Stats: %v\n&#34;</span>, <span style=color:#a6e22e>stats</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li><strong>自动化部署工具</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appsv1</span> <span style=color:#e6db74>&#34;k8s.io/api/apps/v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span> <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>deployApplication</span>(<span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>image</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 加载 kubeconfig</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientcmd</span>.<span style=color:#a6e22e>BuildConfigFromFlags</span>(<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;~/.kube/config&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建 clientset</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clientset</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>NewForConfig</span>(<span style=color:#a6e22e>config</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建 deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deployment</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>appsv1</span>.<span style=color:#a6e22e>Deployment</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ObjectMeta</span>: <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Spec</span>: <span style=color:#a6e22e>appsv1</span>.<span style=color:#a6e22e>DeploymentSpec</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Replicas</span>: <span style=color:#a6e22e>int32Ptr</span>(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Selector</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>LabelSelector</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>MatchLabels</span>: <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;app&#34;</span>: <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Template</span>: <span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>PodTemplateSpec</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ObjectMeta</span>: <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span>{
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>Labels</span>: <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;app&#34;</span>: <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>                    },
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Spec</span>: <span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>PodSpec</span>{
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>Containers</span>: []<span style=color:#a6e22e>corev1</span>.<span style=color:#a6e22e>Container</span>{
</span></span><span style=display:flex><span>                        {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>Name</span>:  <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>Image</span>: <span style=color:#a6e22e>image</span>,
</span></span><span style=display:flex><span>                        },
</span></span><span style=display:flex><span>                    },
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 执行部署</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>clientset</span>.<span style=color:#a6e22e>AppsV1</span>().<span style=color:#a6e22e>Deployments</span>(<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>(), <span style=color:#a6e22e>deployment</span>, <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>CreateOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-实用的-devops-脚本>3. 实用的 DevOps 脚本
<a class=anchor href=#3-%e5%ae%9e%e7%94%a8%e7%9a%84-devops-%e8%84%9a%e6%9c%ac>#</a></h3><ol><li><strong>CI/CD 辅助工具</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GitlabCI</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, token, url):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>token <span style=color:#f92672>=</span> token
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> url
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>headers <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;PRIVATE-TOKEN&#39;</span>: token}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>trigger_pipeline</span>(self, project_id, ref<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;main&#39;</span>):
</span></span><span style=display:flex><span>        endpoint <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>/api/v4/projects/</span><span style=color:#e6db74>{</span>project_id<span style=color:#e6db74>}</span><span style=color:#e6db74>/pipeline&#34;</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;ref&#39;</span>: ref}
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(endpoint, headers<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>headers, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_pipeline_status</span>(self, project_id, pipeline_id):
</span></span><span style=display:flex><span>        endpoint <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>self<span style=color:#f92672>.</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>/api/v4/projects/</span><span style=color:#e6db74>{</span>project_id<span style=color:#e6db74>}</span><span style=color:#e6db74>/pipelines/</span><span style=color:#e6db74>{</span>pipeline_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(endpoint, headers<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>headers)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> response<span style=color:#f92672>.</span>json()
</span></span></code></pre></div><ol start=2><li><strong>资源清理工具</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> kubernetes <span style=color:#f92672>import</span> client, config
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cleanup_old_pods</span>(namespace, hours<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>):
</span></span><span style=display:flex><span>    config<span style=color:#f92672>.</span>load_kube_config()
</span></span><span style=display:flex><span>    v1 <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>CoreV1Api()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        pods <span style=color:#f92672>=</span> v1<span style=color:#f92672>.</span>list_namespaced_pod(namespace)
</span></span><span style=display:flex><span>        now <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now(timezone<span style=color:#f92672>.</span>utc)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> pod <span style=color:#f92672>in</span> pods<span style=color:#f92672>.</span>items:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>phase <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;Failed&#39;</span>, <span style=color:#e6db74>&#39;Succeeded&#39;</span>]:
</span></span><span style=display:flex><span>                created_time <span style=color:#f92672>=</span> pod<span style=color:#f92672>.</span>metadata<span style=color:#f92672>.</span>creation_timestamp
</span></span><span style=display:flex><span>                age <span style=color:#f92672>=</span> now <span style=color:#f92672>-</span> created_time
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> age <span style=color:#f92672>&gt;</span> timedelta(hours<span style=color:#f92672>=</span>hours):
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Deleting pod: </span><span style=color:#e6db74>{</span>pod<span style=color:#f92672>.</span>metadata<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    v1<span style=color:#f92672>.</span>delete_namespaced_pod(
</span></span><span style=display:flex><span>                        pod<span style=color:#f92672>.</span>metadata<span style=color:#f92672>.</span>name,
</span></span><span style=display:flex><span>                        namespace,
</span></span><span style=display:flex><span>                        body<span style=color:#f92672>=</span>client<span style=color:#f92672>.</span>V1DeleteOptions()
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error during cleanup: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><p>这些工具都是基于实际运维需求开发的。主要特点：</p><ol><li><p><strong>自动化</strong></p><ul><li>减少人工操作</li><li>提高效率</li><li>降低错误率</li></ul></li><li><p><strong>监控告警</strong></p><ul><li>实时监控系统状态</li><li>及时发现问题</li><li>自动处理或通知</li></ul></li><li><p><strong>运维管理</strong></p><ul><li>资源清理</li><li>配置管理</li><li>日志分析</li></ul></li><li><p><strong>持续集成/部署</strong></p><ul><li>自动化构建</li><li>自动化测试</li><li>自动化部署</li></ul></li></ol><p>根据实际需求，这些工具可以进一步定制和扩展。</p><p>让我基于你的 pod.yaml 文件，写一个实用的 Python 脚本来监控和管理这个 Pod：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> kubernetes <span style=color:#f92672>import</span> client, config
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>basicConfig(level<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO)
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PodMonitor</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, namespace<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;default&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 加载 k8s 配置</span>
</span></span><span style=display:flex><span>        config<span style=color:#f92672>.</span>load_kube_config()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>v1 <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>CoreV1Api()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>namespace <span style=color:#f92672>=</span> namespace
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>monitor_pod_resources</span>(self, pod_name):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;监控 Pod 的资源使用情况&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            pod <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>v1<span style=color:#f92672>.</span>read_namespaced_pod(pod_name, self<span style=color:#f92672>.</span>namespace)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># 检查资源限制和请求</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> container <span style=color:#f92672>in</span> pod<span style=color:#f92672>.</span>spec<span style=color:#f92672>.</span>containers:
</span></span><span style=display:flex><span>                resources <span style=color:#f92672>=</span> container<span style=color:#f92672>.</span>resources
</span></span><span style=display:flex><span>                logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Container: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Resource Limits: </span><span style=color:#e6db74>{</span>resources<span style=color:#f92672>.</span>limits<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Resource Requests: </span><span style=color:#e6db74>{</span>resources<span style=color:#f92672>.</span>requests<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 检查 Pod 状态</span>
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Pod Status: </span><span style=color:#e6db74>{</span>pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>phase<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># 检查就绪状态</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>container_statuses:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> container <span style=color:#f92672>in</span> pod<span style=color:#f92672>.</span>status<span style=color:#f92672>.</span>container_statuses:
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Container </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74> Ready: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>ready<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Restart Count: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>restart_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error monitoring pod </span><span style=color:#e6db74>{</span>pod_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_probes</span>(self, pod_name):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;检查 Pod 的健康检查状态&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            pod <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>v1<span style=color:#f92672>.</span>read_namespaced_pod(pod_name, self<span style=color:#f92672>.</span>namespace)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> container <span style=color:#f92672>in</span> pod<span style=color:#f92672>.</span>spec<span style=color:#f92672>.</span>containers:
</span></span><span style=display:flex><span>                logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Container: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> container<span style=color:#f92672>.</span>readiness_probe:
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;Readiness Probe:&#34;</span>)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Initial Delay: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>readiness_probe<span style=color:#f92672>.</span>initial_delay_seconds<span style=color:#e6db74>}</span><span style=color:#e6db74>s&#34;</span>)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Period: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>readiness_probe<span style=color:#f92672>.</span>period_seconds<span style=color:#e6db74>}</span><span style=color:#e6db74>s&#34;</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> container<span style=color:#f92672>.</span>liveness_probe:
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;Liveness Probe:&#34;</span>)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Initial Delay: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>liveness_probe<span style=color:#f92672>.</span>initial_delay_seconds<span style=color:#e6db74>}</span><span style=color:#e6db74>s&#34;</span>)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Period: </span><span style=color:#e6db74>{</span>container<span style=color:#f92672>.</span>liveness_probe<span style=color:#f92672>.</span>period_seconds<span style=color:#e6db74>}</span><span style=color:#e6db74>s&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error checking probes for pod </span><span style=color:#e6db74>{</span>pod_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_configmap_mounted</span>(self, pod_name):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;检查 ConfigMap 挂载状态&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            pod <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>v1<span style=color:#f92672>.</span>read_namespaced_pod(pod_name, self<span style=color:#f92672>.</span>namespace)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> volume <span style=color:#f92672>in</span> pod<span style=color:#f92672>.</span>spec<span style=color:#f92672>.</span>volumes:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> volume<span style=color:#f92672>.</span>config_map:
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;ConfigMap mounted: </span><span style=color:#e6db74>{</span>volume<span style=color:#f92672>.</span>config_map<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#75715e># 检查 ConfigMap 是否存在</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                        config_map <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>v1<span style=color:#f92672>.</span>read_namespaced_config_map(
</span></span><span style=display:flex><span>                            volume<span style=color:#f92672>.</span>config_map<span style=color:#f92672>.</span>name, 
</span></span><span style=display:flex><span>                            self<span style=color:#f92672>.</span>namespace
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>                        logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;ConfigMap exists and is accessible&#34;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                        logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error accessing ConfigMap: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Error checking ConfigMap for pod </span><span style=color:#e6db74>{</span>pod_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>continuous_monitoring</span>(self, pod_name, interval<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;持续监控 Pod&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>=== Monitoring Pod </span><span style=color:#e6db74>{</span>pod_name<span style=color:#e6db74>}</span><span style=color:#e6db74> at </span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>now()<span style=color:#e6db74>}</span><span style=color:#e6db74> ===&#34;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>monitor_pod_resources(pod_name)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>check_probes(pod_name)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>check_configmap_mounted(pod_name)
</span></span><span style=display:flex><span>            time<span style=color:#f92672>.</span>sleep(interval)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    monitor <span style=color:#f92672>=</span> PodMonitor()
</span></span><span style=display:flex><span>    pod_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;app-pod&#34;</span>  <span style=color:#75715e># 你的 pod 名称</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        monitor<span style=color:#f92672>.</span>continuous_monitoring(pod_name)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;Monitoring stopped by user&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Unexpected error: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>这个脚本提供了以下功能：</p><ol><li><p><strong>资源监控</strong></p><ul><li>检查 CPU 和内存使用</li><li>监控容器状态</li><li>跟踪重启次数</li></ul></li><li><p><strong>健康检查监控</strong></p><ul><li>监控 readinessProbe</li><li>监控 livenessProbe</li><li>检查探针配置</li></ul></li><li><p><strong>配置检查</strong></p><ul><li>验证 ConfigMap 挂载</li><li>检查 ConfigMap 可访问性</li></ul></li><li><p><strong>持续监控</strong></p><ul><li>定期检查 Pod 状态</li><li>输出详细日志</li><li>异常处理和报告</li></ul></li></ol><p>你可以根据需要调整监控间隔和添加其他监控指标。要使用这个脚本，需要先安装 kubernetes 客户端：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install kubernetes
</span></span></code></pre></div><p>这个工具可以帮助你更好地监控和管理你的 Pod。</p><p>我再基于你的 pod.yaml 写一个更实用的 Go 版本的监控工具，这个版本会更关注性能和并发处理：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span> <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/client-go/util/homedir&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;path/filepath&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PodMonitor</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clientset</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>Clientset</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>namespace</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewPodMonitor</span>(<span style=color:#a6e22e>namespace</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PodMonitor</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 获取 kubeconfig 路径</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kubeconfig</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>homedir</span>.<span style=color:#a6e22e>HomeDir</span>(), <span style=color:#e6db74>&#34;.kube&#34;</span>, <span style=color:#e6db74>&#34;config&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建 config</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>clientcmd</span>.<span style=color:#a6e22e>BuildConfigFromFlags</span>(<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>kubeconfig</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;error building config: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建 clientset</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clientset</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kubernetes</span>.<span style=color:#a6e22e>NewForConfig</span>(<span style=color:#a6e22e>config</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;error creating clientset: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PodMonitor</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>clientset</span>: <span style=color:#a6e22e>clientset</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>namespace</span>: <span style=color:#a6e22e>namespace</span>,
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>pm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PodMonitor</span>) <span style=color:#a6e22e>MonitorPod</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>podName</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ticker</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>NewTicker</span>(<span style=color:#ae81ff>30</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>ticker</span>.<span style=color:#a6e22e>Stop</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Monitoring stopped&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ticker</span>.<span style=color:#a6e22e>C</span>:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pod</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pm</span>.<span style=color:#a6e22e>clientset</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>pm</span>.<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Get</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>podName</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>GetOptions</span>{},
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error getting pod %s: %v\n&#34;</span>, <span style=color:#a6e22e>podName</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 检查 Pod 状态</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Pod Status: %s\n&#34;</span>, <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>Phase</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 检查容器状态</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Status</span>.<span style=color:#a6e22e>ContainerStatuses</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Container: %s\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  Ready: %v\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Ready</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  RestartCount: %d\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>RestartCount</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 检查资源使用</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>State</span>.<span style=color:#a6e22e>Running</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  Running since: %v\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>State</span>.<span style=color:#a6e22e>Running</span>.<span style=color:#a6e22e>StartedAt</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 检查资源配置</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>resources</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Resources</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Resource Limits - CPU: %s, Memory: %s\n&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>Limits</span>.<span style=color:#a6e22e>Cpu</span>(),
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>Limits</span>.<span style=color:#a6e22e>Memory</span>(),
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Resource Requests - CPU: %s, Memory: %s\n&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>Requests</span>.<span style=color:#a6e22e>Cpu</span>(),
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>Requests</span>.<span style=color:#a6e22e>Memory</span>(),
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>pm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PodMonitor</span>) <span style=color:#a6e22e>CheckProbes</span>(<span style=color:#a6e22e>podName</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pod</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pm</span>.<span style=color:#a6e22e>clientset</span>.<span style=color:#a6e22e>CoreV1</span>().<span style=color:#a6e22e>Pods</span>(<span style=color:#a6e22e>pm</span>.<span style=color:#a6e22e>namespace</span>).<span style=color:#a6e22e>Get</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>podName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>GetOptions</span>{},
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;error getting pod: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Container: %s\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>ReadinessProbe</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ReadinessProbe:\n&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  InitialDelay: %ds\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>ReadinessProbe</span>.<span style=color:#a6e22e>InitialDelaySeconds</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  Period: %ds\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>ReadinessProbe</span>.<span style=color:#a6e22e>PeriodSeconds</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>LivenessProbe</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;LivenessProbe:\n&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  InitialDelay: %ds\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>LivenessProbe</span>.<span style=color:#a6e22e>InitialDelaySeconds</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  Period: %ds\n&#34;</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>LivenessProbe</span>.<span style=color:#a6e22e>PeriodSeconds</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>monitor</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewPodMonitor</span>(<span style=color:#e6db74>&#34;default&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;Error creating monitor: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithCancel</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 启动监控</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>monitor</span>.<span style=color:#a6e22e>MonitorPod</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;app-pod&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查探针配置</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>monitor</span>.<span style=color:#a6e22e>CheckProbes</span>(<span style=color:#e6db74>&#34;app-pod&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error checking probes: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 保持程序运行</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Program terminated&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这个 Go 版本的监控工具具有以下特点：</p><ol><li><p><strong>性能更好</strong></p><ul><li>使用 Go 的并发特性</li><li>更低的资源消耗</li><li>更快的响应速度</li></ul></li><li><p><strong>更好的错误处理</strong></p><ul><li>使用 context 控制生命周期</li><li>详细的错误信息</li><li>优雅的退出机制</li></ul></li><li><p><strong>功能完整</strong></p><ul><li>监控 Pod 状态</li><li>检查资源使用</li><li>探针状态监控</li></ul></li></ol><p>要运行这个程序，需要先安装依赖：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get k8s.io/client-go@latest
</span></span></code></pre></div><p>这个工具比 Python 版本的性能更好，特别是在需要长期运行或监控多个 Pod 的场景下。</p><h2 id=减少docker镜像的体积大小>减少docker镜像的体积大小
<a class=anchor href=#%e5%87%8f%e5%b0%91docker%e9%95%9c%e5%83%8f%e7%9a%84%e4%bd%93%e7%a7%af%e5%a4%a7%e5%b0%8f>#</a></h2><p>基于减少 Docker 镜像体积，我来举例说明几种常用的优化方法：</p><h3 id=1-多阶段构建-multi-stage-build>1. 多阶段构建 (Multi-stage Build)
<a class=anchor href=#1-%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba-multi-stage-build>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 构建阶段</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> maven:3.8.1-jdk-8 AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> pom.xml .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 缓存依赖</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mvn dependency:go-offline<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> src ./src<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mvn package -DskipTests<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 运行阶段 - 使用更小的基础镜像</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> openjdk:8-jre-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 只复制构建产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/target/*.jar app.jar<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;java&#34;</span>, <span style=color:#e6db74>&#34;-jar&#34;</span>, <span style=color:#e6db74>&#34;app.jar&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=2-使用轻量级基础镜像>2. 使用轻量级基础镜像
<a class=anchor href=#2-%e4%bd%bf%e7%94%a8%e8%bd%bb%e9%87%8f%e7%ba%a7%e5%9f%ba%e7%a1%80%e9%95%9c%e5%83%8f>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 不推荐</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:latest    # ~70MB</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 推荐</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> alpine:latest    # ~5MB</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=3-优化-run-指令和清理>3. 优化 RUN 指令和清理
<a class=anchor href=#3-%e4%bc%98%e5%8c%96-run-%e6%8c%87%e4%bb%a4%e5%92%8c%e6%b8%85%e7%90%86>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.9-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> requirements.txt .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 合并命令并清理缓存</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip install --no-cache-dir -r requirements.txt <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf /root/.cache/pip <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf /var/cache/apk/*<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=4-使用-dockerignore>4. 使用 .dockerignore
<a class=anchor href=#4-%e4%bd%bf%e7%94%a8-dockerignore>#</a></h3><pre tabindex=0><code class=language-text:.dockerignore data-lang=text:.dockerignore># 排除不需要的文件
node_modules
*.log
.git
.env
*.md
tests
docs
*.pyc
__pycache__
.pytest_cache
</code></pre><h3 id=5-生产环境优化示例>5. 生产环境优化示例
<a class=anchor href=#5-%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e4%bc%98%e5%8c%96%e7%a4%ba%e4%be%8b>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># Node.js 应用优化示例</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 使用更轻量的镜像运行</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/build /usr/share/nginx/html<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=6-分离开发和生产依赖>6. 分离开发和生产依赖
<a class=anchor href=#6-%e5%88%86%e7%a6%bb%e5%bc%80%e5%8f%91%e5%92%8c%e7%94%9f%e4%ba%a7%e4%be%9d%e8%b5%96>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 开发环境</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS development</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 生产环境</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS production</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>development /app/dist ./dist<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;dist/main&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=7-最佳实践总结>7. 最佳实践总结
<a class=anchor href=#7-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93>#</a></h3><ol><li><p><strong>选择合适的基础镜像</strong></p><ul><li>使用官方镜像</li><li>选择 alpine 版本</li><li>使用特定版本标签</li></ul></li><li><p><strong>优化构建过程</strong></p><ul><li>合并 RUN 指令</li><li>清理缓存文件</li><li>使用多阶段构建</li></ul></li><li><p><strong>文件处理</strong></p><ul><li>使用 .dockerignore</li><li>只复制必要文件</li><li>删除临时文件</li></ul></li><li><p><strong>依赖管理</strong></p><ul><li>只安装生产依赖</li><li>使用版本锁定</li><li>清理包管理器缓存</li></ul></li></ol><h3 id=8-实际示例基于你的-podyaml>8. 实际示例（基于你的 pod.yaml）
<a class=anchor href=#8-%e5%ae%9e%e9%99%85%e7%a4%ba%e4%be%8b%e5%9f%ba%e4%ba%8e%e4%bd%a0%e7%9a%84-podyaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 多阶段构建示例</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 生产镜像</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 复制构建产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/dist /usr/share/nginx/html<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 复制 nginx 配置</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> nginx.conf /etc/nginx/conf.d/default.conf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 设置用户</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 资源使用限制（对应 pod.yaml 中的设置）</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_OPTIONS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--max-old-space-size=256&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 健康检查</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=30s --timeout=3s \
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    </span><span style=color:#66d9ef>CMD</span> wget -q --spider http://localhost/ <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这些优化可以显著减少镜像大小，提高部署效率。记住要根据实际应用需求选择适当的优化策略。</p><h2 id=多阶段构建啥意思>多阶段构建啥意思
<a class=anchor href=#%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba%e5%95%a5%e6%84%8f%e6%80%9d>#</a></h2><p>多阶段构建（Multi-stage Build）是一种优化 Docker 镜像大小的技术。让我用具体例子解释：</p><h3 id=1-传统构建方式单阶段>1. 传统构建方式（单阶段）
<a class=anchor href=#1-%e4%bc%a0%e7%bb%9f%e6%9e%84%e5%bb%ba%e6%96%b9%e5%bc%8f%e5%8d%95%e9%98%b6%e6%ae%b5>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 这种方式最终镜像会包含构建工具和中间文件，体积很大</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> maven:3.8.1-jdk-8</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mvn package<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;java&#34;</span>, <span style=color:#e6db74>&#34;-jar&#34;</span>, <span style=color:#e6db74>&#34;target/app.jar&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=2-多阶段构建方式>2. 多阶段构建方式
<a class=anchor href=#2-%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba%e6%96%b9%e5%bc%8f>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 第一阶段：构建阶段</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> maven:3.8.1-jdk-8 AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> pom.xml .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> src ./src<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mvn package<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 第二阶段：运行阶段</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> openjdk:8-jre-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 只复制第一阶段构建的产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/target/*.jar app.jar<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;java&#34;</span>, <span style=color:#e6db74>&#34;-jar&#34;</span>, <span style=color:#e6db74>&#34;app.jar&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>主要优点：</p><ol><li><strong>最终镜像更小</strong>：只包含运行必需的文件</li><li><strong>更安全</strong>：不包含构建工具和源代码</li><li><strong>层更少</strong>：优化缓存和构建速度</li></ol><h3 id=3-更复杂的多阶段构建示例>3. 更复杂的多阶段构建示例
<a class=anchor href=#3-%e6%9b%b4%e5%a4%8d%e6%9d%82%e7%9a%84%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba%e7%a4%ba%e4%be%8b>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 第一阶段：依赖安装</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 第二阶段：构建</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>dependencies /app/node_modules ./node_modules<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 第三阶段：运行</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 只复制构建产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/dist /usr/share/nginx/html<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 配置文件</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> nginx.conf /etc/nginx/conf.d/default.conf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这个例子中：</p><ol><li>第一阶段安装依赖</li><li>第二阶段进行构建</li><li>第三阶段只包含运行所需的文件</li></ol><p>最终镜像只包含：</p><ul><li>nginx 运行环境</li><li>构建后的静态文件</li><li>nginx 配置</li></ul><p>不包含：</p><ul><li>node.js 环境</li><li>npm 包</li><li>源代码</li><li>构建工具</li></ul><p>这样可以大大减少最终镜像的大小，通常可以减少 60-90% 的体积。</p><p>好的，我看到你有一个 pod.yaml 文件。让我结合你的 pod.yaml 配置，写一个实际的多阶段构建的例子，这样可以确保构建出的镜像既小巧又符合你的资源限制要求：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 第一阶段：依赖安装和构建</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 安装依赖</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 复制源代码并构建</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 第二阶段：运行环境</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/share/nginx/html</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 从builder阶段复制构建产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/dist .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> nginx.conf /etc/nginx/conf.d/default.conf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 设置非root用户运行</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 配置健康检查，对应 pod.yaml 中的探针配置</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=10s --timeout=3s \
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    </span><span style=color:#66d9ef>CMD</span> wget -q --spider http://localhost/ <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 资源使用优化，对应 pod.yaml 中的资源限制</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_OPTIONS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--max-old-space-size=256&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这个 Dockerfile：</p><ol><li>构建阶段只包含必要的构建工具</li><li>运行阶段使用轻量级的 alpine 基础镜像</li><li>最终镜像符合 pod.yaml 中的资源限制和健康检查要求</li></ol><p>这样构建出的镜像会更小，更适合在你的 K8s 环境中运行。</p><p>是的！我注意到你的 pod.yaml 配置得很规范，包含了资源限制、健康检查等重要配置。让我们可以进一步优化 Dockerfile，使其完全匹配你的 pod.yaml 配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 第一阶段：构建</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 使用 .dockerignore 排除不必要文件</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci --only<span style=color:#f92672>=</span>production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 第二阶段：运行</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/share/nginx/html</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 对应 pod.yaml 中的资源限制</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># memory: &#34;256Mi&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># cpu: &#34;500m&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NGINX_WORKER_PROCESSES<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;auto&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NGINX_WORKER_CONNECTIONS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1024&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 复制构建产物</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/dist .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> nginx.conf /etc/nginx/conf.d/default.conf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 对应 pod.yaml 中的健康检查配置</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># readinessProbe 和 livenessProbe</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=10s --timeout=3s \
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>    </span><span style=color:#66d9ef>CMD</span> wget -q --spider http://localhost/ <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 安全性配置</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这样构建出的镜像不仅体积小，而且完全符合你在 pod.yaml 中定义的运行要求。你觉得这样的优化方向对吗？</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#504错误是啥>504错误是啥</a><ul><li><a href=#主要原因>主要原因：</a></li><li><a href=#常见场景>常见场景：</a></li><li><a href=#解决方案>解决方案：</a></li></ul></li><li><a href=#常见的状态码>常见的状态码</a><ul><li><a href=#2xx---成功响应>2XX - 成功响应</a></li><li><a href=#3xx---重定向>3XX - 重定向</a></li><li><a href=#4xx---客户端错误>4XX - 客户端错误</a></li><li><a href=#5xx---服务器错误>5XX - 服务器错误</a></li><li><a href=#使用建议>使用建议</a></li></ul></li><li><a href=#k8s创建pod的过程>k8s创建pod的过程</a><ul><li><a href=#1-提交请求阶段>1. 提交请求阶段</a></li><li><a href=#2-调度阶段>2. 调度阶段</a></li><li><a href=#3-创建阶段>3. 创建阶段</a></li><li><a href=#4-运行阶段>4. 运行阶段</a></li><li><a href=#示例-pod-配置>示例 Pod 配置：</a></li><li><a href=#可能的问题和解决方案>可能的问题和解决方案：</a></li><li><a href=#1-基础配置优化>1. 基础配置优化</a></li><li><a href=#2-静态文件优化>2. 静态文件优化</a></li><li><a href=#3-负载均衡优化>3. 负载均衡优化</a></li><li><a href=#4-ssl-优化>4. SSL 优化</a></li><li><a href=#5-安全优化>5. 安全优化</a></li><li><a href=#6-日志优化>6. 日志优化</a></li><li><a href=#7-监控指标>7. 监控指标</a></li><li><a href=#优化建议>优化建议：</a></li></ul></li><li><a href=#gitlab的runner-干嘛的>gitlab的runner 干嘛的</a><ul><li><a href=#1-runner-的主要功能>1. Runner 的主要功能</a></li><li><a href=#2-runner-类型>2. Runner 类型</a></li><li><a href=#3-配置示例>3. 配置示例</a></li><li><a href=#4-runner-在-kubernetes-中的配置>4. Runner 在 Kubernetes 中的配置</a></li><li><a href=#5-runner-注册配置>5. Runner 注册配置</a></li><li><a href=#6-常见使用场景>6. 常见使用场景</a></li><li><a href=#7-最佳实践>7. 最佳实践</a></li></ul></li><li><a href=#jenkins常用插件>jenkins常用插件</a><ul><li><a href=#1-基础功能插件>1. 基础功能插件</a></li><li><a href=#2-构建相关插件>2. 构建相关插件</a></li><li><a href=#3-容器相关插件>3. 容器相关插件</a></li><li><a href=#4-代码质量插件>4. 代码质量插件</a></li><li><a href=#5-通知类插件>5. 通知类插件</a></li><li><a href=#6-其他实用插件>6. 其他实用插件</a></li><li><a href=#安装建议>安装建议</a></li></ul></li><li><a href=#声明式和脚本式的jenkins的写法举例>声明式和脚本式的jenkins的写法举例</a><ul><li><a href=#1-并行执行-parallel>1. 并行执行 (Parallel)</a></li><li><a href=#2-矩阵构建-matrix>2. 矩阵构建 (Matrix)</a></li><li><a href=#3-多分支流水线>3. 多分支流水线</a></li><li><a href=#4-上游下游任务-upstreamdownstream>4. 上游/下游任务 (Upstream/Downstream)</a></li><li><a href=#5-参数化构建矩阵>5. 参数化构建矩阵</a></li><li><a href=#6-资源分配和限制>6. 资源分配和限制</a></li><li><a href=#最佳实践建议>最佳实践建议：</a></li></ul></li><li><a href=#怎么确保密码-这些不会明文写到流水线里面>怎么确保密码 这些不会明文写到流水线里面</a><ul><li><a href=#1-默认行为>1. 默认行为</a></li><li><a href=#2-安全处理示例>2. 安全处理示例</a></li><li><a href=#3-最佳实践>3. 最佳实践</a></li><li><a href=#4-安全检查清单>4. 安全检查清单</a></li></ul></li><li><a href=#说下你对容器和k8s的理解>说下你对容器和k8s的理解</a><ul><li><a href=#1-容器的本质>1. 容器的本质</a></li><li><a href=#2-k8s-的核心功能>2. K8s 的核心功能</a></li><li><a href=#3-架构设计理念>3. 架构设计理念</a></li><li><a href=#4-实际应用场景>4. 实际应用场景</a></li><li><a href=#5-生产环境考虑>5. 生产环境考虑</a></li><li><a href=#6-最佳实践>6. 最佳实践</a></li><li><a href=#1-资源管理>1. 资源管理</a></li><li><a href=#2-健康检查>2. 健康检查</a></li><li><a href=#3-配置管理>3. 配置管理</a></li><li><a href=#4-节点选择>4. 节点选择</a></li></ul></li><li><a href=#你用过go或者python写东西吗-有关运维的-devops的>你用过go或者python写东西吗 有关运维的 devops的</a><ul><li><a href=#1-python-自动化运维示例>1. Python 自动化运维示例</a></li><li><a href=#2-go-运维工具示例>2. Go 运维工具示例</a></li><li><a href=#3-实用的-devops-脚本>3. 实用的 DevOps 脚本</a></li></ul></li><li><a href=#减少docker镜像的体积大小>减少docker镜像的体积大小</a><ul><li><a href=#1-多阶段构建-multi-stage-build>1. 多阶段构建 (Multi-stage Build)</a></li><li><a href=#2-使用轻量级基础镜像>2. 使用轻量级基础镜像</a></li><li><a href=#3-优化-run-指令和清理>3. 优化 RUN 指令和清理</a></li><li><a href=#4-使用-dockerignore>4. 使用 .dockerignore</a></li><li><a href=#5-生产环境优化示例>5. 生产环境优化示例</a></li><li><a href=#6-分离开发和生产依赖>6. 分离开发和生产依赖</a></li><li><a href=#7-最佳实践总结>7. 最佳实践总结</a></li><li><a href=#8-实际示例基于你的-podyaml>8. 实际示例（基于你的 pod.yaml）</a></li></ul></li><li><a href=#多阶段构建啥意思>多阶段构建啥意思</a><ul><li><a href=#1-传统构建方式单阶段>1. 传统构建方式（单阶段）</a></li><li><a href=#2-多阶段构建方式>2. 多阶段构建方式</a></li><li><a href=#3-更复杂的多阶段构建示例>3. 更复杂的多阶段构建示例</a></li></ul></li></ul></nav></div></aside></main></body></html>
<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="01
背景
容器网络为何出现
在一个汽车发动机的生产车间中，汽车发动机的各个组件会存在一定的顺序进行组装，这就要求有直接关系的组件必须知道下一个组件的具体位置。当一个汽车发动机组装完成后，距离最后成品汽车，还差了很多部件，比如底盘，车身等。此时，需要将发动机发往一个装配中心进行组合安装，这样我们就必须知道装配中心的地理位置。
这些位置在容器中可以理解为 IP 地址，容器网络便是如此。在上面这个例子里，即描述了容器网络本节点内部互通场景，又描述了跨节点的通信场景。
随着云计算的发展，应用间通信从物理机网络，虚拟机网络，发展到目前的容器网络。由于容器不同于物理机、虚拟机，容器可以被理解为一个标准的，轻量级的，便携的，独立的集装箱，集装箱之间相互隔离，都使用自己的环境和资源。但随着越来越复杂环境变化，容器在运行中会需要容器间或者容器与集群外部之间的信息传输，这时候容器就要在网络层面拥有一个名字（即 IP 地址），由此容器网络就应运而生。
再从技术的角度来谈容器网络的由来，首先要从容器本质说起，它是由以下几点来实现的：


cgroup：实现资源的可配额


overlay fs：实现文件系统的安全性和便携性


namespace：实现资源的隔离性



IPC ：System V IPC 和 POSIX 消息队列
Network：网络设备、网络协议栈、网络端口等
PID：进程
Mount：挂载点
UTS：主机名和域名
USR：用户和用户组



由于主机与容器、容器与容器间的网络栈并不相通，也没有统一的控制面，导致容器间无法直接的感知。为了解决这个问题，本文中我们要讨论的容器网络出现了，再配合不同的网络虚拟化技术带来了多样化的容器网络方案。
02
容器网络的基本要求


IP-per-Pod，每个 Pod 都拥有一个独立 IP 地址，Pod 内所有容器共享一个网络命名空间


集群内所有 Pod 都在一个直接连通的扁平网络中，可通过 IP 直接访问



所有容器之间无需 NAT 就可以直接互相访问
所有 Node 和所有容器之间无需 NAT 就可以直接互相访问
容器自己看到的 IP 跟其他容器看到的一样



Service cluster IP 尽可在集群内部访问，外部请求需要通过 NodePort、LoadBalance 或者 Ingress 来访问


02
网络插件介绍
Aliware
01
网络插件概述
容器和该容器所在的宿主机是分隔的两地，如果需要连通就得建立一座桥梁，但由于容器侧还没有名字，就无法建立桥梁，这时候就先需要给容器侧命名，这样才能成功建立起桥梁。网络插件就是起到给容器侧命名和建立桥梁的功能。
即网络插件将网络接口插入容器网络命名空间（例如，veth 对的一端），并在主机上进行任何必要的改变（例如将 veth 的另一端连接到网桥）。然后通过调用适当的 IPAM 插件（IP 地址管理插件）分配给接口一个空闲的 IP 地址，并设置与此 IP 地址相对应的路由规则。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qq547475331.github.io/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/"><meta property="og:site_name" content="Guichen's Blog"><meta property="og:title" content="彻悟容器网络 2024-04-07 10:30:11.55"><meta property="og:description" content="01
背景
容器网络为何出现
在一个汽车发动机的生产车间中，汽车发动机的各个组件会存在一定的顺序进行组装，这就要求有直接关系的组件必须知道下一个组件的具体位置。当一个汽车发动机组装完成后，距离最后成品汽车，还差了很多部件，比如底盘，车身等。此时，需要将发动机发往一个装配中心进行组合安装，这样我们就必须知道装配中心的地理位置。
这些位置在容器中可以理解为 IP 地址，容器网络便是如此。在上面这个例子里，即描述了容器网络本节点内部互通场景，又描述了跨节点的通信场景。
随着云计算的发展，应用间通信从物理机网络，虚拟机网络，发展到目前的容器网络。由于容器不同于物理机、虚拟机，容器可以被理解为一个标准的，轻量级的，便携的，独立的集装箱，集装箱之间相互隔离，都使用自己的环境和资源。但随着越来越复杂环境变化，容器在运行中会需要容器间或者容器与集群外部之间的信息传输，这时候容器就要在网络层面拥有一个名字（即 IP 地址），由此容器网络就应运而生。
再从技术的角度来谈容器网络的由来，首先要从容器本质说起，它是由以下几点来实现的：
cgroup：实现资源的可配额
overlay fs：实现文件系统的安全性和便携性
namespace：实现资源的隔离性
IPC ：System V IPC 和 POSIX 消息队列 Network：网络设备、网络协议栈、网络端口等 PID：进程 Mount：挂载点 UTS：主机名和域名 USR：用户和用户组 由于主机与容器、容器与容器间的网络栈并不相通，也没有统一的控制面，导致容器间无法直接的感知。为了解决这个问题，本文中我们要讨论的容器网络出现了，再配合不同的网络虚拟化技术带来了多样化的容器网络方案。
02
容器网络的基本要求
IP-per-Pod，每个 Pod 都拥有一个独立 IP 地址，Pod 内所有容器共享一个网络命名空间
集群内所有 Pod 都在一个直接连通的扁平网络中，可通过 IP 直接访问
所有容器之间无需 NAT 就可以直接互相访问 所有 Node 和所有容器之间无需 NAT 就可以直接互相访问 容器自己看到的 IP 跟其他容器看到的一样 Service cluster IP 尽可在集群内部访问，外部请求需要通过 NodePort、LoadBalance 或者 Ingress 来访问
02
网络插件介绍
Aliware
01
网络插件概述
容器和该容器所在的宿主机是分隔的两地，如果需要连通就得建立一座桥梁，但由于容器侧还没有名字，就无法建立桥梁，这时候就先需要给容器侧命名，这样才能成功建立起桥梁。网络插件就是起到给容器侧命名和建立桥梁的功能。
即网络插件将网络接口插入容器网络命名空间（例如，veth 对的一端），并在主机上进行任何必要的改变（例如将 veth 的另一端连接到网桥）。然后通过调用适当的 IPAM 插件（IP 地址管理插件）分配给接口一个空闲的 IP 地址，并设置与此 IP 地址相对应的路由规则。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>彻悟容器网络 2024-04-07 10:30:11.55 | Guichen's Blog</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qq547475331.github.io/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.9ff30e0de52311d167a0c227f35b51c7f883b74d8ceb8fe1247d2f335b095dd7.js integrity="sha256-n/MODeUjEdFnoMIn81tRx/iDt02M64/hJH0vM1sJXdc=" crossorigin=anonymous></script></head><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!0});let e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(e=>{let t=document.createElement("div");t.classList.add("mermaid"),t.innerHTML=e.innerText,e.parentNode.replaceWith(t)}),mermaid.init(void 0,document.querySelectorAll(".mermaid"))})</script><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Guichen's Blog</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/00-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8F%82%E6%95%B0%E8%AE%BE%E5%AE%9A-00--ji-qun-gui-hua-he-ji-chu-can-shu-she-ding/>00-集群规划和基础参数设定 2023-09-28 15:19:02.214</a></li><li><a href=/docs/01-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-01--chuang-jian-zheng-shu-he-huan-jing-zhun-bei/>01-创建证书和环境准备 2023-09-28 15:22:19.812</a></li><li><a href=/docs/02-%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4-02--an-zhuang-etcd-ji-qun/>02-安装etcd集群 2023-09-28 15:23:07.363</a></li><li><a href=/docs/2025-2-24-%E9%9D%A2%E8%AF%950224/>0224面试</a></li><li><a href=/docs/2025-2-26-k8s%E7%9B%B8%E5%85%B3/>0226 k8s题目</a></li><li><a href=/docs/03-%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6-03--an-zhuang-rong-qi-yun-xing-shi/>03-安装容器运行时 2023-09-28 15:23:56.241</a></li><li><a href=/docs/04-%E5%AE%89%E8%A3%85kube_master%E8%8A%82%E7%82%B9-04--an-zhuang-kubemaster-jie-dian/>04-安装kube_master节点 2023-09-28 15:24:21.203</a></li><li><a href=/docs/05-%E5%AE%89%E8%A3%85kube_node%E8%8A%82%E7%82%B9-05--an-zhuang-kubenode-jie-dian/>05-安装kube_node节点 2023-09-28 15:24:43.201</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85calico%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-calico-wang-luo-zu-jian/>06-安装calico网络组件 2023-09-28 15:34:28.483</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85cilium%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-cilium-wang-luo-zu-jian/>06-安装cilium网络组件 2023-09-28 15:35:23.884</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-flannel-wang-luo-zu-jian/>06-安装flannel网络组件 2023-09-28 15:35:50.039</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85kube-ovn%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-kube-ovn-wang-luo-zu-jian/>06-安装kube-ovn网络组件 2023-09-28 15:36:11.265</a></li><li><a href=/docs/06-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-06--an-zhuang-wang-luo-zu-jian/>06-安装网络组件 2023-09-28 15:25:14.997</a></li><li><a href=/docs/07-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E4%B8%BB%E8%A6%81%E6%8F%92%E4%BB%B6-07--an-zhuang-ji-qun-zhu-yao-cha-jian/>07-安装集群主要插件 2023-09-28 15:26:42.651</a></li><li><a href=/docs/08-k8s-%E9%9B%86%E7%BE%A4%E5%AD%98%E5%82%A8--k8s-ji-qun-cun-chu/>08-K8S 集群存储 2023-09-28 15:27:29.454</a></li><li><a href=/docs/16%E4%B8%AA%E6%A6%82%E5%BF%B5%E5%B8%A6%E4%BD%A0%E5%85%A5%E9%97%A8-kubernetes-16-ge-gai-nian-dai-ni-ru-men-kubernetes/>16个概念带你入门 Kubernetes 2024-04-03 15:09:21.671</a></li><li><a href=/docs/16%E5%BC%A0%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3k8s%E7%BD%91%E7%BB%9C-16-zhang-ying-he-tu-jie-k8s-wang-luo/>16张硬核图解k8s网络 2024-04-03 15:12:49.601</a></li><li><a href=/docs/2024-12-07-microk8s/>2024-12-07 microk8s</a></li><li><a href=/docs/2024-12-08-devstack/>2024-12-08 devstack</a></li><li><a href=/docs/2024-12-08-mutilpass%E6%93%8D%E4%BD%9C/>2024-12-08 mutilpass操作</a></li><li><a href=/docs/2024-12-08-nano%E6%93%8D%E4%BD%9C/>2024-12-08 nano操作</a></li><li><a href=/docs/2024-12-08-openstack%E5%92%8Ckubernetes%E5%8C%BA%E5%88%AB/>2024-12-08 openstack和kubernetes区别</a></li><li><a href=/docs/2024-12-08-openstack%E9%9C%80%E8%A6%81%E5%87%A0%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/>2024-12-08 openstack需要几台虚拟机</a></li><li><a href=/docs/2024-12-08-%E5%9D%97%E5%AD%98%E5%82%A8%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%82%A8%E5%AD%98%E5%8C%BA%E5%88%AB/>2024-12-08 块存储和对象储存区别</a></li><li><a href=/docs/2024-12-09-docker-daemon.json/>2024-12-09 docker daemon.json</a></li><li><a href=/docs/2024-12-09-helmchart-%E9%83%A8%E7%BD%B2flask%E5%BA%94%E7%94%A8/>2024-12-09 helmchart 部署flask应用</a></li><li><a href=/docs/2024-12-08-mutilpass%E9%83%A8%E7%BD%B2openstack/>2024-12-09 mutilpass部署openstack devstack形式</a></li><li><a href=/docs/2024-12-09-openstack-ssh%E8%BF%9E%E6%8E%A5/>2024-12-09 openstack ssh连接</a></li><li><a href=/docs/2024-12-10-docker-registrry/>2024-12-10 docker registrry</a></li><li><a href=/docs/2024-2-22-k8s%E6%9E%B6%E6%9E%84%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8/>2024-2-22 k8s架构师面试大全</a></li><li><a href=/docs/2024-2-22-k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/>2024-2-22 k8s面试宝典</a></li><li><a href=/docs/2024-2-26-%E9%9D%A2%E8%AF%95/>2024-2-26 面试</a></li><li><a href=/docs/2024-3-19-%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86/>2024-3-19 两张图全面理解k8s原理</a></li><li><a href=/docs/2024-3-4-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B/>2024-3-4 CNI剖析演进</a></li><li><a href=/docs/2024-3-8-%E9%9D%A2%E8%AF%950308/>2024-3-8 面试</a></li><li><a href=/docs/2024-4-17-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/>2024-4-17 面试总结</a></li><li><a href=/docs/2024-8-1-kubernetes%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-8-1 k8s面试题</a></li><li><a href=/docs/2024-8-1-%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E5%BF%85%E7%9C%8B/>2024-8-1 linux运维面试题</a></li><li><a href=/docs/2024-8-1-linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/>2024-8-1 linux面试题</a></li><li><a href=/docs/2025-1-1-sealos%E8%8E%B7%E6%8A%95/>2025-1-1 sealos获投</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E7%82%B9%E5%AD%90/>2025-1-1 创业点子</a></li><li><a href=/docs/2025-1-1-%E5%88%9B%E4%B8%9A%E8%80%85%E4%BA%A4%E6%B5%81/>2025-1-1 创业者交流</a></li><li><a href=/docs/2025-1-1-%E5%88%9D%E5%88%9B%E5%85%AC%E5%8F%B8/>2025-1-1 初创公司</a></li><li><a href=/docs/2025-1-1-%E5%A4%A7%E5%A0%B0%E6%B2%B3-%E6%88%91%E7%9A%84%E4%BF%9D%E5%A7%86/>2025-1-1 大堰河-我的保姆</a></li><li><a href=/docs/2025-1-1-%E6%97%A9%E6%9C%9F%E6%A8%A1%E5%BC%8F/>2025-1-1 早期模式</a></li><li><a href=/docs/2025-1-1-%E8%A6%81%E4%B8%8D%E8%A6%81%E5%88%9B%E4%B8%9A/>2025-1-1 要不要创业</a></li><li><a href=/docs/2024-3-4-k8s-csi%E5%89%96%E6%9E%90/>2025-1-16 CSI剖析演进</a></li><li><a href=/docs/2025-1-16-k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E6%8C%87%E5%8D%97/>2025-1-16 k8s常见故障指南</a></li><li><a href=/docs/2024-3-4-k8s%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90/>2025-1-16 k8s流量链路剖析</a></li><li><a href=/docs/2025-3-12-%E8%BF%BD%E8%A7%85%E9%9D%A2%E8%AF%95/>2025-3-12 追觅面试</a></li><li><a href=/docs/2025-3-12-%E5%A1%94%E8%B5%9E%E9%9D%A2%E8%AF%95/>2025-3-12 塔赞面试</a></li><li><a href=/docs/2025-3-13-calico%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%B5%81%E9%87%8F%E4%BC%A0%E8%BE%93%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90/>2025-3-13 calico三种模式下流量传输</a></li><li><a href=/docs/2025-3-13-istio%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/>2025-3-13 istio流量分析</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%9B%E5%BB%BApod-deployment%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-8 k8s创建pod 流程图详解</a></li><li><a href=/docs/2025-3-8-k8s%E5%88%A0%E9%99%A4pod-deployment%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%AF%A6%E8%A7%A3/>2025-3-8 k8s删除pod deployment的流程图详解</a></li><li><a href=/docs/33%E6%AC%BEgitops%E4%B8%8Edevops%E4%B8%BB%E6%B5%81%E7%B3%BB%E7%BB%9F-33-kuan-gitops-yu-devops-zhu-liu-xi-tong/>33款gitops与devops主流系统 2024-08-02 17:45:15.709</a></li><li><a href=/docs/600%E6%9D%A1%E6%9C%80%E5%BC%BAlinux%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93-600-tiao-zui-qiang-linux-ming-ling-zong-jie/>600条最强linux命令总结 2024-04-03 15:12:31.282</a></li><li><a href=/docs/acme%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6-acme-zi-dong-geng-xin-zheng-shu/>acme自动更新证书 2024-04-03 14:41:44.289</a></li><li><a href=/docs/calico-%E9%85%8D%E7%BD%AE-bgp-route-reflectors-calico-pei-zhi-bgproutereflectors/>calico 配置 BGP Route Reflectors 2023-09-28 15:34:01.007</a></li><li><a href=/docs/calico%E7%BD%91%E7%BB%9C%E8%87%AA%E5%AE%9A%E4%B9%89-calico-wang-luo-zi-ding-yi/>Calico网络自定义 2024-04-03 15:08:43.394</a></li><li><a href=/docs/cicd%E6%80%9D%E8%80%83-cicd-si-kao/>CICD思考 2024-04-03 15:11:24.151</a></li><li><a href=/docs/client-go-%E5%9B%9B%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-client-go-si-zhong-ke-hu-duan/>Client-go 四种客户端 2024-04-03 14:49:34.32</a></li><li><a href=/docs/client-go-%E6%9E%B6%E6%9E%84-client-go-jia-gou/>Client-go 架构 2024-04-03 14:48:40.716</a></li><li><a href=/docs/cni%E6%8F%92%E4%BB%B6%E9%80%89%E5%9E%8B-cni-cha-jian-xuan-xing/>CNI插件选型 2024-04-03 15:01:51.29</a></li><li><a href=/docs/containerd-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-containerd-ji-ben-cao-zuo/>Containerd 基本操作 2024-04-03 14:55:46.786</a></li><li><a href=/docs/coredns%E4%B9%8B%E5%85%89-coredns-zhi-guang/>COREDNS之光 2024-04-03 14:54:52.059</a></li><li><a href=/docs/dockerfile%E5%AE%9A%E5%88%B6%E4%B8%93%E5%B1%9E%E9%95%9C%E5%83%8F-dockerfile-ding-zhi-zhuan-shu-jing-xiang/>dockerfile定制专属镜像 2024-08-02 17:44:00.522</a></li><li><a href=/docs/dockerfile%E7%9A%84copy%E5%92%8Cadd%E7%9A%84%E5%8C%BA%E5%88%AB-dockerfile-de-copy-he-add-de-qu-bie/>dockerfile的copy和add的区别 2024-04-03 15:01:09.565</a></li><li><a href=/docs/docker%E9%87%8D%E8%A6%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E7%82%B9-docker-zhong-yao-de-wang-luo-zhi-shi-dian/>Docker重要的网络知识点 2024-04-03 15:12:10.162</a></li><li><a href=/docs/etcd%E5%A4%87%E4%BB%BD-etcd-bei-fen/>ETCD备份 2024-04-03</a></li><li><a href=/docs/etcd%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%8A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-etcd-wen-ding-xing-ji-xing-neng-you-hua-shi-jian/>ETCD稳定性及性能优化实践 2024-04-03 15:06:31.141</a></li><li><a href=/docs/ex-lb-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%83%A8%E7%BD%B2-ex-lb-fu-zai-jun-heng-bu-shu/>EX-LB 负载均衡部署 2023-09-28 15:28:51.998</a></li><li><a href=/docs/ezctl-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D-ezctl-ming-ling-xing-jie-shao/>ezctl 命令行介绍 2023-09-28 15:28:00.619</a></li><li><a href=/docs/flanel%E7%BD%91%E7%BB%9C-flanel-wang-luo/>flanel网络 2024-04-03 15:05:04.16</a></li><li><a href=/docs/godel-scheduler-godel-scheduler/>godel-scheduler 2024-08-02 17:41:00.668</a></li><li><a href=/docs/helm-chart%E5%92%8Crepo-helmchart-he-repo/>helm chart和repo 2024-04-03 15:00:43.125</a></li><li><a href=/docs/istio-ingress-gateway-istio-ingress-gateway/>istio-ingress-gateway 2024-08-02 17:51:54.75</a></li><li><a href=/docs/istio%E9%83%A8%E7%BD%B2-istio-bu-shu/>istio部署 2024-08-02 17:52:40.721</a></li><li><a href=/docs/k8s-cni%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scni-pou-xi-yan-jin/>K8S CNI剖析演进 2024-03-04 10:51:33.245</a></li><li><a href=/docs/k8s-csi-openebs%E5%8E%9F%E7%90%86-k8scsiopenebs-yuan-li/>K8S csi openebs原理 2024-04-03 14:44:48.967</a></li><li><a href=/docs/k8s-csi%E5%89%96%E6%9E%90%E6%BC%94%E8%BF%9B-k8scsi-pou-xi-yan-jin/>K8S CSI剖析演进 2024-03-04 10:52:20.507</a></li><li><a href=/docs/k8s-gpt-k8sgpt/>K8S GPT 2024-04-03 15:02:09.127</a></li><li><a href=/docs/k8s-%E5%BC%80%E5%8F%91%E5%8F%AF%E4%B8%8D%E6%AD%A2-crud-k8s-kai-fa-ke-bu-zhi-crud/>K8S 开发可不止 CRUD 2024-04-03 14:50:11.765</a></li><li><a href=/docs/k8s-%E6%8E%A2%E9%92%88%E5%8E%9F%E7%90%86-k8s-tan-zhen-yuan-li/>K8S 探针原理 2024-04-03 14:53:29.429</a></li><li><a href=/docs/k8s-%E6%B5%81%E9%87%8F%E9%93%BE%E8%B7%AF%E5%89%96%E6%9E%90-k8s-liu-liang-lian-lu-pou-xi/>K8S 流量链路剖析 2024-03-04 10:50:22.991</a></li><li><a href=/docs/k8s-%E8%B0%83%E5%BA%A6%E5%99%A8-scheduler_onego-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-scheduleronego-yuan-ma-jie-du/>K8S 调度器 scheduler_one.go 源码解读 2024-04-09 11:45:28.22</a></li><li><a href=/docs/k8s%E4%B9%8Bingress-nginx%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE-k8s-zhi-ingress-nginx-yuan-li-ji-pei-zhi/>K8S之ingress-nginx原理及配置 2024-07-05 18:02:14.243</a></li><li><a href=/docs/k8s%E4%B9%8Bkubelet%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-zhi-kubelet-yuan-ma-jie-du/>k8s之kubelet源码解读 2024-03-28 15:30:39.633</a></li><li><a href=/docs/k8s%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7-k8s-yuan-de-sheng-ji/>K8S原地升级 2024-04-03 15:04:38.125</a></li><li><a href=/docs/k8s%E5%91%BD%E4%BB%A4%E6%8C%87%E5%8D%97-k8s-ming-ling-zhi-nan/>K8S命令指南 2024-04-03 15:14:14.207</a></li><li><a href=/docs/k8s%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97-ip-k8s-ru-he-huo-de-ip/>K8S如何获得 IP 2024-04-16 17:09:59.658</a></li><li><a href=/docs/k8s%E5%BA%94%E7%94%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-k8s-ying-yong-de-zui-jia-shi-jian/>k8s应用的最佳实践 2024-04-03 14:43:16.936</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-deployment_controllergo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-deploymentcontrollergo-yuan-ma-jie-du/>K8S控制器之 deployment_controller.go源码解读 2024-04-09 11:30:03.133</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-progressgo-%E8%BF%9B%E5%BA%A6-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-progressgo-jin-du-yuan-ma-jie-du/>K8S控制器之 progress.go 进度 源码解读 2024-04-09 11:31:08.86</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-rollinggo-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollinggo-gun-dong-geng-xin-yuan-ma-jie-du/>K8S控制器之 rolling.go 滚动更新 源码解读 2024-04-09 11:32:58.133</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8B-schedulergo-%E8%B0%83%E5%BA%A6%E5%99%A8-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-schedulergo-diao-du-qi-yuan-ma-jie-du/>K8S控制器之 scheduler.go 调度器 源码解读 2024-04-09 11:44:25.171</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brecreatego-%E9%87%8D%E5%BB%BA-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-recreatego-zhong-jian-yuan-ma-jie-du/>K8S控制器之recreate.go 重建 源码解读 2024-04-09 11:31:49.855</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Brollbackgo-%E5%9B%9E%E6%BB%9A-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-rollbackgo-hui-gun-yuan-ma-jie-du/>K8S控制器之rollback.go 回滚 源码解读 2024-04-09 11:32:26.587</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_pod_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulpodcontrolgo-yuan-ma-jie-du/>K8S控制器之stateful_pod_control.go源码解读 2024-04-10 09:42:50.078</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_controlgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetcontrolgo-yuan-ma-jie-du/>K8S控制器之stateful_set_control.go源码解读 2024-04-10 09:41:30.316</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_set_status_updatego%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetstatusupdatego-yuan-ma-jie-du/>K8S控制器之stateful_set_status_update.go源码解读 2024-04-10</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bstateful_setgo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-statefulsetgo-yuan-ma-jie-du/>K8S控制器之stateful_set.go源码解读 2024-04-10</a></li><li><a href=/docs/k8s%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B9%8Bsyncgo-%E5%90%8C%E6%AD%A5-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-kong-zhi-qi-zhi-syncgo-tong-bu-yuan-ma-jie-du/>K8S控制器之sync.go 同步 源码解读 2024-04-09 11:33:26.356</a></li><li><a href=/docs/k8s%E7%9A%84pod%E7%B1%BB%E5%9E%8B-k8s-de-pod-lei-xing/>K8S的POD类型 2024-04-03 14:57:11.072</a></li><li><a href=/docs/k8s%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%9D%97%E6%8B%BC%E5%9B%BE-dbpaas-k8s-de-zui-hou-yi-kuai-pin-tu-dbpaas/>K8S的最后一块拼图 dbpaas 2024-08-02 17:48:35.899</a></li><li><a href=/docs/2025-2-7-k8s%E7%BB%84%E4%BB%B6/>k8s组件</a></li><li><a href=/docs/k8s%E8%83%8C%E5%90%8Eservice%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84-k8s-bei-hou-service-shi-ru-he-gong-zuo-de/>k8s背后service是如何工作的 2024-08-02 17:49:44.981</a></li><li><a href=/docs/k8s%E8%B0%83%E5%BA%A6%E5%99%A8-extendergo-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-k8s-diao-du-qi-extendergo-yuan-ma-jie-du/>K8S调度器 extender.go 源码解读 2024-04-09 11:45:59.666</a></li><li><a href=/docs/k8s%E8%B0%83%E8%AF%95pod-k8s-diao-shi-pod/>K8S调试POD 2024-04-03 14:58:15.293</a></li><li><a href=/docs/k8s%E8%BF%90%E7%BB%B4%E4%B9%8B%E6%B8%85%E7%90%86%E7%A3%81%E7%9B%98-k8s-yun-wei-zhi-qing-li-ci-pan/>k8s运维之清理磁盘 2024-04-03 15:13:57.279</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8-k8s-mian-shi-da-quan/>K8S面试大全 2024-04-03 15:10:54.493</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8-k8s-mian-shi-bao-dian/>K8S面试宝典 2024-04-03 15:11:09.316</a></li><li><a href=/docs/k8s%E9%9D%A2%E8%AF%95%E9%A2%98-k8s-mian-shi-ti/>K8S面试题 2024-08-02 17:50:50.418</a></li><li><a href=/docs/kruise%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E8%A7%A3%E6%9E%90-kruise-yuan-de-sheng-ji-jie-xi/>kruise原地升级解析 2024-08-02 17:59:31.689</a></li><li><a href=/docs/kube-router-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6-kube-router-wang-luo-zu-jian/>kube-router 网络组件 2023-09-28 15:33:20.658</a></li><li><a href=/docs/2024-12-05-kubeasz%E9%83%A8%E7%BD%B2k8s/>kubeasz部署k8s</a></li><li><a href=/docs/kubekey%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9-kubekey-tian-jia-xin-jie-dian/>kubekey添加新节点 2024-04-03 15:36:47.646</a></li><li><a href=/docs/kubernetes-api-kubernetesapi/>Kubernetes API 2024-04-03 14:47:30.212</a></li><li><a href=/docs/kubernetes-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84-kubernetes-yuan-ma-jie-gou/>Kubernetes 源码结构 2024-04-03 14:48:05.954</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E8%AE%A4%E8%AF%81-kubernetes-zheng-shu-xiang-jie--ren-zheng-/>Kubernetes 证书详解(认证) 2024-04-03 14:52:56.54</a></li><li><a href=/docs/kubernetes-%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3%E9%89%B4%E6%9D%83-kubernetes-zheng-shu-xiang-jie--jian-quan-/>Kubernetes 证书详解(鉴权) 2024-04-03 14:49:04.385</a></li><li><a href=/docs/kubewharf-kubewharf/>kubewharf 2024-08-02 17:41:32.72</a></li><li><a href=/docs/linux-awk%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%99%A8-8%E4%B8%AA%E6%A1%88%E4%BE%8B-linuxawk-wen-ben-chu-li-qi-8-ge-an-li/>linux awk文本处理器 8个案例 2024-08-02 17:46:53.603</a></li><li><a href=/docs/linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8-linux-xing-neng-you-hua-da-quan/>Linux 性能优化大全 2024-04-03 15:09:06.854</a></li><li><a href=/docs/linux%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%B8%83%E4%B8%AA%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C-linux-xi-tong-xing-neng-you-hua-qi-ge-shi-zhan-jing-yan/>linux系统性能优化 七个实战经验 2024-08-02 17:47:26.212</a></li><li><a href=/docs/linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E5%B8%8850%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98-linux-yun-wei-gong-cheng-shi-50-ge-chang-jian-mian-shi-ti/>linux运维工程师50个常见面试题 2024-08-02 17:42:12.968</a></li><li><a href=/docs/metallb-l2-%E5%8E%9F%E7%90%86-metallbl2-yuan-li/>MetalLB L2 原理 2024-04-03 14:52:24.662</a></li><li><a href=/docs/netctl%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4pod%E9%97%B4%E8%BF%9E%E9%80%9A%E6%80%A7-netctl-jian-ce-ji-qun-pod-jian-lian-tong-xing/>netctl检测集群pod间连通性 2024-08-02 18:00:36.753</a></li><li><a href=/docs/network-check-network-check/>network-check 2023-09-28 15:36:33.04</a></li><li><a href=/docs/nginx%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94-nginx-ru-he-jie-jue-jing-qun-xiao-ying/>nginx如何解决惊群效应 2024-08-02 17:45:54.531</a></li><li><a href=/docs/openkruise%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A%E4%BB%A5%E5%8F%8A%E5%8E%9F%E5%9C%B0%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%85%A8%E9%93%BE%E8%B7%AF%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88-openkruise-xiang-xi-jie-shi-yi-ji-yuan-de-sheng-ji-ji-quan-lian-lu-hui-du-fa-bu-fang-an/>OpenKruise详细解释以及原地升级及全链路灰度发布方案 2024-07-22 11:44:46.892</a></li><li><a href=/docs/pixie-pixie/>pixie 2024-08-02 17:52:17.843</a></li><li><a href=/docs/2025-2-28-prometheus/>prometheus 面试题</a></li><li><a href=/docs/prometheus-stack-prometheus-stack/>prometheus-stack 2024-08-02 17:55:22.326</a></li><li><a href=/docs/prometheus%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93-prometheus-qi-ye-ji-jian-kong-shi-yong-zong-jie/>prometheus企业级监控使用总结 2024-04-03 15:13:11.185</a></li><li><a href=/docs/ssl%E8%AF%81%E4%B9%A6%E8%87%AA%E7%AD%BE%E5%8F%91-ssl-zheng-shu-zi-qian-fa/>ssl证书自签发 2024-04-03</a></li><li><a href=/docs/teg%E4%B8%8Eistio%E9%9B%86%E6%88%90-teg-yu-istio-ji-cheng/>TEG与istio集成 2024-08-02 17:51:20.389</a></li><li><a href=/docs/%E4%B8%A4%E5%BC%A0%E5%9B%BE%E5%85%A8%E9%9D%A2%E7%90%86%E8%A7%A3k8s%E5%8E%9F%E7%90%86-liang-zhang-tu-quan-mian-li-jie-k8s-yuan-li/>两张图全面理解K8S原理 2024-04-03 14:51:27.431</a></li><li><a href=/docs/%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9B%86%E7%BE%A4%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE-ge-xing-hua-ji-qun-can-shu-pei-zhi/>个性化集群参数配置 2023-09-28 15:30:56.072</a></li><li><a href=/docs/2025-2-24-%E4%B8%AD%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_%E9%A2%98%E7%9B%AE/>中级运维面试题</a></li><li><a href=/docs/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2k8s%E5%8A%A0%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C-er-jin-zhi-bu-shu-k8s-jia-jie-dian-cao-zuo/>二进制部署K8S加节点操作 2024-04-03 15:08:26.726</a></li><li><a href=/docs/2024-10-20-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/>使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-keepalived-%E5%92%8C-haproxy-%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8-kubernetes-%E9%9B%86%E7%BE%A4-shi-yong-keepalived-he-haproxy-chuang-jian-gao-ke-yong-kubernetes-ji-qun/>使用 Keepalived 和 HAproxy 创建高可用 Kubernetes 集群 2023-04-12 04:04:09.458</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8-openfunction-%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-shi-yong-openfunction-zai-ren-he-ji-chu-she-shi-shang-yun-xing-wu-fu-wu-qi-gong-zuo-fu-zai/>使用 OpenFunction 在任何基础设施上运行无服务器工作负载 2024-01-21 04:02:44.459</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8cloudflarecf%E6%90%AD%E5%BB%BAdockerhub%E4%BB%A3%E7%90%86-shi-yong-cloudflarecf-da-jian-dockerhub-dai-li/>使用cloudflare(CF)搭建dockerhub代理 2024-06-28 14:38:34.339</a></li><li><a href=/docs/%E4%BD%BF%E7%94%A8kubernees-leases-%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0leader-election-shi-yong-kuberneesleases-qing-song-shi-xian-leaderelection/>使用kubernees leases 轻松实现leader election 2024-04-03 15:09:46.129</a></li><li><a href=/docs/%E5%85%AC%E6%9C%89%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2-kubeasz-gong-you-yun-shang-bu-shu-kubeasz/>公有云上部署 kubeasz 2023-09-28 15:31:16.19</a></li><li><a href=/docs/2024-5-14-%E5%8D%95master%E5%8D%95etcd%E6%94%B9%E9%80%A0/>单master单etcd改造为3master3etcd</a></li><li><a href=/docs/%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%89%9Bjenkins-pipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AF%A6%E8%A7%A3-shi-shang-zui-niu-jenkinspipeline-liu-shui-xian-xiang-jie/>史上最牛jenkins pipeline流水线详解 2024-08-02</a></li><li><a href=/docs/%E5%A4%9A%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81-duo-jia-gou-zhi-chi/>多架构支持 2023-09-28 15:29:54.111</a></li><li><a href=/docs/%E5%A4%A7%E5%8E%82%E6%80%BB%E7%BB%93nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0-da-chang-zong-jie-nginx-gao-bing-fa-you-hua-bi-ji/>大厂总结nginx高并发优化笔记 2024-08-02 17:46:19.098</a></li><li><a href=/docs/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%A6%82%E4%BD%95%E5%8A%A0%E5%BF%AB-pod-%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6-da-gui-mo-bing-fa-xia-ru-he-jia-kuai-pod-qi-dong-su-du/>大规模并发下如何加快 Pod 启动速度 2024-04-03</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%B8%BAk8s%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA-ru-he-wei-k8s-bao-jia-hu-hang/>如何为K8S保驾护航 2024-04-16 17:09:21.962</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8tekton%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcicd%E5%B9%B3%E5%8F%B0-ru-he-shi-yong-tekton-kuai-su-da-jian-cicd-ping-tai/>如何使用tekton快速搭建CI/CD平台 2024-04-03</a></li><li><a href=/docs/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95-crash-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C-ru-he-diao-shi-crash-rong-qi-de-wang-luo/>如何调试 crash 容器的网络 2024-04-03 14:50:51.378</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E4%B8%8D%E5%90%8Cdnspolicy%E5%AF%B9%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D-rong-qi-zhong-yu-ming-jie-xi-yi-ji-bu-tong-dnspolicy-dui-yu-ming-jie-xi-de-ying-xiang/>容器中域名解析以及不同dnspolicy对域名解析的影响 2024-04-03 15:04:09.254</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84-1-%E5%8F%B7%E8%BF%9B%E7%A8%8B-rong-qi-nei-de-1-hao-jin-cheng/>容器内的 1 号进程 2024-04-03 14:46:29.998</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E5%8E%9F%E7%90%86-rong-qi-yuan-li/>容器原理 2024-04-03 14:45:58.422</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80-overlayfs-%E5%8E%9F%E7%90%86-rong-qi-de-wen-jian-xi-tong--yi-overlayfs-yuan-li/>容器的文件系统 OverlayFS 原理 2024-04-03 14:45:26.893</a></li><li><a href=/docs/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86-rong-qi-wang-luo-yuan-li/>容器网络原理 2024-04-03 14:51:51.962</a></li><li><a href=/docs/%E5%B8%B8%E8%A7%81linux%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98-chang-jian-linux-yun-wei-mian-shi-ti/>常见linux运维面试题 2024-08-02 17:42:33.873</a></li><li><a href=/docs/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8-cilium-kai-shi-shi-yong-cilium/>开始使用 cilium 2023-09-28 15:34:49.205</a></li><li><a href=/docs/%E5%BD%BB%E6%82%9F%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C-che-wu-rong-qi-wang-luo/ class=active>彻悟容器网络 2024-04-07 10:30:11.55</a></li><li><a href=/docs/%E5%BF%AB%E9%80%9F%E6%8C%87%E5%8D%97-kuai-su-zhi-nan/>快速指南 2023-09-28 15:28:25.71</a></li><li><a href=/docs/%E6%88%91%E5%8F%AA%E6%83%B3%E5%81%9A%E6%8A%80%E6%9C%AF-%E8%B5%B0%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF-wo-zhi-xiang-zuo-ji-shu-zou-ji-shu-lu-xian/>我只想做技术 走技术路线 2024-08-02 17:43:31.897</a></li><li><a href=/docs/%E6%90%9E%E6%87%82k8s%E9%89%B4%E6%9D%83-gao-dong-k8s-jian-quan/>搞懂K8S鉴权 2024-04-03 15:11:54.885</a></li><li><a href=/docs/%E6%90%AD%E4%B8%AA%E6%97%A5%E5%BF%97%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B8%8D%E9%A6%99%E5%90%97-da-ge-ri-zhi-shou-ji-xi-tong-bu-xiang-ma/>搭个日志手机系统不香吗 2024-08-02 17:47:58.794</a></li><li><a href=/docs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%B4%E6%98%8E-cao-zuo-xi-tong-shuo-ming/>操作系统说明 2023-09-28 15:31:37.694</a></li><li><a href=/docs/%E6%96%87%E5%AD%A6%E7%9A%84%E6%95%85%E4%B9%A1-wen-xue-de-gu-xiang/>文学的故乡 2024-04-03 14:40:45.926</a></li><li><a href=/docs/%E6%98%AF%E6%8A%80%E6%9C%AF%E5%A4%A7%E7%A5%9E%E8%BF%98%E6%98%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E9%83%A8%E7%9A%84%E7%A5%B8%E5%AE%B3-shi-ji-shu-da-shen-hai-shi-ji-chu-jia-gou-bu-de-huo-hai/>是技术大神还是基础架构部的祸害 2024-08-02 17:50:26.139</a></li><li><a href=/docs/%E6%9C%89%E8%BF%993%E4%B8%AA%E8%BF%B9%E8%B1%A1%E4%BD%A0%E5%B0%B1%E8%AF%A5%E7%A6%BB%E8%81%8C%E4%BA%86-you-zhe-3-ge-ji-xiang--ni-jiu-gai-li-zhi-le/>有这3个迹象，你就该离职了 2023-09-21 16:00:22.432</a></li><li><a href=/docs/%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87%E7%9A%84-linux-%E5%91%BD%E4%BB%A4-ji-da-ti-gao-gong-zuo-xiao-lv-de-linux-ming-ling/>极大提高工作效率的 Linux 命令 2024-04-03 14:42:46.957</a></li><li><a href=/docs/%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A9%E5%99%A8buildkit-gou-jian-rong-qi-jing-xiang-li-qi-buildkit/>构建容器镜像利器buildkit 2024-08-02 17:49:14.916</a></li><li><a href=/docs/%E6%B5%81%E9%87%8F%E4%BD%95%E5%A4%84%E6%9D%A5%E4%BD%95%E5%A4%84%E5%8E%BB-liu-liang-he-chu-lai-he-chu-qu/>流量何处来何处去 2024-04-03 14:56:20.089</a></li><li><a href=/docs/%E6%B8%85%E7%90%86docker%E9%95%9C%E5%83%8F-qing-li-docker-jing-xiang/>清理docker镜像 2024-08-02 17:54:48.594</a></li><li><a href=/docs/%E6%B8%85%E7%90%86%E6%AE%8B%E7%95%99%E7%9A%84calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6-qing-li-can-liu-de-calico-wang-luo/>清理残留的calico网络插件 2024-04-03 15:07:38.854</a></li><li><a href=/docs/%E7%A3%81%E7%9B%98%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D-ci-pan-shu-ju-hui-fu/>磁盘数据恢复 2024-04-03 14:59:27.839</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85kubephere-li-xian-an-zhuang-kubephere/>离线安装kubephere 2024-04-03 14:59:59.885</a></li><li><a href=/docs/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4-li-xian-an-zhuang-ji-qun/>离线安装集群 2023-09-28 15:29:14.742</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%92/>美国码农薪酬</a></li><li><a href=/docs/2025-2-7-%E8%AE%A1%E5%88%922/>美国码农计划</a></li><li><a href=/docs/%E8%87%AA%E5%8A%A8%E5%B1%8F%E8%94%BDip%E6%94%BB%E5%87%BB-zi-dong-ping-bi-ip-gong-ji/>自动屏蔽IP攻击 2024-04-03 14:54:11.783</a></li><li><a href=/docs/2025-2-12-%E9%9D%A2%E8%AF%950212/>面试0212</a></li><li><a href=/docs/2025-2-19-%E9%9D%A2%E8%AF%950219/>面试0219</a></li><li><a href=/docs/2025-2-20-%E9%9D%A2%E8%AF%950220/>面试0220</a></li><li><a href=/docs/2025-2-26-%E9%9D%A2%E8%AF%950225/>面试0225</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%950308-mian-shi-0308/>面试0308 2024-04-03 14:57:53.576</a></li><li><a href=/docs/2025-2-11-%E9%9D%A2%E8%AF%950211/>面试2025-02-11</a></li><li><a href=/docs/2025-2-18-%E9%9D%A2%E8%AF%95/>面试2025-0218</a></li><li><a href=/docs/%E9%9D%A2%E8%AF%95%E7%94%A8-golang-%E6%89%8B%E6%92%B8-lru-mian-shi-yong-golang-shou-lu-lru/>面试用 Golang 手撸 LRU 2024-04-03 14:47:00.767</a></li><li><a href=/docs/%E9%A1%B6%E7%BA%A7devops%E5%B7%A5%E5%85%B7%E5%A4%A7%E7%9B%98%E7%82%B9-ding-ji-devops-gong-ju-da-pan-dian/>顶级devops工具大盘点 2024-08-02 17:43:03.661</a></li><li><a href=/docs/2025-2-24-%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E9%A2%98_ai_linux%E9%83%A8%E5%88%86/>高级运维面试题-linux部分</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>彻悟容器网络 2024-04-07 10:30:11.55</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#hybridnet><strong>Hybridnet</strong></a></li><li><a href=#calico><strong>Calico</strong></a></li><li><a href=#bifrost><strong>Bifrost</strong></a></li></ul></li><li></li><li><a href=#heading>****</a></li><li><a href=#heading-1>****</a><ul><li><a href=#网络插件分类><strong>网络插件分类</strong></a></li><li><a href=#网络插件对比><strong>网络插件对比</strong></a></li></ul></li><li><a href=#heading-2>****</a></li></ul><ul><li><ul><li><a href=#整体架构><strong>整体架构</strong></a></li><li><a href=#heading-4>****</a></li><li><a href=#通信路径><strong>通信路径</strong></a></li></ul></li><li><a href=#heading-7>****</a><ul><li><a href=#heading-8>****</a></li><li><a href=#整体架构-1><strong>整体架构</strong></a></li><li><a href=#heading-9>****</a></li><li><a href=#通信路径-1><strong>通信路径</strong></a></li></ul></li><li><a href=#heading-10>****</a><ul><li><a href=#整体架构-2><strong>整体架构</strong></a></li><li><a href=#heading-11>****</a></li><li><a href=#通信路径-2><strong>通信路径</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#背景><strong>背景</strong></a></li><li><a href=#heading-13>****</a></li><li><a href=#现状><strong>现状</strong></a></li></ul></li><li><a href=#heading-14>****</a><ul><li><a href=#背景-1><strong>背景</strong></a></li><li><a href=#heading-15>****</a></li><li><a href=#现状-1><strong>现状</strong></a></li></ul></li><li></li><li><a href=#heading-16>****</a><ul><li><a href=#背景-2><strong>背景</strong></a></li><li><a href=#heading-17>****</a></li><li><a href=#现状-2><strong>现状</strong></a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p><strong>01</strong></p><p><strong>背景</strong></p><p><strong>容器网络为何出现</strong></p><p><strong>在一个汽车发动机的生产车间中，汽车发动机的各个组件会存在一定的顺序进行组装，这就要求有直接关系的组件必须知道下一个组件的具体位置。当一个汽车发动机组装完成后，距离最后成品汽车，还差了很多部件，比如底盘，车身等。此时，需要将发动机发往一个装配中心进行组合安装，这样我们就必须知道装配中心的地理位置。</strong></p><p><strong>这些位置在容器中可以理解为 IP 地址，容器网络便是如此。在上面这个例子里，即描述了容器网络本节点内部互通场景，又描述了跨节点的通信场景。</strong></p><p><strong>随着云计算的发展，应用间通信从物理机网络，虚拟机网络，发展到目前的容器网络。由于容器不同于物理机、虚拟机，容器可以被理解为一个标准的，轻量级的，便携的，独立的集装箱，集装箱之间相互隔离，都使用自己的环境和资源。但随着越来越复杂环境变化，容器在运行中会需要容器间或者容器与集群外部之间的信息传输，这时候容器就要在网络层面拥有一个名字（即 IP 地址），由此容器网络就应运而生。</strong></p><p><strong>再从技术的角度来谈容器网络的由来，首先要从容器本质说起，它是由以下几点来实现的：</strong></p><ul><li><p><strong>cgroup：实现资源的可配额</strong></p></li><li><p><strong>overlay fs：实现文件系统的安全性和便携性</strong></p></li><li><p><strong>namespace：实现资源的隔离性</strong></p></li><li><ul><li><strong>IPC ：System V IPC 和 POSIX 消息队列</strong></li><li><strong>Network：网络设备、网络协议栈、网络端口等</strong></li><li><strong>PID：进程</strong></li><li><strong>Mount：挂载点</strong></li><li><strong>UTS：主机名和域名</strong></li><li><strong>USR：用户和用户组</strong></li></ul></li></ul><p><strong>由于主机与容器、容器与容器间的网络栈并不相通，也没有统一的控制面，导致容器间无法直接的感知。为了解决这个问题，本文中我们要讨论的容器网络出现了，再配合不同的网络虚拟化技术带来了多样化的容器网络方案。</strong></p><p><strong>02</strong></p><p><strong>容器网络的基本要求</strong></p><ul><li><p><strong>IP-per-Pod，每个 Pod 都拥有一个独立 IP 地址，Pod 内所有容器共享一个网络命名空间</strong></p></li><li><p><strong>集群内所有 Pod 都在一个直接连通的扁平网络中，可通过 IP 直接访问</strong></p></li><li><ul><li><strong>所有容器之间无需 NAT 就可以直接互相访问</strong></li><li><strong>所有 Node 和所有容器之间无需 NAT 就可以直接互相访问</strong></li><li><strong>容器自己看到的 IP 跟其他容器看到的一样</strong></li></ul></li><li><p><strong>Service cluster IP 尽可在集群内部访问，外部请求需要通过 NodePort、LoadBalance 或者 Ingress 来访问</strong></p></li></ul><p><strong>02</strong></p><p><strong>网络插件介绍</strong></p><p><em><strong>Aliware</strong></em></p><p><strong>01</strong></p><p><strong>网络插件概述</strong></p><p><strong>容器和该容器所在的宿主机是分隔的两地，如果需要连通就得建立一座桥梁，但由于容器侧还没有名字，就无法建立桥梁，这时候就先需要给容器侧命名，这样才能成功建立起桥梁。网络插件就是起到给容器侧命名和建立桥梁的功能。</strong></p><p><strong>即网络插件将网络接口插入容器网络命名空间（例如，veth 对的一端），并在主机上进行任何必要的改变（例如将 veth 的另一端连接到网桥）。然后通过调用适当的 IPAM 插件（IP 地址管理插件）分配给接口一个空闲的 IP 地址，并设置与此 IP 地址相对应的路由规则。</strong></p><p><strong>对于 K8s 来讲，网络属于最重要的功能之一，因为没有一个良好的网络，集群不同节点之间甚至同一个节点之间的 pod 就无法良好的运行起来。</strong></p><p><strong>但是 K8s 在设计网络的时候，采用的准则就一点：“灵活”！那怎么才能灵活呢？那就是 K8s 自身没有实现太多跟网络相关的操作，而是制定了一个规范：</strong></p><ol><li><strong>有配置文件，能够提供要使用的网络插件名，以及该插件所需信息</strong></li><li><strong>让 CRI 调用这个插件，并把容器的运行时信息，包括容器的命名空间，容器 ID 等信息传给插件</strong></li><li><strong>不关心网络插件内部实现，只需要最后能够输出网络插件提供的 pod IP 即可</strong></li></ol><p><strong>没错一共就这三点，如此简单灵活的规范就是大名鼎鼎的 CNI 规范。</strong></p><p><strong>不过恰恰因为 K8s 自己“啥也不干”，所以大家可以自由发挥，自由实现不同的 CNI 插件，即网络插件。除了社区大名鼎鼎的 Calico、Bifrost 网络插件，阿里也开发了一款功能和性能极优的网络插件 Hybridnet。</strong></p><ul><li><h3 id=hybridnet><strong>Hybridnet</strong>
<a class=anchor href=#hybridnet>#</a></h3></li></ul><p><strong>Hybridnet 是专为混合云设计的开源容器网络解决方案，与 Kubernetes 集成，并被以下 PaaS 平台使用:</strong></p><ul><li><strong>阿里云 ACK 发行版</strong></li><li><strong>阿里云 AECP</strong></li><li><strong>蚂蚁金服 SOFAStack</strong></li></ul><p><strong>Hybridnet 专注于高效的大规模集群、异构基础设施和用户友好性。</strong></p><ul><li><h3 id=calico><strong>Calico</strong>
<a class=anchor href=#calico>#</a></h3></li></ul><p><strong>Calico 是一种广泛采用、久经考验的开源网络和网络安全解决方案，适用于 Kubernetes、虚拟机和裸机工作负载。Calico 为 Cloud Native 应用程序提供两大服务：</strong></p><ul><li><p><strong>工作负载之间的网络连接</strong></p></li><li><p><strong>工作负载之间的网络安全策略</strong></p></li><li><h3 id=bifrost><strong>Bifrost</strong>
<a class=anchor href=#bifrost>#</a></h3></li></ul><p><strong>Bifrost 是一个可为 Kubernetes 启用 L2 网络的开源解决方案，支持以下特性</strong></p><ul><li><strong>Bifrost 中的网络流量可以通过传统设备进行管理和监控</strong></li><li><strong>支持 macvlan 对于 service 流量的访问</strong></li></ul><p><strong>02</strong></p><p><strong>通信路径介绍</strong></p><h2><a class=anchor href=#>#</a></h2><p><strong>Overlay 方案：意味着将不同主机上的容器用同一个虚拟网络连接起来的跨主机网络</strong></p><ul><li><p><strong>VXLAN</strong></p></li><li><ul><li><strong>VXLAN（Virtual eXtensible Local Area Network，虚拟扩展局域网），是由 IETF 定义的 NVO3（Network Virtualization over Layer 3）标准技术之一，采用 L2 over L4（MAC-in-UDP）的报文封装模式，将二层报文用三层协议进行封装，可实现二层网络在三层范围内进行扩展，同时满足数据中心大二层虚拟迁移和多租户的需求</strong></li></ul></li><li><p><strong>IPIP</strong></p></li><li><ul><li><strong>基于 TUN 设备实现 IPIP 隧道，TUN 网络设备能将三层（IP 网络数据包）数据包封装在另外一个三层数据包之中，Linux 原生支持好几种不同的 IPIP 隧道类型，但都依赖于 TUN 网络设备</strong></li></ul></li><li><ul><li><strong>ipip: 普通的 IPIP 隧道，就是在报文的基础上再封装成一个 IPv4 报文</strong></li><li><strong>gre: 通用路由封装（Generic Routing Encapsulation），定义了在任意网络层协议上封装其他网络层协议的机制，所以对于 IPv4 和 IPv6 都适用</strong></li><li><strong>sit: sit 模式主要用于 IPv4 报文封装 IPv6 报文，即 IPv6 over IPv4</strong></li><li><strong>isatap: 站内自动隧道寻址协议（Intra-Site Automatic Tunnel Addressing Protocol），类似于 sit 也是用于 IPv6 的隧道封装</strong></li><li><strong>vti: 即虚拟隧道接口（Virtual Tunnel Interface），是一种 IPsec 隧道技术</strong></li></ul></li><li><ul><li><strong>本文中我们使用的是 ipip 这种普通的 IPIP 隧道</strong></li></ul></li></ul><p><strong>Underlay 方案：由交换机和路由器等设备组成，借助以太网协议、路由协议和 VLAN 协议等驱动的网络。</strong></p><ul><li><p><strong>BGP</strong></p></li><li><ul><li><strong>边界网关协议BGP（Border Gateway Protocol）是一种实现自治系统AS（Autonomous System）之间的路由可达，并选择最佳路由的距离矢量路由协议</strong></li></ul></li><li><p><strong>Vlan</strong></p></li><li><ul><li><strong>VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN在逻辑上划分成多个广播域的通信技术。VLAN内的主机间可以直接通信，而VLAN间不能直接通信，从而将广播报文限制在一个VLAN内</strong></li></ul></li></ul><h2 id=heading>****
<a class=anchor href=#heading>#</a></h2><p><strong>03</strong></p><p><strong>网络插件的原理</strong></p><ul><li><strong>calico 利用 IPIP 等隧道技术或者宿主机间建立 BGP 连接完成容器路由的互相学习解决了跨节点通信的问题。</strong></li><li><strong>hybridnet 利用 vxlan 隧道技术、宿主机间建立 BGP 连接完成容器路由的互相学习或者 ARP 代理来解决跨节点通信的问题。</strong></li><li><strong>bifrost 通过内核 macvlan 模块利用交换机 vlan 的能力来解决容器通信问题</strong></li></ul><h2 id=heading-1>****
<a class=anchor href=#heading-1>#</a></h2><p><strong>04</strong></p><p><strong>网络插件分类及对比</strong></p><ul><li><h3 id=网络插件分类><strong>网络插件分类</strong>
<a class=anchor href=#%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6%e5%88%86%e7%b1%bb>#</a></h3></li></ul><table><thead><tr><th>****</th><th><strong>overlay 方案</strong></th><th><strong>underlay 方案</strong></th></tr></thead><tbody><tr><td><strong>主流方案</strong></td><td><strong>路由或 SDN 方案:Calico IPIP/Calico VXLAN</strong></td><td><strong>Calico BGP/MACVLAN/IPVLAN</strong></td></tr><tr><td><strong>优点</strong></td><td><strong>对物理网络无侵入维护和管理简单</strong></td><td><strong>高性能网络流量可管理、可监控</strong></td></tr><tr><td><strong>缺点</strong></td><td><strong>容器网络难以监控容器访问集群外部通过 Node SNAT，无法精确管理流量</strong></td><td><strong>对现有组网有侵入维护和管理工作量大占用现网 IP 地址，前期需要详细规划</strong></td></tr></tbody></table><ul><li><h3 id=网络插件对比><strong>网络插件对比</strong>
<a class=anchor href=#%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6%e5%af%b9%e6%af%94>#</a></h3></li></ul><table><thead><tr><th>****</th><th><strong>hybridnet</strong></th><th><strong>calico ipip</strong></th><th><strong>calico bgp</strong></th><th><strong>bifrost</strong></th></tr></thead><tbody><tr><td><strong>支持场景</strong></td><td><strong>overlay/underlay</strong></td><td><strong>overlay</strong></td><td><strong>underlay</strong></td><td><strong>underlay</strong></td></tr><tr><td><strong>网络栈</strong></td><td><strong>IPv4/IPv6</strong></td><td><strong>IPv4</strong></td><td><strong>IPv4/IPv6</strong></td><td><strong>IPv4</strong></td></tr><tr><td><strong>通信技术</strong></td><td><strong>vxlan/vlan/bgp</strong></td><td><strong>ipip</strong></td><td><strong>bgp</strong></td><td><strong>macvlan</strong></td></tr><tr><td><strong>通信机制</strong></td><td><strong>隧道通信/二层+三层通信/三层通信</strong></td><td><strong>隧道通信</strong></td><td><strong>三层通信</strong></td><td><strong>二层通信</strong></td></tr><tr><td><strong>容器通信</strong></td><td><strong>veth pair</strong></td><td><strong>veth pair</strong></td><td><strong>veth pair</strong></td><td><strong>macvlan子接口</strong></td></tr><tr><td><strong>是否支持固定IP/固定IP池</strong></td><td><strong>是</strong></td><td><strong>是</strong></td><td><strong>是</strong></td><td><strong>是</strong></td></tr><tr><td><strong>IPPool模式</strong></td><td><strong>block + detail</strong></td><td><strong>block(如1.1.1.0/24)</strong></td><td><strong>block(如1.1.1.0/24)</strong></td><td><strong>detail(如1.1.1.1~1.1.1.9)</strong></td></tr><tr><td><strong>南北向流量出口</strong></td><td><strong>SNAT/podIP</strong></td><td><strong>SNAT</strong></td><td><strong>SNAT/podIP</strong></td><td><strong>podIP</strong></td></tr><tr><td><strong>是否支持网络策略</strong></td><td><strong>是</strong></td><td><strong>是</strong></td><td><strong>是</strong></td><td><strong>商用版支持</strong></td></tr></tbody></table><ul><li><strong>SNAT: 对数据包的源 IP 地址进行转化</strong></li><li><strong>podIP：由 podIP 直接通信</strong></li><li><strong>veth pair：在 Linux 下，可以创建一对 veth pair 的网卡，从一边发送包，另一边就能收到，对于容器流量来说会通过主机侧的 veth pair 网卡进入主机网络栈，即会过主机的 iptables 规则后再由物理网卡发出。</strong></li><li><strong>macvlan子接口：macvlan 子接口和原来的宿主机主接口是完全独立的，可以单独配置 MAC 地址和 IP 地址，对外通信时，容器流量不会进入主机网络栈，既不会过主机的iptables规则，只会经过二层由物理网卡发出。</strong></li></ul><h2 id=heading-2>****
<a class=anchor href=#heading-2>#</a></h2><p><strong>05</strong></p><p><strong>网络插件应用场景</strong></p><p><strong>针对数据中心复杂的网络情况，我们要按需求出发去选择相对应的容器网络方案</strong></p><ul><li><p><strong>希望对数据中心物理网络较少侵入性，可选择使用隧道方案</strong></p></li><li><ul><li><strong>需支持双栈，则可选 hybridnet vxlan 方案</strong></li><li><strong>只支持单栈 IPv4，则可选 calico IPIP，calico vxlan 方案</strong></li></ul></li><li><p><strong>希望数据中心支持并使用 BGP</strong></p></li><li><ul><li><strong>宿主机处于同网段内，则可选 calico BGP 方案（支持双栈）</strong></li><li><strong>宿主机处于不同网段内，则可选 hybridnet bgp 方案（支持双栈）</strong></li></ul></li><li><p><strong>对于业务的高性能和低延迟的追求，出现了 macvlan，ipvlan l2 等方案</strong></p></li><li><p><strong>公有云场景下，可选用 terway 方案，或者其他 ipvlan l3 方案，或者隧道方案</strong></p></li><li><p><strong>也有为了满足全场景而开发的方案，如 hybridnet、multus 等，Multus 一款为支持其他 CNI 能力的开源容器网络插件</strong></p></li></ul><p><strong>本文我们将对 hybridnet vxlan、hybridnet vlan、hybridnet bgp、calico IPIP、calico BGP 和基于 macvlan 改造的 bifrost 进行 pod 数据链路上的详细分析</strong></p><h1 id=heading-3>****
<a class=anchor href=#heading-3>#</a></h1><p><strong>03</strong></p><p><strong>网络插件架构及通信路径</strong></p><p><em><strong>Aliware</strong></em></p><p><strong>01</strong></p><p><strong>Hybridnet</strong></p><h2><a class=anchor href=#>#</a></h2><ul><li><h3 id=整体架构><strong>整体架构</strong>
<a class=anchor href=#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84>#</a></h3></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071021763.png alt=image-20240407102148690></strong></p><ul><li><strong>Hybridnet-daemon：控制每个节点上的数据平面配置，例如 Iptables 规则，策略路由等</strong></li></ul><h3 id=heading-4>****
<a class=anchor href=#heading-4>#</a></h3><ul><li><h3 id=通信路径><strong>通信路径</strong>
<a class=anchor href=#%e9%80%9a%e4%bf%a1%e8%b7%af%e5%be%84>#</a></h3></li></ul><h4 id=1vxlan-模式><strong>1、VXLAN 模式</strong>
<a class=anchor href=#1vxlan-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071022389.png alt=image-20240407102230314></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 39999 路由表，并在 39999 路由表中匹配到 Pod2 的路由规则</strong></li><li><strong>流量从 hybrYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从pod2的eth0->主机侧的hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到39999路由表，并在39999路由表中匹配到 Pod1 的路由规则</strong></li><li><strong>流量从 hybrXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><ul><li><strong>跨节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071022760.png alt=image-20240407102248695></strong></p><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071023980.png alt=image-20240407102302926></strong></p><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071023503.png alt=image-20240407102314449></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 40000 路由表，并在 40000 路由表中匹配到 Pod2 所在网段需要发往 eth0.vxlan20 网卡的路由规则</strong></li><li><strong>eth0.vxlan20 设备的转发表中记录了对端 vtep 的 mac 地址和 remoteip 的对应关系</strong></li><li><strong>流量经过 eth0.vxlan20 网卡，封装一个 UDP 的头部</strong></li><li><strong>经过查询路由，与本机处于同网段，通过 mac 地址查询获取到对端物理网卡的 mac 地址，经由 Node1 eth0 物理网卡发送</strong></li><li><strong>流量从 Node2 eth0 物理网卡进入，并经过 eth0.vxlan20 网卡解封一个 UDP 的头部</strong></li><li><strong>根据 39999 路由表，流量从hybrYYY网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 40000 路由表，并在 40000 路由表中匹配到 Pod1 所在网段需要发往 eth0.vxlan20 网卡的路由规则</strong></li><li><strong>eth0.vxlan20 设备的转发表中记录了对端 vtep 的 mac 地址和 remoteip 的对应关系</strong></li><li><strong>流量经过 eth0.vxlan20 网卡，封装一个 UDP 的头部</strong></li><li><strong>经过查询路由，与本机处于同网段，通过 mac 地址查询获取到对端物理网卡的 mac 地址，经由 Node2 eth0 物理网卡发送</strong></li><li><strong>流量从 Node1 eth0 物理网卡进入，并经过 eth0.vxlan20 网卡解封一个 UDP 的头部</strong></li><li><strong>根据 39999 路由表，流量从 hybrXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><h4 id=heading-5>****
<a class=anchor href=#heading-5>#</a></h4><h4 id=2vlan-模式><strong>2、VLAN 模式</strong>
<a class=anchor href=#2vlan-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071023465.png alt=image-20240407102340409></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 39999 路由表，并在 39999 路由表中匹配到 Pod2 的路由规则</strong></li><li><strong>流量从 hybrYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 39999 路由表，并在 39999 路由表中匹配到 Pod1 的路由规则</strong></li><li><strong>流量从 hybrXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><p><strong>跨节点通信</strong></p><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071023531.png alt=image-20240407102353463></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 10001 路由表，并在 10001 路由表中匹配到 Pod2 相对应的路由规则</strong></li><li><strong>根据路由规则，流量从 eth0.20 网卡所对应的 eth0 物理网卡发出，并发往交换机</strong></li><li><strong>在交换机上匹配到 pod2 的 MAC 地址，所以将流量发往 Node2 所对应的 eth0 物理网卡</strong></li><li><strong>流量被 eth0.20 vlan 网卡接收到，并根据 39999 路由表匹配到的路由，将流量从 hybrYYY 网卡打入 pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 10001 路由表，并在 10001 路由表中匹配到 Pod1 相对应的路由规则</strong></li><li><strong>根据路由规则，流量从 eth0.20 网卡所对应的 eth0 物理网卡发出，并发往交换机</strong></li><li><strong>在交换机上匹配到 pod1 的 MAC 地址，所以将流量发往 Node1 所对应的 eth0 物理网卡</strong></li><li><strong>流量被 eth0.20 vlan 网卡接收到，并根据 39999 路由表匹配到的路由，将流量从 hybrXXX 网卡打入 pod1 容器网络栈，完成回包动作</strong></li></ol><h4 id=heading-6>****
<a class=anchor href=#heading-6>#</a></h4><h4 id=3bgp-模式><strong>3、BGP 模式</strong>
<a class=anchor href=#3bgp-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071024283.png alt=image-20240407102409225></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 39999 路由表，并在 39999 路由表中匹配到 Pod2 的路由规则</strong></li><li><strong>流量从 hybrYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 39999 路由表，并在 39999 路由表中匹配到 Pod1 的路由规则</strong></li><li><strong>流量从 hybrXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><ul><li><strong>跨节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071024549.png alt=image-20240407102422486></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 hybrXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 10001 路由表，并在 10001 路由表中匹配到默认路由</strong></li><li><strong>根据路由，将流量发往 10.0.0.1 所对应的交换机</strong></li><li><strong>在交换机上匹配到 pod2 所对应的特定路由，将流量发往 Node2 eth0 物理网卡</strong></li><li><strong>流量从 hybrYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 hybrYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在主机的策略路由匹配到 10001 路由表，并在 10001 路由表中匹配到默认路由</strong></li><li><strong>根据路由，将流量发往 10.0.0.1 所对应的交换机</strong></li><li><strong>在交换机上匹配到 pod1 所对应的特定路由，将流量发往 Node1 eth0 物理网卡</strong></li><li><strong>流量从 hybrXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><h2 id=heading-7>****
<a class=anchor href=#heading-7>#</a></h2><p><strong>02</strong></p><p><strong>Calico</strong></p><p><strong>基本概念：</strong></p><ul><li><strong>纯三层的数据中心网络方案</strong></li><li><strong>利用 Linux Kernel 使得宿主机实现 vRouter 来负责数据转发</strong></li><li><strong>vRouter 通过 BGP 协议传播路由信息</strong></li><li><strong>基于 iptables 还提供了丰富而灵活的网络策略规则</strong></li></ul><h3 id=heading-8>****
<a class=anchor href=#heading-8>#</a></h3><ul><li><h3 id=整体架构-1><strong>整体架构</strong>
<a class=anchor href=#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84-1>#</a></h3></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071024836.png alt=image-20240407102434774></strong></p><ul><li><strong>Felix：运行在每个容器宿主节点上，主要负责配置路由、ACL 等信息来确保容器的联通状态</strong></li><li><strong>Brid：把 Felix 写入 Kernel 的路由信息分发到 Calico 网络，保证容器间的通信有效性</strong></li><li><strong>etcd：分布式的 Key/Value 存储，负责网络元数据一致性，确保 Calico 网络状态的准确性</strong></li><li><strong>RR：路由反射器，默认 Calico 工作在 node-mesh 模式，所有节点互相连接， node-mesh 模式在小规模部署时工作是没有问题的，当大规模部署时，连接数会非常大，消耗过多资源，利用 BGP RR ，可以避免这种情况的发生，通过一个或者多个 BGP RR 来完成集中式的路由分发，减少对网络资源的消耗以及提高 Calico 工作效率、稳定性</strong></li></ul><h3 id=heading-9>****
<a class=anchor href=#heading-9>#</a></h3><ul><li><h3 id=通信路径-1><strong>通信路径</strong>
<a class=anchor href=#%e9%80%9a%e4%bf%a1%e8%b7%af%e5%be%84-1>#</a></h3></li></ul><h4 id=1ipip-模式><strong>1、IPIP 模式</strong>
<a class=anchor href=#1ipip-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071024731.png alt=image-20240407102446666></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 caliXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在路由表中匹配到 Pod2 的路由规则</strong></li><li><strong>流量从 caliYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 caliYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在路由表中匹配到 Pod1 的路由规则</strong></li><li><strong>流量从 caliXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><ul><li><strong>跨节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071024901.png alt=image-20240407102458841></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><p><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 caliXXX，进入主机网络栈中</strong></p></li><li><ol><li><strong>src: pod1IP</strong></li><li><strong>dst: pod2IP</strong></li></ol></li><li><p><strong>根据目的 IP，流量在路由表中匹配到将流量转发到 tunl0 网卡上的路由规则</strong></p></li><li><ol><li><strong>src: pod1IP</strong></li><li><strong>dst: pod2IP</strong></li></ol></li><li><p><strong>流量从 tunl0 进行 IPIP 封装（即封装一个 IP 头部），通过 eth0 物理网卡发出</strong></p></li><li><ol><li><strong>src: Node1IP</strong></li><li><strong>dst: Node2IP</strong></li></ol></li><li><p><strong>流量从 Node2 的 eth0 网卡进入 Node2 的主机网络栈</strong></p></li><li><ol><li><strong>src: Node1IP</strong></li><li><strong>dst: Node2IP</strong></li></ol></li><li><p><strong>流量进入 tunl0 进行 IPIP 解包</strong></p></li><li><ol><li><strong>src: pod1IP</strong></li><li><strong>dst: pod2IP</strong></li></ol></li><li><p><strong>流量从 caliYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></p></li><li><ol><li><strong>src: pod1IP</strong></li><li><strong>dst: pod2IP</strong></li></ol></li></ol><p><strong>回包过程：</strong></p><ol><li><p><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 caliYYY，进入主机网络栈中</strong></p></li><li><ol><li><strong>src: pod2IP</strong></li><li><strong>dst: pod1IP</strong></li></ol></li><li><p><strong>根据目的 IP，流量在路由表中匹配到将流量转发到 tunl0 网卡上的路由规则</strong></p></li><li><ol><li><strong>src: pod2IP</strong></li><li><strong>dst: pod1IP</strong></li></ol></li><li><p><strong>流量从 tunl0 进行 IPIP 封装（即封装一个 IP 头部），通过 eth0 物理网卡发出</strong></p></li><li><ol><li><strong>src: Node2IP</strong></li><li><strong>dst: Node1IP</strong></li></ol></li><li><p><strong>流量从 Node1 的 eth0 网卡进入 Node1 的主机网络栈</strong></p></li><li><ol><li><strong>src: Node2IP</strong></li><li><strong>dst: Node1IP</strong></li></ol></li><li><p><strong>流量进入 tunl0 进行 IPIP 解包</strong></p></li><li><ol><li><strong>src: pod2IP</strong></li><li><strong>dst: pod1IP</strong></li></ol></li><li><p><strong>流量从 caliXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></p></li><li><ol><li><strong>src: pod2IP</strong></li><li><strong>dst: pod1IP</strong></li></ol></li></ol><h4 id=2bgp-模式><strong>2、BGP 模式</strong>
<a class=anchor href=#2bgp-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071025613.png alt=image-20240407102512554></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 caliXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在路由表中匹配到 Pod2 的路由规则</strong></li><li><strong>流量从 caliYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><p><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 caliYYY，进入主机网络栈中</strong></p></li><li><p><strong>根据目的 IP，流量在路由表中匹配到 Pod1 的路由规则</strong></p></li><li><p><strong>流量从 caliXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></p></li></ol><ul><li><strong>跨节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071025502.png alt=image-20240407102523444></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 veth-pair 网卡，即从 pod1 的 eth0->主机侧的 caliXXX，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在路由表中匹配到 Pod2 相对应网段的路由规则，并从 Node1 eth0 物理网卡发出</strong></li><li><strong>流量从 Node2 eth0 物理网卡进入，并从 caliYYY 网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 veth-pair 网卡，即从 pod2 的 eth0->主机侧的 caliYYY，进入主机网络栈中</strong></li><li><strong>根据目的 IP，流量在路由表中匹配到 Pod1 相对应网段的路由规则，并从 Node2 eth0 物理网卡发出</strong></li><li><strong>流量从 Node1 eth0 物理网卡进入，并从 caliXXX 网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><h2 id=heading-10>****
<a class=anchor href=#heading-10>#</a></h2><p><strong>03</strong></p><p><strong>Bifrost</strong></p><ul><li><h3 id=整体架构-2><strong>整体架构</strong>
<a class=anchor href=#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84-2>#</a></h3></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071025767.png alt=image-20240407102540707></strong></p><ul><li><strong>veth0-bifrXXX：bifrost 对于 macvlan 实现 service 访问的一套解决方案，通过 veth-pair 网卡完成在主机网络栈中的 kube-proxy + iptables 对于服务流量转化为对 pod 的访问</strong></li><li><strong>eth0：容器内的 eth0 网卡为主机 vlan 子网卡对应的 macvlan 网卡</strong></li></ul><h3 id=heading-11>****
<a class=anchor href=#heading-11>#</a></h3><ul><li><h3 id=通信路径-2><strong>通信路径</strong>
<a class=anchor href=#%e9%80%9a%e4%bf%a1%e8%b7%af%e5%be%84-2>#</a></h3></li></ul><h4 id=1macvlan-模式><strong>1、MACVLAN 模式</strong>
<a class=anchor href=#1macvlan-%e6%a8%a1%e5%bc%8f>#</a></h4><ul><li><strong>同节点同 vlan 通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071025587.png alt=image-20240407102552523></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 macvlan 网卡，即 pod1 的 eth0 走二层网络进入 eth0-10 vlan 子网卡</strong></li><li><strong>由于 macvlan 开启 bridge 模式，能够匹配到 pod2 的 MAC 地址</strong></li><li><strong>流量从 eth0-10 vlan 子网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 macvlan 网卡，即 pod2 的 eth0 走二层网络进入 eth0-10 vlan 子网卡</strong></li><li><strong>由于 macvlan 开启 bridge 模式，能够匹配到 pod1 的 MAC 地址</strong></li><li><strong>流量从 eth0-10 vlan 子网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><hr><hr><ul><li><strong>同节点跨 vlan 通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071026043.png alt=image-20240407102605973></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 macvlan 网卡，即 pod1 的 eth0 走默认路由（网关为 5.0.0.1）进入 eth0-5 vlan 子网卡</strong></li><li><strong>由于在 eth0-5 上找到网关 5.0.0.1 的 MAC 地址，所以将流量从 eth0 物理网卡出打到交换机上</strong></li><li><strong>流量在交换机上匹配到了 pod2 的 MAC 地址</strong></li><li><strong>流量进入 Pod2 所在宿主机的物理网卡，并进入相对应的 eth0-10 vlan 子网卡</strong></li><li><strong>流量从 eth0-10 vlan 子网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 macvlan 网卡，即 pod2 的 eth0 走默认路由（网关为 10.0.0.1）进入 eth0-10 vlan 子网卡</strong></li><li><strong>由于在 eth0-10 上找到网关 10.0.0.1 的 MAC 地址，所以将流量从 eth0 物理网卡出打到交换机上</strong></li><li><strong>流量在交换机上匹配到了 pod1 的 MAC 地址</strong></li><li><strong>流量进入 Pod1 所在宿主机的物理网卡，并进入相对应的 eth0-5 vlan 子网卡</strong></li><li><strong>流量从 eth0-5 vlan 子网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><ul><li><strong>跨节点通信</strong></li></ul><p><strong><img src=https://picture-base.oss-cn-hangzhou.aliyuncs.com/picture/202404071026339.png alt=image-20240407102617281></strong></p><p><strong>Pod1 访问 Pod2 的通信过程</strong></p><p><strong>发包过程：</strong></p><ol><li><strong>Pod1 流量通过 macvlan 网卡，即 pod1 的 eth0 走默认路由（网关为 5.0.0.1）进入 eth0-5 vlan 子网卡</strong></li><li><strong>由于在 eth0-5 上找到网关 5.0.0.1 的 MAC 地址，所以将流量从 eth0 物理网卡出打到交换机上</strong></li><li><strong>流量在交换机上匹配到了 pod2 的 MAC 地址</strong></li><li><strong>流量进入 Pod2 所在宿主机的物理网卡，并进入相对应的 eth0-10 vlan 子网卡</strong></li><li><strong>流量从 eth0-10 vlan 子网卡进入 Pod2 容器网络栈，完成发包动作</strong></li></ol><p><strong>回包过程：</strong></p><ol><li><strong>Pod2 流量通过 macvlan 网卡，即 pod2 的 eth0 走默认路由（网关为 10.0.0.1）进入 eth0-10 vlan 子网卡</strong></li><li><strong>由于在 eth0-10 上找到网关 10.0.0.1 的 MAC 地址，所以将流量从 eth0 物理网卡出打到交换机上</strong></li><li><strong>流量在交换机上匹配到了 pod1 的 MAC 地址</strong></li><li><strong>流量进入 Pod1 所在宿主机的物理网卡，并进入相对应的 eth0-5 vlan 子网卡</strong></li><li><strong>流量从 eth0-5 vlan 子网卡进入 Pod1 容器网络栈，完成回包动作</strong></li></ol><h1 id=heading-12>****
<a class=anchor href=#heading-12>#</a></h1><p><strong>04</strong></p><p><strong>面临的问题及未来发展</strong></p><p><em><strong>Aliware</strong></em></p><p><strong>01</strong></p><p><strong>IPv4/IPv6 双栈</strong></p><h2><a class=anchor href=#>#</a></h2><ul><li><h3 id=背景><strong>背景</strong>
<a class=anchor href=#%e8%83%8c%e6%99%af>#</a></h3></li></ul><p><strong>IP 作为互联网最基础的要素，是为计算机网络相互连接进行通信而设计的协议，正是因为有了 IP 协议，因特网才得以迅速发展成为世界上最大的、开放的计算机通信网络。IP 协议随着互联网的发展，产生了 IPv4 和 IPv6 两种协议：</strong></p><ul><li><p><strong>IPv4</strong></p></li><li><ul><li><strong>IPv4 是互联网协议第四版，是计算机网络使用的数据报传输机制，此协议是第一个被广泛部署的 IP 协议。每一个连接 Internet 的设备（不管是交换机、PC 还是其他设备），都会为其分配一个唯一的 IP 地址，如 192.149.252.76，如下图所示，IPv4 使用 32 位（4 字节）地址，大约可以存储 43 亿个地址，但随着越来越多的用户接入到 Internet，全球 IPv4 地址已于 2019 年 11 月已全数耗尽。这也是后续互联网工程任务组（IEIF）提出 IPv6 的原因之一。</strong></li></ul></li><li><p><strong>IPv6</strong></p></li><li><ul><li><strong>IPv6 是由 IEIF 提出的互联网协议第六版，用来替代 IPv4 的下一代协议，它的提出不仅解决了网络地址资源匮乏问题，也解决了多种接入设备接入互联网的障碍。IPv6 的地址长度为 128 位，可支持 340 多万亿个地址。如下图，3ffe:1900:fe21:4545:0000:0000:0000:0000，这是一个 IPv6 地址，IPv6 地址通常分为 8 组，4 个十六进制数为一组，每组之间用冒号分隔。</strong></li></ul></li></ul><p><strong>IPv4 占主流，IPv6 还未兴起时，主要面临的问题：</strong></p><ol><li><strong>IPv4 地址数量已经不再满足需求，需要 IPv6 地址进行扩展</strong></li><li><strong>随着国内下一代互联网发展政策的明确，客户数据中心需要使用 IPv6 来符合更严格的监管</strong></li></ol><h3 id=heading-13>****
<a class=anchor href=#heading-13>#</a></h3><ul><li><h3 id=现状><strong>现状</strong>
<a class=anchor href=#%e7%8e%b0%e7%8a%b6>#</a></h3></li></ul><table><thead><tr><th>****</th><th><strong>hybridnet</strong></th><th><strong>calico IPIP</strong></th><th><strong>calico BGP</strong></th><th><strong>bifrost</strong></th></tr></thead><tbody><tr><td><strong>是否支持IPv6/双栈</strong></td><td><strong>是</strong></td><td><strong>否</strong></td><td><strong>是</strong></td><td><strong>否</strong></td></tr></tbody></table><p><strong>calico IPIP 不支持 IPv6 的原因:</strong></p><ul><li><strong>ipip 是普通的 IPIP 隧道，就是在报文的基础上再封装成一个 IPv4 报文，所以不支持 IPv6 的封包</strong></li></ul><h2 id=heading-14>****
<a class=anchor href=#heading-14>#</a></h2><p><strong>02</strong></p><p><strong>多网卡（多通信机制）</strong></p><ul><li><h3 id=背景-1><strong>背景</strong>
<a class=anchor href=#%e8%83%8c%e6%99%af-1>#</a></h3></li></ul><p><strong>通常情况下在 K8s 中，一个 Pod 只有一个接口，即单网卡，用于集群网络中 pod 和 pod 通信。而 Pod 需要和异构网络进行通信时，可选择在 Pod 中建立多个接口，即多网卡。</strong></p><p><strong>目前的问题：</strong></p><ol><li><strong>部分客户真实 IP 资源紧张，导致无法全部使用 underlay 方案</strong></li><li><strong>客户希望把 UDP 网络和 TCP 网络分开，导致如基于 TCP 协议的网络模型无法独立存在于 UDP 网络中</strong></li></ol><h3 id=heading-15>****
<a class=anchor href=#heading-15>#</a></h3><ul><li><h3 id=现状-1><strong>现状</strong>
<a class=anchor href=#%e7%8e%b0%e7%8a%b6-1>#</a></h3></li></ul><p><strong>目前实现多网卡的方案，大致两种：</strong></p><ul><li><strong>在单一 CNI 调用 IPAM 时，通过 CNI config 配置生成相对应的网卡并分配合适的 IP 资源</strong></li><li><strong>通过元 CNI 依次调用各个 CNI 来完成相对应的网卡并分配合适的 IP 资源，如 multus 方案</strong></li></ul><h2><a class=anchor href=#>#</a></h2><h2 id=heading-16>****
<a class=anchor href=#heading-16>#</a></h2><p><strong>03</strong></p><p><strong>网络流量管控</strong></p><ul><li><h3 id=背景-2><strong>背景</strong>
<a class=anchor href=#%e8%83%8c%e6%99%af-2>#</a></h3></li></ul><p><strong>通常在数据中心中，我们将其网络流量分为两种类型，一种是数据中心外部用户和内部服务器之间交互的流量，这样的流量称作南北向流量或者纵向流量；另外一种就是数据中心内部服务器之间交互的流量，也叫东西向流量或者横向流量。</strong></p><p><strong>那么在容器云范畴内，我们将东西向流量定义为集群内宿主机和容器、容器间或宿主机间的流量，南北向流量为容器云外部与容器云内部之间交互的流量。</strong></p><p><strong>目前的问题：</strong></p><ol><li><strong>传统防火墙在容器云的东西向场景下，难以起到流量管控，需要提供服务间或容器间流量管控的能力</strong></li></ol><h3 id=heading-17>****
<a class=anchor href=#heading-17>#</a></h3><ul><li><h3 id=现状-2><strong>现状</strong>
<a class=anchor href=#%e7%8e%b0%e7%8a%b6-2>#</a></h3></li></ul><table><thead><tr><th>****</th><th><strong>calico</strong></th><th><strong>cillum</strong></th><th><strong>bifrost-商用版</strong></th></tr></thead><tbody><tr><td><strong>技术基础</strong></td><td><strong>iptables</strong></td><td><strong>ebpf</strong></td><td><strong>ebpf</strong></td></tr><tr><td><strong>适配性</strong></td><td><strong>三层路由且流量经过主机网络栈</strong></td><td><strong>二层且满足cillum通信方式</strong></td><td><strong>主流CNI插件</strong></td></tr></tbody></table><h1 id=heading-18>****
<a class=anchor href=#heading-18>#</a></h1><h1 id=参考资料><em><strong>参考资料</strong></em>
<a class=anchor href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99>#</a></h1><p><em><strong>1、calico vxlan ipv4 overlay组网跨主机通信分析</strong></em></p><p><em><strong><a href=https://www.jianshu.com/p/5edd6982e3be>https://www.jianshu.com/p/5edd6982e3be</a></strong></em></p><p><em><strong>2、Qunar容器平台网络之道：Calico</strong></em></p><p><em><strong><a href=http://dockone.io/article/2434328>http://dockone.io/article/2434328</a></strong></em></p><p><em><strong>3、最好的vxlan介绍</strong></em></p><p><em><strong><a href=https://www.jianshu.com/p/cccfb481d548>https://www.jianshu.com/p/cccfb481d548</a></strong></em></p><p><em><strong>4、揭秘 IPIP 隧道</strong></em></p><p><em><strong><a href=https://morven.life/posts/networking-3-ipip/>https://morven.life/posts/networking-3-ipip/</a></strong></em></p><p><em><strong>5、BGP基础知识</strong></em></p><p><em><strong><a href=https://blog.csdn.net/qq_38265137/article/details/80439561>https://blog.csdn.net/qq_38265137/article/details/80439561</a></strong></em></p><p><em><strong>6、VLAN基础知识</strong></em></p><p><em><strong><a href=https://cshihong.github.io/2017/11/05/VLAN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>https://cshihong.github.io/2017/11/05/VLAN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</a></strong></em></p><p><em><strong>7、Overlay和Underlay网络协议区别及概述讲解</strong></em></p><p><em><strong><a href=https://www.cnblogs.com/fengdejiyixx/p/15567609.html#%E4%BA%8Cunderlay%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>https://www.cnblogs.com/fengdejiyixx/p/15567609.html#%E4%BA%8Cunderlay%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B</a></strong></em></p><p><em><strong>8、东西向流量牵引方案小结</strong></em></p><p><em><strong><a href=http://blog.nsfocus.net/east-west-flow-sum/>http://blog.nsfocus.net/east-west-flow-sum/</a></strong></em></p><p><em><strong>9、容器网络接口（CNI）</strong></em></p><p><em><strong><a href=https://jimmysong.io/kubernetes-handbook/concepts/cni.html>https://jimmysong.io/kubernetes-handbook/concepts/cni.html</a></strong></em></p><p><em><strong>10、K8s 网络之深入理解 CNI</strong></em></p><p><em><strong><a href=https://zhuanlan.zhihu.com/p/450140876>https://zhuanlan.zhihu.com/p/450140876</a></strong></em></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#hybridnet><strong>Hybridnet</strong></a></li><li><a href=#calico><strong>Calico</strong></a></li><li><a href=#bifrost><strong>Bifrost</strong></a></li></ul></li><li></li><li><a href=#heading>****</a></li><li><a href=#heading-1>****</a><ul><li><a href=#网络插件分类><strong>网络插件分类</strong></a></li><li><a href=#网络插件对比><strong>网络插件对比</strong></a></li></ul></li><li><a href=#heading-2>****</a></li></ul><ul><li><ul><li><a href=#整体架构><strong>整体架构</strong></a></li><li><a href=#heading-4>****</a></li><li><a href=#通信路径><strong>通信路径</strong></a></li></ul></li><li><a href=#heading-7>****</a><ul><li><a href=#heading-8>****</a></li><li><a href=#整体架构-1><strong>整体架构</strong></a></li><li><a href=#heading-9>****</a></li><li><a href=#通信路径-1><strong>通信路径</strong></a></li></ul></li><li><a href=#heading-10>****</a><ul><li><a href=#整体架构-2><strong>整体架构</strong></a></li><li><a href=#heading-11>****</a></li><li><a href=#通信路径-2><strong>通信路径</strong></a></li></ul></li></ul><ul><li><ul><li><a href=#背景><strong>背景</strong></a></li><li><a href=#heading-13>****</a></li><li><a href=#现状><strong>现状</strong></a></li></ul></li><li><a href=#heading-14>****</a><ul><li><a href=#背景-1><strong>背景</strong></a></li><li><a href=#heading-15>****</a></li><li><a href=#现状-1><strong>现状</strong></a></li></ul></li><li></li><li><a href=#heading-16>****</a><ul><li><a href=#背景-2><strong>背景</strong></a></li><li><a href=#heading-17>****</a></li><li><a href=#现状-2><strong>现状</strong></a></li></ul></li></ul></nav></div></aside></main></body></html>